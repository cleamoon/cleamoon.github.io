<!DOCTYPE html><html lang="en"><head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">






  

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.yj0.se","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.22.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/./public/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script>



<link rel="canonical" href="http://blog.yj0.se/2021/posix_threads_programming_note/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://blog.yj0.se/2021/posix_threads_programming_note/","path":"2021/posix_threads_programming_note/","title":"Introduction to Posix Threads Programming"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Introduction to Posix Threads Programming | Yue Jiao's blog</title>
  








  <style>:root {
  --body-bg-color: #eee;
  --content-bg-color: #fff;
  --card-bg-color: #f5f5f5;
  --text-color: #555;
  --selection-bg: #262a30;
  --selection-color: #eee;
  --blockquote-color: #666;
  --link-color: #555;
  --link-hover-color: #222;
  --brand-color: #fff;
  --brand-hover-color: #fff;
  --table-row-odd-bg-color: #f9f9f9;
  --table-row-hover-bg-color: #f5f5f5;
  --menu-item-bg-color: #f5f5f5;
  --theme-color: #222;
  --btn-default-bg: #fff;
  --btn-default-color: #555;
  --btn-default-border-color: #555;
  --btn-default-hover-bg: #222;
  --btn-default-hover-color: #fff;
  --btn-default-hover-border-color: #222;
  --highlight-background: #f0f0f0;
  --highlight-foreground: #444;
  --highlight-gutter-background: #dedede;
  --highlight-gutter-foreground: #555;
  color-scheme: light;
}
html {
  line-height: 1.15; /* 1 */
  -webkit-text-size-adjust: 100%; /* 2 */
}
body {
  margin: 0;
}
main {
  display: block;
}
h1 {
  font-size: 2em;
  margin: 0.67em 0;
}
hr {
  box-sizing: content-box; /* 1 */
  height: 0; /* 1 */
  overflow: visible; /* 2 */
}
pre {
  font-family: monospace, monospace; /* 1 */
  font-size: 1em; /* 2 */
}
a {
  background: transparent;
}
abbr[title] {
  border-bottom: none; /* 1 */
  text-decoration: underline; /* 2 */
  text-decoration: underline dotted; /* 2 */
}
b,
strong {
  font-weight: bolder;
}
code,
kbd,
samp {
  font-family: monospace, monospace; /* 1 */
  font-size: 1em; /* 2 */
}
small {
  font-size: 80%;
}
sub,
sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}
sub {
  bottom: -0.25em;
}
sup {
  top: -0.5em;
}
img {
  border-style: none;
}
button,
input,
optgroup,
select,
textarea {
  font-family: inherit; /* 1 */
  font-size: 100%; /* 1 */
  line-height: 1.15; /* 1 */
  margin: 0; /* 2 */
}
button,
input {
/* 1 */
  overflow: visible;
}
button,
select {
/* 1 */
  text-transform: none;
}
button,
[type='button'],
[type='reset'],
[type='submit'] {
  -webkit-appearance: button;
}
button::-moz-focus-inner,
[type='button']::-moz-focus-inner,
[type='reset']::-moz-focus-inner,
[type='submit']::-moz-focus-inner {
  border-style: none;
  padding: 0;
}
button:-moz-focusring,
[type='button']:-moz-focusring,
[type='reset']:-moz-focusring,
[type='submit']:-moz-focusring {
  outline: 1px dotted ButtonText;
}
fieldset {
  padding: 0.35em 0.75em 0.625em;
}
legend {
  box-sizing: border-box; /* 1 */
  color: inherit; /* 2 */
  display: table; /* 1 */
  max-width: 100%; /* 1 */
  padding: 0; /* 3 */
  white-space: normal; /* 1 */
}
progress {
  vertical-align: baseline;
}
textarea {
  overflow: auto;
}
[type='checkbox'],
[type='radio'] {
  box-sizing: border-box; /* 1 */
  padding: 0; /* 2 */
}
[type='number']::-webkit-inner-spin-button,
[type='number']::-webkit-outer-spin-button {
  height: auto;
}
[type='search'] {
  outline-offset: -2px; /* 2 */
  -webkit-appearance: textfield; /* 1 */
}
[type='search']::-webkit-search-decoration {
  -webkit-appearance: none;
}
::-webkit-file-upload-button {
  font: inherit; /* 2 */
  -webkit-appearance: button; /* 1 */
}
details {
  display: block;
}
summary {
  display: list-item;
}
template {
  display: none;
}
[hidden] {
  display: none;
}
::selection {
  background: var(--selection-bg);
  color: var(--selection-color);
}
html,
body {
  height: 100%;
}
body {
  background: var(--body-bg-color);
  box-sizing: border-box;
  color: var(--text-color);
  font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;
  font-size: 1em;
  line-height: 2;
  min-height: 100%;
  position: relative;
  transition: padding 0.2s ease-in-out;
}
h1,
h2,
h3,
h4,
h5,
h6 {
  font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;
  font-weight: bold;
  line-height: 1.5;
  margin: 30px 0 15px;
}
h1 {
  font-size: 1.5em;
}
h2 {
  font-size: 1.375em;
}
h3 {
  font-size: 1.25em;
}
h4 {
  font-size: 1.125em;
}
h5 {
  font-size: 1em;
}
h6 {
  font-size: 0.875em;
}
p {
  margin: 0 0 20px;
}
a {
  border-bottom: 1px solid #999;
  color: var(--link-color);
  cursor: pointer;
  outline: 0;
  text-decoration: none;
  overflow-wrap: break-word;
}
a:hover {
  border-bottom-color: var(--link-hover-color);
  color: var(--link-hover-color);
}
iframe,
img,
video,
embed {
  display: block;
  margin-left: auto;
  margin-right: auto;
  max-width: 100%;
}
hr {
  background-image: repeating-linear-gradient(-45deg, #ddd, #ddd 4px, transparent 4px, transparent 8px);
  border: 0;
  height: 3px;
  margin: 40px 0;
}
blockquote {
  border-left: 4px solid #ddd;
  color: var(--blockquote-color);
  margin: 0;
  padding: 0 15px;
}
blockquote cite::before {
  content: '-';
  padding: 0 5px;
}
dt {
  font-weight: bold;
}
dd {
  margin: 0;
  padding: 0;
}
.table-container {
  overflow: auto;
}
table {
  border-collapse: collapse;
  border-spacing: 0;
  font-size: 0.875em;
  margin: 0 0 20px;
  width: 100%;
}
tbody tr:nth-of-type(odd) {
  background: var(--table-row-odd-bg-color);
}
tbody tr:hover {
  background: var(--table-row-hover-bg-color);
}
caption,
th,
td {
  padding: 8px;
}
th,
td {
  border: 1px solid #ddd;
  border-bottom: 3px solid #ddd;
}
th {
  font-weight: 700;
  padding-bottom: 10px;
}
td {
  border-bottom-width: 1px;
}
.btn {
  background: var(--btn-default-bg);
  border: 2px solid var(--btn-default-border-color);
  border-radius: 2px;
  color: var(--btn-default-color);
  display: inline-block;
  font-size: 0.875em;
  line-height: 2;
  padding: 0 20px;
  transition: background-color 0.2s ease-in-out;
}
.btn:hover {
  background: var(--btn-default-hover-bg);
  border-color: var(--btn-default-hover-border-color);
  color: var(--btn-default-hover-color);
}
.btn + .btn {
  margin: 0 0 8px 8px;
}
.btn .fa-fw {
  text-align: left;
  width: 1.285714285714286em;
}
.toggle {
  line-height: 0;
}
.toggle .toggle-line {
  background: #fff;
  display: block;
  height: 2px;
  left: 0;
  position: relative;
  top: 0;
  transition: 0.4s;
  transition-property: left, opacity, top, transform, width;
  width: 100%;
}
.toggle .toggle-line:first-child {
  margin-top: 1px;
}
.toggle .toggle-line:not(:first-child) {
  margin-top: 4px;
}
.toggle.toggle-arrow :first-child {
  left: 50%;
  top: 2px;
  transform: rotate(45deg);
  width: 50%;
}
.toggle.toggle-arrow :last-child {
  left: 50%;
  top: -2px;
  transform: rotate(-45deg);
  width: 50%;
}
.toggle.toggle-close :nth-child(2) {
  opacity: 0;
}
.toggle.toggle-close :first-child {
  top: 6px;
  transform: rotate(45deg);
}
.toggle.toggle-close :last-child {
  top: -6px;
  transform: rotate(-45deg);
}
/*

Original highlight.js style (c) Ivan Sagalaev <maniac@softwaremaniacs.org>

*/

.hljs {
  display: block;
  overflow-x: auto;
  padding: 0.5em;
  background: #F0F0F0;
}


/* Base color: saturation 0; */

.hljs,
.hljs-subst {
  color: #444;
}

.hljs-comment {
  color: #888888;
}

.hljs-keyword,
.hljs-attribute,
.hljs-selector-tag,
.hljs-meta-keyword,
.hljs-doctag,
.hljs-name {
  font-weight: bold;
}


/* User color: hue: 0 */

.hljs-type,
.hljs-string,
.hljs-number,
.hljs-selector-id,
.hljs-selector-class,
.hljs-quote,
.hljs-template-tag,
.hljs-deletion {
  color: #880000;
}

.hljs-title,
.hljs-section {
  color: #880000;
  font-weight: bold;
}

.hljs-regexp,
.hljs-symbol,
.hljs-variable,
.hljs-template-variable,
.hljs-link,
.hljs-selector-attr,
.hljs-selector-pseudo {
  color: #BC6060;
}


/* Language color: hue: 90; */

.hljs-literal {
  color: #78A960;
}

.hljs-built_in,
.hljs-bullet,
.hljs-code,
.hljs-addition {
  color: #397300;
}


/* Meta color: hue: 200 */

.hljs-meta {
  color: #1f7199;
}

.hljs-meta-string {
  color: #4d99bf;
}


/* Misc effects */

.hljs-emphasis {
  font-style: italic;
}

.hljs-strong {
  font-weight: bold;
}

code,
kbd,
figure.highlight,
pre {
  background: var(--highlight-background);
  color: var(--highlight-foreground);
}
figure.highlight,
pre {
  line-height: 1.6;
  margin: 0 auto 20px;
}
figure.highlight figcaption,
pre .caption {
  background: var(--highlight-gutter-background);
  color: var(--highlight-foreground);
  display: flow-root;
  font-size: 0.875em;
  line-height: 1.2;
  padding: 0.5em;
}
figure.highlight figcaption a,
pre .caption a {
  color: var(--highlight-foreground);
  float: right;
}
figure.highlight figcaption a:hover,
pre .caption a:hover {
  border-bottom-color: var(--highlight-foreground);
}
pre,
code {
  font-family: consolas, Menlo, monospace, 'PingFang SC', 'Microsoft YaHei';
}
code {
  border-radius: 3px;
  font-size: 0.875em;
  padding: 2px 4px;
  overflow-wrap: break-word;
}
kbd {
  border: 2px solid #ccc;
  border-radius: 0.2em;
  box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1);
  font-family: inherit;
  padding: 0.1em 0.3em;
  white-space: nowrap;
}
figure.highlight {
  overflow: auto;
  position: relative;
}
figure.highlight pre {
  border: 0;
  margin: 0;
  padding: 10px 0;
}
figure.highlight table {
  border: 0;
  margin: 0;
  width: auto;
}
figure.highlight td {
  border: 0;
  padding: 0;
}
figure.highlight .gutter {
  -webkit-user-select: none;
  user-select: none;
}
figure.highlight .gutter pre {
  background: var(--highlight-gutter-background);
  color: var(--highlight-gutter-foreground);
  padding-left: 10px;
  padding-right: 10px;
  text-align: right;
}
figure.highlight .code pre {
  padding-left: 10px;
  width: 100%;
}
figure.highlight .marked {
  background: rgba(0,0,0,0.3);
}
pre .caption {
  margin-bottom: 10px;
}
.gist table {
  width: auto;
}
.gist table td {
  border: 0;
}
pre {
  overflow: auto;
  padding: 10px;
}
pre code {
  background: none;
  padding: 0;
  text-shadow: none;
}
.blockquote-center {
  border-left: 0;
  margin: 40px 0;
  padding: 0;
  position: relative;
  text-align: center;
}
.blockquote-center::before,
.blockquote-center::after {
  left: 0;
  line-height: 1;
  opacity: 0.6;
  position: absolute;
  width: 100%;
}
.blockquote-center::before {
  border-top: 1px solid #ccc;
  text-align: left;
  top: -20px;
  content: '\f10d';
  font-family: 'Font Awesome 6 Free';
  font-weight: 900;
}
.blockquote-center::after {
  border-bottom: 1px solid #ccc;
  bottom: -20px;
  text-align: right;
  content: '\f10e';
  font-family: 'Font Awesome 6 Free';
  font-weight: 900;
}
.blockquote-center p,
.blockquote-center div {
  text-align: center;
}
.group-picture {
  margin-bottom: 20px;
}
.group-picture .group-picture-row {
  display: flex;
  gap: 3px;
  margin-bottom: 3px;
}
.group-picture .group-picture-column {
  flex: 1;
}
.group-picture .group-picture-column img {
  height: 100%;
  margin: 0;
  object-fit: cover;
  width: 100%;
}
.post-body .label {
  color: #555;
  padding: 0 2px;
}
.post-body .label.default {
  background: #f0f0f0;
}
.post-body .label.primary {
  background: #efe6f7;
}
.post-body .label.info {
  background: #e5f2f8;
}
.post-body .label.success {
  background: #e7f4e9;
}
.post-body .label.warning {
  background: #fcf6e1;
}
.post-body .label.danger {
  background: #fae8eb;
}
.post-body .link-grid {
  display: grid;
  grid-gap: 1.5rem;
  gap: 1.5rem;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  margin-bottom: 20px;
  padding: 1rem;
}
.post-body .link-grid .link-grid-container {
  border: solid #ddd;
  box-shadow: 1rem 1rem 0.5rem rgba(0,0,0,0.5);
  min-height: 5rem;
  min-width: 0;
  padding: 0.5rem;
  position: relative;
  transition: background 0.3s;
}
.post-body .link-grid .link-grid-container:hover {
  animation: next-shake 0.5s;
  background: var(--card-bg-color);
}
.post-body .link-grid .link-grid-container:active {
  box-shadow: 0.5rem 0.5rem 0.25rem rgba(0,0,0,0.5);
  transform: translate(0.2rem, 0.2rem);
}
.post-body .link-grid .link-grid-container .link-grid-image {
  border: 1px solid #ddd;
  border-radius: 50%;
  box-sizing: border-box;
  height: 5rem;
  padding: 3px;
  position: absolute;
  width: 5rem;
}
.post-body .link-grid .link-grid-container p {
  margin: 0 1rem 0 6rem;
}
.post-body .link-grid .link-grid-container p:first-of-type {
  font-size: 1.2em;
}
.post-body .link-grid .link-grid-container p:last-of-type {
  font-size: 0.8em;
  line-height: 1.3rem;
  opacity: 0.7;
}
.post-body .link-grid .link-grid-container a {
  border: 0;
  height: 100%;
  left: 0;
  position: absolute;
  top: 0;
  width: 100%;
}
@keyframes next-shake {
  0% {
    transform: translate(1pt, 1pt) rotate(0deg);
  }
  10% {
    transform: translate(-1pt, -2pt) rotate(-1deg);
  }
  20% {
    transform: translate(-3pt, 0pt) rotate(1deg);
  }
  30% {
    transform: translate(3pt, 2pt) rotate(0deg);
  }
  40% {
    transform: translate(1pt, -1pt) rotate(1deg);
  }
  50% {
    transform: translate(-1pt, 2pt) rotate(-1deg);
  }
  60% {
    transform: translate(-3pt, 1pt) rotate(0deg);
  }
  70% {
    transform: translate(3pt, 1pt) rotate(-1deg);
  }
  80% {
    transform: translate(-1pt, -1pt) rotate(1deg);
  }
  90% {
    transform: translate(1pt, 2pt) rotate(0deg);
  }
  100% {
    transform: translate(1pt, -2pt) rotate(-1deg);
  }
}
.post-body .note {
  border-radius: 3px;
  margin-bottom: 20px;
  padding: 1em;
  position: relative;
  background: #f5f5f5;
  border: 1px solid transparent;
}
.post-body .note summary {
  cursor: pointer;
  outline: 0;
}
.post-body .note summary p {
  display: inline;
}
.post-body .note h2,
.post-body .note h3,
.post-body .note h4,
.post-body .note h5,
.post-body .note h6 {
  border-bottom: initial;
  margin: 0;
  padding-top: 0;
}
.post-body .note :first-child {
  margin-top: 0;
}
.post-body .note :last-child {
  margin-bottom: 0;
}
.post-body .note.default {
  background: #f3f3f3;
  border-color: #e1e1e1;
  color: #666;
}
.post-body .note.default a:not(.btn) {
  border-bottom-color: #666;
  color: #666;
}
.post-body .note.default a:not(.btn):hover {
  border-bottom-color: #454545;
  color: #454545;
}
.post-body .note.primary {
  background: #f3daff;
  border-color: #e1c2ff;
  color: #6f42c1;
}
.post-body .note.primary a:not(.btn) {
  border-bottom-color: #6f42c1;
  color: #6f42c1;
}
.post-body .note.primary a:not(.btn):hover {
  border-bottom-color: #453298;
  color: #453298;
}
.post-body .note.info {
  background: #d9edf7;
  border-color: #b3e5ef;
  color: #31708f;
}
.post-body .note.info a:not(.btn) {
  border-bottom-color: #31708f;
  color: #31708f;
}
.post-body .note.info a:not(.btn):hover {
  border-bottom-color: #215761;
  color: #215761;
}
.post-body .note.success {
  background: #dff0d8;
  border-color: #d0e6be;
  color: #3c763d;
}
.post-body .note.success a:not(.btn) {
  border-bottom-color: #3c763d;
  color: #3c763d;
}
.post-body .note.success a:not(.btn):hover {
  border-bottom-color: #32562c;
  color: #32562c;
}
.post-body .note.warning {
  background: #fcf4e3;
  border-color: #fae4cd;
  color: #8a6d3b;
}
.post-body .note.warning a:not(.btn) {
  border-bottom-color: #8a6d3b;
  color: #8a6d3b;
}
.post-body .note.warning a:not(.btn):hover {
  border-bottom-color: #714f30;
  color: #714f30;
}
.post-body .note.danger {
  background: #f2dfdf;
  border-color: #ebcdd2;
  color: #a94442;
}
.post-body .note.danger a:not(.btn) {
  border-bottom-color: #a94442;
  color: #a94442;
}
.post-body .note.danger a:not(.btn):hover {
  border-bottom-color: #84333f;
  color: #84333f;
}
.post-body .tabs {
  margin-bottom: 20px;
}
.post-body .tabs,
.tabs-comment {
  padding-top: 10px;
}
.post-body .tabs ul.nav-tabs,
.tabs-comment ul.nav-tabs {
  background: var(--content-bg-color);
  display: flex;
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  margin: 0;
  padding: 0;
  position: sticky;
  top: 0;
  z-index: 5;
}
@media (max-width: 413px) {
  .post-body .tabs ul.nav-tabs,
  .tabs-comment ul.nav-tabs {
    display: block;
    margin-bottom: 5px;
  }
}
.post-body .tabs ul.nav-tabs li.tab,
.tabs-comment ul.nav-tabs li.tab {
  border-bottom: 1px solid #ddd;
  border-left: 1px solid transparent;
  border-right: 1px solid transparent;
  border-radius: 0 0 0 0;
  border-top: 3px solid transparent;
  flex-grow: 1;
  list-style-type: none;
}
@media (max-width: 413px) {
  .post-body .tabs ul.nav-tabs li.tab,
  .tabs-comment ul.nav-tabs li.tab {
    border-bottom: 1px solid transparent;
    border-left: 3px solid transparent;
    border-right: 1px solid transparent;
    border-top: 1px solid transparent;
  }
}
@media (max-width: 413px) {
  .post-body .tabs ul.nav-tabs li.tab,
  .tabs-comment ul.nav-tabs li.tab {
    border-radius: 0;
  }
}
.post-body .tabs ul.nav-tabs li.tab a,
.tabs-comment ul.nav-tabs li.tab a {
  border-bottom: initial;
  display: block;
  line-height: 1.8;
  padding: 0.25em 0.75em;
  text-align: center;
  transition: all 0.2s ease-out;
}
.post-body .tabs ul.nav-tabs li.tab a i[class^='fa'],
.tabs-comment ul.nav-tabs li.tab a i[class^='fa'] {
  width: 1.285714285714286em;
}
.post-body .tabs ul.nav-tabs li.tab.active,
.tabs-comment ul.nav-tabs li.tab.active {
  border-bottom-color: transparent;
  border-left-color: #ddd;
  border-right-color: #ddd;
  border-top-color: #fc6423;
}
@media (max-width: 413px) {
  .post-body .tabs ul.nav-tabs li.tab.active,
  .tabs-comment ul.nav-tabs li.tab.active {
    border-bottom-color: #ddd;
    border-left-color: #fc6423;
    border-right-color: #ddd;
    border-top-color: #ddd;
  }
}
.post-body .tabs ul.nav-tabs li.tab.active a,
.tabs-comment ul.nav-tabs li.tab.active a {
  cursor: default;
}
.post-body .tabs .tab-content,
.tabs-comment .tab-content {
  border: 1px solid #ddd;
  border-radius: 0 0 0 0;
  border-top-color: transparent;
}
@media (max-width: 413px) {
  .post-body .tabs .tab-content,
  .tabs-comment .tab-content {
    border-radius: 0;
    border-top-color: #ddd;
  }
}
.post-body .tabs .tab-content .tab-pane,
.tabs-comment .tab-content .tab-pane {
  padding: 20px 20px 0;
}
.post-body .tabs .tab-content .tab-pane:not(.active),
.tabs-comment .tab-content .tab-pane:not(.active) {
  display: none;
}
.pagination .prev,
.pagination .next,
.pagination .page-number,
.pagination .space {
  display: inline-block;
  margin: -1px 10px 0;
  padding: 0 10px;
}
@media (max-width: 767px) {
  .pagination .prev,
  .pagination .next,
  .pagination .page-number,
  .pagination .space {
    margin: 0 5px;
  }
}
.pagination .page-number.current {
  background: #ccc;
  border-color: #ccc;
  color: var(--content-bg-color);
}
.pagination {
  border-top: 1px solid #eee;
  margin: 120px 0 0;
  text-align: center;
}
.pagination .prev,
.pagination .next,
.pagination .page-number {
  border-bottom: 0;
  border-top: 1px solid #eee;
  transition: border-color 0.2s ease-in-out;
}
.pagination .prev:hover,
.pagination .next:hover,
.pagination .page-number:hover {
  border-top-color: var(--link-hover-color);
}
@media (max-width: 767px) {
  .pagination {
    border-top: 0;
  }
  .pagination .prev,
  .pagination .next,
  .pagination .page-number {
    border-bottom: 1px solid #eee;
    border-top: 0;
  }
  .pagination .prev:hover,
  .pagination .next:hover,
  .pagination .page-number:hover {
    border-bottom-color: var(--link-hover-color);
  }
}
.pagination .space {
  margin: 0;
  padding: 0;
}
.comments {
  margin-top: 60px;
  overflow: hidden;
}
.comment-button-group {
  display: flex;
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  justify-content: center;
  margin: 1em 0;
}
.comment-button-group .comment-button {
  margin: 0.1em 0.2em;
}
.comment-button-group .comment-button.active {
  background: var(--btn-default-hover-bg);
  border-color: var(--btn-default-hover-border-color);
  color: var(--btn-default-hover-color);
}
.comment-position {
  display: none;
}
.comment-position.active {
  display: block;
}
.tabs-comment {
  margin-top: 4em;
  padding-top: 0;
}
.tabs-comment .comments {
  margin-top: 0;
  padding-top: 0;
}
.headband {
  background: var(--theme-color);
  height: 3px;
}
@media (max-width: 991px) {
  .headband {
    display: none;
  }
}
.site-brand-container {
  display: flex;
  flex-shrink: 0;
  padding: 0 10px;
}
.use-motion .column,
.use-motion .site-brand-container .toggle {
  opacity: 0;
}
.site-meta {
  flex-grow: 1;
  text-align: center;
}
@media (max-width: 767px) {
  .site-meta {
    text-align: center;
  }
}
.custom-logo-image {
  margin-top: 20px;
}
@media (max-width: 991px) {
  .custom-logo-image {
    display: none;
  }
}
.brand {
  border-bottom: 0;
  color: var(--brand-color);
  display: inline-block;
  padding: 0;
}
.brand:hover {
  color: var(--brand-hover-color);
}
.site-title {
  font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;
  font-size: 1.375em;
  font-weight: normal;
  line-height: 1.5;
  margin: 0;
}
.site-subtitle {
  color: #ddd;
  font-size: 0.8125em;
  margin: 10px 10px 0;
}
.use-motion .site-title,
.use-motion .site-subtitle,
.use-motion .custom-logo-image {
  opacity: 0;
  position: relative;
  top: -10px;
}
.site-nav-toggle,
.site-nav-right {
  display: none;
}
@media (max-width: 767px) {
  .site-nav-toggle,
  .site-nav-right {
    display: flex;
    flex-direction: column;
    justify-content: center;
  }
}
.site-nav-toggle .toggle,
.site-nav-right .toggle {
  color: var(--text-color);
  padding: 10px;
  width: 22px;
}
.site-nav-toggle .toggle .toggle-line,
.site-nav-right .toggle .toggle-line {
  background: var(--text-color);
  border-radius: 1px;
}
@media (max-width: 767px) {
  .site-nav {
    --scroll-height: 0;
    height: 0;
    overflow: hidden;
    transition: 0.2s ease-in-out;
    transition-property: height, visibility;
    visibility: hidden;
  }
  body:not(.site-nav-on) .site-nav .animated {
    animation: none;
  }
  body.site-nav-on .site-nav {
    height: var(--scroll-height);
    visibility: unset;
  }
}
.menu {
  margin: 0;
  padding: 1em 0;
  text-align: center;
}
.menu-item {
  display: inline-block;
  list-style: none;
  margin: 0 10px;
}
@media (max-width: 767px) {
  .menu-item {
    display: block;
    margin-top: 10px;
  }
  .menu-item.menu-item-search {
    display: none;
  }
}
.menu-item a {
  border-bottom: 0;
  display: block;
  font-size: 0.8125em;
  transition: border-color 0.2s ease-in-out;
}
.menu-item a:hover,
.menu-item a.menu-item-active {
  background: var(--menu-item-bg-color);
}
.menu-item i[class^='fa'] {
  margin-right: 8px;
}
.menu-item .badge {
  background: #ccc;
  border-radius: 10px;
  color: var(--content-bg-color);
  font-weight: bold;
  line-height: 1;
  margin-left: 0.35em;
  padding: 2px 5px;
  text-shadow: 1px 1px 0 rgba(0,0,0,0.1);
}
.use-motion .menu-item {
  visibility: hidden;
}
@media (max-width: 991px) {
  .sidebar {
    left: -320px;
  }
  .sidebar-active .sidebar {
    left: 0;
  }
  .sidebar {
    background: #222;
    bottom: 0;
    box-shadow: inset 0 2px 6px #000;
    max-height: 100vh;
    overflow-y: auto;
    position: fixed;
    top: 0;
    transition: 0.2s ease-out;
    transition-property: left, right;
    width: 320px;
    z-index: 20;
  }
  .sidebar a {
    border-bottom-color: #555;
    color: #999;
  }
  .sidebar a:hover {
    border-bottom-color: #eee;
    color: #eee;
  }
  .links-of-author:not(:first-child) {
    margin-top: 15px;
  }
  .links-of-author a {
    border-bottom-color: #555;
    display: inline-block;
    margin-bottom: 10px;
    margin-right: 10px;
    vertical-align: middle;
  }
  .links-of-author a::before {
    background: #6efa6c;
    display: inline-block;
    margin-right: 3px;
    transform: translateY(-2px);
    border-radius: 50%;
    content: ' ';
    height: 4px;
    width: 4px;
  }
  .links-of-blogroll-item {
    padding: 0 5px;
  }
  .popular-posts .popular-posts-item .popular-posts-link:hover {
    background: none;
  }
  .sidebar-dimmer {
    background: #000;
    height: 100%;
    left: 0;
    opacity: 0;
    position: fixed;
    top: 0;
    transition: visibility 0.4s, opacity 0.4s;
    visibility: hidden;
    width: 100%;
    z-index: 10;
  }
  .sidebar-active .sidebar-dimmer {
    opacity: 0.7;
    visibility: visible;
  }
}
.sidebar-inner {
  color: #999;
  padding: 18px 10px;
  text-align: center;
  display: flex;
  flex-direction: column;
  justify-content: center;
}
.sidebar-toggle {
  bottom: 61px;
  height: 16px;
  padding: 5px;
  width: 16px;
  background: #222;
  cursor: pointer;
  opacity: 0.6;
  position: fixed;
  z-index: 30;
  left: 30px;
}
@media (max-width: 991px) {
  .sidebar-toggle {
    left: 20px;
  }
}
.sidebar-toggle:hover {
  opacity: 0.8;
}
@media (max-width: 991px) {
  .sidebar-toggle {
    opacity: 0.8;
  }
}
.sidebar-toggle:hover .toggle-line {
  background: #fc6423;
}
@media (any-hover: hover) {
  body:not(.sidebar-active) .sidebar-toggle:hover :first-child {
    left: 50%;
    top: 2px;
    transform: rotate(45deg);
    width: 50%;
  }
  body:not(.sidebar-active) .sidebar-toggle:hover :last-child {
    left: 50%;
    top: -2px;
    transform: rotate(-45deg);
    width: 50%;
  }
}
.sidebar-active .sidebar-toggle :nth-child(2) {
  opacity: 0;
}
.sidebar-active .sidebar-toggle :first-child {
  top: 6px;
  transform: rotate(45deg);
}
.sidebar-active .sidebar-toggle :last-child {
  top: -6px;
  transform: rotate(-45deg);
}
.sidebar-nav {
  font-size: 0.875em;
  height: 0;
  margin: 0;
  overflow: hidden;
  padding-left: 0;
  pointer-events: none;
  transition: 0.2s ease-in-out;
  transition-property: height, visibility;
  visibility: hidden;
}
.sidebar-nav-active .sidebar-nav {
  height: calc(2em + 1px);
  pointer-events: unset;
  visibility: unset;
}
.sidebar-nav li {
  border-bottom: 1px solid transparent;
  color: var(--text-color);
  cursor: pointer;
  display: inline-block;
  transition: 0.2s ease-in-out;
  transition-property: border-bottom-color, color;
}
.sidebar-nav li.sidebar-nav-overview {
  margin-left: 10px;
}
.sidebar-nav li:hover {
  color: #fc6423;
}
.sidebar-toc-active .sidebar-nav-toc,
.sidebar-overview-active .sidebar-nav-overview {
  border-bottom-color: #fc6423;
  color: #fc6423;
  transition-delay: 0.2s;
}
.sidebar-toc-active .sidebar-nav-toc:hover,
.sidebar-overview-active .sidebar-nav-overview:hover {
  color: #fc6423;
}
.sidebar-panel-container {
  align-items: start;
  display: grid;
  flex: 1;
  overflow-x: hidden;
  overflow-y: auto;
  padding-top: 0;
  transition: padding-top 0.2s ease-in-out;
}
.sidebar-nav-active .sidebar-panel-container {
  padding-top: 20px;
}
.sidebar-panel {
  animation: deactivate-sidebar-panel 0.2s ease-in-out;
  grid-area: 1/1;
  height: 0;
  opacity: 0;
  overflow: hidden;
  pointer-events: none;
  transform: translateY(0);
  transition: 0.2s ease-in-out;
  transition-delay: 0s;
  transition-property: opacity, transform, visibility;
  visibility: hidden;
}
.sidebar-nav-active .sidebar-panel,
.sidebar-overview-active .sidebar-panel.post-toc-wrap {
  transform: translateY(-20px);
}
.sidebar-overview-active:not(.sidebar-nav-active) .sidebar-panel.post-toc-wrap {
  transition-delay: 0s, 0.2s, 0s;
}
.sidebar-overview-active .sidebar-panel.site-overview-wrap,
.sidebar-toc-active .sidebar-panel.post-toc-wrap {
  animation-name: activate-sidebar-panel;
  height: auto;
  opacity: 1;
  pointer-events: unset;
  transform: translateY(0);
  transition-delay: 0.2s, 0.2s, 0s;
  visibility: unset;
}
.sidebar-panel.site-overview-wrap {
  display: flex;
  flex-direction: column;
  justify-content: center;
  gap: 10px;
  justify-content: flex-start;
}
@keyframes deactivate-sidebar-panel {
  from {
    height: var(--inactive-panel-height, 0);
  }
  to {
    height: var(--active-panel-height, 0);
  }
}
@keyframes activate-sidebar-panel {
  from {
    height: var(--inactive-panel-height, auto);
  }
  to {
    height: var(--active-panel-height, auto);
  }
}
.post-toc {
  font-size: 0.875em;
}
.post-toc ol {
  list-style: none;
  margin: 0;
  padding: 0 2px 0 10px;
  text-align: left;
}
.post-toc ol > :last-child {
  margin-bottom: 5px;
}
.post-toc ol > ol {
  padding-left: 0;
}
.post-toc ol a {
  transition: all 0.2s ease-in-out;
}
.post-toc .nav-item {
  line-height: 1.8;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.post-toc .nav .nav-child {
  --height: 0;
  height: 0;
  opacity: 0;
  overflow: hidden;
  transition-property: height, opacity, visibility;
  transition: 0.2s ease-in-out;
  visibility: hidden;
}
.post-toc .nav .active > .nav-child {
  height: var(--height, auto);
  opacity: 1;
  visibility: unset;
}
.post-toc .nav .active > a {
  border-bottom-color: #fc6423;
  color: #fc6423;
}
.post-toc .nav .active-current > a {
  color: #fc6423;
}
.post-toc .nav .active-current > a:hover {
  color: #fc6423;
}
.site-author-image {
  border: 1px solid #eee;
  max-width: 120px;
  padding: 2px;
}
.site-author-name {
  color: var(--text-color);
  font-weight: 600;
  margin: 0;
}
.site-description {
  color: #999;
  font-size: 0.8125em;
  margin-top: 0;
}
.site-state {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  line-height: 1.4;
}
.site-state-item {
  padding: 0 15px;
}
.site-state-item a {
  border-bottom: 0;
  display: block;
}
.site-state-item-count {
  display: block;
  font-size: 1em;
  font-weight: 600;
}
.site-state-item-name {
  color: #999;
  font-size: 0.8125em;
}
.sidebar .sidebar-button:not(:first-child) {
  margin-top: 15px;
}
.sidebar .sidebar-button button {
  background: transparent;
  color: #fc6423;
  cursor: pointer;
  line-height: 2;
  padding: 0 15px;
  border: 1px solid #fc6423;
  border-radius: 4px;
}
.sidebar .sidebar-button button:hover {
  background: #fc6423;
  color: #fff;
}
.sidebar .sidebar-button button i[class^='fa'] {
  margin-right: 5px;
}
.links-of-author a {
  font-size: 0.8125em;
}
.links-of-author i[class^='fa'] {
  margin-right: 2px;
}
.cc-license .cc-opacity {
  border-bottom: 0;
  opacity: 0.7;
}
.cc-license .cc-opacity:hover {
  opacity: 0.9;
}
.cc-license img {
  display: inline-block;
}
.links-of-blogroll {
  font-size: 0.8125em;
}
.links-of-blogroll-title {
  font-size: 0.875em;
  font-weight: 600;
}
.links-of-blogroll-list {
  list-style: none;
  gap: 5px;
  margin: 5px 0 0;
  padding: 0;
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  flex-direction: column;
}
.links-of-blogroll-item {
  max-width: calc(100% - 20px);
}
.links-of-blogroll-item a {
  box-sizing: border-box;
  display: inline-block;
  max-width: 100%;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.footer {
  color: #999;
  font-size: 0.875em;
  padding: 20px 0;
  transition: 0.2s ease-in-out;
  transition-property: left, right;
}
.footer.footer-fixed {
  bottom: 0;
  left: 0;
  position: absolute;
  right: 0;
}
.footer-inner {
  box-sizing: border-box;
  text-align: center;
  display: flex;
  flex-direction: column;
  justify-content: center;
  margin: 0 auto;
  width: calc(100% - 20px);
}
@media (max-width: 767px) {
  .footer-inner {
    width: auto;
  }
}
@media (min-width: 1200px) {
  .footer-inner {
    width: 1160px;
  }
}
@media (min-width: 1600px) {
  .footer-inner {
    width: 73%;
  }
}
.use-motion .footer {
  opacity: 0;
}
.languages {
  display: inline-block;
  font-size: 1.125em;
  position: relative;
}
.languages .lang-select-label span {
  margin: 0 0.5em;
}
.languages .lang-select {
  height: 100%;
  left: 0;
  opacity: 0;
  position: absolute;
  top: 0;
  width: 100%;
}
.with-love {
  color: ##0000ff;
  display: inline-block;
  margin: 0 5px;
}
@keyframes icon-animate {
  0%, 100% {
    transform: scale(1);
  }
  10%, 30% {
    transform: scale(0.9);
  }
  20%, 40%, 60%, 80% {
    transform: scale(1.1);
  }
  50%, 70% {
    transform: scale(1.1);
  }
}
.back-to-top {
  font-size: 12px;
  align-items: center;
  bottom: -100px;
  color: #fff;
  display: flex;
  height: 26px;
  transition: 0.2s ease-in-out;
  transition-property: bottom;
  background: #222;
  cursor: pointer;
  opacity: 0.6;
  position: fixed;
  z-index: 30;
  left: 30px;
}
.back-to-top span {
  margin-right: 8px;
  display: none;
}
.back-to-top .fa {
  text-align: center;
  width: 26px;
}
@media (max-width: 991px) {
  .back-to-top {
    left: 20px;
  }
}
.back-to-top:hover {
  opacity: 0.8;
}
@media (max-width: 991px) {
  .back-to-top {
    opacity: 0.8;
  }
}
.back-to-top:hover {
  color: #fc6423;
}
.back-to-top.back-to-top-on {
  bottom: 30px;
}
.reading-progress-bar {
  --progress: 0;
  background: #37c6c0;
  height: 3px;
  position: fixed;
  z-index: 50;
  width: var(--progress);
  left: 0;
  bottom: 0;
}
.rtl.post-body p,
.rtl.post-body a,
.rtl.post-body h1,
.rtl.post-body h2,
.rtl.post-body h3,
.rtl.post-body h4,
.rtl.post-body h5,
.rtl.post-body h6,
.rtl.post-body li,
.rtl.post-body ul,
.rtl.post-body ol {
  direction: rtl;
  font-family: UKIJ Ekran;
}
.rtl.post-title {
  font-family: UKIJ Ekran;
}
.post-button {
  margin-top: 40px;
  text-align: center;
}
.use-motion .post-block,
.use-motion .pagination,
.use-motion .comments {
  visibility: hidden;
}
.use-motion .post-header {
  visibility: hidden;
}
.use-motion .post-body {
  visibility: hidden;
}
.use-motion .collection-header {
  visibility: hidden;
}
.posts-collapse .post-content {
  margin-bottom: 35px;
  margin-left: 35px;
  position: relative;
}
@media (max-width: 767px) {
  .posts-collapse .post-content {
    margin-left: 0;
    margin-right: 0;
  }
}
.posts-collapse .post-content .collection-title {
  font-size: 1.125em;
  position: relative;
}
.posts-collapse .post-content .collection-title::before {
  background: #999;
  border: 1px solid #fff;
  margin-left: -6px;
  margin-top: -4px;
  position: absolute;
  top: 50%;
  border-radius: 50%;
  content: ' ';
  height: 10px;
  width: 10px;
}
.posts-collapse .post-content .collection-year {
  font-size: 1.5em;
  font-weight: bold;
  margin: 60px 0;
  position: relative;
}
.posts-collapse .post-content .collection-year .collection-year-count {
  font-size: 0.75em;
  background: #ccc;
  border-radius: 10px;
  color: var(--content-bg-color);
  font-weight: bold;
  line-height: 1;
  margin-left: 0.35em;
  padding: 2px 5px;
  text-shadow: 1px 1px 0 rgba(0,0,0,0.1);
}
.posts-collapse .post-content .collection-year::before {
  background: #bbb;
  margin-left: -4px;
  margin-top: -4px;
  position: absolute;
  top: 50%;
  border-radius: 50%;
  content: ' ';
  height: 8px;
  width: 8px;
}
.posts-collapse .post-content .collection-header {
  display: block;
  margin-left: 20px;
}
.posts-collapse .post-content .collection-header small {
  color: #bbb;
  margin-left: 5px;
}
.posts-collapse .post-content .post-header {
  border-bottom: 1px dashed #ccc;
  margin: 30px 2px 0;
  padding-left: 15px;
  position: relative;
  transition: border 0.2s ease-in-out;
}
.posts-collapse .post-content .post-header::before {
  background: #bbb;
  border: 1px solid #fff;
  left: -6px;
  position: absolute;
  top: 0.75em;
  transition: background 0.2s ease-in-out;
  border-radius: 50%;
  content: ' ';
  height: 6px;
  width: 6px;
}
.posts-collapse .post-content .post-header:hover {
  border-bottom-color: #666;
}
.posts-collapse .post-content .post-header:hover::before {
  background: #222;
}
.posts-collapse .post-content .post-meta-container {
  display: inline;
  font-size: 0.75em;
  margin-right: 10px;
}
.posts-collapse .post-content .post-title {
  display: inline;
}
.posts-collapse .post-content .post-title a {
  border-bottom: 0;
  color: var(--link-color);
}
.posts-collapse .post-content .post-title .fa {
  font-size: 0.875em;
  margin-left: 5px;
}
.posts-collapse .post-content::before {
  background: #f5f5f5;
  content: ' ';
  height: 100%;
  margin-left: -2px;
  position: absolute;
  top: 1.25em;
  width: 4px;
}
.post-body {
  font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;
  overflow-wrap: break-word;
}
@media (min-width: 1200px) {
  .post-body {
    font-size: 1.125em;
  }
}
@media (min-width: 992px) {
  .post-body {
    text-align: justify;
  }
}
@media (max-width: 991px) {
  .post-body {
    text-align: justify;
  }
}
.post-body h1 .header-anchor,
.post-body h2 .header-anchor,
.post-body h3 .header-anchor,
.post-body h4 .header-anchor,
.post-body h5 .header-anchor,
.post-body h6 .header-anchor,
.post-body h1 .headerlink,
.post-body h2 .headerlink,
.post-body h3 .headerlink,
.post-body h4 .headerlink,
.post-body h5 .headerlink,
.post-body h6 .headerlink {
  border-bottom-style: none;
  color: inherit;
  float: right;
  font-size: 0.875em;
  margin-left: 10px;
  opacity: 0;
}
.post-body h1 .header-anchor::before,
.post-body h2 .header-anchor::before,
.post-body h3 .header-anchor::before,
.post-body h4 .header-anchor::before,
.post-body h5 .header-anchor::before,
.post-body h6 .header-anchor::before,
.post-body h1 .headerlink::before,
.post-body h2 .headerlink::before,
.post-body h3 .headerlink::before,
.post-body h4 .headerlink::before,
.post-body h5 .headerlink::before,
.post-body h6 .headerlink::before {
  content: '\f0c1';
  font-family: 'Font Awesome 6 Free';
  font-weight: 900;
}
.post-body h1:hover .header-anchor,
.post-body h2:hover .header-anchor,
.post-body h3:hover .header-anchor,
.post-body h4:hover .header-anchor,
.post-body h5:hover .header-anchor,
.post-body h6:hover .header-anchor,
.post-body h1:hover .headerlink,
.post-body h2:hover .headerlink,
.post-body h3:hover .headerlink,
.post-body h4:hover .headerlink,
.post-body h5:hover .headerlink,
.post-body h6:hover .headerlink {
  opacity: 0.5;
}
.post-body h1:hover .header-anchor:hover,
.post-body h2:hover .header-anchor:hover,
.post-body h3:hover .header-anchor:hover,
.post-body h4:hover .header-anchor:hover,
.post-body h5:hover .header-anchor:hover,
.post-body h6:hover .header-anchor:hover,
.post-body h1:hover .headerlink:hover,
.post-body h2:hover .headerlink:hover,
.post-body h3:hover .headerlink:hover,
.post-body h4:hover .headerlink:hover,
.post-body h5:hover .headerlink:hover,
.post-body h6:hover .headerlink:hover {
  opacity: 1;
}
.post-body .exturl .fa {
  font-size: 0.875em;
  margin-left: 4px;
}
.post-body figure:not(.highlight) figcaption {
  color: #999;
  font-size: 0.875em;
  font-weight: bold;
  line-height: 1;
  margin: -15px auto 15px;
  text-align: center;
}
.post-body iframe,
.post-body img,
.post-body video,
.post-body embed {
  margin-bottom: 20px;
}
.post-body .video-container {
  height: 0;
  margin-bottom: 20px;
  overflow: hidden;
  padding-top: 75%;
  position: relative;
  width: 100%;
}
.post-body .video-container iframe,
.post-body .video-container object,
.post-body .video-container embed {
  height: 100%;
  left: 0;
  margin: 0;
  position: absolute;
  top: 0;
  width: 100%;
}
.post-gallery {
  display: flex;
  min-height: 200px;
}
.post-gallery .post-gallery-image {
  flex: 1;
}
.post-gallery .post-gallery-image:not(:first-child) {
  clip-path: polygon(40px 0, 100% 0, 100% 100%, 0 100%);
  margin-left: -20px;
}
.post-gallery .post-gallery-image:not(:last-child) {
  margin-right: -20px;
}
.post-gallery .post-gallery-image img {
  height: 100%;
  object-fit: cover;
  opacity: 1;
  width: 100%;
}
.posts-expand .post-gallery {
  margin-bottom: 60px;
}
.posts-collapse .post-gallery {
  margin: 15px 0;
}
.posts-expand .post-header {
  font-size: 1.125em;
  margin-bottom: 60px;
  text-align: center;
}
.posts-expand .post-title {
  font-size: 1.5em;
  font-weight: normal;
  margin: initial;
  overflow-wrap: break-word;
}
.posts-expand .post-title-link {
  border-bottom: 0;
  color: var(--link-color);
  display: inline-block;
  position: relative;
}
.posts-expand .post-title-link::before {
  background: var(--link-color);
  bottom: 0;
  content: '';
  height: 2px;
  left: 0;
  position: absolute;
  transform: scaleX(0);
  transition: transform 0.2s ease-in-out;
  width: 100%;
}
.posts-expand .post-title-link:hover::before {
  transform: scaleX(1);
}
.posts-expand .post-title-link .fa {
  font-size: 0.875em;
  margin-left: 5px;
}
.post-sticky-flag {
  display: inline-block;
  margin-right: 8px;
  transform: rotate(30deg);
}
.posts-expand .post-meta-container {
  color: #999;
  font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;
  font-size: 0.75em;
  margin-top: 3px;
}
.posts-expand .post-meta-container .post-description {
  font-size: 0.875em;
  margin-top: 2px;
}
.posts-expand .post-meta-container time {
  border-bottom: 1px dashed #999;
}
.post-meta {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
}
:not(.post-meta-break) + .post-meta-item::before {
  content: '|';
  margin: 0 0.5em;
}
.post-meta-item-icon {
  margin-right: 3px;
}
@media (max-width: 991px) {
  .post-meta-item-text {
    display: none;
  }
}
.post-meta-break {
  flex-basis: 100%;
  height: 0;
}
.post-nav {
  border-top: 1px solid #eee;
  display: flex;
  gap: 30px;
  justify-content: space-between;
  margin-top: 1em;
  padding: 10px 5px 0;
}
.post-nav-item {
  flex: 1;
}
.post-nav-item a {
  border-bottom: 0;
  display: block;
  font-size: 0.875em;
  line-height: 1.6;
}
.post-nav-item a:active {
  top: 2px;
}
.post-nav-item .fa {
  font-size: 0.75em;
}
.post-nav-item:first-child .fa {
  margin-right: 5px;
}
.post-nav-item:last-child {
  text-align: right;
}
.post-nav-item:last-child .fa {
  margin-left: 5px;
}
.post-footer {
  display: flex;
  flex-direction: column;
  justify-content: center;
}
.post-eof {
  background: #ccc;
  height: 1px;
  margin: 80px auto 60px;
  width: 8%;
}
.post-block:last-of-type .post-eof {
  display: none;
}
.post-tags {
  margin-top: 40px;
  text-align: center;
}
.post-tags a {
  display: inline-block;
  font-size: 0.8125em;
}
.post-tags a:not(:last-child) {
  margin-right: 10px;
}
.social-like {
  border-top: 1px solid #eee;
  font-size: 0.875em;
  margin-top: 1em;
  padding-top: 1em;
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
}
.social-like a {
  border-bottom: none;
}
.reward-container {
  margin: 1em 0 0;
  padding: 1em 0;
  text-align: center;
}
.reward-container button {
  background: transparent;
  color: #fc6423;
  cursor: pointer;
  line-height: 2;
  padding: 0 15px;
  border: 2px solid #fc6423;
  border-radius: 2px;
  outline: 0;
  vertical-align: text-top;
}
.reward-container button:hover {
  background: #fc6423;
  color: #fff;
}
.post-reward {
  display: none;
  padding-top: 20px;
}
.post-reward.active {
  display: block;
}
.post-reward div {
  display: inline-block;
}
.post-reward div span {
  display: block;
}
.post-reward img {
  display: inline-block;
  margin: 0.8em 2em 0;
  max-width: 100%;
  width: 180px;
}
@keyframes next-roll {
  from {
    transform: rotateZ(30deg);
  }
  to {
    transform: rotateZ(-30deg);
  }
}
.category-all-page .category-all-title {
  text-align: center;
}
.category-all-page .category-all {
  margin-top: 20px;
}
.category-all-page .category-list {
  list-style: none;
  margin: 0;
  padding: 0;
}
.category-all-page .category-list-item {
  margin: 5px 10px;
}
.category-all-page .category-list-count {
  font-size: 0.75em;
  background: #ccc;
  border-radius: 10px;
  color: var(--content-bg-color);
  font-weight: bold;
  line-height: 1;
  margin-left: 0.35em;
  padding: 2px 5px;
  text-shadow: 1px 1px 0 rgba(0,0,0,0.1);
}
.category-all-page .category-list-child {
  padding-left: 10px;
}
.event-list hr {
  background: #222;
  margin: 20px 0 45px;
}
.event-list hr::after {
  background: #222;
  color: #fff;
  content: 'NOW';
  display: inline-block;
  font-weight: bold;
  padding: 0 5px;
}
.event-list .event {
  --event-background: #222;
  --event-foreground: #bbb;
  --event-title: #fff;
  background: var(--event-background);
  padding: 15px;
}
.event-list .event .event-summary {
  border-bottom: 0;
  color: var(--event-title);
  margin: 0;
  padding: 0 0 0 35px;
  position: relative;
}
.event-list .event .event-summary::before {
  animation: dot-flash 1s alternate infinite ease-in-out;
  background: var(--event-title);
  left: 0;
  margin-top: -6px;
  position: absolute;
  top: 50%;
  border-radius: 50%;
  content: ' ';
  height: 12px;
  width: 12px;
}
.event-list .event:nth-of-type(odd) .event-summary::before {
  animation-delay: 0.5s;
}
.event-list .event:not(:last-child) {
  margin-bottom: 20px;
}
.event-list .event .event-relative-time {
  color: var(--event-foreground);
  display: inline-block;
  font-size: 12px;
  font-weight: normal;
  padding-left: 12px;
}
.event-list .event .event-details {
  color: var(--event-foreground);
  display: block;
  line-height: 18px;
  padding: 6px 0 6px 35px;
}
.event-list .event .event-details::before {
  color: var(--event-foreground);
  display: inline-block;
  margin-right: 9px;
  width: 14px;
  font-family: 'Font Awesome 6 Free';
  font-weight: 900;
}
.event-list .event .event-details.event-location::before {
  content: '\f041';
}
.event-list .event .event-details.event-duration::before {
  content: '\f017';
}
.event-list .event .event-details.event-description::before {
  content: '\f024';
}
.event-list .event-past {
  --event-background: #f5f5f5;
  --event-foreground: #999;
  --event-title: #222;
}
@keyframes dot-flash {
  from {
    opacity: 1;
    transform: scale(1);
  }
  to {
    opacity: 0;
    transform: scale(0.8);
  }
}
ul.breadcrumb {
  font-size: 0.75em;
  list-style: none;
  margin: 1em 0;
  padding: 0 2em;
  text-align: center;
}
ul.breadcrumb li {
  display: inline;
}
ul.breadcrumb li:not(:first-child)::before {
  content: '/\00a0';
  font-weight: normal;
  padding: 0.5em;
}
ul.breadcrumb li:last-child {
  font-weight: bold;
}
.tag-cloud {
  text-align: center;
}
.tag-cloud a {
  display: inline-block;
  margin: 10px;
}
.tag-cloud-0 {
  border-bottom-color: #aaa;
  color: #aaa;
}
.tag-cloud-1 {
  border-bottom-color: #9a9a9a;
  color: #9a9a9a;
}
.tag-cloud-2 {
  border-bottom-color: #8b8b8b;
  color: #8b8b8b;
}
.tag-cloud-3 {
  border-bottom-color: #7c7c7c;
  color: #7c7c7c;
}
.tag-cloud-4 {
  border-bottom-color: #6c6c6c;
  color: #6c6c6c;
}
.tag-cloud-5 {
  border-bottom-color: #5d5d5d;
  color: #5d5d5d;
}
.tag-cloud-6 {
  border-bottom-color: #4e4e4e;
  color: #4e4e4e;
}
.tag-cloud-7 {
  border-bottom-color: #3e3e3e;
  color: #3e3e3e;
}
.tag-cloud-8 {
  border-bottom-color: #2f2f2f;
  color: #2f2f2f;
}
.tag-cloud-9 {
  border-bottom-color: #202020;
  color: #202020;
}
.tag-cloud-10 {
  border-bottom-color: #111;
  color: #111;
}
.search-active {
  overflow: hidden;
}
.search-pop-overlay {
  background: rgba(0,0,0,0);
  display: flex;
  height: 100%;
  left: 0;
  position: fixed;
  top: 0;
  transition: visibility 0.4s, background 0.4s;
  visibility: hidden;
  width: 100%;
  z-index: 40;
}
.search-active .search-pop-overlay {
  background: rgba(0,0,0,0.3);
  visibility: visible;
}
.search-popup {
  background: var(--card-bg-color);
  border-radius: 5px;
  height: 80%;
  margin: auto;
  transform: scale(0);
  transition: transform 0.4s;
  width: 700px;
}
.search-active .search-popup {
  transform: scale(1);
}
@media (max-width: 767px) {
  .search-popup {
    border-radius: 0;
    height: 100%;
    width: 100%;
  }
}
.search-popup .search-icon,
.search-popup .popup-btn-close {
  color: #999;
  font-size: 18px;
  padding: 0 10px;
}
.search-popup .popup-btn-close {
  cursor: pointer;
}
.search-popup .popup-btn-close:hover .fa {
  color: #222;
}
.search-popup .search-header {
  background: #eee;
  border-top-left-radius: 5px;
  border-top-right-radius: 5px;
  display: flex;
  padding: 5px;
}
.search-popup input.search-input {
  background: transparent;
  border: 0;
  outline: 0;
  width: 100%;
}
.search-popup input.search-input::-webkit-search-cancel-button {
  display: none;
}
.search-popup .search-result-container {
  display: flex;
  flex-direction: column;
  height: calc(100% - 55px);
  overflow: auto;
  padding: 5px 25px;
}
.search-popup .search-result-container hr {
  flex-shrink: 0;
  margin: 5px 0 10px;
}
.search-popup .search-result-container hr:first-child {
  display: none;
}
.search-popup .search-result-list {
  margin: 0 5px;
  padding: 0;
}
.search-popup a.search-result-title {
  font-weight: bold;
}
.search-popup p.search-result {
  border-bottom: 1px dashed #ccc;
  padding: 5px 0;
}
.search-popup .search-input-container {
  flex-grow: 1;
  padding: 2px;
}
.search-popup .search-result-icon {
  color: #ccc;
  margin: auto;
}
mark.search-keyword {
  background: transparent;
  border-bottom: 1px dashed #ff2a2a;
  color: #ff2a2a;
  font-weight: bold;
}
.use-motion .animated {
  animation-fill-mode: none;
  visibility: inherit;
}
.use-motion .sidebar .animated {
  animation-fill-mode: both;
}
header.header {
  background: var(--content-bg-color);
  border-radius: initial;
  box-shadow: 0 2px 2px 0 rgba(0,0,0,0.12), 0 3px 1px -2px rgba(0,0,0,0.06), 0 1px 5px 0 rgba(0,0,0,0.12);
}
@media (max-width: 991px) {
  header.header {
    border-radius: initial;
  }
}
.main {
  align-items: stretch;
  display: flex;
  justify-content: space-between;
  margin: 0 auto;
  width: calc(100% - 20px);
}
@media (max-width: 767px) {
  .main {
    width: auto;
  }
}
@media (min-width: 1200px) {
  .main {
    width: 1160px;
  }
}
@media (min-width: 1600px) {
  .main {
    width: 73%;
  }
}
@media (max-width: 991px) {
  .main {
    display: block;
    width: auto;
  }
}
.main-inner {
  border-radius: initial;
  box-sizing: border-box;
  width: calc(100% - 252px);
}
@media (max-width: 991px) {
  .main-inner {
    border-radius: initial;
    width: 100%;
  }
}
.footer-inner {
  padding-left: 252px;
}
@media (max-width: 991px) {
  .footer-inner {
    padding-left: 0;
    padding-right: 0;
    width: auto;
  }
}
.column {
  width: 240px;
}
@media (max-width: 991px) {
  .column {
    width: auto;
  }
}
.site-brand-container {
  background: var(--theme-color);
}
@media (max-width: 991px) {
  .site-nav-on .site-brand-container {
    box-shadow: 0 0 16px rgba(0,0,0,0.5);
  }
}
.site-meta {
  padding: 20px 0;
}
@media (min-width: 768px) and (max-width: 991px) {
  .site-nav-toggle,
  .site-nav-right {
    display: flex;
    flex-direction: column;
    justify-content: center;
  }
}
.site-nav-toggle .toggle,
.site-nav-right .toggle {
  color: #fff;
}
.site-nav-toggle .toggle .toggle-line,
.site-nav-right .toggle .toggle-line {
  background: #fff;
}
@media (min-width: 768px) and (max-width: 991px) {
  .site-nav {
    --scroll-height: 0;
    height: 0;
    overflow: hidden;
    transition: 0.2s ease-in-out;
    transition-property: height, visibility;
    visibility: hidden;
  }
  body:not(.site-nav-on) .site-nav .animated {
    animation: none;
  }
  body.site-nav-on .site-nav {
    height: var(--scroll-height);
    visibility: unset;
  }
}
.menu .menu-item {
  display: block;
  margin: 0;
}
.menu .menu-item a {
  padding: 5px 20px;
  position: relative;
  transition-property: background-color;
  display: flex;
  align-items: center;
}
.menu .menu-item a .badge {
  margin-left: auto;
}
@media (max-width: 991px) {
  .menu .menu-item.menu-item-search {
    display: none;
  }
}
.main-menu .menu-item-active::after {
  background: #bbb;
  border-radius: 50%;
  content: ' ';
  height: 6px;
  margin-top: -3px;
  position: absolute;
  right: 15px;
  top: 50%;
  width: 6px;
}
.sub-menu {
  margin: 0;
  padding: 6px 0;
}
.sub-menu .menu-item {
  display: inline-block;
}
.sub-menu .menu-item a {
  background: transparent;
  margin: 5px 10px;
  padding: initial;
}
.sub-menu .menu-item a:hover {
  background: transparent;
  color: #fc6423;
}
.sub-menu .menu-item-active {
  border-bottom-color: #fc6423;
  color: #fc6423;
}
.sub-menu .menu-item-active:hover {
  border-bottom-color: #fc6423;
}
@media (min-width: 992px) {
  .sidebar {
    position: sticky;
    top: 12px;
  }
  .sidebar-toggle {
    display: none;
  }
  .sidebar-inner {
    background: var(--content-bg-color);
    border-radius: initial;
    box-shadow: 0 2px 2px 0 rgba(0,0,0,0.12), 0 3px 1px -2px rgba(0,0,0,0.06), 0 1px 5px 0 rgba(0,0,0,0.12), 0 -1px 0.5px 0 rgba(0,0,0,0.09);
    box-sizing: border-box;
    color: var(--text-color);
    margin-top: 12px;
    max-height: calc(100vh - 24px);
    visibility: hidden;
  }
  .site-state-item {
    padding: 0 10px;
  }
  .sidebar .sidebar-button {
    border-bottom: 1px dotted #ccc;
    border-top: 1px dotted #ccc;
  }
  .sidebar .sidebar-button button {
    border: 0;
    color: #fc6423;
    display: block;
    width: 100%;
  }
  .sidebar .sidebar-button button:hover {
    background: none;
    border: 0;
    color: #e34603;
  }
  .links-of-author {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
  }
  .links-of-author-item {
    margin: 5px 0 0;
    width: 50%;
  }
  .links-of-author-item a {
    border-bottom: 0;
    border-radius: 4px;
    display: block;
    padding: 0 5px;
    box-sizing: border-box;
    display: inline-block;
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  .links-of-author-item a:hover {
    background: var(--body-bg-color);
  }
  .links-of-blogroll-item a {
    padding: 0 5px;
  }
}
.main-inner .sub-menu,
.main-inner .post-block,
.main-inner .tabs-comment,
.main-inner > .comments,
.main-inner .comment-position .comments,
.main-inner .pagination {
  background: var(--content-bg-color);
  border-radius: initial;
  box-shadow: 0 2px 2px 0 rgba(0,0,0,0.12), 0 3px 1px -2px rgba(0,0,0,0.06), 0 1px 5px 0 rgba(0,0,0,0.12);
}
.main-inner .post-block:not(:first-child):not(:first-child) {
  border-radius: initial;
  box-shadow: 0 2px 2px 0 rgba(0,0,0,0.12), 0 3px 1px -2px rgba(0,0,0,0.06), 0 1px 5px 0 rgba(0,0,0,0.12), 0 -1px 0.5px 0 rgba(0,0,0,0.09);
  margin-top: 12px;
}
@media (min-width: 768px) and (max-width: 991px) {
  .main-inner .post-block:not(:first-child):not(:first-child) {
    margin-top: 10px;
  }
}
@media (max-width: 767px) {
  .main-inner .post-block:not(:first-child):not(:first-child) {
    margin-top: 8px;
  }
}
.main-inner .tabs-comment,
.main-inner > .comments,
.main-inner .comment-position .comments,
.main-inner .pagination {
  border-radius: initial;
  box-shadow: 0 2px 2px 0 rgba(0,0,0,0.12), 0 3px 1px -2px rgba(0,0,0,0.06), 0 1px 5px 0 rgba(0,0,0,0.12), 0 -1px 0.5px 0 rgba(0,0,0,0.09);
  margin-top: 12px;
}
@media (min-width: 768px) and (max-width: 991px) {
  .main-inner .tabs-comment,
  .main-inner > .comments,
  .main-inner .comment-position .comments,
  .main-inner .pagination {
    margin-top: 10px;
  }
}
@media (max-width: 767px) {
  .main-inner .tabs-comment,
  .main-inner > .comments,
  .main-inner .comment-position .comments,
  .main-inner .pagination {
    margin-top: 8px;
  }
}
.post-block,
.comments {
  padding: 40px;
}
.post-eof {
  display: none;
}
.pagination {
  border-top: initial;
  padding: 10px 0;
}
.post-body h1,
.post-body h2 {
  border-bottom: 1px solid #eee;
}
.post-body h3 {
  border-bottom: 1px dotted #eee;
}
@media (min-width: 768px) and (max-width: 991px) {
  .main-inner {
    padding: 10px;
  }
  .posts-expand .post-button {
    margin-top: 20px;
  }
  .post-block {
    padding: 20px;
  }
  .comments {
    padding: 10px 20px;
  }
}
@media (max-width: 767px) {
  .main-inner {
    padding: 8px;
  }
  .posts-expand .post-button {
    margin: 12px 0;
  }
  .post-block {
    padding: 12px;
  }
  .comments {
    padding: 10px 12px;
  }
}
</style><noscript>
    
  </noscript>
<style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style><link rel="alternate" href="/atom.xml" title="Yue Jiao's blog" type="application/atom+xml">
<script>function loadCss(l){var d=document,h=d.head,s=d.createElement('link');s.rel='stylesheet';s.href=l;!function e(f){if (d.body)return f();setTimeout(function(){e(f)})}(function(){h.appendChild(s);});}loadCss('/style.css');loadCss('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css');loadCss('https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css');</script><noscript><link rel="stylesheet" href="/style.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css"></noscript></head>

<body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Yue Jiao's blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#abstract"><span class="nav-number">1.</span> <span class="nav-text">1. Abstract</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pthreads-overview"><span class="nav-number">2.</span> <span class="nav-text">2. Pthreads Overview</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#what-is-a-thread"><span class="nav-number">2.1.</span> <span class="nav-text">What is a thread?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#what-are-pthreads"><span class="nav-number">2.2.</span> <span class="nav-text">What are Pthreads?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#why-pthreads"><span class="nav-number">2.3.</span> <span class="nav-text">Why Pthreads?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#designing-threaded-programs"><span class="nav-number">2.4.</span> <span class="nav-text">Designing threaded programs</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#shared-memory-model"><span class="nav-number">2.4.1.</span> <span class="nav-text">Shared memory model</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#thread-safeness"><span class="nav-number">2.4.2.</span> <span class="nav-text">Thread-safeness</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#thread-limits"><span class="nav-number">2.4.3.</span> <span class="nav-text">Thread limits</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#the-pthreads-api"><span class="nav-number">3.</span> <span class="nav-text">3. The Pthreads API</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#compiling-threaded-programs"><span class="nav-number">4.</span> <span class="nav-text">4. Compiling Threaded Programs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#thread-management"><span class="nav-number">5.</span> <span class="nav-text">5. Thread management</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#creating-and-terminating-threads"><span class="nav-number">5.1.</span> <span class="nav-text">Creating and terminating
threads</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#creating-threads"><span class="nav-number">5.1.1.</span> <span class="nav-text">Creating threads:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#thread-attributes"><span class="nav-number">5.1.2.</span> <span class="nav-text">Thread attributes</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#thread-binding-and-scheduling"><span class="nav-number">5.1.3.</span> <span class="nav-text">Thread binding and
scheduling</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#thread-termination"><span class="nav-number">5.1.4.</span> <span class="nav-text">Thread termination</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#example"><span class="nav-number">5.1.5.</span> <span class="nav-text">Example:</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#passing-arguments-to-threads"><span class="nav-number">5.2.</span> <span class="nav-text">Passing arguments to threads</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#example-1-uses-a-unique-data-structure-for-each-thread"><span class="nav-number">5.2.1.</span> <span class="nav-text">Example
1: uses a unique data structure for each thread</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#example-2-passing-multiple-arguments-via-a-structure"><span class="nav-number">5.2.2.</span> <span class="nav-text">Example 2:
passing multiple arguments via a structure</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#joining-and-detaching-threads"><span class="nav-number">5.3.</span> <span class="nav-text">Joining and detaching
threads</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#joinable-or-not"><span class="nav-number">5.3.1.</span> <span class="nav-text">Joinable or not?</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#detaching"><span class="nav-number">5.3.2.</span> <span class="nav-text">Detaching</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#recommendations"><span class="nav-number">5.3.3.</span> <span class="nav-text">Recommendations</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#joining-example"><span class="nav-number">5.3.4.</span> <span class="nav-text">Joining example</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#stack-management"><span class="nav-number">5.4.</span> <span class="nav-text">Stack Management</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#preventing-stack-problems"><span class="nav-number">5.4.1.</span> <span class="nav-text">Preventing stack problems:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#example-1"><span class="nav-number">5.4.2.</span> <span class="nav-text">Example</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#miscellaneous-routines"><span class="nav-number">5.5.</span> <span class="nav-text">Miscellaneous Routines</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mutex-variables"><span class="nav-number">6.</span> <span class="nav-text">6. Mutex Variables</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#example-2"><span class="nav-number">6.1.</span> <span class="nav-text">Example</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#condition-variables"><span class="nav-number">7.</span> <span class="nav-text">7. Condition Variables</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#example-3"><span class="nav-number">7.0.1.</span> <span class="nav-text">Example</span></a></li></ol></li></ol><li class="nav-item nav-level-2"><a class="nav-link" href="#monitoring-debugging"><span class="nav-number">8.</span> <span class="nav-text">8. Monitoring, Debugging</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#topic-to-be-covered-in-future"><span class="nav-number">9.</span> <span class="nav-text">9. Topic to be Covered in
Future</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#reference"><span class="nav-number">10.</span> <span class="nav-text">Reference</span></a></li></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Yue Jiao</p>
  <div class="site-description" itemprop="description">Personal blog for idea sharing and archiving.</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">38</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">36</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.yj0.se/2021/posix_threads_programming_note/">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Yue Jiao">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yue Jiao's blog">
      <meta itemprop="description" content="Personal blog for idea sharing and archiving.">
    </span>

    <span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Introduction to Posix Threads Programming | Yue Jiao's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Introduction to Posix Threads Programming
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-04-05 00:00:00" itemprop="dateCreated datePublished" datetime="2021-04-05T00:00:00+02:00">2021-04-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-07-29 03:00:41" itemprop="dateModified" datetime="2022-07-29T03:00:41+02:00">2022-07-29</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>28k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time </span>
      <span>25 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>The basic of Posix thread programming is introduced in this article.
More advanced topic might be added later.</p>
<span id="more"></span>
<h2 id="abstract">1. Abstract</h2>
<p>In shared memory multiprocessor architectures, threads can be used to
implement parallelism. Historically, hardware vendors have implemented
their own proprietary version of threads, making portability a concern
for software developers. For UNIX systems, a standardized C language
threads programming interface has been specified. Implementations that
adhere to this standard are referred to as POSIX threads, or
Pthreads</p>
<h2 id="pthreads-overview">2. Pthreads Overview</h2>
<h3 id="what-is-a-thread">What is a thread?</h3>
<p>Technically, a thread is defined as an independent stream of
instructions that can be scheduled to run as such by the operating
system</p>
<p>A process is created by the operating system, and requires a fair
amount of "overhead". Processes contain information about program
resources and program execution state, including:</p>
<ul>
<li>Process ID, process group ID, user ID, and group ID</li>
<li>Environment</li>
<li>Working directory</li>
<li>Program instructions</li>
<li>Registers</li>
<li>Stack</li>
<li>Heap</li>
<li>File descriptors</li>
<li>Signal actions</li>
<li>Shared libraries</li>
<li>Inter-process communication tools
<ul>
<li>Such as message queues, pipes, semaphores, or shared memory</li>
</ul></li>
</ul>
<p>Threads use and exist within these process resources, yet are able to
be schedules by the operating system and run as independent entities
largely because they duplicate only the bare essential resources that
enable them to exist as executable code</p>
<p>This independent flow of control is accomplished because a thread
maintains its own:</p>
<ul>
<li>Stack pointer</li>
<li>Registers</li>
<li>Scheduling properties
<ul>
<li>Such as policy or priority</li>
</ul></li>
<li>Set of pending and blocked signal</li>
<li>Thread specific data</li>
</ul>
<p>So, in summary, in the UNIX environment, a thread:</p>
<ul>
<li>Exists within a process and uses the process' resources</li>
<li>Has its own independent flow of control as long as its parent
process exists and the OS supports it</li>
<li>Duplicates only the essential resources it needs to be independently
schedulable</li>
<li>May share the process resources with other threads that act equally
independently (and dependently)</li>
<li>Dies if the parent process dies</li>
<li>It "lightweight" because most of the overhead has already been
accomplished throught the creation of its process</li>
</ul>
<p>Because threads within the same process share resources:</p>
<ul>
<li>Changes made by one thread to shared system resources (such as
closing a file) will be seen by all other threads</li>
<li>Two pointers having the same value point to the same data</li>
<li>Reading and writing to the same memory locationss is possible, and
therefore requires explicit synchronization by the programmer</li>
</ul>
<h3 id="what-are-pthreads">What are Pthreads?</h3>
<p>Pthreadsare defined as a set of C language programming types and
procedure calls, implemented with a <code>pthread.h</code> header and a
thread library - though this library may be part of another library,
such as <code>libc</code>, in some implementations</p>
<h3 id="why-pthreads">Why Pthreads?</h3>
<ul>
<li>Lightweight
<ul>
<li>A thread can be created with much less operating system
overhead</li>
</ul></li>
<li>Efficient communications / data exchange
<ul>
<li>In the worst case scenario, Pthread communications become more of a
cache-to-CPU or memory-to-CPU bandwidth issue. These speeds are much
higher than MPI shared memory communications</li>
</ul></li>
<li>Threaded applications offer potential performance gains and
practical advantages over non-threaded applications in several other
ways
<ul>
<li>Overlapping CPU work with I/O: For example, a program may have
sections where it is performing a long I/O operation. While one thread
is waiting for an I/O system call to complete, CPU intensive work can be
performed by other thread</li>
<li>Priority/real-time scheduling: tasks which are more important can be
scheduled to supersede or interrupt lower priority tasks</li>
<li>Asynchronous event handling: tasks which service events of
indeterminate frequency and duration can be interleaved. For example, a
web server can both transfer data from previous requests and manage the
arrival of new requests</li>
</ul></li>
</ul>
<h3 id="designing-threaded-programs">Designing threaded programs</h3>
<p>There are many considerations for designing parallel programs, such
as:</p>
<ul>
<li>What type of parallel programming model to use?</li>
<li>Problem partitioning</li>
<li>Load balancing</li>
<li>Communications</li>
<li>Data dependencies</li>
<li>Synchronization and race conditions</li>
<li>Memory issues</li>
<li>I/O issues</li>
<li>Program complexity</li>
<li>Programmer effort / costs / time</li>
<li>...</li>
</ul>
<p>In general, in order for a program to take advantage of Pthreads, it
must be able to be organized into discrete, independent tasks which can
execute concurrently</p>
<p>Programs having the following characteristics may be well suited for
pthreads:</p>
<ul>
<li>Work that can be executed, or data that can be operated on, by
multiple tasks simultaneously</li>
<li>Block for potentially long I/O waits</li>
<li>Use many CPU cycles in some places but not others</li>
<li>Must respond to asynchronous events</li>
<li>Some work is more important than other work (priority
interrupts)</li>
</ul>
<p>Several common models for threaded programs exist:</p>
<ul>
<li>Manager/worker: a single thread, the manager assigns work to other
threads, the workers. Typically, the manager handles all input and
parcels out work to the other tasks. At least two forms of the
manager/worker model are common: static worker pool and dynamic worker
pool</li>
<li>Pipeline: a task is broken into a series of suboperations, each of
which is handled in series, but concurrently, by a different thread. An
automobile assembly line best describes this model</li>
<li>Peer: similar to the manager / worker model, but after the main
thread creates other threads, it participates in the work</li>
</ul>
<h4 id="shared-memory-model">Shared memory model</h4>
<p>All threads have access to the same global, shared memory. Threads
also have their own private data. Programmers are responsible for
synchronizing access (protecting) globally shared data</p>
<h4 id="thread-safeness">Thread-safeness</h4>
<p>In a nutshell, refers to an application's ability to execute multiple
threads simultaneously without "clobbering" shared data or creating
"race" conditions. The implication to users of external library routines
is that if you aren't 100% certain the routine is thread-safe, then you
take your chances with problems that could arise</p>
<p>Recommendation: Be careful if your application uses libraries or
other objects that don't explicitly guarantee thread-safeness. When in
doubt, assume that they are not until proven otherwise. This can be done
by "serializing" the calls to the uncertain routine, etc.</p>
<h4 id="thread-limits">Thread limits</h4>
<p>The Pthreads API is an ANSI/IEEE standard, implementations can vary
in ways not specified by the standard. Several thread limits are
discussed in more detail later</p>
<h2 id="the-pthreads-api">3. The Pthreads API</h2>
<p>The subroutines which comprise the Pthreads API can be informally
grouped into four major groups</p>
<ul>
<li>Thread management: Routines that work directly on threads -
creating, detaching, joining, etc. They also include functions to set /
query thread attributes (joinable, scheduling etc.)</li>
<li>Mutexes: Routines that deal with synchronization, called a " mutex",
which is an abbreviation for "mutual exclusion". Mutex functions
provides for creating, destroying, locking and unlocking mutexes. These
are supplemented by mutex attribute functions that set or modify
attributes associated with mutexes</li>
<li>Condition variables: Routines that address communications between
threads that share a mutex. Based upon programmer specified conditions.
This group includes functions to create, destroy, wait and signal based
upon specified variable values. Functions to set / query condition
variable attributes are also included</li>
<li>Synchronization: Routines that manage read 7 write locks and
barriers</li>
</ul>
<p>Naming conventions:</p>
<table>
<colgroup>
<col style="width: 27%">
<col style="width: 72%">
</colgroup>
<thead>
<tr>
<th>Routine Prefix</th>
<th>Functional Group</th>
</tr>
</thead>
<tbody>
<tr>
<td>pthread_</td>
<td>Threads themselves and miscellaneous subroutines</td>
</tr>
<tr>
<td>pthread_attr_</td>
<td>Thread attributes objects</td>
</tr>
<tr>
<td>pthread_mutex_</td>
<td>Mutexes</td>
</tr>
<tr>
<td>pthread_mutexattr_</td>
<td>Mutex attributes objects</td>
</tr>
<tr>
<td>pthread_cond_</td>
<td>Condition variables</td>
</tr>
<tr>
<td>pthread_condattr_</td>
<td>Condition attributes objects</td>
</tr>
<tr>
<td>pthread_key_</td>
<td>Thread-specific data keys</td>
</tr>
<tr>
<td>pthread_rwlock_</td>
<td>Read/write locks</td>
</tr>
<tr>
<td>pthread_barrier_</td>
<td>Synchronization barriers</td>
</tr>
</tbody>
</table>
<p>The concept of opaque objects pervades the design of the API. The
basic calls work to create or modify opaque objects - the opaque objects
can be modified by calls to attribute functions, which deal with opaque
attributes</p>
<h2 id="compiling-threaded-programs">4. Compiling Threaded Programs</h2>
<p>Several examples of compile commands used for pthreads codes are
listed in the table below</p>
<table>
<thead>
<tr>
<th>Compiler / Platform</th>
<th>Compiler command</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Intel Linux</td>
<td>icc -pthread</td>
<td>C</td>
</tr>
<tr>
<td>Intel Linux</td>
<td>icpc -pthread</td>
<td>C++</td>
</tr>
<tr>
<td>PGI Linux</td>
<td>pgcc -lpthread</td>
<td>C</td>
</tr>
<tr>
<td>PGI Linux</td>
<td>pgCC -lpthread</td>
<td>C++</td>
</tr>
<tr>
<td>GNU Linux</td>
<td>gcc -pthread</td>
<td>GNU C</td>
</tr>
<tr>
<td>GNU Linux</td>
<td>g++ -pthread</td>
<td>GNU C++</td>
</tr>
</tbody>
</table>
<h2 id="thread-management">5. Thread management</h2>
<h3 id="creating-and-terminating-threads">Creating and terminating
threads</h3>
<h4 id="creating-threads">Creating threads:</h4>
<p>Initially, your <code>main()</code> program comprises a single,
default thread. All other threads must be explicitly created by the
programmer. <code>pthread_create</code> creates a new thread and makes
it executable. This routine can be called any number of times from
anywhere within your code</p>
<p><code>pthread_create</code>'s arguments:</p>
<ul>
<li><code>thread</code>: An opaque, unique identifier for the new thread
returned by the subroutine</li>
<li><code>attr</code>: An opaque attribute object that may be used to
set thread attributes. You can specify a thread attributes object, or
NULL for the default values</li>
<li><code>start_routine</code>: the C routine that the thread will
execute once it is created</li>
<li><code>arg</code>: A single argument that may be passed to
<code>start_routine</code>. It must be passed by reference as a pointer
cast of type void. NULL may be used if no argument is to be passed</li>
</ul>
<p>The maximum number of threads that may be created by a process is
implementation dependent. Programs that attempt to exceed the limit can
fail or produce wrong results. It can be set by command
<code>ulimit</code> on Linux</p>
<h4 id="thread-attributes">Thread attributes</h4>
<p>By default, a thread is created with certain attributes. Some of
these attributes can be changed by the programmer via the thread
attribute object</p>
<p><code>pthread_attr_init</code> and <code>pthread_attr_destroy</code>
are used to initialize / destroy the thread attribute object. Other
routines are then used to query / set specific attributes in the thread
attribute object. Attributes include:</p>
<ul>
<li>Detached or joinable state</li>
<li>Scheduling inheritance</li>
<li>Scheduling policy</li>
<li>Scheduling parameters</li>
<li>Scheduling contention scope</li>
<li>Stack size</li>
<li>Stack address</li>
<li>Stack guard (overflow) size</li>
</ul>
<h4 id="thread-binding-and-scheduling">Thread binding and
scheduling</h4>
<p>The Pthreads API provides several routines that may be used to
specify how threads are scheduled for execution. For example, threads
can be scheduled to run FIFO (first-in first-out), RR (round-robin) or
OTHER (operating system determines). It also provides the ability to set
a thread's scheduling priority value. The
<code>sched_setscheduler</code> man page on Linux has more information
about this</p>
<p>The Pthreads API does not provide routines for binding threads to
specific cpus/cores. However, local implementations may include this
functionality - such as the non-standard
<code>pthread_setaffinity_np</code> routine. Here <code>_np</code>
stands for "non-portable"</p>
<h4 id="thread-termination">Thread termination</h4>
<p>There are several ways in which a thread may be terminated:</p>
<ul>
<li>The thread returns normally from its starting routine. Its work is
done</li>
<li>The thread makes a call to the <code>pthread_exit</code> subroutine
- whether its work is done or not</li>
<li>The thread is canceled by another thread via the
<code>pthread_cancel</code> routine</li>
<li>The entire process is terminated due to making a call to either the
<code>exec()</code> or <code>exit()</code></li>
<li>If <code>main()</code> finishes first, without calling
<code>pthread_exit</code> explicitly itself
<ul>
<li>There is a definite problem if <code>main()</code> finishes before
the threads it spawned if you don't call <code>pthread_exit()</code>
explicitly. All of the threads it created will terminate because
<code>main()</code> is done and no longer exists to support the
threads</li>
<li>By having <code>main()</code> explicitly call
<code>pthread_exit()</code>as the last thing it does,
<code>main()</code> will block and be kept alive to support the threads
it created until they are done</li>
</ul></li>
</ul>
<p>The <code>pthread_exit()</code> routine allows the programmer to
specify an optional termination status parameter. This optional
parameter is typically returned to threads "joining" the terminated
thread. In subroutines that execute to completion normally, you can
often dispense with calling <code>pthread_exit()</code> - unless, of
course, you want to pass the optional status code back</p>
<p>The <code>pthread_exit()</code> routine does not close files; any
files opened inside the thread will remain open after the thread is
terminated</p>
<h4 id="example">Example:</h4>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> NUM_THREADS 5</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">PrintHello</span> <span class="params">(<span class="type">void</span> * threadid)</span> {</span><br><span class="line">    <span class="type">long</span> tid;</span><br><span class="line">    tid = (<span class="type">long</span>) threadid;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Hello World from thread #%ld!\n"</span>, tid);</span><br><span class="line">    pthread_exit(<span class="literal">NULL</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> {</span><br><span class="line">    <span class="type">pthread_t</span> threads[NUM_THREADS];</span><br><span class="line">    <span class="type">int</span> rc;</span><br><span class="line">    <span class="type">long</span> t;</span><br><span class="line">    <span class="keyword">for</span> (t = <span class="number">0</span>; t &lt; NUM_THREADS; t++) {</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"In main: creating thread %ld\n"</span>, t);</span><br><span class="line">        rc = pthread_create(&amp;threads[t], <span class="literal">NULL</span>, PrintHello, (<span class="type">void</span> *)t);</span><br><span class="line">        <span class="keyword">if</span> (rc) {</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"ERROR: return code from pthread_create() is %d\n"</span>, rc);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* Last thing that main() should do */</span></span><br><span class="line">    pthread_exit(<span class="literal">NULL</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="passing-arguments-to-threads">Passing arguments to threads</h3>
<p>The <code>pthread_create()</code> routine permits the programmer to
pass one argument to the thread start routine. All arguments must be
passed by reference and cast to <code>(void *)</code></p>
<p>How can you safely pass data to newly created threads, given their
non-deterministic start-up and scheduling?</p>
<h4 id="example-1-uses-a-unique-data-structure-for-each-thread">Example
1: uses a unique data structure for each thread</h4>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> NUM_THREADS 8</span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span> * messages[NUM_THREADS];</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">PrintHello</span><span class="params">(<span class="type">void</span> *threadid)</span> {</span><br><span class="line">    <span class="type">long</span> taskid;</span><br><span class="line">    sleep(<span class="number">1</span>);</span><br><span class="line">    taskid = (<span class="type">long</span>) threadid;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Thread %d: %s\n"</span>, taskid, messages[taskid]);</span><br><span class="line">    pthread_exit(<span class="literal">NULL</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> {</span><br><span class="line">    <span class="type">pthread_t</span> threads[NUM_THREADS];</span><br><span class="line">    <span class="type">long</span> taskids[NUM_THREADS];</span><br><span class="line">    <span class="type">int</span> rc, t;</span><br><span class="line">    </span><br><span class="line">    messages[<span class="number">0</span>] = <span class="string">"English: Hello World!"</span>;</span><br><span class="line">    messages[<span class="number">1</span>] = <span class="string">"French: Bonjour, le monde!"</span>;</span><br><span class="line">    messages[<span class="number">2</span>] = <span class="string">"Spanish: Hola al mundo"</span>;</span><br><span class="line">    messages[<span class="number">3</span>] = <span class="string">"Klingon: Nuq neH!"</span>;</span><br><span class="line">    messages[<span class="number">4</span>] = <span class="string">"German: Guten Tag, Welt!"</span>; </span><br><span class="line">    messages[<span class="number">5</span>] = <span class="string">"Russian: Zdravstvuyte, mir!"</span>;</span><br><span class="line">    messages[<span class="number">6</span>] = <span class="string">"Japan: Sekai e konnichiwa!"</span>;</span><br><span class="line">    messages[<span class="number">7</span>] = <span class="string">"Latin: Orbis, te saluto!"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(t = <span class="number">0</span>; t &lt; NUM_THREADS; t++) {</span><br><span class="line">        taskids[t] = t;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Creating thread %d\n"</span>, t);</span><br><span class="line">        rc = pthread_create(&amp;threads[t], <span class="literal">NULL</span>, PrintHello, (<span class="type">void</span> *) taskids[t]);</span><br><span class="line">        <span class="keyword">if</span> (rc) {</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"ERROR: return code from pthread_create() is %d\n"</span>, rc);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    pthread_exit(<span class="literal">NULL</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="example-2-passing-multiple-arguments-via-a-structure">Example 2:
passing multiple arguments via a structure</h4>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> NUM_THREADS 8</span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span> * messages[NUM_THREADS];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">thread_data</span> {</span></span><br><span class="line">    <span class="type">int</span> thread_id;</span><br><span class="line">    <span class="type">int</span> sum;</span><br><span class="line">    <span class="type">char</span> * message;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">thread_data</span> <span class="title">thread_data_array</span>[<span class="title">NUM_THREADS</span>];</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">PrintHello</span><span class="params">(<span class="type">void</span> *threadarg)</span> {</span><br><span class="line">    <span class="type">int</span> taskid, sum;</span><br><span class="line">    <span class="type">char</span> * hello_msg;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">thread_data</span> * <span class="title">my_data</span>;</span></span><br><span class="line">    </span><br><span class="line">    sleep(<span class="number">1</span>);</span><br><span class="line">    my_data = (<span class="keyword">struct</span> thread_data *) threadarg;</span><br><span class="line">    taskid = my_data -&gt; threadid;</span><br><span class="line">    sum = my_data -&gt; sum;</span><br><span class="line">    hello_msg = my_data -&gt; message;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Thread %d: %s, Sum = %d\n"</span>, taskid, hello_msg, sum);</span><br><span class="line">    pthread_exit(<span class="literal">NULL</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> {</span><br><span class="line">    <span class="type">pthread_t</span> threads[NUM_THREADS];</span><br><span class="line">    <span class="type">int</span> * taskids[NUM_THREADS];</span><br><span class="line">    <span class="type">int</span> rc, t, sum;</span><br><span class="line">    </span><br><span class="line">    sum = <span class="number">0</span>;</span><br><span class="line">    messages[<span class="number">0</span>] = <span class="string">"English: Hello World!"</span>;</span><br><span class="line">    messages[<span class="number">1</span>] = <span class="string">"French: Bonjour, le monde!"</span>;</span><br><span class="line">    messages[<span class="number">2</span>] = <span class="string">"Spanish: Hola al mundo"</span>;</span><br><span class="line">    messages[<span class="number">3</span>] = <span class="string">"Klingon: Nuq neH!"</span>;</span><br><span class="line">    messages[<span class="number">4</span>] = <span class="string">"German: Guten Tag, Welt!"</span>; </span><br><span class="line">    messages[<span class="number">5</span>] = <span class="string">"Russian: Zdravstvuyte, mir!"</span>;</span><br><span class="line">    messages[<span class="number">6</span>] = <span class="string">"Japan: Sekai e konnichiwa!"</span>;</span><br><span class="line">    messages[<span class="number">7</span>] = <span class="string">"Latin: Orbis, te saluto!"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(t = <span class="number">0</span>; t &lt; NUM_THREADS; t++) {</span><br><span class="line">        sum = sum + t;</span><br><span class="line">        thread_data_array[t].thread_id = t;</span><br><span class="line">        thread_data_array[t].sum = sum;</span><br><span class="line">        thread_data_array[t].message = messages[t];</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Creating thread %d\n"</span>, t);</span><br><span class="line">        rc = pthread_create(&amp;threads[t], <span class="literal">NULL</span>, PrintHello, (<span class="type">void</span> *) thread_data_array[t]);</span><br><span class="line">        <span class="keyword">if</span> (rc) {</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"ERROR: return code from pthread_create() is %d\n"</span>, rc);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    pthread_exit(<span class="literal">NULL</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="joining-and-detaching-threads">Joining and detaching
threads</h3>
<p>Joining is one way to accomplish synchronization between threads. The
<code>pthread_join()</code> subroutine blocks the calling thread until
the specified thread terminates. The programmer is able to obtain the
target thread's termination return status if it was specified in the
thread's call to <code>pthread_exit()</code>. A joining thread can match
one <code>pthread_join()</code> call. It is a logical error to attempt
multiple joins on the same thread</p>
<h4 id="joinable-or-not">Joinable or not?</h4>
<p>Only threads that are created as joinable can be joined. If a thread
is created as detached, it can never be joined. To explicitly create a
thread as joinable or detached, the <code>attr</code> argument in the
<code>pthread_create()</code> routine is used. The typical 4 step
process is:</p>
<ul>
<li>Declare a pthread attribute variable of the
<code>pthread_attr_t</code> data type</li>
<li>Initialize the attribute variable with
<code>pthread_attr_init()</code></li>
<li>Set the attribute detached status with
<code>pthread_attr_setdetachstate()</code></li>
<li>When done, free library resources used by the attribute with
<code>pthread_attr_destroy()</code></li>
</ul>
<h4 id="detaching">Detaching</h4>
<p>The <code>pthread_detach()</code> routine can be used to explicitly
detach a thread even though it was created as joinable. There is no
converse routine</p>
<h4 id="recommendations">Recommendations</h4>
<p>If a thread requires joining, consider explicitly creating it as
joinable. This provides protability as not all implementations may
create threads as joinable by default. If you know in advance that a
thread will never need to join with another thread, consider creating it
in a detached state. Some system resources may be able to be freed</p>
<h4 id="joining-example">Joining example</h4>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> NUM_THREADS 4</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">BusyWork</span> <span class="params">(<span class="type">void</span> *t)</span> {</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="type">long</span> tid;</span><br><span class="line">    <span class="type">double</span> result = <span class="number">0.0</span>;</span><br><span class="line">    tid = (<span class="type">long</span>) t;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Thread %ld starting ...\n"</span>, tid);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">1000000</span>; i++) {</span><br><span class="line">        result = result + <span class="built_in">sin</span>(i) * <span class="built_in">tan</span>(i);</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Thread %ld done. Result = %e\n"</span>, tid, result);</span><br><span class="line">    pthread_exit((<span class="type">void</span> *) t);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> {</span><br><span class="line">    <span class="type">pthread_t</span> thread[NUM_THREADS];</span><br><span class="line">    <span class="type">pthread_attr_t</span> attr;</span><br><span class="line">    <span class="type">int</span> rc;</span><br><span class="line">    <span class="type">long</span> t;</span><br><span class="line">    <span class="type">void</span> *status;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* Initialize and set thread detached attribute */</span></span><br><span class="line">    pthread_attr_init(&amp;attr);</span><br><span class="line">    pthread_attr_setdetachstate(&amp;attr, PTHREAD_CREATE_JOINABLE);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (t = <span class="number">0</span>; t &lt; NUM_THREADS; t++) {</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Main: creating thread %ld\n"</span>, t);</span><br><span class="line">        rc = pthread_create(&amp;thread[t], &amp;attr, BusyWork, (<span class="type">void</span> *)t);</span><br><span class="line">        <span class="keyword">if</span> (rc) {</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"ERROR: return code from pthread_create() is %d\n"</span>, rc);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* Free attribute and wait for the other threads */</span></span><br><span class="line">    pthread_attr_destroy(&amp;attr);</span><br><span class="line">    <span class="keyword">for</span> (t = <span class="number">0</span>; t &lt; NUM_THREADS; t++) {</span><br><span class="line">        rc = pthread_join(thread[t], &amp;status);</span><br><span class="line">        <span class="keyword">if</span> (rc) {</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"ERROR: return code from pthread_join() is %d\n"</span>, rc);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Main: completed join with thread %ld having a status of %ld\n"</span>, t, (<span class="type">long</span>) status);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Main: program completed. Exiting.\n"</span>);</span><br><span class="line">    pthread_exit(<span class="literal">NULL</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="stack-management">Stack Management</h3>
<h4 id="preventing-stack-problems">Preventing stack problems:</h4>
<p>The POSIX standard does not dictate the size of a thread's stack.
This is implementation dependent and varies. Safe and portable programs
do not depend upon the default stack limit, but instead, explicitly
allocate enough stack for each thread by using the
<code>pthread_attr_setstacksize</code> routine. The
<code>pthread_attr_getstackaddr</code> and
<code>pthread_attr_setstackaddr</code> routines can be used by
applications in an environment where the stack for a thread must be
placed in some particular region of memory</p>
<h4 id="example-1">Example</h4>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> NTHREADS 4</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 1000</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MEGEXTRA 1000000</span></span><br><span class="line"></span><br><span class="line"><span class="type">pthread_attr_t</span> attr;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> * <span class="title function_">dowork</span> <span class="params">(<span class="type">void</span> * threadid)</span> {</span><br><span class="line">    <span class="type">double</span> A[N][N];</span><br><span class="line">    <span class="type">int</span> i, j;</span><br><span class="line">    <span class="type">long</span> tid;</span><br><span class="line">    <span class="type">size_t</span> mystacksize;</span><br><span class="line">    </span><br><span class="line">    tid = (<span class="type">long</span>) threadid;</span><br><span class="line">    pthread_attr_getstacksize(&amp;attr, &amp;mystacksize);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Thread %ld: stack size = %li bytes\n"</span>, tid, mystacksize);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; N; j++) </span><br><span class="line">            A[i][j] = ((i * j) / <span class="number">3.452</span>) + (N - i);</span><br><span class="line">    pthread_exit(<span class="literal">NULL</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> {</span><br><span class="line">    <span class="type">pthread_t</span> threads[NTHREADS];</span><br><span class="line">    <span class="type">size_t</span> stacksize;</span><br><span class="line">    <span class="type">int</span> rc;</span><br><span class="line">    <span class="type">long</span> t;</span><br><span class="line">    </span><br><span class="line">    pthread_attr_init(&amp;attr);</span><br><span class="line">    pthread_attr_getstacksize (&amp;attr, &amp;stacksize);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Default stack size = %li\n"</span>, stacksize);</span><br><span class="line">    stacksize = <span class="keyword">sizeof</span> (<span class="type">double</span>) * N * N + MEGEXTRA;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Amount of stack needed per thread = %li\n"</span>, stacksize);</span><br><span class="line">    pthread_attr_setstacksize(&amp;attr, stacksize);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Creating threads with stack size = %li bytes\n"</span>, stacksize);</span><br><span class="line">    <span class="keyword">for</span> (t = <span class="number">0</span>; t &lt; NTHREADS; t++) {</span><br><span class="line">        rc = pthread_create(&amp;threads[t], &amp;attr, dowork, (<span class="type">void</span> *) t);</span><br><span class="line">        <span class="keyword">if</span> (rc) {</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"ERROR: return code from pthread_create() is %d\n"</span>, rc);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Created %ld threads.\n"</span>, t);</span><br><span class="line">    pthread_exit(<span class="literal">NULL</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="miscellaneous-routines">Miscellaneous Routines</h3>
<p><code>pthread_self()</code> return the unique, system assigned thread
ID of the calling thread. <code>pthread_equal(thread1, thread2)</code>
compares two thread IDs. returns non-zero if they are equal. Note that
for both of these routines, the thread identifier objects are opaque and
cannot be easily inspected. Because thread IDs are opaque objects, the C
language equivalence operator <code>==</code> should not be used for
comparison</p>
<p><code>pthread_once(once_control, init_routine)</code> executes the
<code>init_routine</code> exactly once in a process. The first call to
this routine by any thread in the process executes the given
<code>init_routine</code>, without parameters. Any subsequent call will
have no effect. The <code>init_routine</code> is typically an
initialization routine. The <code>once_control</code> parameter is a
synchronization control structure that requires initialization prior to
calling <code>pthread_once</code>. For example</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">pthread_once_t</span> once_control = PTHREAD_ONCE_INIT;</span><br></pre></td></tr></tbody></table></figure>
<h2 id="mutex-variables">6. Mutex Variables</h2>
<p>Mutex variables are one of the primary means of implementing thread
synchronization and for protecting shared data when multiple writes
occur. A mutex variable acts like a "lock" protecting access to a shared
data resource</p>
<p>Only one thread can lock (or own) a mutex variable at any given time.
Even if several threads try to lock a mutex only one thread will be
successful. No other thread can own that mutex until the owning thread
unlocks that mutex</p>
<p>A typical sequence in the use of a mutex is as follows:</p>
<ul>
<li>Create and initialize a mutex variable</li>
<li>Several threads attempt to lock the mutex</li>
<li>Only one succeeds and that thread owns the mutex</li>
<li>The owner thread performs some set of actions</li>
<li>The owner unlocks the mutex</li>
<li>Another thread acquires the mutex and repeats the process</li>
<li>Finally the mutex is destroyed</li>
</ul>
<p>Mutex variables must be declared with type
<code>pthread_mutex_t</code>, and must be initialized before they can be
used. There are two ways to initialize a mutex variable:</p>
<ol type="1">
<li><p>Statically, when it is declared. For example</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">pthread_mutex_t</span> mymutex = PTHREAD_MUTEX_INITIALIZER;</span><br></pre></td></tr></tbody></table></figure></li>
<li><p>Dynamically, with the <code>pthread_mutex_init()</code> routine.
This method permits setting mutex object attributes,
<code>attr</code></p>
<p>The <code>attr</code> object is used to establish properties for the
mutex object, and must be of type <code>pthread_mutexattr_t</code> if
used. The Pthreads standard defines 3 optional mutex attributes:</p>
<ul>
<li>Protocol: Specifies the protocol used to prevent priority inversions
for a mutex</li>
<li>Prioceiling: Specifies the priority ceiling of a mutex</li>
<li>Process-shared: Specifies the process sharing of a mutex</li>
</ul>
<p>Note that not all implementations provide the three optional mutex
attributes</p></li>
</ol>
<p>The mutex is initially unlocked. The
<code>pthread_mutexattr_init()</code> and
<code>pthread_mutexattr_destroy()</code> routines are used to create and
destroy mutex attribute objects respectively</p>
<p>The <code>pthread_mutex_lock()</code> routine is used by a thread to
acquire a lock on the specified mutex variable. If the mutex is already
locked by another thread, this call will block the calling thread until
the mutex is unlocked</p>
<p><code>pthread_mutex_trylock()</code> will attempt to lock a mutex. If
the mutex is already locked, the routine will return immediately with a
"busy" error code. This routine may be useful in preventing deadlock
conditions, as in a priority-inversion situation</p>
<p><code>pthread_mutex_unlock()</code> will unlock a mutex if called by
the owning thread. An error will be returned if:</p>
<ul>
<li>If the mutex was already unlocked</li>
<li>If the mutex is owned by another thread</li>
</ul>
<h3 id="example-2">Example</h3>
<p>This example program illustrates the use of mutex variables in a
threads program that performs a dot product</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">    <span class="type">double</span>		*a;</span><br><span class="line">    <span class="type">double</span>		*b;</span><br><span class="line">    <span class="type">double</span> 	   sum;</span><br><span class="line">    <span class="type">int</span>     veclen;</span><br><span class="line">} DOTDATA;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> NUMTHRDS 4</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> VECLEN 100</span></span><br><span class="line"></span><br><span class="line">DOTDATA dotstr;</span><br><span class="line"><span class="type">pthread_t</span> callThd[NUMTHRDS];</span><br><span class="line"><span class="type">pthread_mutex_t</span> mutexsum;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">dotprod</span> <span class="params">(<span class="type">void</span> *arg)</span> {</span><br><span class="line">    <span class="type">int</span> i, start, end, len;</span><br><span class="line">    <span class="type">long</span> offset;</span><br><span class="line">    <span class="type">double</span> mysum, *x, *y;</span><br><span class="line">    offset = (<span class="type">long</span>) arg;</span><br><span class="line">    </span><br><span class="line">    len = dotstr.veclen;</span><br><span class="line">    start = offset*len;</span><br><span class="line">    end = start + len;</span><br><span class="line">    x = dotstr.a;</span><br><span class="line">    y = dotstr.b;</span><br><span class="line">    </span><br><span class="line">    mysum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = start; i &lt; end; i++) {</span><br><span class="line">        mysum += (x[i] * y[i]);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    pthread_mutex_lock (&amp;mutexsum);</span><br><span class="line">    dotstr.sum += mysum;</span><br><span class="line">    pthread_mutex_unlock (&amp;mutexsum);</span><br><span class="line">    </span><br><span class="line">    pthread_exit((<span class="type">void</span> *) <span class="number">0</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span> <span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span> {</span><br><span class="line">    <span class="type">long</span> i;</span><br><span class="line">    <span class="type">double</span> *a, *b;</span><br><span class="line">    <span class="type">void</span> *status;</span><br><span class="line">    <span class="type">pthread_attr_t</span> attr;</span><br><span class="line">    </span><br><span class="line">    a = (<span class="type">double</span>*) <span class="built_in">malloc</span> (NUMTHRDS * VECLEN * <span class="keyword">sizeof</span>(<span class="type">double</span>));</span><br><span class="line">    b = (<span class="type">double</span>*) <span class="built_in">malloc</span> (NUMTHRDS * VECLEN * <span class="keyword">sizeof</span>(<span class="type">double</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; VECLEN * NUMTHRDS; i++) {</span><br><span class="line">        a[i] = <span class="number">1.0</span>;</span><br><span class="line">        b[i] = a[i];</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    dotstr.veclen = VECLEN;</span><br><span class="line">    dotstr.a = a;</span><br><span class="line">    dotstr.b = b;</span><br><span class="line">    dotstr.sum = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    pthread_mutex_init(&amp;mutexsum, <span class="literal">NULL</span>);</span><br><span class="line">    </span><br><span class="line">    pthread_attr_init(&amp;attr);</span><br><span class="line">    pthread_attr_setdetachstate(&amp;attr, PTHREAD_CREATE_JOINABLE);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; NUMTHRDS; i++) {</span><br><span class="line">        pthread_create(&amp;callThd[i], &amp;attr, dotprod, (<span class="type">void</span> *)i);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    pthread_attr_destroy(&amp;attr);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; NUMTHRDS; i++) {</span><br><span class="line">        pthread_join(callThd[i], &amp;status);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Sum = %f\n"</span>, dotstr.sum);</span><br><span class="line">    <span class="built_in">free</span> (a);</span><br><span class="line">    <span class="built_in">free</span> (b);</span><br><span class="line">    pthread_mutex_destroy(&amp;mutexsum);</span><br><span class="line">    pthread_exit(<span class="literal">NULL</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="condition-variables">7. Condition Variables</h2>
<p>Condition variables provide yet another way for threads to
synchronize. Condition variables implement synchronization based upon
the actual value of data. A condition variable is always used in
conjunction with a mutex lock. A representative sequence for using
condition variables is shown below</p>
<p>Condition variables must be declared with type
<code>pthread_cond_t</code>, and must be initialized before they can be
used. There are two ways to initilize a condition variable:</p>
<ul>
<li><p>Statically: when it is declared. For example</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">pthread_cond_t</span> myconvar = PTHREAD_COND_INITIALIZER;</span><br></pre></td></tr></tbody></table></figure></li>
<li><p>Dynamically, with the <code>pthread_cond_init()</code> routine.
The ID of the created condition variable is returned to the calling
thread through the condition parameter. This method permits setting
condition variable object attributes, <code>attr</code></p></li>
</ul>
<p>The optional <code>attr</code> object is used to set condition
variable attributes. There is only one attribute defined for condition
variables: process-shared, which allows the condition variable to be
seen by threads in other processes. The attribute object, if used, must
be of type <code>pthread_condattr_t</code>. Note that not all
implemetations may provide the process-shared attribute</p>
<p>The <code>pthread_condattr_init()</code> and
<code>pthread_condattr_destroy()</code> routines are used to create and
destroy condition variable attribute objects</p>
<p><code>pthread_cond_wait()</code> blocks the calling thread until the
specified condition is signalled. This routine should be called while
mutex is locked, and it will automatically release the mutex while it
waits. After signal is received and thread is awakened, mutex will be
automatically locked for use by the thread. The programmer is then
responsible for unlocking mutex when the thread is finished with it</p>
<p>Recommendation: Using a <code>while</code> loop instead of an
<code>if</code> statement to check the waited for condition can help
deal with several potential problems, such as:</p>
<ul>
<li>If several threads are waiting for the same wake up signal, they
will take turns acquiring the mutex and any one of them can then modify
the condition they all waited for</li>
<li>If the thread received the signal in error due to a program bug</li>
<li>The Pthreads library is permitted to issue spurious wake ups to a
waiting thread without violating the standard</li>
</ul>
<p>The <code>pthread_cond_signal()</code> routine is used to signal (or
wake up) another thread which is waiting on the condition variable. It
should be called after mutex is locked, and must unlock mutex in order
for <code>pthread_cond_wait()</code> routine to complete</p>
<p>The <code>pthread_cond_broadcast()</code> routine should be used
instead of <code>pthread_cond_signal()</code> if more than one thread is
in a blocking wait state. It is a logical error to call
<code>pthread_cond_signal()</code> before calling
<code>pthread_cond_wait()</code></p>
<p>Proper locking and unlocking of the associated mutex variable is
essential when using these routines. For example</p>
<ul>
<li>Failing to lock the mutex before calling
<code>pthread_cond_wait()</code> may cause it NOT to block</li>
<li>Failing to unlock the mutex after calling
<code>pthread_cond_signal()</code> may not allow a matching
<code>pthread_cond_wait()</code> routine to complete (it will remain
blocked)</li>
</ul>
<h4 id="example-3">Example</h4>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> NUM_THREADS 3</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TCOUNT 10</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> COUNT_LIMIT 12</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="type">pthread_mutex_t</span> count_mutex;</span><br><span class="line"><span class="type">pthread_cond_t</span> count_threshold_cv;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">inc_count</span> <span class="params">(<span class="type">void</span> *t)</span> {</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="type">long</span> my_id = (<span class="type">long</span>) t;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; TCOUNT; i++) {</span><br><span class="line">        pthread_mutex_lock(&amp;count_mutex);</span><br><span class="line">        count++;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (count == COUNT_LIMIT) {</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"inc_count(): thread %ld, count = %d, Threshold reached.\n"</span>, my_id, count);</span><br><span class="line">            pthread_cond_signal(&amp;count_threshold_cv);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"Just sent the signal.\n"</span>);</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"inc_count(): thread %ld, count = %d, unlocking mutex\n"</span>, my_id, count);</span><br><span class="line">        pthread_mutex_unlock(&amp;count_mutex);</span><br><span class="line">        </span><br><span class="line">        sleep(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    pthread_exit(<span class="literal">NULL</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">watch_count</span><span class="params">(<span class="type">void</span> *t)</span> {</span><br><span class="line">    <span class="type">long</span> my_id = (<span class="type">long</span>) t;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Starting watch_count(): thread %ld\n"</span>, my_id);</span><br><span class="line">    </span><br><span class="line">    pthread_mutex_lock(&amp;count_mutex);</span><br><span class="line">    <span class="keyword">while</span>(count &lt; COUNT_LIMIT) {</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"watch_count(): thread %ld. Count= %d. Going into wait...\n"</span>, my_id, count);</span><br><span class="line">        pthread_cond_wait(&amp;count_threshold_cv, &amp;count_mutex);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"watch_count(): thread %ld. Condition signal received. Count= %d\n"</span>, my_id, count);</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"watch_count(): thread %ld. Updating the value of count...\n"</span>, my_id);</span><br><span class="line">    count += <span class="number">125</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"watch_count(): thread %ld count now = %d.\n"</span>, my_id, count);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"watch_count(): thread %ld unlocking mutex.\n"</span>, my_id);</span><br><span class="line">    pthread_mutex_unlock(&amp;count_mutex);</span><br><span class="line">    pthread_exit(<span class="literal">NULL</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> {</span><br><span class="line">    <span class="type">int</span> i, rc;</span><br><span class="line">    <span class="type">long</span> t1 = <span class="number">1</span>, t2 = <span class="number">2</span>, t3 = <span class="number">3</span>;</span><br><span class="line">    <span class="type">pthread_t</span> threads[<span class="number">3</span>];</span><br><span class="line">    <span class="type">pthread_attr_t</span> attr;</span><br><span class="line">    </span><br><span class="line">    pthread_mutex_init(&amp;count_mutex, <span class="literal">NULL</span>);</span><br><span class="line">    pthread_cond_init(&amp;count_threshold_cv, <span class="literal">NULL</span>);</span><br><span class="line">    </span><br><span class="line">    pthread_attr_init(&amp;attr);</span><br><span class="line">    pthread_attr_setdetachstate(&amp;attr, PTHREAD_CREATE_JOINABLE);</span><br><span class="line">    pthread_create(&amp;threads[<span class="number">0</span>], &amp;attr, watch_count, (<span class="type">void</span>*) t1);</span><br><span class="line">    pthread_create(&amp;threads[<span class="number">1</span>], &amp;attr, inc_count, (<span class="type">void</span>*) t2);</span><br><span class="line">    pthread_create(&amp;threads[<span class="number">2</span>], &amp;attr, inc_count, (<span class="type">void</span>*) t3);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; NUM_THREADS; i++) {</span><br><span class="line">        pthread_join(threads[i], <span class="literal">NULL</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Main(): Waited and joined with %d threads. Final value of count = %d. Done.\n"</span>, NUM_THREADS, count);</span><br><span class="line">    </span><br><span class="line">    pthread_attr_destroy(&amp;attr);</span><br><span class="line">    pthread_mutex_destroy(&amp;count_mutex);</span><br><span class="line">    pthread_cond_destroy(&amp;count_threshold_cv);</span><br><span class="line">    pthread_exit(<span class="literal">NULL</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="monitoring-debugging">8. Monitoring, Debugging</h2>
<p>To monitoring and debugging Pthreads program, we can use the
TotalView debugger</p>
<p>Several performance analysis tools worth investigating, include:</p>
<ul>
<li>Open SpeedShop</li>
<li>TAU</li>
<li>HPCToolKit</li>
<li>PAPI</li>
<li>Intel VTune Amplifier ThreadSpotter</li>
</ul>
<h2 id="topic-to-be-covered-in-future">9. Topic to be Covered in
Future</h2>
<ul>
<li>Thread scheduling
<ul>
<li>Implementations will differ on how threads are scheduled to run. In
most cases, the default mechanism is adequate</li>
<li>The Pthreads API provides routines to explicitly set thread
scheduling policies ad priorities which may override the default
mechanisms</li>
<li>The API does not require implementations to support these
features</li>
</ul></li>
<li>Keys: Thread-specific data
<ul>
<li>As threads call andreturn from different routines, the local data on
a thread's stack comes and goes</li>
<li>To preserve stack data you can usually pass it as an argument from
one routine to the next, or else store the data in a global variable
associated with a thread</li>
<li>Pthreads provides another, possibly more convenient and versatile,
way of accomplishing this through keys</li>
</ul></li>
<li>Mutex protocol attributes and mutex priorit management for the
handling of "priority inversion" problems
<ul>
<li>Condition variable sharing - across processes</li>
<li>Thread cancellation</li>
<li>Threads and signals</li>
<li>Synchronization constructs - barriers and locks</li>
</ul></li>
</ul>
<h2 id="reference">Reference</h2>
<ol type="1">
<li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hpc-tutorials.llnl.gov/posix/">Lawrence Livermore
National Laboratory</a></li>
</ol>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Programming/" rel="tag"># Programming</a>
              <a href="/tags/C/" rel="tag"># C</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/intro-to-go/" rel="prev" title="Introduction to Go">
                  <i class="fa fa-angle-left"></i> Introduction to Go
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/lombok_note/" rel="next" title="Reducing Boilerplate Code with Project Lombok">
                  Reducing Boilerplate Code with Project Lombok <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
     
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-cat"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Yue Jiao</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="Word count total">686k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">10:24</span>
  </span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener external nofollow noreferrer" target="_blank">Hexo</a> &amp; <a href="https://theme-next.js.org/" rel="noopener external nofollow noreferrer" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>








  







<script src="/bundle.js"></script></body></html>