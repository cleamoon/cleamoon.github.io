<!DOCTYPE html><html lang="en"><head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.0.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">






  

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.yj0.se","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.21.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/./public/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script>

    <meta name="description" content="Booknote of The Modern JavaScript Tutorial. This is a comprehensive guide to JavaScript programming in a modern style. The part 1 cover the core element of modern JavaScript.">
<meta property="og:type" content="article">
<meta property="og:title" content="The Modern JavaScript Tutorial - Part 1 Core JavaScript Note">
<meta property="og:url" content="http://blog.yj0.se/2021/modern-js-p1/index.html">
<meta property="og:site_name" content="Yue Jiao's blog">
<meta property="og:description" content="Booknote of The Modern JavaScript Tutorial. This is a comprehensive guide to JavaScript programming in a modern style. The part 1 cover the core element of modern JavaScript.">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-10-30T22:00:00.000Z">
<meta property="article:modified_time" content="2022-07-29T01:00:41.690Z">
<meta property="article:author" content="Yue Jiao">
<meta property="article:tag" content="Programming">
<meta property="article:tag" content="JavaScript">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://blog.yj0.se/2021/modern-js-p1/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://blog.yj0.se/2021/modern-js-p1/","path":"2021/modern-js-p1/","title":"The Modern JavaScript Tutorial - Part 1 Core JavaScript Note"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>The Modern JavaScript Tutorial - Part 1 Core JavaScript Note | Yue Jiao's blog</title>
  








  <style>:root {
  --body-bg-color: #eee;
  --content-bg-color: #fff;
  --card-bg-color: #f5f5f5;
  --text-color: #555;
  --selection-bg: #262a30;
  --selection-color: #eee;
  --blockquote-color: #666;
  --link-color: #555;
  --link-hover-color: #222;
  --brand-color: #fff;
  --brand-hover-color: #fff;
  --table-row-odd-bg-color: #f9f9f9;
  --table-row-hover-bg-color: #f5f5f5;
  --menu-item-bg-color: #f5f5f5;
  --theme-color: #222;
  --btn-default-bg: #fff;
  --btn-default-color: #555;
  --btn-default-border-color: #555;
  --btn-default-hover-bg: #222;
  --btn-default-hover-color: #fff;
  --btn-default-hover-border-color: #222;
  --highlight-background: #f0f0f0;
  --highlight-foreground: #444;
  --highlight-gutter-background: #dedede;
  --highlight-gutter-foreground: #555;
  color-scheme: light;
}
html {
  line-height: 1.15; /* 1 */
  -webkit-text-size-adjust: 100%; /* 2 */
}
body {
  margin: 0;
}
main {
  display: block;
}
h1 {
  font-size: 2em;
  margin: 0.67em 0;
}
hr {
  box-sizing: content-box; /* 1 */
  height: 0; /* 1 */
  overflow: visible; /* 2 */
}
pre {
  font-family: monospace, monospace; /* 1 */
  font-size: 1em; /* 2 */
}
a {
  background: transparent;
}
abbr[title] {
  border-bottom: none; /* 1 */
  text-decoration: underline; /* 2 */
  text-decoration: underline dotted; /* 2 */
}
b,
strong {
  font-weight: bolder;
}
code,
kbd,
samp {
  font-family: monospace, monospace; /* 1 */
  font-size: 1em; /* 2 */
}
small {
  font-size: 80%;
}
sub,
sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}
sub {
  bottom: -0.25em;
}
sup {
  top: -0.5em;
}
img {
  border-style: none;
}
button,
input,
optgroup,
select,
textarea {
  font-family: inherit; /* 1 */
  font-size: 100%; /* 1 */
  line-height: 1.15; /* 1 */
  margin: 0; /* 2 */
}
button,
input {
/* 1 */
  overflow: visible;
}
button,
select {
/* 1 */
  text-transform: none;
}
button,
[type='button'],
[type='reset'],
[type='submit'] {
  -webkit-appearance: button;
}
button::-moz-focus-inner,
[type='button']::-moz-focus-inner,
[type='reset']::-moz-focus-inner,
[type='submit']::-moz-focus-inner {
  border-style: none;
  padding: 0;
}
button:-moz-focusring,
[type='button']:-moz-focusring,
[type='reset']:-moz-focusring,
[type='submit']:-moz-focusring {
  outline: 1px dotted ButtonText;
}
fieldset {
  padding: 0.35em 0.75em 0.625em;
}
legend {
  box-sizing: border-box; /* 1 */
  color: inherit; /* 2 */
  display: table; /* 1 */
  max-width: 100%; /* 1 */
  padding: 0; /* 3 */
  white-space: normal; /* 1 */
}
progress {
  vertical-align: baseline;
}
textarea {
  overflow: auto;
}
[type='checkbox'],
[type='radio'] {
  box-sizing: border-box; /* 1 */
  padding: 0; /* 2 */
}
[type='number']::-webkit-inner-spin-button,
[type='number']::-webkit-outer-spin-button {
  height: auto;
}
[type='search'] {
  outline-offset: -2px; /* 2 */
  -webkit-appearance: textfield; /* 1 */
}
[type='search']::-webkit-search-decoration {
  -webkit-appearance: none;
}
::-webkit-file-upload-button {
  font: inherit; /* 2 */
  -webkit-appearance: button; /* 1 */
}
details {
  display: block;
}
summary {
  display: list-item;
}
template {
  display: none;
}
[hidden] {
  display: none;
}
::selection {
  background: var(--selection-bg);
  color: var(--selection-color);
}
html,
body {
  height: 100%;
}
body {
  background: var(--body-bg-color);
  box-sizing: border-box;
  color: var(--text-color);
  font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;
  font-size: 1em;
  line-height: 2;
  min-height: 100%;
  position: relative;
  transition: padding 0.2s ease-in-out;
}
h1,
h2,
h3,
h4,
h5,
h6 {
  font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;
  font-weight: bold;
  line-height: 1.5;
  margin: 30px 0 15px;
}
h1 {
  font-size: 1.5em;
}
h2 {
  font-size: 1.375em;
}
h3 {
  font-size: 1.25em;
}
h4 {
  font-size: 1.125em;
}
h5 {
  font-size: 1em;
}
h6 {
  font-size: 0.875em;
}
p {
  margin: 0 0 20px;
}
a {
  border-bottom: 1px solid #999;
  color: var(--link-color);
  cursor: pointer;
  outline: 0;
  text-decoration: none;
  overflow-wrap: break-word;
}
a:hover {
  border-bottom-color: var(--link-hover-color);
  color: var(--link-hover-color);
}
iframe,
img,
video,
embed {
  display: block;
  margin-left: auto;
  margin-right: auto;
  max-width: 100%;
}
hr {
  background-image: repeating-linear-gradient(-45deg, #ddd, #ddd 4px, transparent 4px, transparent 8px);
  border: 0;
  height: 3px;
  margin: 40px 0;
}
blockquote {
  border-left: 4px solid #ddd;
  color: var(--blockquote-color);
  margin: 0;
  padding: 0 15px;
}
blockquote cite::before {
  content: '-';
  padding: 0 5px;
}
dt {
  font-weight: bold;
}
dd {
  margin: 0;
  padding: 0;
}
.table-container {
  overflow: auto;
}
table {
  border-collapse: collapse;
  border-spacing: 0;
  font-size: 0.875em;
  margin: 0 0 20px;
  width: 100%;
}
tbody tr:nth-of-type(odd) {
  background: var(--table-row-odd-bg-color);
}
tbody tr:hover {
  background: var(--table-row-hover-bg-color);
}
caption,
th,
td {
  padding: 8px;
}
th,
td {
  border: 1px solid #ddd;
  border-bottom: 3px solid #ddd;
}
th {
  font-weight: 700;
  padding-bottom: 10px;
}
td {
  border-bottom-width: 1px;
}
.btn {
  background: var(--btn-default-bg);
  border: 2px solid var(--btn-default-border-color);
  border-radius: 2px;
  color: var(--btn-default-color);
  display: inline-block;
  font-size: 0.875em;
  line-height: 2;
  padding: 0 20px;
  transition: background-color 0.2s ease-in-out;
}
.btn:hover {
  background: var(--btn-default-hover-bg);
  border-color: var(--btn-default-hover-border-color);
  color: var(--btn-default-hover-color);
}
.btn + .btn {
  margin: 0 0 8px 8px;
}
.btn .fa-fw {
  text-align: left;
  width: 1.285714285714286em;
}
.toggle {
  line-height: 0;
}
.toggle .toggle-line {
  background: #fff;
  display: block;
  height: 2px;
  left: 0;
  position: relative;
  top: 0;
  transition: 0.4s;
  transition-property: left, opacity, top, transform, width;
  width: 100%;
}
.toggle .toggle-line:first-child {
  margin-top: 1px;
}
.toggle .toggle-line:not(:first-child) {
  margin-top: 4px;
}
.toggle.toggle-arrow :first-child {
  left: 50%;
  top: 2px;
  transform: rotate(45deg);
  width: 50%;
}
.toggle.toggle-arrow :last-child {
  left: 50%;
  top: -2px;
  transform: rotate(-45deg);
  width: 50%;
}
.toggle.toggle-close :nth-child(2) {
  opacity: 0;
}
.toggle.toggle-close :first-child {
  top: 6px;
  transform: rotate(45deg);
}
.toggle.toggle-close :last-child {
  top: -6px;
  transform: rotate(-45deg);
}
/*

Original highlight.js style (c) Ivan Sagalaev <maniac@softwaremaniacs.org>

*/

.hljs {
  display: block;
  overflow-x: auto;
  padding: 0.5em;
  background: #F0F0F0;
}


/* Base color: saturation 0; */

.hljs,
.hljs-subst {
  color: #444;
}

.hljs-comment {
  color: #888888;
}

.hljs-keyword,
.hljs-attribute,
.hljs-selector-tag,
.hljs-meta-keyword,
.hljs-doctag,
.hljs-name {
  font-weight: bold;
}


/* User color: hue: 0 */

.hljs-type,
.hljs-string,
.hljs-number,
.hljs-selector-id,
.hljs-selector-class,
.hljs-quote,
.hljs-template-tag,
.hljs-deletion {
  color: #880000;
}

.hljs-title,
.hljs-section {
  color: #880000;
  font-weight: bold;
}

.hljs-regexp,
.hljs-symbol,
.hljs-variable,
.hljs-template-variable,
.hljs-link,
.hljs-selector-attr,
.hljs-selector-pseudo {
  color: #BC6060;
}


/* Language color: hue: 90; */

.hljs-literal {
  color: #78A960;
}

.hljs-built_in,
.hljs-bullet,
.hljs-code,
.hljs-addition {
  color: #397300;
}


/* Meta color: hue: 200 */

.hljs-meta {
  color: #1f7199;
}

.hljs-meta-string {
  color: #4d99bf;
}


/* Misc effects */

.hljs-emphasis {
  font-style: italic;
}

.hljs-strong {
  font-weight: bold;
}

code,
kbd,
figure.highlight,
pre {
  background: var(--highlight-background);
  color: var(--highlight-foreground);
}
figure.highlight,
pre {
  line-height: 1.6;
  margin: 0 auto 20px;
}
figure.highlight figcaption,
pre .caption,
pre figcaption {
  background: var(--highlight-gutter-background);
  color: var(--highlight-foreground);
  display: flow-root;
  font-size: 0.875em;
  line-height: 1.2;
  padding: 0.5em;
}
figure.highlight figcaption a,
pre .caption a,
pre figcaption a {
  color: var(--highlight-foreground);
  float: right;
}
figure.highlight figcaption a:hover,
pre .caption a:hover,
pre figcaption a:hover {
  border-bottom-color: var(--highlight-foreground);
}
pre,
code {
  font-family: consolas, Menlo, monospace, 'PingFang SC', 'Microsoft YaHei';
}
code {
  border-radius: 3px;
  font-size: 0.875em;
  padding: 2px 4px;
  overflow-wrap: break-word;
}
kbd {
  border: 2px solid #ccc;
  border-radius: 0.2em;
  box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1);
  font-family: inherit;
  padding: 0.1em 0.3em;
  white-space: nowrap;
}
figure.highlight {
  overflow: auto;
  position: relative;
}
figure.highlight pre {
  border: 0;
  margin: 0;
  padding: 10px 0;
}
figure.highlight table {
  border: 0;
  margin: 0;
  width: auto;
}
figure.highlight td {
  border: 0;
  padding: 0;
}
figure.highlight .gutter {
  -moz-user-select: none;
  -ms-user-select: none;
  -webkit-user-select: none;
  user-select: none;
}
figure.highlight .gutter pre {
  background: var(--highlight-gutter-background);
  color: var(--highlight-gutter-foreground);
  padding-left: 10px;
  padding-right: 10px;
  text-align: right;
}
figure.highlight .code pre {
  padding-left: 10px;
  width: 100%;
}
figure.highlight .marked {
  background: rgba(0,0,0,0.3);
}
pre .caption,
pre figcaption {
  margin-bottom: 10px;
}
.gist table {
  width: auto;
}
.gist table td {
  border: 0;
}
pre {
  overflow: auto;
  padding: 10px;
}
pre code {
  background: none;
  padding: 0;
  text-shadow: none;
}
.blockquote-center {
  border-left: 0;
  margin: 40px 0;
  padding: 0;
  position: relative;
  text-align: center;
}
.blockquote-center::before,
.blockquote-center::after {
  left: 0;
  line-height: 1;
  opacity: 0.6;
  position: absolute;
  width: 100%;
}
.blockquote-center::before {
  border-top: 1px solid #ccc;
  text-align: left;
  top: -20px;
  content: '\f10d';
  font-family: 'Font Awesome 6 Free';
  font-weight: 900;
}
.blockquote-center::after {
  border-bottom: 1px solid #ccc;
  bottom: -20px;
  text-align: right;
  content: '\f10e';
  font-family: 'Font Awesome 6 Free';
  font-weight: 900;
}
.blockquote-center p,
.blockquote-center div {
  text-align: center;
}
.group-picture {
  margin-bottom: 20px;
}
.group-picture .group-picture-row {
  display: flex;
  gap: 3px;
  margin-bottom: 3px;
}
.group-picture .group-picture-column {
  flex: 1;
}
.group-picture .group-picture-column img {
  height: 100%;
  margin: 0;
  object-fit: cover;
  width: 100%;
}
.post-body .label {
  color: #555;
  padding: 0 2px;
}
.post-body .label.default {
  background: #f0f0f0;
}
.post-body .label.primary {
  background: #efe6f7;
}
.post-body .label.info {
  background: #e5f2f8;
}
.post-body .label.success {
  background: #e7f4e9;
}
.post-body .label.warning {
  background: #fcf6e1;
}
.post-body .label.danger {
  background: #fae8eb;
}
.post-body .link-grid {
  display: grid;
  grid-gap: 1.5rem;
  gap: 1.5rem;
  grid-template-columns: 1fr 1fr;
  margin-bottom: 20px;
  padding: 1rem;
}
@media (max-width: 767px) {
  .post-body .link-grid {
    grid-template-columns: 1fr;
  }
}
.post-body .link-grid .link-grid-container {
  border: solid #ddd;
  box-shadow: 1rem 1rem 0.5rem rgba(0,0,0,0.5);
  min-height: 5rem;
  min-width: 0;
  padding: 0.5rem;
  position: relative;
  transition: background 0.3s;
}
.post-body .link-grid .link-grid-container:hover {
  animation: next-shake 0.5s;
  background: var(--card-bg-color);
}
.post-body .link-grid .link-grid-container:active {
  box-shadow: 0.5rem 0.5rem 0.25rem rgba(0,0,0,0.5);
  transform: translate(0.2rem, 0.2rem);
}
.post-body .link-grid .link-grid-container .link-grid-image {
  border: 1px solid #ddd;
  border-radius: 50%;
  box-sizing: border-box;
  height: 5rem;
  padding: 3px;
  position: absolute;
  width: 5rem;
}
.post-body .link-grid .link-grid-container p {
  margin: 0 1rem 0 6rem;
}
.post-body .link-grid .link-grid-container p:first-of-type {
  font-size: 1.2em;
}
.post-body .link-grid .link-grid-container p:last-of-type {
  font-size: 0.8em;
  line-height: 1.3rem;
  opacity: 0.7;
}
.post-body .link-grid .link-grid-container a {
  border: 0;
  height: 100%;
  left: 0;
  position: absolute;
  top: 0;
  width: 100%;
}
@keyframes next-shake {
  0% {
    transform: translate(1pt, 1pt) rotate(0deg);
  }
  10% {
    transform: translate(-1pt, -2pt) rotate(-1deg);
  }
  20% {
    transform: translate(-3pt, 0pt) rotate(1deg);
  }
  30% {
    transform: translate(3pt, 2pt) rotate(0deg);
  }
  40% {
    transform: translate(1pt, -1pt) rotate(1deg);
  }
  50% {
    transform: translate(-1pt, 2pt) rotate(-1deg);
  }
  60% {
    transform: translate(-3pt, 1pt) rotate(0deg);
  }
  70% {
    transform: translate(3pt, 1pt) rotate(-1deg);
  }
  80% {
    transform: translate(-1pt, -1pt) rotate(1deg);
  }
  90% {
    transform: translate(1pt, 2pt) rotate(0deg);
  }
  100% {
    transform: translate(1pt, -2pt) rotate(-1deg);
  }
}
.post-body .note {
  border-radius: 3px;
  margin-bottom: 20px;
  padding: 1em;
  position: relative;
  border: 1px solid #eee;
  border-left-width: 5px;
}
.post-body .note summary {
  cursor: pointer;
  outline: 0;
}
.post-body .note summary p {
  display: inline;
}
.post-body .note h2,
.post-body .note h3,
.post-body .note h4,
.post-body .note h5,
.post-body .note h6 {
  border-bottom: initial;
  margin: 0;
  padding-top: 0;
}
.post-body .note :first-child {
  margin-top: 0;
}
.post-body .note :last-child {
  margin-bottom: 0;
}
.post-body .note.default {
  border-left-color: #777;
}
.post-body .note.default h2,
.post-body .note.default h3,
.post-body .note.default h4,
.post-body .note.default h5,
.post-body .note.default h6 {
  color: #777;
}
.post-body .note.primary {
  border-left-color: #6f42c1;
}
.post-body .note.primary h2,
.post-body .note.primary h3,
.post-body .note.primary h4,
.post-body .note.primary h5,
.post-body .note.primary h6 {
  color: #6f42c1;
}
.post-body .note.info {
  border-left-color: #428bca;
}
.post-body .note.info h2,
.post-body .note.info h3,
.post-body .note.info h4,
.post-body .note.info h5,
.post-body .note.info h6 {
  color: #428bca;
}
.post-body .note.success {
  border-left-color: #5cb85c;
}
.post-body .note.success h2,
.post-body .note.success h3,
.post-body .note.success h4,
.post-body .note.success h5,
.post-body .note.success h6 {
  color: #5cb85c;
}
.post-body .note.warning {
  border-left-color: #f0ad4e;
}
.post-body .note.warning h2,
.post-body .note.warning h3,
.post-body .note.warning h4,
.post-body .note.warning h5,
.post-body .note.warning h6 {
  color: #f0ad4e;
}
.post-body .note.danger {
  border-left-color: #d9534f;
}
.post-body .note.danger h2,
.post-body .note.danger h3,
.post-body .note.danger h4,
.post-body .note.danger h5,
.post-body .note.danger h6 {
  color: #d9534f;
}
.post-body .tabs {
  margin-bottom: 20px;
}
.post-body .tabs,
.tabs-comment {
  padding-top: 10px;
}
.post-body .tabs ul.nav-tabs,
.tabs-comment ul.nav-tabs {
  background: var(--content-bg-color);
  display: flex;
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  margin: 0;
  padding: 0;
  position: -webkit-sticky;
  position: sticky;
  top: 0;
  z-index: 5;
}
@media (max-width: 413px) {
  .post-body .tabs ul.nav-tabs,
  .tabs-comment ul.nav-tabs {
    display: block;
    margin-bottom: 5px;
  }
}
.post-body .tabs ul.nav-tabs li.tab,
.tabs-comment ul.nav-tabs li.tab {
  border-bottom: 1px solid #ddd;
  border-left: 1px solid transparent;
  border-right: 1px solid transparent;
  border-radius: 0 0 0 0;
  border-top: 3px solid transparent;
  flex-grow: 1;
  list-style-type: none;
}
@media (max-width: 413px) {
  .post-body .tabs ul.nav-tabs li.tab,
  .tabs-comment ul.nav-tabs li.tab {
    border-bottom: 1px solid transparent;
    border-left: 3px solid transparent;
    border-right: 1px solid transparent;
    border-top: 1px solid transparent;
  }
}
@media (max-width: 413px) {
  .post-body .tabs ul.nav-tabs li.tab,
  .tabs-comment ul.nav-tabs li.tab {
    border-radius: 0;
  }
}
.post-body .tabs ul.nav-tabs li.tab a,
.tabs-comment ul.nav-tabs li.tab a {
  border-bottom: initial;
  display: block;
  line-height: 1.8;
  padding: 0.25em 0.75em;
  text-align: center;
  transition: all 0.2s ease-out;
}
.post-body .tabs ul.nav-tabs li.tab a i[class^='fa'],
.tabs-comment ul.nav-tabs li.tab a i[class^='fa'] {
  width: 1.285714285714286em;
}
.post-body .tabs ul.nav-tabs li.tab.active,
.tabs-comment ul.nav-tabs li.tab.active {
  border-bottom-color: transparent;
  border-left-color: #ddd;
  border-right-color: #ddd;
  border-top-color: #fc6423;
}
@media (max-width: 413px) {
  .post-body .tabs ul.nav-tabs li.tab.active,
  .tabs-comment ul.nav-tabs li.tab.active {
    border-bottom-color: #ddd;
    border-left-color: #fc6423;
    border-right-color: #ddd;
    border-top-color: #ddd;
  }
}
.post-body .tabs ul.nav-tabs li.tab.active a,
.tabs-comment ul.nav-tabs li.tab.active a {
  cursor: default;
}
.post-body .tabs .tab-content,
.tabs-comment .tab-content {
  border: 1px solid #ddd;
  border-radius: 0 0 0 0;
  border-top-color: transparent;
}
@media (max-width: 413px) {
  .post-body .tabs .tab-content,
  .tabs-comment .tab-content {
    border-radius: 0;
    border-top-color: #ddd;
  }
}
.post-body .tabs .tab-content .tab-pane,
.tabs-comment .tab-content .tab-pane {
  padding: 20px 20px 0;
}
.post-body .tabs .tab-content .tab-pane:not(.active),
.tabs-comment .tab-content .tab-pane:not(.active) {
  display: none;
}
.pagination .prev,
.pagination .next,
.pagination .page-number,
.pagination .space {
  display: inline-block;
  margin: -1px 10px 0;
  padding: 0 10px;
}
@media (max-width: 767px) {
  .pagination .prev,
  .pagination .next,
  .pagination .page-number,
  .pagination .space {
    margin: 0 5px;
  }
}
.pagination .page-number.current {
  background: #ccc;
  border-color: #ccc;
  color: var(--content-bg-color);
}
.pagination {
  border-top: 1px solid #eee;
  margin: 120px 0 0;
  text-align: center;
}
.pagination .prev,
.pagination .next,
.pagination .page-number {
  border-bottom: 0;
  border-top: 1px solid #eee;
  transition: border-color 0.2s ease-in-out;
}
.pagination .prev:hover,
.pagination .next:hover,
.pagination .page-number:hover {
  border-top-color: var(--link-hover-color);
}
@media (max-width: 767px) {
  .pagination {
    border-top: 0;
  }
  .pagination .prev,
  .pagination .next,
  .pagination .page-number {
    border-bottom: 1px solid #eee;
    border-top: 0;
  }
  .pagination .prev:hover,
  .pagination .next:hover,
  .pagination .page-number:hover {
    border-bottom-color: var(--link-hover-color);
  }
}
.pagination .space {
  margin: 0;
  padding: 0;
}
.comments {
  margin-top: 60px;
  overflow: hidden;
}
.comment-button-group {
  display: flex;
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  justify-content: center;
  margin: 1em 0;
}
.comment-button-group .comment-button {
  margin: 0.1em 0.2em;
}
.comment-button-group .comment-button.active {
  background: var(--btn-default-hover-bg);
  border-color: var(--btn-default-hover-border-color);
  color: var(--btn-default-hover-color);
}
.comment-position {
  display: none;
}
.comment-position.active {
  display: block;
}
.tabs-comment {
  margin-top: 4em;
  padding-top: 0;
}
.tabs-comment .comments {
  margin-top: 0;
  padding-top: 0;
}
.headband {
  background: var(--theme-color);
  height: 3px;
}
@media (max-width: 991px) {
  .headband {
    display: none;
  }
}
.site-brand-container {
  display: flex;
  flex-shrink: 0;
  padding: 0 10px;
}
.use-motion .column,
.use-motion .site-brand-container .toggle {
  opacity: 0;
}
.site-meta {
  flex-grow: 1;
  text-align: center;
}
@media (max-width: 767px) {
  .site-meta {
    text-align: center;
  }
}
.custom-logo-image {
  margin-top: 20px;
}
@media (max-width: 991px) {
  .custom-logo-image {
    display: none;
  }
}
.brand {
  border-bottom: 0;
  color: var(--brand-color);
  display: inline-block;
  padding: 0;
}
.brand:hover {
  color: var(--brand-hover-color);
}
.site-title {
  font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;
  font-size: 1.375em;
  font-weight: normal;
  line-height: 1.5;
  margin: 0;
}
.site-subtitle {
  color: #ddd;
  font-size: 0.8125em;
  margin: 10px 10px 0;
}
.use-motion .site-title,
.use-motion .site-subtitle,
.use-motion .custom-logo-image {
  opacity: 0;
  position: relative;
  top: -10px;
}
.site-nav-toggle,
.site-nav-right {
  display: none;
}
@media (max-width: 767px) {
  .site-nav-toggle,
  .site-nav-right {
    display: flex;
    flex-direction: column;
    justify-content: center;
  }
}
.site-nav-toggle .toggle,
.site-nav-right .toggle {
  color: var(--text-color);
  padding: 10px;
  width: 22px;
}
.site-nav-toggle .toggle .toggle-line,
.site-nav-right .toggle .toggle-line {
  background: var(--text-color);
  border-radius: 1px;
}
@media (max-width: 767px) {
  .site-nav {
    --scroll-height: 0;
    height: 0;
    overflow: hidden;
    transition: 0.2s ease-in-out;
    transition-property: height, visibility;
    visibility: hidden;
  }
  body:not(.site-nav-on) .site-nav .animated {
    animation: none;
  }
  body.site-nav-on .site-nav {
    height: var(--scroll-height);
    visibility: unset;
  }
}
.menu {
  margin: 0;
  padding: 1em 0;
  text-align: center;
}
.menu-item {
  display: inline-block;
  list-style: none;
  margin: 0 10px;
}
@media (max-width: 767px) {
  .menu-item {
    display: block;
    margin-top: 10px;
  }
  .menu-item.menu-item-search {
    display: none;
  }
}
.menu-item a {
  border-bottom: 0;
  display: block;
  font-size: 0.8125em;
  transition: border-color 0.2s ease-in-out;
}
.menu-item a:hover,
.menu-item a.menu-item-active {
  background: var(--menu-item-bg-color);
}
.menu-item i[class^='fa'] {
  margin-right: 8px;
}
.menu-item .badge {
  background: #ccc;
  border-radius: 10px;
  color: var(--content-bg-color);
  font-weight: bold;
  line-height: 1;
  margin-left: 0.35em;
  padding: 2px 5px;
  text-shadow: 1px 1px 0 rgba(0,0,0,0.1);
}
.use-motion .menu-item {
  visibility: hidden;
}
@media (max-width: 991px) {
  .sidebar {
    left: -320px;
  }
  .sidebar-active .sidebar {
    left: 0;
  }
  .sidebar {
    background: #222;
    bottom: 0;
    box-shadow: inset 0 2px 6px #000;
    max-height: 100vh;
    overflow-y: auto;
    position: fixed;
    top: 0;
    transition: 0.2s ease-out;
    transition-property: left, right;
    width: 320px;
    z-index: 20;
  }
  .sidebar a {
    border-bottom-color: #555;
    color: #999;
  }
  .sidebar a:hover {
    border-bottom-color: #eee;
    color: #eee;
  }
  .links-of-author:not(:first-child) {
    margin-top: 15px;
  }
  .links-of-author a {
    border-bottom-color: #555;
    display: inline-block;
    margin-bottom: 10px;
    margin-right: 10px;
    vertical-align: middle;
  }
  .links-of-author a::before {
    background: #66feb0;
    display: inline-block;
    margin-right: 3px;
    transform: translateY(-2px);
    border-radius: 50%;
    content: ' ';
    height: 4px;
    width: 4px;
  }
  .links-of-blogroll-item {
    padding: 2px 10px;
  }
  .links-of-blogroll-item a {
    box-sizing: border-box;
    display: inline-block;
    max-width: 280px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  .popular-posts .popular-posts-item .popular-posts-link:hover {
    background: none;
  }
  .sidebar-dimmer {
    background: #000;
    height: 100%;
    left: 0;
    opacity: 0;
    position: fixed;
    top: 0;
    transition: visibility 0.4s, opacity 0.4s;
    visibility: hidden;
    width: 100%;
    z-index: 10;
  }
  .sidebar-active .sidebar-dimmer {
    opacity: 0.7;
    visibility: visible;
  }
}
.sidebar-inner {
  color: #999;
  padding: 18px 10px;
  text-align: center;
  display: flex;
  flex-direction: column;
  justify-content: center;
}
.cc-license .cc-opacity {
  border-bottom: 0;
  opacity: 0.7;
}
.cc-license .cc-opacity:hover {
  opacity: 0.9;
}
.cc-license img {
  display: inline-block;
}
.site-author-image {
  border: 1px solid #eee;
  max-width: 120px;
  padding: 2px;
}
.site-author-name {
  color: var(--text-color);
  font-weight: 600;
  margin: 0;
}
.site-description {
  color: #999;
  font-size: 0.8125em;
  margin-top: 0;
}
.links-of-author a {
  font-size: 0.8125em;
}
.links-of-author i[class^='fa'] {
  margin-right: 2px;
}
.sidebar .sidebar-button:not(:first-child) {
  margin-top: 15px;
}
.sidebar .sidebar-button button {
  background: transparent;
  color: #fc6423;
  cursor: pointer;
  line-height: 2;
  padding: 0 15px;
  border: 1px solid #fc6423;
  border-radius: 4px;
}
.sidebar .sidebar-button button:hover {
  background: #fc6423;
  color: #fff;
}
.sidebar .sidebar-button button i[class^='fa'] {
  margin-right: 5px;
}
.links-of-blogroll {
  font-size: 0.8125em;
}
.links-of-blogroll-title {
  font-size: 0.875em;
  font-weight: 600;
}
.links-of-blogroll-list {
  list-style: none;
  margin: 0;
  padding: 0;
}
.sidebar-nav {
  font-size: 0.875em;
  height: 0;
  margin: 0;
  overflow: hidden;
  padding-left: 0;
  pointer-events: none;
  transition: 0.2s ease-in-out;
  transition-property: height, visibility;
  visibility: hidden;
}
.sidebar-nav-active .sidebar-nav {
  height: calc(2em + 1px);
  pointer-events: unset;
  visibility: unset;
}
.sidebar-nav li {
  border-bottom: 1px solid transparent;
  color: var(--text-color);
  cursor: pointer;
  display: inline-block;
  transition: 0.2s ease-in-out;
  transition-property: border-bottom-color, color;
}
.sidebar-nav li.sidebar-nav-overview {
  margin-left: 10px;
}
.sidebar-nav li:hover {
  color: #fc6423;
}
.sidebar-toc-active .sidebar-nav-toc,
.sidebar-overview-active .sidebar-nav-overview {
  border-bottom-color: #fc6423;
  color: #fc6423;
  transition-delay: 0.2s;
}
.sidebar-toc-active .sidebar-nav-toc:hover,
.sidebar-overview-active .sidebar-nav-overview:hover {
  color: #fc6423;
}
.sidebar-panel-container {
  align-items: start;
  display: grid;
  flex: 1;
  overflow-x: hidden;
  overflow-y: auto;
  padding-top: 0;
  transition: padding-top 0.2s ease-in-out;
}
.sidebar-nav-active .sidebar-panel-container {
  padding-top: 20px;
}
.sidebar-panel {
  animation: deactivate-sidebar-panel 0.2s ease-in-out;
  grid-area: 1/1;
  height: 0;
  opacity: 0;
  overflow: hidden;
  pointer-events: none;
  transform: translateY(0);
  transition: 0.2s ease-in-out;
  transition-delay: 0s;
  transition-property: opacity, transform, visibility;
  visibility: hidden;
}
.sidebar-nav-active .sidebar-panel,
.sidebar-overview-active .sidebar-panel.post-toc-wrap {
  transform: translateY(-20px);
}
.sidebar-overview-active:not(.sidebar-nav-active) .sidebar-panel.post-toc-wrap {
  transition-delay: 0s, 0.2s, 0s;
}
.sidebar-overview-active .sidebar-panel.site-overview-wrap,
.sidebar-toc-active .sidebar-panel.post-toc-wrap {
  animation-name: activate-sidebar-panel;
  height: auto;
  opacity: 1;
  pointer-events: unset;
  transform: translateY(0);
  transition-delay: 0.2s, 0.2s, 0s;
  visibility: unset;
}
.sidebar-panel.site-overview-wrap {
  display: flex;
  flex-direction: column;
  justify-content: center;
  gap: 10px;
  justify-content: flex-start;
}
@keyframes deactivate-sidebar-panel {
  from {
    height: var(--inactive-panel-height, 0);
  }
  to {
    height: var(--active-panel-height, 0);
  }
}
@keyframes activate-sidebar-panel {
  from {
    height: var(--inactive-panel-height, auto);
  }
  to {
    height: var(--active-panel-height, auto);
  }
}
.sidebar-toggle {
  bottom: 61px;
  height: 16px;
  padding: 5px;
  width: 16px;
  background: #222;
  cursor: pointer;
  opacity: 0.6;
  position: fixed;
  z-index: 30;
  left: 30px;
}
@media (max-width: 991px) {
  .sidebar-toggle {
    left: 20px;
  }
}
.sidebar-toggle:hover {
  opacity: 0.8;
}
@media (max-width: 991px) {
  .sidebar-toggle {
    opacity: 0.8;
  }
}
.sidebar-toggle:hover .toggle-line {
  background: #fc6423;
}
@media (any-hover: hover) {
  body:not(.sidebar-active) .sidebar-toggle:hover :first-child {
    left: 50%;
    top: 2px;
    transform: rotate(45deg);
    width: 50%;
  }
  body:not(.sidebar-active) .sidebar-toggle:hover :last-child {
    left: 50%;
    top: -2px;
    transform: rotate(-45deg);
    width: 50%;
  }
}
.sidebar-active .sidebar-toggle :nth-child(2) {
  opacity: 0;
}
.sidebar-active .sidebar-toggle :first-child {
  top: 6px;
  transform: rotate(45deg);
}
.sidebar-active .sidebar-toggle :last-child {
  top: -6px;
  transform: rotate(-45deg);
}
.post-toc {
  font-size: 0.875em;
}
.post-toc ol {
  list-style: none;
  margin: 0;
  padding: 0 2px 0 10px;
  text-align: left;
}
.post-toc ol > :last-child {
  margin-bottom: 5px;
}
.post-toc ol > ol {
  padding-left: 0;
}
.post-toc ol a {
  transition: all 0.2s ease-in-out;
}
.post-toc .nav-item {
  line-height: 1.8;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.post-toc .nav .nav-child {
  --height: 0;
  height: 0;
  opacity: 0;
  overflow: hidden;
  transition-property: height, opacity, visibility;
  transition: 0.2s ease-in-out;
  visibility: hidden;
}
.post-toc .nav .active > .nav-child {
  height: var(--height, auto);
  opacity: 1;
  visibility: unset;
}
.post-toc .nav .active > a {
  border-bottom-color: #fc6423;
  color: #fc6423;
}
.post-toc .nav .active-current > a {
  color: #fc6423;
}
.post-toc .nav .active-current > a:hover {
  color: #fc6423;
}
.site-state {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  line-height: 1.4;
}
.site-state-item {
  padding: 0 15px;
}
.site-state-item a {
  border-bottom: 0;
  display: block;
}
.site-state-item-count {
  display: block;
  font-size: 1em;
  font-weight: 600;
}
.site-state-item-name {
  color: #999;
  font-size: 0.8125em;
}
.footer {
  color: #999;
  font-size: 0.875em;
  padding: 20px 0;
  transition: 0.2s ease-in-out;
  transition-property: left, right;
}
.footer.footer-fixed {
  bottom: 0;
  left: 0;
  position: absolute;
  right: 0;
}
.footer-inner {
  box-sizing: border-box;
  text-align: center;
  display: flex;
  flex-direction: column;
  justify-content: center;
  margin: 0 auto;
  width: calc(100% - 20px);
}
@media (max-width: 767px) {
  .footer-inner {
    width: auto;
  }
}
@media (min-width: 1200px) {
  .footer-inner {
    width: 1160px;
  }
}
@media (min-width: 1600px) {
  .footer-inner {
    width: 73%;
  }
}
.use-motion .footer {
  opacity: 0;
}
.languages {
  display: inline-block;
  font-size: 1.125em;
  position: relative;
}
.languages .lang-select-label span {
  margin: 0 0.5em;
}
.languages .lang-select {
  height: 100%;
  left: 0;
  opacity: 0;
  position: absolute;
  top: 0;
  width: 100%;
}
.with-love {
  color: #00f;
  display: inline-block;
  margin: 0 5px;
}
@keyframes icon-animate {
  0%, 100% {
    transform: scale(1);
  }
  10%, 30% {
    transform: scale(0.9);
  }
  20%, 40%, 60%, 80% {
    transform: scale(1.1);
  }
  50%, 70% {
    transform: scale(1.1);
  }
}
.back-to-top {
  font-size: 12px;
  align-items: center;
  bottom: -100px;
  color: #fff;
  display: flex;
  height: 26px;
  transition: 0.2s ease-in-out;
  transition-property: bottom;
  background: #222;
  cursor: pointer;
  opacity: 0.6;
  position: fixed;
  z-index: 30;
  left: 30px;
}
.back-to-top span {
  margin-right: 8px;
  display: none;
}
.back-to-top .fa {
  text-align: center;
  width: 26px;
}
@media (max-width: 991px) {
  .back-to-top {
    left: 20px;
  }
}
.back-to-top:hover {
  opacity: 0.8;
}
@media (max-width: 991px) {
  .back-to-top {
    opacity: 0.8;
  }
}
.back-to-top:hover {
  color: #fc6423;
}
.back-to-top.back-to-top-on {
  bottom: 30px;
}
.reading-progress-bar {
  --progress: 0;
  background: #37c6c0;
  height: 3px;
  position: fixed;
  z-index: 50;
  width: var(--progress);
  left: 0;
  bottom: 0;
}
.rtl.post-body p,
.rtl.post-body a,
.rtl.post-body h1,
.rtl.post-body h2,
.rtl.post-body h3,
.rtl.post-body h4,
.rtl.post-body h5,
.rtl.post-body h6,
.rtl.post-body li,
.rtl.post-body ul,
.rtl.post-body ol {
  direction: rtl;
  font-family: UKIJ Ekran;
}
.rtl.post-title {
  font-family: UKIJ Ekran;
}
.post-button {
  margin-top: 40px;
  text-align: center;
}
.use-motion .post-block,
.use-motion .pagination,
.use-motion .comments {
  visibility: hidden;
}
.use-motion .post-header {
  visibility: hidden;
}
.use-motion .post-body {
  visibility: hidden;
}
.use-motion .collection-header {
  visibility: hidden;
}
.posts-collapse .post-content {
  margin-bottom: 35px;
  margin-left: 35px;
  position: relative;
}
@media (max-width: 767px) {
  .posts-collapse .post-content {
    margin-left: 0;
    margin-right: 0;
  }
}
.posts-collapse .post-content .collection-title {
  font-size: 1.125em;
  position: relative;
}
.posts-collapse .post-content .collection-title::before {
  background: #999;
  border: 1px solid #fff;
  margin-left: -6px;
  margin-top: -4px;
  position: absolute;
  top: 50%;
  border-radius: 50%;
  content: ' ';
  height: 10px;
  width: 10px;
}
.posts-collapse .post-content .collection-year {
  font-size: 1.5em;
  font-weight: bold;
  margin: 60px 0;
  position: relative;
}
.posts-collapse .post-content .collection-year .collection-year-count {
  font-size: 0.75em;
  background: #ccc;
  border-radius: 10px;
  color: var(--content-bg-color);
  font-weight: bold;
  line-height: 1;
  margin-left: 0.35em;
  padding: 2px 5px;
  text-shadow: 1px 1px 0 rgba(0,0,0,0.1);
}
.posts-collapse .post-content .collection-year::before {
  background: #bbb;
  margin-left: -4px;
  margin-top: -4px;
  position: absolute;
  top: 50%;
  border-radius: 50%;
  content: ' ';
  height: 8px;
  width: 8px;
}
.posts-collapse .post-content .collection-header {
  display: block;
  margin-left: 20px;
}
.posts-collapse .post-content .collection-header small {
  color: #bbb;
  margin-left: 5px;
}
.posts-collapse .post-content .post-header {
  border-bottom: 1px dashed #ccc;
  margin: 30px 2px 0;
  padding-left: 15px;
  position: relative;
  transition: border 0.2s ease-in-out;
}
.posts-collapse .post-content .post-header::before {
  background: #bbb;
  border: 1px solid #fff;
  left: -6px;
  position: absolute;
  top: 0.75em;
  transition: background 0.2s ease-in-out;
  border-radius: 50%;
  content: ' ';
  height: 6px;
  width: 6px;
}
.posts-collapse .post-content .post-header:hover {
  border-bottom-color: #666;
}
.posts-collapse .post-content .post-header:hover::before {
  background: #222;
}
.posts-collapse .post-content .post-meta-container {
  display: inline;
  font-size: 0.75em;
  margin-right: 10px;
}
.posts-collapse .post-content .post-title {
  display: inline;
}
.posts-collapse .post-content .post-title a {
  border-bottom: 0;
  color: var(--link-color);
}
.posts-collapse .post-content .post-title .fa {
  font-size: 0.875em;
  margin-left: 5px;
}
.posts-collapse .post-content::before {
  background: #f5f5f5;
  content: ' ';
  height: 100%;
  margin-left: -2px;
  position: absolute;
  top: 1.25em;
  width: 4px;
}
.post-body {
  font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;
  overflow-wrap: break-word;
}
@media (min-width: 1200px) {
  .post-body {
    font-size: 1.125em;
  }
}
@media (min-width: 992px) {
  .post-body {
    text-align: justify;
  }
}
@media (max-width: 991px) {
  .post-body {
    text-align: justify;
  }
}
.post-body h1 .header-anchor,
.post-body h2 .header-anchor,
.post-body h3 .header-anchor,
.post-body h4 .header-anchor,
.post-body h5 .header-anchor,
.post-body h6 .header-anchor,
.post-body h1 .headerlink,
.post-body h2 .headerlink,
.post-body h3 .headerlink,
.post-body h4 .headerlink,
.post-body h5 .headerlink,
.post-body h6 .headerlink {
  border-bottom-style: none;
  color: inherit;
  float: right;
  font-size: 0.875em;
  margin-left: 10px;
  opacity: 0;
}
.post-body h1 .header-anchor::before,
.post-body h2 .header-anchor::before,
.post-body h3 .header-anchor::before,
.post-body h4 .header-anchor::before,
.post-body h5 .header-anchor::before,
.post-body h6 .header-anchor::before,
.post-body h1 .headerlink::before,
.post-body h2 .headerlink::before,
.post-body h3 .headerlink::before,
.post-body h4 .headerlink::before,
.post-body h5 .headerlink::before,
.post-body h6 .headerlink::before {
  content: '\f0c1';
  font-family: 'Font Awesome 6 Free';
  font-weight: 900;
}
.post-body h1:hover .header-anchor,
.post-body h2:hover .header-anchor,
.post-body h3:hover .header-anchor,
.post-body h4:hover .header-anchor,
.post-body h5:hover .header-anchor,
.post-body h6:hover .header-anchor,
.post-body h1:hover .headerlink,
.post-body h2:hover .headerlink,
.post-body h3:hover .headerlink,
.post-body h4:hover .headerlink,
.post-body h5:hover .headerlink,
.post-body h6:hover .headerlink {
  opacity: 0.5;
}
.post-body h1:hover .header-anchor:hover,
.post-body h2:hover .header-anchor:hover,
.post-body h3:hover .header-anchor:hover,
.post-body h4:hover .header-anchor:hover,
.post-body h5:hover .header-anchor:hover,
.post-body h6:hover .header-anchor:hover,
.post-body h1:hover .headerlink:hover,
.post-body h2:hover .headerlink:hover,
.post-body h3:hover .headerlink:hover,
.post-body h4:hover .headerlink:hover,
.post-body h5:hover .headerlink:hover,
.post-body h6:hover .headerlink:hover {
  opacity: 1;
}
.post-body .exturl .fa {
  font-size: 0.875em;
  margin-left: 4px;
}
.post-body img + figcaption,
.post-body .fancybox + figcaption {
  color: #999;
  font-size: 0.875em;
  font-weight: bold;
  line-height: 1;
  margin: -15px auto 15px;
  text-align: center;
}
.post-body iframe,
.post-body img,
.post-body video,
.post-body embed {
  margin-bottom: 20px;
}
.post-body .video-container {
  height: 0;
  margin-bottom: 20px;
  overflow: hidden;
  padding-top: 75%;
  position: relative;
  width: 100%;
}
.post-body .video-container iframe,
.post-body .video-container object,
.post-body .video-container embed {
  height: 100%;
  left: 0;
  margin: 0;
  position: absolute;
  top: 0;
  width: 100%;
}
.post-gallery {
  display: flex;
  min-height: 200px;
}
.post-gallery .post-gallery-image {
  flex: 1;
}
.post-gallery .post-gallery-image:not(:first-child) {
  clip-path: polygon(40px 0, 100% 0, 100% 100%, 0 100%);
  margin-left: -20px;
}
.post-gallery .post-gallery-image:not(:last-child) {
  margin-right: -20px;
}
.post-gallery .post-gallery-image img {
  height: 100%;
  object-fit: cover;
  opacity: 1;
  width: 100%;
}
.posts-expand .post-gallery {
  margin-bottom: 60px;
}
.posts-collapse .post-gallery {
  margin: 15px 0;
}
.posts-expand .post-header {
  font-size: 1.125em;
  margin-bottom: 60px;
  text-align: center;
}
.posts-expand .post-title {
  font-size: 1.5em;
  font-weight: normal;
  margin: initial;
  overflow-wrap: break-word;
}
.posts-expand .post-title-link {
  border-bottom: 0;
  color: var(--link-color);
  display: inline-block;
  position: relative;
}
.posts-expand .post-title-link::before {
  background: var(--link-color);
  bottom: 0;
  content: '';
  height: 2px;
  left: 0;
  position: absolute;
  transform: scaleX(0);
  transition: transform 0.2s ease-in-out;
  width: 100%;
}
.posts-expand .post-title-link:hover::before {
  transform: scaleX(1);
}
.posts-expand .post-title-link .fa {
  font-size: 0.875em;
  margin-left: 5px;
}
.post-sticky-flag {
  display: inline-block;
  margin-right: 8px;
  transform: rotate(30deg);
}
.posts-expand .post-meta-container {
  color: #999;
  font-family: Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;
  font-size: 0.75em;
  margin-top: 3px;
}
.posts-expand .post-meta-container .post-description {
  font-size: 0.875em;
  margin-top: 2px;
}
.posts-expand .post-meta-container time {
  border-bottom: 1px dashed #999;
}
.post-meta {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
}
:not(.post-meta-break) + .post-meta-item::before {
  content: '|';
  margin: 0 0.5em;
}
.post-meta-item-icon {
  margin-right: 3px;
}
@media (max-width: 991px) {
  .post-meta-item-text {
    display: none;
  }
}
.post-meta-break {
  flex-basis: 100%;
  height: 0;
}
.post-nav {
  border-top: 1px solid #eee;
  display: flex;
  gap: 30px;
  justify-content: space-between;
  margin-top: 1em;
  padding: 10px 5px 0;
}
.post-nav-item {
  flex: 1;
}
.post-nav-item a {
  border-bottom: 0;
  display: block;
  font-size: 0.875em;
  line-height: 1.6;
}
.post-nav-item a:active {
  top: 2px;
}
.post-nav-item .fa {
  font-size: 0.75em;
}
.post-nav-item:first-child .fa {
  margin-right: 5px;
}
.post-nav-item:last-child {
  text-align: right;
}
.post-nav-item:last-child .fa {
  margin-left: 5px;
}
.post-footer {
  display: flex;
  flex-direction: column;
  justify-content: center;
}
.post-eof {
  background: #ccc;
  height: 1px;
  margin: 80px auto 60px;
  width: 8%;
}
.post-block:last-of-type .post-eof {
  display: none;
}
.post-tags {
  margin-top: 40px;
  text-align: center;
}
.post-tags a {
  display: inline-block;
  font-size: 0.8125em;
}
.post-tags a:not(:last-child) {
  margin-right: 10px;
}
.social-like {
  border-top: 1px solid #eee;
  font-size: 0.875em;
  margin-top: 1em;
  padding-top: 1em;
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
}
.social-like a {
  border-bottom: none;
}
.reward-container {
  margin: 1em 0 0;
  padding: 1em 0;
  text-align: center;
}
.reward-container button {
  background: transparent;
  color: #fc6423;
  cursor: pointer;
  line-height: 2;
  padding: 0 15px;
  border: 2px solid #fc6423;
  border-radius: 2px;
  outline: 0;
  vertical-align: text-top;
}
.reward-container button:hover {
  background: #fc6423;
  color: #fff;
}
.post-reward {
  display: none;
  padding-top: 20px;
}
.post-reward.active {
  display: block;
}
.post-reward div {
  display: inline-block;
}
.post-reward div span {
  display: block;
}
.post-reward img {
  display: inline-block;
  margin: 0.8em 2em 0;
  max-width: 100%;
  width: 180px;
}
@keyframes next-roll {
  from {
    transform: rotateZ(30deg);
  }
  to {
    transform: rotateZ(-30deg);
  }
}
.followme {
  color: #bbb;
  padding: 1em 1.5em;
  text-align: center;
  background: var(--card-bg-color);
  border-left: 3px solid #ff2a2a;
  margin: 1em 0 0;
}
.followme .social-list {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
}
.followme .social-list .social-item {
  margin: 0.5em 2em;
  position: relative;
}
@media (max-width: 991px) {
  .followme .social-list .social-item {
    margin: 0.5em 0.75em;
  }
}
.followme .social-list .social-link {
  border: 0;
  display: block;
}
.followme .social-list .social-link .icon {
  font-size: 1.75em;
}
.followme .social-list .social-link .label {
  display: block;
  font-size: 14px;
}
.followme .social-list .social-link:hover + .social-item-img {
  display: block;
}
.followme .social-list span.social-link {
  color: var(--link-color);
}
.followme .social-list span.social-link:hover {
  color: var(--link-hover-color);
}
.followme .social-list .social-item-img {
  display: none;
  left: 50%;
  max-width: 180px;
  position: absolute;
  transform: translate(-50%, 20px);
}
.category-all-page .category-all-title {
  text-align: center;
}
.category-all-page .category-all {
  margin-top: 20px;
}
.category-all-page .category-list {
  list-style: none;
  margin: 0;
  padding: 0;
}
.category-all-page .category-list-item {
  margin: 5px 10px;
}
.category-all-page .category-list-count {
  font-size: 0.75em;
  background: #ccc;
  border-radius: 10px;
  color: var(--content-bg-color);
  font-weight: bold;
  line-height: 1;
  margin-left: 0.35em;
  padding: 2px 5px;
  text-shadow: 1px 1px 0 rgba(0,0,0,0.1);
}
.category-all-page .category-list-child {
  padding-left: 10px;
}
.event-list hr {
  background: #222;
  margin: 20px 0 45px;
}
.event-list hr::after {
  background: #222;
  color: #fff;
  content: 'NOW';
  display: inline-block;
  font-weight: bold;
  padding: 0 5px;
}
.event-list .event {
  --event-background: #222;
  --event-foreground: #bbb;
  --event-title: #fff;
  background: var(--event-background);
  padding: 15px;
}
.event-list .event .event-summary {
  border-bottom: 0;
  color: var(--event-title);
  margin: 0;
  padding: 0 0 0 35px;
  position: relative;
}
.event-list .event .event-summary::before {
  animation: dot-flash 1s alternate infinite ease-in-out;
  background: var(--event-title);
  left: 0;
  margin-top: -6px;
  position: absolute;
  top: 50%;
  border-radius: 50%;
  content: ' ';
  height: 12px;
  width: 12px;
}
.event-list .event:nth-of-type(odd) .event-summary::before {
  animation-delay: 0.5s;
}
.event-list .event:not(:last-child) {
  margin-bottom: 20px;
}
.event-list .event .event-relative-time {
  color: var(--event-foreground);
  display: inline-block;
  font-size: 12px;
  font-weight: normal;
  padding-left: 12px;
}
.event-list .event .event-details {
  color: var(--event-foreground);
  display: block;
  line-height: 18px;
  padding: 6px 0 6px 35px;
}
.event-list .event .event-details::before {
  color: var(--event-foreground);
  display: inline-block;
  margin-right: 9px;
  width: 14px;
  font-family: 'Font Awesome 6 Free';
  font-weight: 900;
}
.event-list .event .event-details.event-location::before {
  content: '\f041';
}
.event-list .event .event-details.event-duration::before {
  content: '\f017';
}
.event-list .event .event-details.event-description::before {
  content: '\f024';
}
.event-list .event-past {
  --event-background: #f5f5f5;
  --event-foreground: #999;
  --event-title: #222;
}
@keyframes dot-flash {
  from {
    opacity: 1;
    transform: scale(1);
  }
  to {
    opacity: 0;
    transform: scale(0.8);
  }
}
ul.breadcrumb {
  font-size: 0.75em;
  list-style: none;
  margin: 1em 0;
  padding: 0 2em;
  text-align: center;
}
ul.breadcrumb li {
  display: inline;
}
ul.breadcrumb li:not(:first-child)::before {
  content: '/\00a0';
  font-weight: normal;
  padding: 0.5em;
}
ul.breadcrumb li:last-child {
  font-weight: bold;
}
.tag-cloud {
  text-align: center;
}
.tag-cloud a {
  display: inline-block;
  margin: 10px;
}
.tag-cloud-0 {
  border-bottom-color: #aaa;
  color: #aaa;
}
.tag-cloud-1 {
  border-bottom-color: #9a9a9a;
  color: #9a9a9a;
}
.tag-cloud-2 {
  border-bottom-color: #8b8b8b;
  color: #8b8b8b;
}
.tag-cloud-3 {
  border-bottom-color: #7c7c7c;
  color: #7c7c7c;
}
.tag-cloud-4 {
  border-bottom-color: #6c6c6c;
  color: #6c6c6c;
}
.tag-cloud-5 {
  border-bottom-color: #5d5d5d;
  color: #5d5d5d;
}
.tag-cloud-6 {
  border-bottom-color: #4e4e4e;
  color: #4e4e4e;
}
.tag-cloud-7 {
  border-bottom-color: #3e3e3e;
  color: #3e3e3e;
}
.tag-cloud-8 {
  border-bottom-color: #2f2f2f;
  color: #2f2f2f;
}
.tag-cloud-9 {
  border-bottom-color: #202020;
  color: #202020;
}
.tag-cloud-10 {
  border-bottom-color: #111;
  color: #111;
}
.search-active {
  overflow: hidden;
}
.search-pop-overlay {
  background: rgba(0,0,0,0);
  display: flex;
  height: 100%;
  left: 0;
  position: fixed;
  top: 0;
  transition: visibility 0.4s, background 0.4s;
  visibility: hidden;
  width: 100%;
  z-index: 40;
}
.search-active .search-pop-overlay {
  background: rgba(0,0,0,0.3);
  visibility: visible;
}
.search-popup {
  background: var(--card-bg-color);
  border-radius: 5px;
  height: 80%;
  margin: auto;
  transform: scale(0);
  transition: transform 0.4s;
  width: 700px;
}
.search-active .search-popup {
  transform: scale(1);
}
@media (max-width: 767px) {
  .search-popup {
    border-radius: 0;
    height: 100%;
    width: 100%;
  }
}
.search-popup .search-icon,
.search-popup .popup-btn-close {
  color: #999;
  font-size: 18px;
  padding: 0 10px;
}
.search-popup .popup-btn-close {
  cursor: pointer;
}
.search-popup .popup-btn-close:hover .fa {
  color: #222;
}
.search-popup .search-header {
  background: #eee;
  border-top-left-radius: 5px;
  border-top-right-radius: 5px;
  display: flex;
  padding: 5px;
}
.search-popup input.search-input {
  background: transparent;
  border: 0;
  outline: 0;
  width: 100%;
}
.search-popup input.search-input::-webkit-search-cancel-button {
  display: none;
}
.search-popup .search-result-container {
  display: flex;
  flex-direction: column;
  height: calc(100% - 55px);
  overflow: auto;
  padding: 5px 25px;
}
.search-popup .search-result-container hr {
  flex-shrink: 0;
  margin: 5px 0 10px;
}
.search-popup .search-result-container hr:first-child {
  display: none;
}
.search-popup .search-result-list {
  margin: 0 5px;
  padding: 0;
}
.search-popup a.search-result-title {
  font-weight: bold;
}
.search-popup p.search-result {
  border-bottom: 1px dashed #ccc;
  padding: 5px 0;
}
.search-popup .search-input-container {
  flex-grow: 1;
  padding: 2px;
}
.search-popup .search-result-icon {
  color: #ccc;
  margin: auto;
}
mark.search-keyword {
  background: transparent;
  border-bottom: 1px dashed #ff2a2a;
  color: #ff2a2a;
  font-weight: bold;
}
mjx-container[jax='CHTML'][display='true'],
.has-jax {
  overflow: auto hidden;
}
mjx-container[display='true'] + br {
  display: none;
}
.use-motion .animated {
  animation-fill-mode: none;
  visibility: inherit;
}
.use-motion .sidebar .animated {
  animation-fill-mode: both;
}
header.header {
  background: var(--content-bg-color);
  border-radius: initial;
  box-shadow: 0 2px 2px 0 rgba(0,0,0,0.12), 0 3px 1px -2px rgba(0,0,0,0.06), 0 1px 5px 0 rgba(0,0,0,0.12);
}
@media (max-width: 991px) {
  header.header {
    border-radius: initial;
  }
}
.main {
  align-items: stretch;
  display: flex;
  justify-content: space-between;
  margin: 0 auto;
  width: calc(100% - 20px);
}
@media (max-width: 767px) {
  .main {
    width: auto;
  }
}
@media (min-width: 1200px) {
  .main {
    width: 1160px;
  }
}
@media (min-width: 1600px) {
  .main {
    width: 73%;
  }
}
@media (max-width: 991px) {
  .main {
    display: block;
    width: auto;
  }
}
.main-inner {
  border-radius: initial;
  box-sizing: border-box;
  width: calc(100% - 252px);
}
@media (max-width: 991px) {
  .main-inner {
    border-radius: initial;
    width: 100%;
  }
}
.footer-inner {
  padding-left: 252px;
}
@media (max-width: 991px) {
  .footer-inner {
    padding-left: 0;
    padding-right: 0;
    width: auto;
  }
}
.column {
  width: 240px;
}
@media (max-width: 991px) {
  .column {
    width: auto;
  }
}
.site-brand-container {
  background: var(--theme-color);
}
@media (max-width: 991px) {
  .site-nav-on .site-brand-container {
    box-shadow: 0 0 16px rgba(0,0,0,0.5);
  }
}
.site-meta {
  padding: 20px 0;
}
@media (min-width: 768px) and (max-width: 991px) {
  .site-nav-toggle,
  .site-nav-right {
    display: flex;
    flex-direction: column;
    justify-content: center;
  }
}
.site-nav-toggle .toggle,
.site-nav-right .toggle {
  color: #fff;
}
.site-nav-toggle .toggle .toggle-line,
.site-nav-right .toggle .toggle-line {
  background: #fff;
}
@media (min-width: 768px) and (max-width: 991px) {
  .site-nav {
    --scroll-height: 0;
    height: 0;
    overflow: hidden;
    transition: 0.2s ease-in-out;
    transition-property: height, visibility;
    visibility: hidden;
  }
  body:not(.site-nav-on) .site-nav .animated {
    animation: none;
  }
  body.site-nav-on .site-nav {
    height: var(--scroll-height);
    visibility: unset;
  }
}
.menu .menu-item {
  display: block;
  margin: 0;
}
.menu .menu-item a {
  padding: 5px 20px;
  position: relative;
  transition-property: background-color;
  display: flex;
  align-items: center;
}
.menu .menu-item a .badge {
  margin-left: auto;
}
.menu .menu-item a.menu-item-active::after {
  background: #bbb;
  border-radius: 50%;
  content: ' ';
  height: 6px;
  margin-top: -3px;
  position: absolute;
  right: 15px;
  top: 50%;
  width: 6px;
}
@media (max-width: 991px) {
  .menu .menu-item.menu-item-search {
    display: none;
  }
}
.sub-menu {
  margin: 0;
  padding: 6px 0;
}
.sub-menu .menu-item {
  display: inline-block;
}
.sub-menu .menu-item a {
  background: transparent;
  margin: 5px 10px;
  padding: initial;
}
.sub-menu .menu-item a:hover {
  background: transparent;
  color: #fc6423;
}
.sub-menu .menu-item-active {
  border-bottom-color: #fc6423;
  color: #fc6423;
}
.sub-menu .menu-item-active:hover {
  border-bottom-color: #fc6423;
}
@media (min-width: 992px) {
  .sidebar {
    position: -webkit-sticky;
    position: sticky;
    top: 12px;
  }
  .sidebar-toggle {
    display: none;
  }
  .sidebar-inner {
    background: var(--content-bg-color);
    border-radius: initial;
    box-shadow: 0 2px 2px 0 rgba(0,0,0,0.12), 0 3px 1px -2px rgba(0,0,0,0.06), 0 1px 5px 0 rgba(0,0,0,0.12), 0 -1px 0.5px 0 rgba(0,0,0,0.09);
    box-sizing: border-box;
    color: var(--text-color);
    margin-top: 12px;
    max-height: calc(100vh - 24px);
    visibility: hidden;
  }
  .site-state-item {
    padding: 0 10px;
  }
  .sidebar .sidebar-button {
    border-bottom: 1px dotted #ccc;
    border-top: 1px dotted #ccc;
  }
  .sidebar .sidebar-button button {
    border: 0;
    color: #fc6423;
    display: block;
    width: 100%;
  }
  .sidebar .sidebar-button button:hover {
    background: none;
    border: 0;
    color: #e34603;
  }
  .links-of-author {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
  }
  .links-of-author-item {
    margin: 5px 0 0;
    width: 50%;
  }
  .links-of-author-item a {
    box-sizing: border-box;
    display: inline-block;
    max-width: 100%;
    overflow: hidden;
    padding: 0 5px;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  .links-of-author-item a {
    border-bottom: 0;
    border-radius: 4px;
    display: block;
  }
  .links-of-author-item a:hover {
    background: var(--body-bg-color);
  }
}
.main-inner .sub-menu,
.main-inner .post-block,
.main-inner .tabs-comment,
.main-inner > .comments,
.main-inner .comment-position .comments,
.main-inner .pagination {
  background: var(--content-bg-color);
  border-radius: initial;
  box-shadow: 0 2px 2px 0 rgba(0,0,0,0.12), 0 3px 1px -2px rgba(0,0,0,0.06), 0 1px 5px 0 rgba(0,0,0,0.12);
}
.main-inner .post-block:not(:first-child):not(:first-child) {
  border-radius: initial;
  box-shadow: 0 2px 2px 0 rgba(0,0,0,0.12), 0 3px 1px -2px rgba(0,0,0,0.06), 0 1px 5px 0 rgba(0,0,0,0.12), 0 -1px 0.5px 0 rgba(0,0,0,0.09);
  margin-top: 12px;
}
@media (min-width: 768px) and (max-width: 991px) {
  .main-inner .post-block:not(:first-child):not(:first-child) {
    margin-top: 10px;
  }
}
@media (max-width: 767px) {
  .main-inner .post-block:not(:first-child):not(:first-child) {
    margin-top: 8px;
  }
}
.main-inner .tabs-comment,
.main-inner > .comments,
.main-inner .comment-position .comments,
.main-inner .pagination {
  border-radius: initial;
  box-shadow: 0 2px 2px 0 rgba(0,0,0,0.12), 0 3px 1px -2px rgba(0,0,0,0.06), 0 1px 5px 0 rgba(0,0,0,0.12), 0 -1px 0.5px 0 rgba(0,0,0,0.09);
  margin-top: 12px;
}
@media (min-width: 768px) and (max-width: 991px) {
  .main-inner .tabs-comment,
  .main-inner > .comments,
  .main-inner .comment-position .comments,
  .main-inner .pagination {
    margin-top: 10px;
  }
}
@media (max-width: 767px) {
  .main-inner .tabs-comment,
  .main-inner > .comments,
  .main-inner .comment-position .comments,
  .main-inner .pagination {
    margin-top: 8px;
  }
}
.post-block,
.comments {
  padding: 40px;
}
.post-eof {
  display: none;
}
.pagination {
  border-top: initial;
  padding: 10px 0;
}
.post-body h1,
.post-body h2 {
  border-bottom: 1px solid #eee;
}
.post-body h3 {
  border-bottom: 1px dotted #eee;
}
@media (min-width: 768px) and (max-width: 991px) {
  .main-inner {
    padding: 10px;
  }
  .posts-expand .post-button {
    margin-top: 20px;
  }
  .post-block {
    padding: 20px;
  }
  .comments {
    padding: 10px 20px;
  }
}
@media (max-width: 767px) {
  .main-inner {
    padding: 8px;
  }
  .posts-expand .post-button {
    margin: 12px 0;
  }
  .post-block {
    padding: 12px;
  }
  .comments {
    padding: 10px 12px;
  }
}
@media (min-width: 992px) and (max-width: 991px) {
  .sidebar {
    display: none;
  }
}
</style><noscript>
    
  </noscript>
<style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style><link rel="alternate" href="/atom.xml" title="Yue Jiao's blog" type="application/atom+xml">
<script>function loadCss(l){var d=document,h=d.head,s=d.createElement('link');s.rel='stylesheet';s.href=l;!function e(f){if (d.body)return f();setTimeout(function(){e(f)})}(function(){h.appendChild(s);});}loadCss('/style.css');loadCss('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css');loadCss('https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css');</script><noscript><link rel="stylesheet" href="/style.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css"></noscript></head>

<body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Yue Jiao's blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#an-introduction"><span class="nav-number">1.</span> <span class="nav-text">An introduction</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#an-introduction-to-javascript"><span class="nav-number">1.1.</span> <span class="nav-text">1.1 An introduction to
JavaScript</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#manuals-and-specifications"><span class="nav-number">1.2.</span> <span class="nav-text">1.2 Manuals and specifications</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#code-editors"><span class="nav-number">1.3.</span> <span class="nav-text">1.3 Code editors</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#developer-console"><span class="nav-number">1.4.</span> <span class="nav-text">1.4 Developer console</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#javascript-fundamentals"><span class="nav-number">2.</span> <span class="nav-text">JavaScript Fundamentals</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#hello-world"><span class="nav-number">2.1.</span> <span class="nav-text">2.1 Hello, world!</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#the-script-tag"><span class="nav-number">2.1.1.</span> <span class="nav-text">The "script" tag</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#modern-markup"><span class="nav-number">2.1.2.</span> <span class="nav-text">Modern markup</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#external-scripts"><span class="nav-number">2.1.3.</span> <span class="nav-text">External scripts</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#code-structure"><span class="nav-number">2.2.</span> <span class="nav-text">2.2 Code structure</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#semicolons"><span class="nav-number">2.2.1.</span> <span class="nav-text">Semicolons</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#comments"><span class="nav-number">2.2.2.</span> <span class="nav-text">Comments</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#the-modern-mode-use-strict"><span class="nav-number">2.3.</span> <span class="nav-text">2.3 The modern mode, "use
strict"</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#use-strict"><span class="nav-number">2.3.1.</span> <span class="nav-text">"use strict"</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#variables"><span class="nav-number">2.4.</span> <span class="nav-text">2.4 Variables</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#a-variable"><span class="nav-number">2.4.1.</span> <span class="nav-text">A variable</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#variable-naming"><span class="nav-number">2.4.2.</span> <span class="nav-text">Variable naming</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#constants"><span class="nav-number">2.4.3.</span> <span class="nav-text">Constants</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#data-types"><span class="nav-number">2.5.</span> <span class="nav-text">2.5 Data types</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#number"><span class="nav-number">2.5.1.</span> <span class="nav-text">Number</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#bitint"><span class="nav-number">2.5.2.</span> <span class="nav-text">BitInt</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#string"><span class="nav-number">2.5.3.</span> <span class="nav-text">String</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#boolean"><span class="nav-number">2.5.4.</span> <span class="nav-text">Boolean</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#the-null-value"><span class="nav-number">2.5.5.</span> <span class="nav-text">The "null" value</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#the-undefined-value"><span class="nav-number">2.5.6.</span> <span class="nav-text">The "undefined" value</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#objects-and-symbols"><span class="nav-number">2.5.7.</span> <span class="nav-text">Objects and symbols</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#the-typeof-operator"><span class="nav-number">2.5.8.</span> <span class="nav-text">The typeof operator</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#interaction-alert-prompt-confirm"><span class="nav-number">2.6.</span> <span class="nav-text">2.6 Interaction: alert,
prompt, confirm</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#alert"><span class="nav-number">2.6.1.</span> <span class="nav-text">alert</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#prompt"><span class="nav-number">2.6.2.</span> <span class="nav-text">prompt</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#confirm"><span class="nav-number">2.6.3.</span> <span class="nav-text">confirm</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#type-conversions"><span class="nav-number">2.7.</span> <span class="nav-text">2.7 Type conversions</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#string-conversion"><span class="nav-number">2.7.1.</span> <span class="nav-text">String conversion</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#numeric-conversion"><span class="nav-number">2.7.2.</span> <span class="nav-text">Numeric conversion</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#boolean-conversion"><span class="nav-number">2.7.3.</span> <span class="nav-text">Boolean conversion</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#basic-operators-maths"><span class="nav-number">2.8.</span> <span class="nav-text">2.8 Basic operators, maths</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#terms-unary-binary-operand"><span class="nav-number">2.8.1.</span> <span class="nav-text">Terms: unary, binary, operand</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#math-operations"><span class="nav-number">2.8.2.</span> <span class="nav-text">Math operations</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#string-concatenation-with-binary"><span class="nav-number">2.8.3.</span> <span class="nav-text">String concatenation with
binary +</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#numeric-conversion-unary"><span class="nav-number">2.8.4.</span> <span class="nav-text">Numeric conversion, unary +</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#assignment"><span class="nav-number">2.8.5.</span> <span class="nav-text">Assignment</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#modify-in-place"><span class="nav-number">2.8.6.</span> <span class="nav-text">Modify-in-place</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#increment-decrement"><span class="nav-number">2.8.7.</span> <span class="nav-text">Increment / decrement</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#comma"><span class="nav-number">2.8.8.</span> <span class="nav-text">Comma</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#comparisons"><span class="nav-number">2.9.</span> <span class="nav-text">2.9 Comparisons</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#strict-equality"><span class="nav-number">2.9.1.</span> <span class="nav-text">Strict equality</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#comparison-with-null-and-undefined"><span class="nav-number">2.9.2.</span> <span class="nav-text">Comparison with null and
undefined</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#using-strict-equality-to-avoid-strange-bugs"><span class="nav-number">2.9.2.1.</span> <span class="nav-text">Using strict
equality to avoid strange bugs</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#conditional-branching"><span class="nav-number">2.10.</span> <span class="nav-text">2.10 Conditional branching</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#logical-operators"><span class="nav-number">2.11.</span> <span class="nav-text">2.11 Logical operators</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#loops"><span class="nav-number">2.12.</span> <span class="nav-text">2.12 Loops</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#the-while-loop"><span class="nav-number">2.12.1.</span> <span class="nav-text">The "while" loop</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#the-do-...-while-loop"><span class="nav-number">2.12.2.</span> <span class="nav-text">The "do ... while" loop</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#the-for-loop"><span class="nav-number">2.12.3.</span> <span class="nav-text">The "for" loop</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#labels-for-breakcontinue"><span class="nav-number">2.12.4.</span> <span class="nav-text">Labels for break/continue</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#the-switch-statement"><span class="nav-number">2.13.</span> <span class="nav-text">2.13 The "switch" statement</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#functions"><span class="nav-number">2.14.</span> <span class="nav-text">2.14 Functions</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#alternative-default-parameters"><span class="nav-number">2.14.1.</span> <span class="nav-text">Alternative default
parameters</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#function-expressions"><span class="nav-number">2.15.</span> <span class="nav-text">2.15 Function expressions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#arrow-function-the-basics"><span class="nav-number">2.16.</span> <span class="nav-text">2.16 Arrow function, the basics</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#code-quality"><span class="nav-number">3.</span> <span class="nav-text">Code quality</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#debugging-in-the-browser"><span class="nav-number">3.1.</span> <span class="nav-text">3.1 Debugging in the browser</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#debugger-command"><span class="nav-number">3.1.1.</span> <span class="nav-text">Debugger command</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#tracing-the-execution"><span class="nav-number">3.1.2.</span> <span class="nav-text">Tracing the execution</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#coding-style"><span class="nav-number">3.2.</span> <span class="nav-text">3.2 Coding style</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#suggested-syntax-rules"><span class="nav-number">3.2.1.</span> <span class="nav-text">Suggested syntax rules</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#comments-1"><span class="nav-number">3.3.</span> <span class="nav-text">3.3 Comments</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#comments-this"><span class="nav-number">3.3.1.</span> <span class="nav-text">Comments this</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#avoid-comments"><span class="nav-number">3.3.2.</span> <span class="nav-text">Avoid comments:</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ninja-code"><span class="nav-number">3.4.</span> <span class="nav-text">3.4 Ninja code</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#do-not"><span class="nav-number">3.4.1.</span> <span class="nav-text">DO NOT:</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#automated-testing-with-mocha"><span class="nav-number">3.5.</span> <span class="nav-text">3.5 Automated testing with
Mocha</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#behavior-driven-development-bdd"><span class="nav-number">3.5.1.</span> <span class="nav-text">Behavior Driven Development
(BDD)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#development-of-pow-the-spec"><span class="nav-number">3.5.2.</span> <span class="nav-text">Development of "pow": the spec</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#the-development-flow"><span class="nav-number">3.5.3.</span> <span class="nav-text">The development flow</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#the-spec-in-action"><span class="nav-number">3.5.4.</span> <span class="nav-text">The spec in action</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#preprocess-and-postprocessing"><span class="nav-number">3.5.5.</span> <span class="nav-text">Preprocess and
postprocessing</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#other-assertions"><span class="nav-number">3.5.6.</span> <span class="nav-text">Other assertions</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#polyfills-and-transpilers"><span class="nav-number">3.6.</span> <span class="nav-text">3.6 Polyfills and transpilers</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#transpilers"><span class="nav-number">3.6.1.</span> <span class="nav-text">Transpilers</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#polyfills"><span class="nav-number">3.6.2.</span> <span class="nav-text">Polyfills</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#objects-the-basics"><span class="nav-number">4.</span> <span class="nav-text">Objects: the basics</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#objects"><span class="nav-number">4.1.</span> <span class="nav-text">4.1 Objects</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#literals-and-properties"><span class="nav-number">4.1.1.</span> <span class="nav-text">Literals and properties</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#property-value-shorthand"><span class="nav-number">4.1.2.</span> <span class="nav-text">Property value shorthand</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#property-names-limitations"><span class="nav-number">4.1.3.</span> <span class="nav-text">Property names limitations</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#property-existence-test-in-operator"><span class="nav-number">4.1.4.</span> <span class="nav-text">Property existence test,
"in" operator</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#the-for...in-loop"><span class="nav-number">4.1.5.</span> <span class="nav-text">The "for...in" loop</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ordered-like-an-object"><span class="nav-number">4.1.6.</span> <span class="nav-text">Ordered like an object</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#object-references-and-copying"><span class="nav-number">4.2.</span> <span class="nav-text">4.2 Object references and
copying</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#comparison-by-reference"><span class="nav-number">4.2.1.</span> <span class="nav-text">Comparison by reference</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#cloning-and-merging-object.assign"><span class="nav-number">4.2.2.</span> <span class="nav-text">Cloning and merging,
Object.assign</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#nested-cloning"><span class="nav-number">4.2.3.</span> <span class="nav-text">Nested cloning</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#const-objects-can-be-modified"><span class="nav-number">4.2.4.</span> <span class="nav-text">Const objects can be
modified</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#garbage-collection"><span class="nav-number">4.3.</span> <span class="nav-text">4.3 Garbage collection</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#reachability"><span class="nav-number">4.3.1.</span> <span class="nav-text">Reachability</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#internal-algorithms"><span class="nav-number">4.3.2.</span> <span class="nav-text">Internal algorithms</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#object-methods-this"><span class="nav-number">4.4.</span> <span class="nav-text">4.4 Object methods, "this"</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#method-examples"><span class="nav-number">4.4.1.</span> <span class="nav-text">Method examples</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#method-shorthand"><span class="nav-number">4.4.2.</span> <span class="nav-text">Method shorthand</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#this-in-methods"><span class="nav-number">4.4.3.</span> <span class="nav-text">"this" in methods</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#this-is-not-bound"><span class="nav-number">4.4.4.</span> <span class="nav-text">"this" is not bound</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#arrow-functions-have-no-this"><span class="nav-number">4.4.5.</span> <span class="nav-text">Arrow functions have no
"this"</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#constructor-operator-new"><span class="nav-number">4.5.</span> <span class="nav-text">4.5 Constructor, operator "new"</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#constructor-function"><span class="nav-number">4.5.1.</span> <span class="nav-text">Constructor function</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#constructor-mode-test-new.target"><span class="nav-number">4.5.2.</span> <span class="nav-text">Constructor mode test:
new.target</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#return-from-constructors"><span class="nav-number">4.5.3.</span> <span class="nav-text">Return from constructors</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#optional-chaining-."><span class="nav-number">4.6.</span> <span class="nav-text">4.6 Optional chaining '?.'</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#the-non-existing-property-problem"><span class="nav-number">4.6.1.</span> <span class="nav-text">The "non-existing property"
problem</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#optional-chaining"><span class="nav-number">4.6.2.</span> <span class="nav-text">Optional chaining</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#other-variants-.-."><span class="nav-number">4.6.3.</span> <span class="nav-text">Other variants: ?.(),
?.[]</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#symbol-type"><span class="nav-number">4.7.</span> <span class="nav-text">4.7 Symbol type</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#symbols"><span class="nav-number">4.7.1.</span> <span class="nav-text">Symbols</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#hidden-properties"><span class="nav-number">4.7.2.</span> <span class="nav-text">"Hidden" properties</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#symbols-in-an-object-literal"><span class="nav-number">4.7.3.</span> <span class="nav-text">Symbols in an object literal</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#global-symbols"><span class="nav-number">4.7.4.</span> <span class="nav-text">Global symbols</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#symbol.keyfor"><span class="nav-number">4.7.4.1.</span> <span class="nav-text">Symbol.keyFor</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#system-symbols"><span class="nav-number">4.7.5.</span> <span class="nav-text">System symbols</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#object-to-primitive-conversion"><span class="nav-number">4.8.</span> <span class="nav-text">4.8 Object to primitive
conversion</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#conversion-rules"><span class="nav-number">4.8.1.</span> <span class="nav-text">Conversion rules</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#symbol.toprimitive"><span class="nav-number">4.8.2.</span> <span class="nav-text">Symbol.toPrimitive</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#tostring-valueof"><span class="nav-number">4.8.3.</span> <span class="nav-text">toString /
valueOf</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#a-conversion-can-return-any-primitive-type"><span class="nav-number">4.8.4.</span> <span class="nav-text">A conversion can
return any primitive type</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#further-conversions"><span class="nav-number">4.8.5.</span> <span class="nav-text">Further conversions</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#data-types-1"><span class="nav-number">5.</span> <span class="nav-text">Data types</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#methods-of-primitives"><span class="nav-number">5.1.</span> <span class="nav-text">5.1 Methods of primitives</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#a-primitive-as-an-object"><span class="nav-number">5.1.1.</span> <span class="nav-text">A primitive as an object</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#numbers"><span class="nav-number">5.2.</span> <span class="nav-text">5.2 Numbers</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#more-ways-to-write-a-number"><span class="nav-number">5.2.1.</span> <span class="nav-text">More ways to write a number</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#hex-binary-and-octal-numbers"><span class="nav-number">5.2.2.</span> <span class="nav-text">Hex, binary and octal numbers</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#tostringbase"><span class="nav-number">5.2.3.</span> <span class="nav-text">toString(base)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#rounding"><span class="nav-number">5.2.4.</span> <span class="nav-text">Rounding</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#imprecise-calculations"><span class="nav-number">5.2.5.</span> <span class="nav-text">Imprecise calculations</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#tests-isfinite-and-isnan"><span class="nav-number">5.2.6.</span> <span class="nav-text">Tests: isFinite and
isNaN</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#parseint-and-parsefloat"><span class="nav-number">5.2.7.</span> <span class="nav-text">parseInt and
parseFloat</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#other-math-functions"><span class="nav-number">5.2.8.</span> <span class="nav-text">Other math functions</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#strings"><span class="nav-number">5.3.</span> <span class="nav-text">5.3 Strings</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#quotes"><span class="nav-number">5.3.1.</span> <span class="nav-text">Quotes</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#special-characters"><span class="nav-number">5.3.2.</span> <span class="nav-text">Special characters</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#accessing-characters"><span class="nav-number">5.3.3.</span> <span class="nav-text">Accessing characters</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#strings-are-immutable"><span class="nav-number">5.3.4.</span> <span class="nav-text">Strings are immutable</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#searching-for-substring"><span class="nav-number">5.3.5.</span> <span class="nav-text">Searching for substring</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#str.indexofsubstr-pos"><span class="nav-number">5.3.5.1.</span> <span class="nav-text">str.indexOf(substr, pos)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#the-bitwise-not-trick"><span class="nav-number">5.3.5.2.</span> <span class="nav-text">The bitwise NOT trick</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#includes-startswith-endswith"><span class="nav-number">5.3.5.3.</span> <span class="nav-text">includes, startsWith,
endsWith</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#getting-a-substring"><span class="nav-number">5.3.6.</span> <span class="nav-text">Getting a substring</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#comparing-strings"><span class="nav-number">5.3.7.</span> <span class="nav-text">Comparing strings</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#internals-unicode"><span class="nav-number">5.3.8.</span> <span class="nav-text">Internals, Unicode</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#diacritical-marks-and-normalization"><span class="nav-number">5.3.9.</span> <span class="nav-text">Diacritical marks and
normalization</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#arrays"><span class="nav-number">5.4.</span> <span class="nav-text">5.4 Arrays</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#declaration"><span class="nav-number">5.4.1.</span> <span class="nav-text">Declaration</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#methods-pop-push-shift-unshift"><span class="nav-number">5.4.2.</span> <span class="nav-text">Methods pop / push, shift /
unshift</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#internals"><span class="nav-number">5.4.3.</span> <span class="nav-text">Internals</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#performance"><span class="nav-number">5.4.4.</span> <span class="nav-text">Performance</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#loops-1"><span class="nav-number">5.4.5.</span> <span class="nav-text">Loops</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#length"><span class="nav-number">5.4.6.</span> <span class="nav-text">Length</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#new-array"><span class="nav-number">5.4.7.</span> <span class="nav-text">new Array()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#tostring"><span class="nav-number">5.4.8.</span> <span class="nav-text">toString</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#dont-compare-arrays-with"><span class="nav-number">5.4.9.</span> <span class="nav-text">Don't compare arrays with ==</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#array-methods"><span class="nav-number">5.5.</span> <span class="nav-text">5.5 Array methods</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#add-remove-items"><span class="nav-number">5.5.1.</span> <span class="nav-text">Add / remove items</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#splice"><span class="nav-number">5.5.2.</span> <span class="nav-text">Splice</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#slice"><span class="nav-number">5.5.3.</span> <span class="nav-text">Slice</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#concat"><span class="nav-number">5.5.4.</span> <span class="nav-text">Concat</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#iterate-foreach"><span class="nav-number">5.5.5.</span> <span class="nav-text">Iterate: forEach</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#searching-in-array"><span class="nav-number">5.5.6.</span> <span class="nav-text">Searching in array</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#indexof-lastindexof-and-includes"><span class="nav-number">5.5.6.1.</span> <span class="nav-text">indexOf / lastIndexOf and
includes</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#find-and-findindex"><span class="nav-number">5.5.7.</span> <span class="nav-text">find and findIndex</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#filter"><span class="nav-number">5.5.8.</span> <span class="nav-text">filter</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#map"><span class="nav-number">5.5.9.</span> <span class="nav-text">map</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#sortfn"><span class="nav-number">5.5.10.</span> <span class="nav-text">sort(fn)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#use-localecompare-for-strings"><span class="nav-number">5.5.10.1.</span> <span class="nav-text">Use localeCompare
for strings</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#reverse"><span class="nav-number">5.5.11.</span> <span class="nav-text">reverse</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#split-and-join"><span class="nav-number">5.5.12.</span> <span class="nav-text">split and join</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#reduce-reduceright"><span class="nav-number">5.5.13.</span> <span class="nav-text">reduce / reduceRight</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#array.isarray"><span class="nav-number">5.5.14.</span> <span class="nav-text">Array.isArray</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#most-methods-support-thisarg"><span class="nav-number">5.5.15.</span> <span class="nav-text">Most methods support
"thisArg"</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#iterables"><span class="nav-number">5.6.</span> <span class="nav-text">5.6 Iterables</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#symbol.iterator"><span class="nav-number">5.6.1.</span> <span class="nav-text">Symbol.iterator</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#string-is-iterable"><span class="nav-number">5.6.2.</span> <span class="nav-text">String is iterable</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#calling-an-iterator-explicitly"><span class="nav-number">5.6.3.</span> <span class="nav-text">Calling an iterator
explicitly</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#iterable-and-array-likes"><span class="nav-number">5.6.4.</span> <span class="nav-text">Iterable and array-likes</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#array.from"><span class="nav-number">5.6.5.</span> <span class="nav-text">Array.from</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#map-and-set"><span class="nav-number">5.7.</span> <span class="nav-text">5.7 Map and set</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#map-1"><span class="nav-number">5.7.1.</span> <span class="nav-text">Map</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#map-can-also-use-objects-as-keys"><span class="nav-number">5.7.1.1.</span> <span class="nav-text">Map can also use objects as
keys</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#iteration-over-map"><span class="nav-number">5.7.1.2.</span> <span class="nav-text">Iteration over Map</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#object.entries-map-from-object"><span class="nav-number">5.7.1.3.</span> <span class="nav-text">Object.entries: Map from
Object</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#object.fromentries-object-from-map"><span class="nav-number">5.7.1.4.</span> <span class="nav-text">Object.fromEntries: Object
from Map</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#set"><span class="nav-number">5.7.2.</span> <span class="nav-text">Set</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#iteration-over-set"><span class="nav-number">5.7.2.1.</span> <span class="nav-text">Iteration over Set</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#weakmap-and-weakset"><span class="nav-number">5.8.</span> <span class="nav-text">5.8 WeakMap and WeakSet</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#weakmap"><span class="nav-number">5.8.1.</span> <span class="nav-text">WeakMap</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#use-case-additional-data"><span class="nav-number">5.8.1.1.</span> <span class="nav-text">Use case: additional data</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#use-case-caching"><span class="nav-number">5.8.1.2.</span> <span class="nav-text">Use case: caching</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#weakset"><span class="nav-number">5.8.2.</span> <span class="nav-text">WeakSet</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#object.keys-values-entries"><span class="nav-number">5.9.</span> <span class="nav-text">5.9 Object.keys, values,
entries</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#transforming-objects"><span class="nav-number">5.9.1.</span> <span class="nav-text">Transforming objects</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#destructuring-assignment"><span class="nav-number">5.10.</span> <span class="nav-text">5.10 Destructuring assignment</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#array-destructuring"><span class="nav-number">5.10.1.</span> <span class="nav-text">Array destructuring</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#the-rest-..."><span class="nav-number">5.10.1.1.</span> <span class="nav-text">The rest "..."</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#default-values"><span class="nav-number">5.10.1.2.</span> <span class="nav-text">Default values</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#object-destructuring"><span class="nav-number">5.10.2.</span> <span class="nav-text">Object destructuring</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#nested-destructuring"><span class="nav-number">5.10.3.</span> <span class="nav-text">Nested destructuring</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#date-and-time"><span class="nav-number">5.11.</span> <span class="nav-text">5.11 Date and time</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#creation"><span class="nav-number">5.11.1.</span> <span class="nav-text">Creation</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#access-date-components"><span class="nav-number">5.11.2.</span> <span class="nav-text">Access date components</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#setting-date-components"><span class="nav-number">5.11.3.</span> <span class="nav-text">Setting date components</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#autocorrection"><span class="nav-number">5.11.4.</span> <span class="nav-text">Autocorrection</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#date-to-number-date-diff"><span class="nav-number">5.11.5.</span> <span class="nav-text">Date to number, date diff</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#date.parse-from-a-string"><span class="nav-number">5.11.6.</span> <span class="nav-text">Date.parse from a
string</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#json-methods-tojson"><span class="nav-number">5.12.</span> <span class="nav-text">5.12 JSON methods, toJSON</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#json.stringify"><span class="nav-number">5.12.1.</span> <span class="nav-text">JSON.stringify</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#excluding-and-transforming-replacer"><span class="nav-number">5.12.2.</span> <span class="nav-text">Excluding and transforming:
replacer</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#formatting-space"><span class="nav-number">5.12.3.</span> <span class="nav-text">Formatting: space</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#custom-tojson"><span class="nav-number">5.12.4.</span> <span class="nav-text">Custom "toJSON"</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#json.parse"><span class="nav-number">5.12.5.</span> <span class="nav-text">JSON.parse</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#using-reviver"><span class="nav-number">5.12.5.1.</span> <span class="nav-text">Using reviver</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#advanced-working-with-functions"><span class="nav-number">6.</span> <span class="nav-text">Advanced working with
functions</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#recursion-and-stack"><span class="nav-number">6.1.</span> <span class="nav-text">6.1 Recursion and stack</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#rest-parameters-and-spread-syntax"><span class="nav-number">6.2.</span> <span class="nav-text">6.2 Rest parameters and
spread syntax</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#rest-parameters-..."><span class="nav-number">6.2.1.</span> <span class="nav-text">Rest parameters ...</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#the-arguments-variable"><span class="nav-number">6.2.2.</span> <span class="nav-text">The "arguments" variable</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#spread-syntax"><span class="nav-number">6.2.3.</span> <span class="nav-text">Spread syntax</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#copy-an-arrayobject"><span class="nav-number">6.2.4.</span> <span class="nav-text">Copy an array/object</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#variable-scope-closure"><span class="nav-number">6.3.</span> <span class="nav-text">6.3 Variable scope, closure</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#code-blocks"><span class="nav-number">6.3.1.</span> <span class="nav-text">Code blocks</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#nested-functions"><span class="nav-number">6.3.2.</span> <span class="nav-text">Nested functions</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#lexical-environment"><span class="nav-number">6.3.3.</span> <span class="nav-text">Lexical environment</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#variables-1"><span class="nav-number">6.3.3.1.</span> <span class="nav-text">Variables</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#function-declarations"><span class="nav-number">6.3.3.2.</span> <span class="nav-text">Function declarations</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#inner-and-outer-lexical-environment"><span class="nav-number">6.3.3.3.</span> <span class="nav-text">Inner and outer Lexical
Environment</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#returning-a-function"><span class="nav-number">6.3.3.4.</span> <span class="nav-text">Returning a function</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#closure"><span class="nav-number">6.3.3.5.</span> <span class="nav-text">Closure</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#garbage-collection-1"><span class="nav-number">6.3.4.</span> <span class="nav-text">Garbage collection</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#real-life-optimizations"><span class="nav-number">6.3.4.1.</span> <span class="nav-text">Real-life optimizations</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#does-a-function-pickup-latest-changes"><span class="nav-number">6.3.5.</span> <span class="nav-text">Does a function pickup
latest changes?</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#the-old-var"><span class="nav-number">6.4.</span> <span class="nav-text">6.4 The old "var"</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#var-has-no-block-scope"><span class="nav-number">6.4.1.</span> <span class="nav-text">"var" has no block scope</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#var-tolerates-redeclarations"><span class="nav-number">6.4.2.</span> <span class="nav-text">"var" tolerates
redeclarations</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#var-variables-can-be-declared-below-their-use"><span class="nav-number">6.4.3.</span> <span class="nav-text">"var" variables
can be declared below their use</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#iife"><span class="nav-number">6.4.4.</span> <span class="nav-text">IIFE</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#global-object"><span class="nav-number">6.5.</span> <span class="nav-text">6.5 Global object</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#using-for-polyfills"><span class="nav-number">6.5.1.</span> <span class="nav-text">Using for polyfills</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#function-object-nfe"><span class="nav-number">6.6.</span> <span class="nav-text">6.6 Function object, NFE</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#the-name-property"><span class="nav-number">6.6.1.</span> <span class="nav-text">The "name" property</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#the-length-property"><span class="nav-number">6.6.2.</span> <span class="nav-text">The "length" property</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#custom-properties"><span class="nav-number">6.6.3.</span> <span class="nav-text">Custom properties</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#named-function-expression"><span class="nav-number">6.6.4.</span> <span class="nav-text">Named Function Expression</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#the-new-function-syntax"><span class="nav-number">6.7.</span> <span class="nav-text">6.7 The "new Function" syntax</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#syntax"><span class="nav-number">6.7.1.</span> <span class="nav-text">Syntax</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#closure-1"><span class="nav-number">6.7.2.</span> <span class="nav-text">Closure</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#scheduling-settimeout-and-setinterval"><span class="nav-number">6.8.</span> <span class="nav-text">6.8 Scheduling:
setTimeout and setInterval</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#settimeout"><span class="nav-number">6.8.1.</span> <span class="nav-text">setTimeout</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#canceling-with-cleartimeout"><span class="nav-number">6.8.2.</span> <span class="nav-text">Canceling with
clearTimeout</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#setinterval"><span class="nav-number">6.8.3.</span> <span class="nav-text">setInterval</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#nested-settimeout"><span class="nav-number">6.8.4.</span> <span class="nav-text">Nested setTimeout</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#zero-delay-settimeout"><span class="nav-number">6.8.5.</span> <span class="nav-text">Zero delay setTimeout</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#decorators-and-forwarding-callapply"><span class="nav-number">6.9.</span> <span class="nav-text">6.9 Decorators and
forwarding, call/apply</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#transparent-caching"><span class="nav-number">6.9.1.</span> <span class="nav-text">Transparent caching</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#using-func.call-for-the-context"><span class="nav-number">6.9.2.</span> <span class="nav-text">Using func.call
for the context</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#going-multi-argument"><span class="nav-number">6.9.3.</span> <span class="nav-text">Going multi-argument</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#func.apply"><span class="nav-number">6.9.4.</span> <span class="nav-text">func.apply</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#borrowing-a-method"><span class="nav-number">6.9.5.</span> <span class="nav-text">Borrowing a method</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#decorators-and-function-properties"><span class="nav-number">6.9.6.</span> <span class="nav-text">Decorators and function
properties</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#function-binding"><span class="nav-number">6.10.</span> <span class="nav-text">6.10 Function binding</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#losing-this"><span class="nav-number">6.10.1.</span> <span class="nav-text">Losing "this"</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#solution-1-a-wrapper"><span class="nav-number">6.10.2.</span> <span class="nav-text">Solution 1: a wrapper</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#solution-2-bind"><span class="nav-number">6.10.3.</span> <span class="nav-text">Solution 2: bind</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#convenience-method-bindall"><span class="nav-number">6.10.3.1.</span> <span class="nav-text">Convenience method:
bindAll</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#partial-functions"><span class="nav-number">6.10.4.</span> <span class="nav-text">Partial functions</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#going-partial-without-context"><span class="nav-number">6.10.5.</span> <span class="nav-text">Going partial without
context</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#arrow-functions-revisited"><span class="nav-number">6.11.</span> <span class="nav-text">6.11 Arrow functions revisited</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#arrow-functions-have-no-this-1"><span class="nav-number">6.11.1.</span> <span class="nav-text">Arrow functions have no
this</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#arrow-functions-vs-bind"><span class="nav-number">6.11.1.1.</span> <span class="nav-text">Arrow functions vs bind</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#arrows-have-no-arguments-variable"><span class="nav-number">6.11.2.</span> <span class="nav-text">Arrows have no "arguments"
variable</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#object-properties-configuration"><span class="nav-number">7.</span> <span class="nav-text">Object Properties
Configuration</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#property-flags-and-descriptors"><span class="nav-number">7.1.</span> <span class="nav-text">7.1 Property flags and
descriptors</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#property-flags"><span class="nav-number">7.1.1.</span> <span class="nav-text">Property flags</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#object.defineproperties"><span class="nav-number">7.1.2.</span> <span class="nav-text">Object.defineProperties</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#object.getownpropertydescriptors"><span class="nav-number">7.1.3.</span> <span class="nav-text">Object.getOwnPropertyDescriptors</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#sealing-an-object-globally"><span class="nav-number">7.1.4.</span> <span class="nav-text">Sealing an object globally</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#property-getters-and-setters"><span class="nav-number">7.2.</span> <span class="nav-text">7.2 Property getters and
setters</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#getters-and-setters"><span class="nav-number">7.2.1.</span> <span class="nav-text">Getters and setters</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#accessor-descriptors"><span class="nav-number">7.2.2.</span> <span class="nav-text">Accessor descriptors</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#smarter-getters-setters"><span class="nav-number">7.2.3.</span> <span class="nav-text">Smarter getters / setters</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#using-for-compatibility"><span class="nav-number">7.2.4.</span> <span class="nav-text">Using for compatibility</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#prototypes-inheritance"><span class="nav-number">8.</span> <span class="nav-text">Prototypes, inheritance</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#prototypal-inheritance"><span class="nav-number">8.1.</span> <span class="nav-text">8.1 Prototypal inheritance</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#prototype"><span class="nav-number">8.1.1.</span> <span class="nav-text">[[Prototype]]</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#writing-doesnt-use-prototype"><span class="nav-number">8.1.2.</span> <span class="nav-text">Writing doesn't use prototype</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#the-value-of-this"><span class="nav-number">8.1.3.</span> <span class="nav-text">The value of "this"</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#for...in-loop"><span class="nav-number">8.1.4.</span> <span class="nav-text">for...in loop</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#f.prototype"><span class="nav-number">8.2.</span> <span class="nav-text">8.2 F.prototype</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#default-f.prototype-constructor-property"><span class="nav-number">8.2.1.</span> <span class="nav-text">Default F.prototype,
constructor property</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#native-prototypes"><span class="nav-number">8.3.</span> <span class="nav-text">8.3 Native prototypes</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#object.prototype"><span class="nav-number">8.3.1.</span> <span class="nav-text">Object.prototype</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#other-build-in-prototypes"><span class="nav-number">8.3.2.</span> <span class="nav-text">Other build-in prototypes</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#primitives"><span class="nav-number">8.3.3.</span> <span class="nav-text">Primitives</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#changing-native-prototypes"><span class="nav-number">8.3.4.</span> <span class="nav-text">Changing native prototypes</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#borrowing-from-prototypes"><span class="nav-number">8.3.5.</span> <span class="nav-text">Borrowing from prototypes</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#prototype-methods-objects-without-__proto__"><span class="nav-number">8.4.</span> <span class="nav-text">8.4 Prototype
methods, objects without __proto__</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#store-user-provided-keys-in-object"><span class="nav-number">8.4.1.</span> <span class="nav-text">Store user-provided keys in
object</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#classes"><span class="nav-number">9.</span> <span class="nav-text">Classes</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#class-basic-syntax"><span class="nav-number">9.1.</span> <span class="nav-text">9.1 Class basic syntax</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#what-is-a-class"><span class="nav-number">9.1.1.</span> <span class="nav-text">What is a class?</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#not-just-a-syntactic-sugar"><span class="nav-number">9.1.2.</span> <span class="nav-text">Not just a syntactic sugar</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#class-expression"><span class="nav-number">9.1.3.</span> <span class="nav-text">Class expression</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#getters-setters"><span class="nav-number">9.1.4.</span> <span class="nav-text">Getters / setters</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#computed-method-names-..."><span class="nav-number">9.1.5.</span> <span class="nav-text">Computed method names [...]</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#class-fields"><span class="nav-number">9.1.6.</span> <span class="nav-text">Class fields</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#making-bound-methods-with-class-fields"><span class="nav-number">9.1.7.</span> <span class="nav-text">Making bound methods
with class fields</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#class-inheritance"><span class="nav-number">9.2.</span> <span class="nav-text">9.2 Class inheritance</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#the-extends-keyword"><span class="nav-number">9.2.1.</span> <span class="nav-text">The "extends" keyword</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#overriding-a-method"><span class="nav-number">9.2.2.</span> <span class="nav-text">Overriding a method</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#overriding-constructor"><span class="nav-number">9.2.3.</span> <span class="nav-text">Overriding constructor</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#homeobject"><span class="nav-number">9.2.4.</span> <span class="nav-text">[[HomeObject]]</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#methods-not-function-properties"><span class="nav-number">9.2.5.</span> <span class="nav-text">Methods, not function
properties</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#static-properties-and-methods"><span class="nav-number">9.3.</span> <span class="nav-text">9.3 Static properties and
methods</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#static-properties"><span class="nav-number">9.3.1.</span> <span class="nav-text">Static properties</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#inheritance-of-static-properties-and-methods"><span class="nav-number">9.3.2.</span> <span class="nav-text">Inheritance of
static properties and methods</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#private-and-protected-properties-and-methods"><span class="nav-number">9.4.</span> <span class="nav-text">9.4 Private and
protected properties and methods</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#protecting-wateramount"><span class="nav-number">9.4.1.</span> <span class="nav-text">Protecting "waterAmount"</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#read-only-power"><span class="nav-number">9.4.2.</span> <span class="nav-text">Read-only "power"</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#private-waterlimit"><span class="nav-number">9.4.3.</span> <span class="nav-text">Private "#waterLimit"</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#extending-built-in-classes"><span class="nav-number">9.5.</span> <span class="nav-text">9.5 Extending built-in classes</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#no-static-inheritance-in-built-ins"><span class="nav-number">9.5.1.</span> <span class="nav-text">No static inheritance in
built-ins</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#class-checking-instanceof"><span class="nav-number">9.6.</span> <span class="nav-text">9.6 Class checking: "instanceof"</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#symbol.tostringtag"><span class="nav-number">9.6.1.</span> <span class="nav-text">Symbol.toStringTag</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mixins"><span class="nav-number">9.7.</span> <span class="nav-text">9.7 Mixins</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#a-mixin-example"><span class="nav-number">9.7.1.</span> <span class="nav-text">A mixin example</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#eventmixin"><span class="nav-number">9.7.2.</span> <span class="nav-text">EventMixin</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#error-handling"><span class="nav-number">10.</span> <span class="nav-text">Error handling</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#error-handling-try...catch"><span class="nav-number">10.1.</span> <span class="nav-text">10.1 Error handling,
"try...catch"</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#the-syntax"><span class="nav-number">10.1.1.</span> <span class="nav-text">The syntax</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#error-object"><span class="nav-number">10.1.2.</span> <span class="nav-text">Error object</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#throwing-our-own-errors"><span class="nav-number">10.1.3.</span> <span class="nav-text">Throwing our own errors</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#try...catch...finally"><span class="nav-number">10.1.4.</span> <span class="nav-text">try...catch...finally</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#global-catch"><span class="nav-number">10.1.5.</span> <span class="nav-text">Global catch</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#custom-errors-extending-error"><span class="nav-number">10.2.</span> <span class="nav-text">10.2 Custom errors, extending
error</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#extending-error"><span class="nav-number">10.2.1.</span> <span class="nav-text">Extending error</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#promises-asyncawait"><span class="nav-number">11.</span> <span class="nav-text">Promises, async/await</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#introduction-callbacks"><span class="nav-number">11.1.</span> <span class="nav-text">11.1 Introduction: callbacks</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#handling-errors"><span class="nav-number">11.1.1.</span> <span class="nav-text">Handling errors</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#promise"><span class="nav-number">11.2.</span> <span class="nav-text">11.2 Promise</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#consumers-then-catch-finally"><span class="nav-number">11.2.1.</span> <span class="nav-text">Consumers: then, catch,
finally</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#then"><span class="nav-number">11.2.2.</span> <span class="nav-text">then</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#catch"><span class="nav-number">11.2.3.</span> <span class="nav-text">catch</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#finally"><span class="nav-number">11.2.4.</span> <span class="nav-text">finally</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#promises-chaining"><span class="nav-number">11.3.</span> <span class="nav-text">11.3 Promises chaining</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#returning-promises"><span class="nav-number">11.3.1.</span> <span class="nav-text">Returning promises</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#thenables"><span class="nav-number">11.3.2.</span> <span class="nav-text">Thenables</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#error-handling-with-promises"><span class="nav-number">11.4.</span> <span class="nav-text">11.4 Error handling with
promises</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#implicit-try...catch"><span class="nav-number">11.4.1.</span> <span class="nav-text">Implicit try...catch</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#rethrowing"><span class="nav-number">11.4.2.</span> <span class="nav-text">Rethrowing</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#promise-api"><span class="nav-number">11.5.</span> <span class="nav-text">11.5 Promise API</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#promise.all"><span class="nav-number">11.5.1.</span> <span class="nav-text">Promise.all</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#promise.allsettled"><span class="nav-number">11.5.2.</span> <span class="nav-text">Promise.allSettled</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#promise.race"><span class="nav-number">11.5.3.</span> <span class="nav-text">Promise.race</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#promise.any"><span class="nav-number">11.5.4.</span> <span class="nav-text">Promise.any</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#promise.resolvereject"><span class="nav-number">11.5.5.</span> <span class="nav-text">Promise.resolve/reject</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#promise.resolve"><span class="nav-number">11.5.5.1.</span> <span class="nav-text">Promise.resolve</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#promise.reject"><span class="nav-number">11.5.5.2.</span> <span class="nav-text">Promise.reject</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#promisification"><span class="nav-number">11.6.</span> <span class="nav-text">11.6 Promisification</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#microtasks"><span class="nav-number">11.7.</span> <span class="nav-text">11.7 Microtasks</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#microtasks-queue"><span class="nav-number">11.7.1.</span> <span class="nav-text">Microtasks queue</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#unhandled-rejection"><span class="nav-number">11.7.2.</span> <span class="nav-text">Unhandled rejection</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#asyncawait"><span class="nav-number">11.8.</span> <span class="nav-text">11.8 Async/await</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#async-functions"><span class="nav-number">11.8.1.</span> <span class="nav-text">Async functions</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#await"><span class="nav-number">11.8.2.</span> <span class="nav-text">Await</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#error-handling-1"><span class="nav-number">11.8.3.</span> <span class="nav-text">Error handling</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#asyncawait-works-well-with-promise.all"><span class="nav-number">11.8.4.</span> <span class="nav-text">async/await
works well with Promise.all</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#generators-advanced-iteration"><span class="nav-number">12.</span> <span class="nav-text">Generators, advanced
iteration</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#generators"><span class="nav-number">12.1.</span> <span class="nav-text">12.1 Generators</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#generator-functions"><span class="nav-number">12.1.1.</span> <span class="nav-text">Generator functions</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#generators-are-iterable"><span class="nav-number">12.1.2.</span> <span class="nav-text">Generators are iterable</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#using-generators-for-iterables"><span class="nav-number">12.1.3.</span> <span class="nav-text">Using generators for
iterables</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#generator-composition"><span class="nav-number">12.1.4.</span> <span class="nav-text">Generator composition</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#yield-is-a-two-way-street"><span class="nav-number">12.1.5.</span> <span class="nav-text">yield is a two-way
street</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#generator.throw"><span class="nav-number">12.1.6.</span> <span class="nav-text">generator.throw</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#generator.return"><span class="nav-number">12.1.7.</span> <span class="nav-text">generator.return</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#async-iteration-and-generators"><span class="nav-number">12.2.</span> <span class="nav-text">12.2 Async iteration and
generators</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#async-iterables"><span class="nav-number">12.2.1.</span> <span class="nav-text">Async iterables</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#async-generators"><span class="nav-number">12.2.2.</span> <span class="nav-text">Async generators</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#modles"><span class="nav-number">13.</span> <span class="nav-text">Modles</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#modules-introduction"><span class="nav-number">13.1.</span> <span class="nav-text">13.1 Modules, introduction</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#what-is-a-module"><span class="nav-number">13.1.1.</span> <span class="nav-text">What is a module?</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#core-module-features"><span class="nav-number">13.1.2.</span> <span class="nav-text">Core module features</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#browser-specific-features"><span class="nav-number">13.1.3.</span> <span class="nav-text">Browser-specific features</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#export-and-import"><span class="nav-number">13.2.</span> <span class="nav-text">13.2 Export and import</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#export-before-declarations"><span class="nav-number">13.2.1.</span> <span class="nav-text">Export before declarations</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#export-apart-from-declarations"><span class="nav-number">13.2.2.</span> <span class="nav-text">Export apart from
declarations</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#import"><span class="nav-number">13.2.3.</span> <span class="nav-text">import *</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#import-as"><span class="nav-number">13.2.4.</span> <span class="nav-text">import as</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#export-as"><span class="nav-number">13.2.5.</span> <span class="nav-text">export as</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#export-default"><span class="nav-number">13.2.6.</span> <span class="nav-text">Export default</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#the-default-name"><span class="nav-number">13.2.7.</span> <span class="nav-text">The "default" name</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#a-word-against-default-exports"><span class="nav-number">13.2.8.</span> <span class="nav-text">A word against default
exports</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#re-export"><span class="nav-number">13.2.9.</span> <span class="nav-text">Re-export</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#re-exporting-the-default-export"><span class="nav-number">13.2.10.</span> <span class="nav-text">Re-exporting the default
export</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dynamic-imports"><span class="nav-number">13.3.</span> <span class="nav-text">13.3 Dynamic imports</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#the-import-expression"><span class="nav-number">13.3.1.</span> <span class="nav-text">The import() expression</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#miscullaneous"><span class="nav-number">14.</span> <span class="nav-text">Miscullaneous</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#proxy-and-reflect"><span class="nav-number">14.1.</span> <span class="nav-text">14.1 Proxy and Reflect</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#proxy"><span class="nav-number">14.1.1.</span> <span class="nav-text">Proxy</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#default-value-with-get-trap"><span class="nav-number">14.1.2.</span> <span class="nav-text">Default value with "get" trap</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#validation-with-set-trap"><span class="nav-number">14.1.3.</span> <span class="nav-text">Validation with "set" trap</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#protected-properties-with-deleteproperty"><span class="nav-number">14.1.4.</span> <span class="nav-text">Protected properties
with "deleteProperty"</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#in-range-with-has-trap"><span class="nav-number">14.1.5.</span> <span class="nav-text">"In range" with "has" trap</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#wrapping-functions-apply"><span class="nav-number">14.1.6.</span> <span class="nav-text">Wrapping functions: "apply"</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#reflect"><span class="nav-number">14.1.7.</span> <span class="nav-text">Reflect</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#proxy-limitations"><span class="nav-number">14.1.8.</span> <span class="nav-text">Proxy limitations</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#revocable-proxies"><span class="nav-number">14.1.9.</span> <span class="nav-text">Revocable proxies</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#eval-run-a-code-string"><span class="nav-number">14.2.</span> <span class="nav-text">14.2 Eval: run a code string</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#currying"><span class="nav-number">14.3.</span> <span class="nav-text">14.3 Currying</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#what-for"><span class="nav-number">14.3.1.</span> <span class="nav-text">What for?</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#advanced-curry-implementation"><span class="nav-number">14.3.2.</span> <span class="nav-text">Advanced curry
implementation</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#reference-type"><span class="nav-number">14.4.</span> <span class="nav-text">14.4 Reference type</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#reference-type-explained"><span class="nav-number">14.4.1.</span> <span class="nav-text">Reference type explained</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#bigint"><span class="nav-number">14.5.</span> <span class="nav-text">14.5 BigInt</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#polyfills-1"><span class="nav-number">14.5.1.</span> <span class="nav-text">Polyfills</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Yue Jiao</p>
  <div class="site-description" itemprop="description">Personal blog for idea sharing and archiving.</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">38</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">36</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.yj0.se/2021/modern-js-p1/">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Yue Jiao">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yue Jiao's blog">
      <meta itemprop="description" content="Personal blog for idea sharing and archiving.">
    </span>

    <span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="The Modern JavaScript Tutorial - Part 1 Core JavaScript Note | Yue Jiao's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          The Modern JavaScript Tutorial - Part 1 Core JavaScript Note
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-10-31 00:00:00" itemprop="dateCreated datePublished" datetime="2021-10-31T00:00:00+02:00">2021-10-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-07-29 03:00:41" itemprop="dateModified" datetime="2022-07-29T03:00:41+02:00">2022-07-29</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>152k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time ≈</span>
      <span>2:19</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>Booknote of <a target="_blank" rel="noopener external nofollow noreferrer" href="https://javascript.info/">The Modern JavaScript
Tutorial</a>. This is a comprehensive guide to JavaScript programming in
a modern style. The part 1 cover the core element of modern
JavaScript.</p>
<span id="more"></span>
<h2 id="an-introduction">An introduction</h2>
<h3 id="an-introduction-to-javascript">1.1 An introduction to
JavaScript</h3>
<p>Today, JavaScript can execute on any device that has the JavaScript
engine. The browser has an embedded engine sometimes called a
"JavaScript virtual machine". Different engines have different
"codenames". For example: <code>V8</code> in Chrome and Opera or
<code>SpiderMonkey</code> in Firefox</p>
<p>JavaScript's capabilities greatly depend on the environment it's
running in. For example JavaScript in the browser has following
restrictions:</p>
<ul>
<li>JavaScript on a webpage may not read/write arbitrary files on the
hard disk, copy them or execute programs</li>
<li>Different tabs/windows generally do not know about each other</li>
<li>JavaScript can easily communicate over the net to the server where
the current page came from. But its ability to receive data from other
sites/domains is crippled</li>
</ul>
<h3 id="manuals-and-specifications">1.2 Manuals and specifications</h3>
<p>The ECMA-252 specification contains the most in-depth, detailed and
formalized information about JavaScript. It defines the language</p>
<p>MDN (Mozilla) JavaScript Reference is the main manual with examples
and other information. It's great to get in-depth information about
individual language functions, methods etc. One can find it at
https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference</p>
<h3 id="code-editors">1.3 Code editors</h3>
<p>For IDEs, you can choose Visual Studio Code or WebStorm. For editors,
any text editor should work</p>
<h3 id="developer-console">1.4 Developer console</h3>
<p>In the browser, users don't see errors by default. To see errors and
get a lot of other useful information about scripts, "developer tools"
have been embedded in browsers</p>
<h2 id="javascript-fundamentals">JavaScript Fundamentals</h2>
<h3 id="hello-world">2.1 Hello, world!</h3>
<h4 id="the-script-tag">The "script" tag</h4>
<p>JavaScript programs can be inserted almost anywhere into an HTML
document using the <code>&lt;script&gt;</code> tag</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">HTML</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>Before the script...<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">alert</span>( <span class="string">'Hello, world!'</span> );</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>...After the script.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="modern-markup">Modern markup</h4>
<p>The <code>&lt;script&gt;</code> tag has a few attributes that are
rarely used nowadays but can still be found in old code:</p>
<ul>
<li><p>The <code>type</code> attribute:
<code>&lt;script type=...&gt;</code></p>
<p>HTML4 required a script to have a type. Usually it was
<code>type="text/javascript"</code>. It's not required anymore. Also,
the modern HTML standard totally changed the meaning of this
attribute</p></li>
<li><p>The <code>language</code> attribute:
<code>&lt;script language=...&gt;</code></p>
<p>This attribute no longer makes sense because JavaScript is the
default language</p></li>
<li><p>Comments before and after scripts</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="language-handlebars"><span class="language-xml"><span class="comment">&lt;!--</span></span></span></span><br><span class="line"><span class="comment"><span class="language-xml"><span class="language-handlebars">	...</span></span></span></span><br><span class="line"><span class="comment"><span class="language-xml"><span class="language-handlebars">//--&gt;</span></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>These comments hide JavaScript code from old browsers that didn't
know how to process the <code>&lt;script&gt;</code> tag</p></li>
</ul>
<h4 id="external-scripts">External scripts</h4>
<p>Script files are attached to HTML with the <code>src</code>
attribute:</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/path/to/script.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>As a rule, only the simplest script are put into HTML. More complex
ones reside in separate files. The benefit of a separate file is that
the browser will download it and store it in its cache. That reduces
traffic and makes pages faster. If <code>src</code> is set, the script
content is ignored. A single <code>&lt;script&gt;</code> tag can't have
both the <code>src</code> attribute and code inside</p>
<h3 id="code-structure">2.2 Code structure</h3>
<h4 id="semicolons">Semicolons</h4>
<p>A semicolon may be omitted in most cases when a line break exists. In
most cases, JavaScript interprets the line break as an "implicit"
semicolon. This is called automatic semicolon insertion. But there are
situations where JavaScript "fails" to assume a semicolon where it is
really needed. Thus we recommend putting semicolons between statements
even if they are separated by newlines</p>
<h4 id="comments">Comments</h4>
<p>One line comments starts with <code>//</code></p>
<p>Multiline comments start with <code>/*</code> and ends with
<code>*/</code></p>
<h3 id="the-modern-mode-use-strict">2.3 The modern mode, "use
strict"</h3>
<h4 id="use-strict">"use strict"</h4>
<p>Until ECMAScript 5 in 2009, JavaScript had not modified any existed
features. This is change in ES5. It added new features to the language
and modified some of the existing ones. To keep the old code working,
most such modifications are off by default. You need to explicitly
enable them with a special directive: <code>"use strict"</code>. When it
is located at the top of a script, the whole script works the "modern"
way</p>
<p><code>"use strict"</code> can be put at the beginning of a function.
Doing that enables strict mode in that function only. If it is not at
the top of your scripts or functions, it is ignored</p>
<h3 id="variables">2.4 Variables</h3>
<h4 id="a-variable">A variable</h4>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> message = <span class="string">"Hello"</span>;</span><br></pre></td></tr></tbody></table></figure>
<p>There is also keyword <code>var</code> which is almost the same as
<code>let</code>. The difference is discussed later</p>
<h4 id="variable-naming">Variable naming</h4>
<ul>
<li>The name must contain only letters, digits, or the symbols
<code>$</code> and <code>_</code></li>
<li>The first character must not be a digit</li>
<li>Cannot be reserved names</li>
</ul>
<h4 id="constants">Constants</h4>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> birthday = <span class="string">"18.04.1982"</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">COLOR_RED</span> = <span class="string">"#F00"</span>;</span><br></pre></td></tr></tbody></table></figure>
<p>There is a practice to use constants as aliases for
difficult-to-remember values that are prior to execution. "Hard-coded"
variables.</p>
<h3 id="data-types">2.5 Data types</h3>
<p>There are eight basic data types in JavaScript. We can put any type
in a variable. For example, a variable can at one moment be a string and
then store a number</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// no error</span></span><br><span class="line"><span class="keyword">let</span> message = <span class="string">"hello"</span>;</span><br><span class="line">message = <span class="number">1234</span>;</span><br></pre></td></tr></tbody></table></figure>
<h4 id="number">Number</h4>
<p>The number type represents both integer and floating point numbers.
Besides regular numbers, there are so-called "special numeric values"
which also belong to this data type: <code>Infinity</code>,
<code>-Infinity</code>, and <code>NaN</code>. <code>NaN</code>
represents a computational error. It is a result of an incorrect or
undefined mathematical operation. <code>NaN</code> is sticky. Any
further operation on <code>NaN</code> returns <code>NaN</code></p>
<h4 id="bitint">BitInt</h4>
<p>In JavaScript, the "number" type cannot represent integer values
larger than <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex" xmlns="http://www.w3.org/2000/svg" width="8.576ex" height="2.452ex" role="img" focusable="false" viewBox="0 -833.9 3790.6 1083.9"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="msup" transform="translate(389,0)"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="TeXAtom" transform="translate(533,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z" transform="translate(500,0)"></path></g></g></g><g data-mml-node="mo" transform="translate(1901.3,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mn" transform="translate(2901.6,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(3401.6,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container></span>, or less
than <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex" xmlns="http://www.w3.org/2000/svg" width="10.336ex" height="2.452ex" role="img" focusable="false" viewBox="0 -833.9 4568.6 1083.9"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mo" transform="translate(778,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="msup" transform="translate(1167,0)"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="TeXAtom" transform="translate(533,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z" transform="translate(500,0)"></path></g></g></g><g data-mml-node="mo" transform="translate(2679.3,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mn" transform="translate(3679.6,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(4179.6,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container></span> for negatives.
Sometimes we need really big numbers, e.g. for cryptography or
microsecond-precision timestamps</p>
<p><code>BigInt</code> type was recently added to the language to
represent integers of arbitrary length. A <code>BigInt</code> vaule is
created by appending <code>n</code> to the end of an integer:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bigInt = <span class="number">12345678901234567890n</span>;</span><br></pre></td></tr></tbody></table></figure>
<h4 id="string">String</h4>
<p>A string in JavaScript must be surrounded by quotes</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">"Hello"</span>;</span><br><span class="line"><span class="keyword">let</span> str2 = <span class="string">'single quotes works too'</span>;</span><br><span class="line"><span class="keyword">let</span> phrase = <span class="string">`can embed another <span class="subst">${str}</span>`</span></span><br></pre></td></tr></tbody></table></figure>
<p>Double and single quotes are "simple" quotes. There's practically no
difference between them in JS. Backticks are "extended functionality"
quotes. They allow use to embed variables and expressions into a string
by wrapping them in <code>${...}</code>. For example:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name = <span class="string">"John"</span>;</span><br><span class="line"><span class="title function_">alert</span>( <span class="string">`Hello, <span class="subst">${name}</span>!`</span> ); <span class="comment">// Hello, John!</span></span><br><span class="line"><span class="title function_">alert</span>( <span class="string">`the result is <span class="subst">${<span class="number">1</span> + <span class="number">2</span>}</span>`</span> ); <span class="comment">// the result is 3</span></span><br></pre></td></tr></tbody></table></figure>
<p>There is no character type</p>
<h4 id="boolean">Boolean</h4>
<p>The boolean type has only two values: <code>true</code> and
<code>false</code></p>
<h4 id="the-null-value">The "null" value</h4>
<p>The special <code>null</code> value does not belong to any of the
types described above. In JavaScript, <code>null</code> is not a
"reference to a non-existing object" or a "null pointer" like in some
other languages. It's just a special value which represents "nothing",
"empty" or "value unknown"</p>
<h4 id="the-undefined-value">The "undefined" value</h4>
<p>The meaning of <code>undefined</code> is "value is not assigned"</p>
<h4 id="objects-and-symbols">Objects and symbols</h4>
<p>The <code>symbol</code> type is used to create unique identifiers for
objects</p>
<h4 id="the-typeof-operator">The typeof operator</h4>
<p>The <code>typeof</code> operator returns the type of the argument. It
supports two forms of syntax:</p>
<ol type="1">
<li><code>typeof x</code></li>
<li><code>typeof(x)</code></li>
</ol>
<h3 id="interaction-alert-prompt-confirm">2.6 Interaction: alert,
prompt, confirm</h3>
<h4 id="alert">alert</h4>
<p>It shows a message and waits for the user to press "OK"</p>
<h4 id="prompt">prompt</h4>
<p>The function <code>prompt</code> accepts two arguments</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">result = <span class="title function_">prompt</span>(title, [<span class="keyword">default</span>]);</span><br></pre></td></tr></tbody></table></figure>
<p>It shows a modal window with a text message, an input field for the
visitor, and the buttons OK/Cancel</p>
<ul>
<li><code>title</code>: the text to show the visitor</li>
<li><code>default</code>: an optional second parameter, the initial
value for the input field. Always supply a <code>default</code> in
IE</li>
</ul>
<h4 id="confirm">confirm</h4>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">result = <span class="title function_">confirm</span>(question);</span><br></pre></td></tr></tbody></table></figure>
<p>The function <code>confirm</code> shows a modal window with a
question and two buttons: OK and Cancel. The result is <code>true</code>
is OK is pressed and <code>false</code> otherwise</p>
<h3 id="type-conversions">2.7 Type conversions</h3>
<h4 id="string-conversion">String conversion</h4>
<p>For example, <code>alert(value)</code> does it to show the value. We
can also call the <code>String(value)</code> function to convert a value
to a string</p>
<h4 id="numeric-conversion">Numeric conversion</h4>
<p>Numeric conversion happens in mathematical functions and expressions
automatically. For example: </p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">alert</span>(<span class="string">"6"</span> / <span class="string">"2"</span>); <span class="comment">// 3</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<p>Explicit conversion is usually required when we read a value from a
string-based source like a text form but expect a number to be entered.
If the string is not a valid number, the result of such a conversion is
<code>NaN</code>. For instance: </p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> age = <span class="title class_">Number</span>(<span class="string">"Please insert your age: "</span>);</span><br><span class="line"><span class="title function_">alert</span>(age);</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>Numeric conversion rules:</p>
<table>
<colgroup>
<col style="width: 9%">
<col style="width: 90%">
</colgroup>
<thead>
<tr>
<th>value</th>
<th>becomes</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>undefined</code></td>
<td><code>NaN</code></td>
</tr>
<tr>
<td><code>null</code></td>
<td>0</td>
</tr>
<tr>
<td><code>true</code> and <code>false</code></td>
<td>1 and 0</td>
</tr>
<tr>
<td><code>string</code></td>
<td>Whitespaces from the start and end are removed. If the remaining
string is empty, the result is 0. Otherwise, the number is "read" from
the string. An error gives <code>NaN</code></td>
</tr>
</tbody>
</table>
<h4 id="boolean-conversion">Boolean conversion</h4>
<p>It happens in logical operations but can slo be performed explicitly
with a call to <code>Boolean(value)</code>. The conversion rule: *
Values that are intuitively "empty", like 0, an empty string,
<code>null</code>, <code>undefined</code>, and <code>NaN</code>, become
false * Other values become <code>true</code></p>
<h3 id="basic-operators-maths">2.8 Basic operators, maths</h3>
<h4 id="terms-unary-binary-operand">Terms: unary, binary, operand</h4>
<ul>
<li>An operand is what operators are applied to</li>
<li>An operator is unary if it has a single operand. For example, the
unary negation <code>-42</code></li>
<li>An operator is binary if it has two operands. For example, the minus
<code>4-2</code></li>
</ul>
<h4 id="math-operations">Math operations</h4>
<ul>
<li>Addition <code>+</code></li>
<li>Subtraction <code>-</code></li>
<li>Multiplication <code>*</code></li>
<li>Division <code>/</code></li>
<li>Remainder <code>%</code></li>
<li>Exponentiation <code>**</code></li>
</ul>
<h4 id="string-concatenation-with-binary">String concatenation with
binary +</h4>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="string">"my"</span> + <span class="string">"string"</span>; <span class="comment">// mystring</span></span><br></pre></td></tr></tbody></table></figure>
<p>Note that if any of the operands is a string, then the other one is
converted to a string too</p>
<h4 id="numeric-conversion-unary">Numeric conversion, unary +</h4>
<p>The unary plus applied to a single value, doesn't do anything to
numbers. But if the operand is not a number, the unary plus converts it
into a number</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> apples = <span class="string">"2"</span>;</span><br><span class="line"><span class="keyword">let</span> oranges = <span class="string">"3"</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(+apples + +oranges); <span class="comment">// 5</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="assignment">Assignment</h4>
<p>The assignment <code>=</code> returns a value which is the assigned
value</p>
<h4 id="modify-in-place">Modify-in-place</h4>
<p>For example:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> n = <span class="number">2</span>;</span><br><span class="line">n += <span class="number">5</span>; <span class="comment">// n = 7</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="increment-decrement">Increment / decrement</h4>
<ul>
<li>Increment <code>++</code> increases a variable by 1</li>
<li>Decrement <code>--</code> decreases a variable by 1</li>
</ul>
<p>The operators can be placed either before or after a variable</p>
<ul>
<li>When the operator goes after the variable, it is in "postfix
form"</li>
<li>Otherwise it is in "prefix form"</li>
<li>The prefix form returns the new value while the postfix form returns
the old value</li>
</ul>
<h4 id="comma">Comma</h4>
<p>The comma operator allows us to evaluate several expressions,
dividing them with a comma <code>,</code>. Each of them is evaluated but
only the result of the last one is returned</p>
<h3 id="comparisons">2.9 Comparisons</h3>
<p>JavaScript uses the so-called "dictionary" or "lexicographical" order
to compare strings</p>
<h4 id="strict-equality">Strict equality</h4>
<p>A strict equality operator <code>===</code> checks the equality
without type conversion</p>
<h4 id="comparison-with-null-and-undefined">Comparison with null and
undefined</h4>
<ul>
<li><p>For a strict equality:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alert (<span class="literal">null</span> === <span class="literal">undefined</span>); <span class="comment">// false</span></span><br></pre></td></tr></tbody></table></figure></li>
<li><p>For a non-strict check:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alert (<span class="literal">null</span> == <span class="literal">undefined</span>); <span class="comment">// true</span></span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h5 id="using-strict-equality-to-avoid-strange-bugs">Using strict
equality to avoid strange bugs</h5>
<h3 id="conditional-branching">2.10 Conditional branching</h3>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> year = <span class="number">2015</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (year == <span class="number">2015</span>) alert (<span class="string">"It is 2015"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (year == <span class="number">2015</span>) {</span><br><span class="line">    alert (<span class="string">"It is 2015"</span>);</span><br><span class="line">    alert (<span class="string">"Yes, I'm sure"</span>);</span><br><span class="line">} <span class="keyword">else</span> {</span><br><span class="line">    alert (<span class="string">"It is not 2015"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>A shorter way to write short conditionals is to write it with
question mark operator:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> result = condition ? value1 : value2;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="logical-operators">2.11 Logical operators</h3>
<p>There are four logical operators in JavaScript:</p>
<ul>
<li><p><code>||</code>: or</p>
<ul>
<li>OR finds the first truthy value</li>
<li>Short-circuit evaluation</li>
</ul></li>
<li><p><code>&amp;&amp;</code>: and</p>
<ul>
<li>AND finds the first falsy value</li>
<li>Precedence of AND is higher than OR</li>
</ul></li>
<li><p><code>!</code>: not</p></li>
<li><p><code>??</code>: nullish coalescing</p>
<ul>
<li><p>We will say that an expression is "defined" when it's neither
<code>null</code> nor <code>undefined</code></p></li>
<li><p>The result of <code>a ?? b</code> is:</p>
<ul>
<li>If <code>a</code> is defined, then <code>a</code></li>
<li>If <code>a</code> is not defined, then <code>b</code></li>
</ul>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> area = (height ?? <span class="number">100</span>) * (width ?? <span class="number">50</span>);</span><br></pre></td></tr></tbody></table></figure></li>
<li><p>Due to safety reasons, JavaScript forbids using <code>??</code>
together with <code>&amp;&amp;</code> and <code>||</code> operators,
unless the precedence is explicitly specified with parentheses</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x = (<span class="number">1</span> &amp;&amp; <span class="number">2</span>) ?? <span class="number">3</span>; <span class="comment">// 2</span></span><br></pre></td></tr></tbody></table></figure></li>
</ul></li>
</ul>
<h3 id="loops">2.12 Loops</h3>
<h4 id="the-while-loop">The "while" loop</h4>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (condition) {</span><br><span class="line">    <span class="comment">// code</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="the-do-...-while-loop">The "do ... while" loop</h4>
<p>The loop will first execute the body, then check the condition</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> {</span><br><span class="line">    <span class="comment">// loop body</span></span><br><span class="line">} <span class="keyword">while</span> (condition)</span><br></pre></td></tr></tbody></table></figure>
<h4 id="the-for-loop">The "for" loop</h4>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (begin; condition; step) {</span><br><span class="line">  <span class="comment">// ... loop body ...</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="labels-for-breakcontinue">Labels for break/continue</h4>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">outer</span>: </span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) {</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++) {</span><br><span class="line">    <span class="keyword">let</span> input = <span class="title function_">prompt</span>(<span class="string">`Value at coords (<span class="subst">${i}</span>, <span class="subst">${j}</span>)`</span>, <span class="string">''</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!input) <span class="keyword">break</span> outer;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="title function_">alert</span>(<span class="string">'Done!'</span>);</span><br></pre></td></tr></tbody></table></figure>
<h3 id="the-switch-statement">2.13 The "switch" statement</h3>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span>(x) {</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'value1'</span>: </span><br><span class="line">    ...</span><br><span class="line">    [<span class="keyword">break</span>;]</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'value2'</span>:</span><br><span class="line">    ...</span><br><span class="line">    [<span class="keyword">break</span>;]</span><br><span class="line">  <span class="attr">default</span>:</span><br><span class="line">    ...</span><br><span class="line">    [<span class="keyword">break</span>;]</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="functions">2.14 Functions</h3>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">name</span>(<span class="params">parameter1, parameter2, ... parameterN = defaultValue</span>) {</span><br><span class="line">  ...body...</span><br><span class="line">  [<span class="keyword">return</span> [value];]</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>A function with an empty <code>return</code> or without it returns
<code>undefined</code></p>
<h4 id="alternative-default-parameters">Alternative default
parameters</h4>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">showMessage</span>(<span class="params">text1, text2</span>) {</span><br><span class="line">  <span class="keyword">if</span> (text1 === <span class="literal">undefined</span>) {</span><br><span class="line">    text1 = <span class="string">'empty message'</span>;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="title function_">alert</span>(text1);</span><br><span class="line"></span><br><span class="line">  text2 = text2 || <span class="string">'empty message'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">alert</span>(text2);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="function-expressions">2.15 Function expressions</h3>
<p>In JavaScript, a function is not a "magical language structure", but
a special kind of value. The syntax that we used before is called a
function declaration. There is another syntax for creating a function
that is called a function expression. For example: </p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sayHi = <span class="keyword">function</span> (<span class="params"></span>) {</span><br><span class="line">  <span class="title function_">alert</span>(<span class="string">"Hello"</span>);</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>Why is there a semicolon at the end? * There is no need for
<code>;</code> at the end of code blocks and syntax structures that use
them like <code>if {...}</code>, <code>for {...}</code>,
<code>function f {...}</code> etc. * A function expression is used
inside the statement: <code>let sayHi = ...;</code>, as a value. It is
not a code block, but rather an assignment. The semicolon <code>;</code>
is recommended at the end of statements, no matter what the value is</p>
<p>Here, the function is created and assigned to the variable
explicitly, like any other value. The meaning of this code sample means:
"create a function and put it into the variable <code>sayHi</code>". You
can even print out that value using <code>alert</code> which shows the
function code: </p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">alert</span>( sayHi );</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>The last line does not run the function, because there are no
parentheses after <code>sayHi</code>. In JavaScript, a function is a
value, wo we can deal with it as a value.</p>
<p>For example: </p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">ask</span>(<span class="params">question, yes, no</span>) {</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">confirm</span>(question)) <span class="title function_">yes</span>()</span><br><span class="line">  <span class="keyword">else</span> <span class="title function_">no</span>();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">ask (</span><br><span class="line">  <span class="string">"Do you agree?"</span>,</span><br><span class="line">  <span class="keyword">function</span>(<span class="params"></span>) { <span class="title function_">alert</span>(<span class="string">"You agreed."</span>); },</span><br><span class="line">  <span class="keyword">function</span>(<span class="params"></span>) { <span class="title function_">alert</span>(<span class="string">"You canceled the execution."</span>); }</span><br><span class="line">);</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>A function is a value representing an "action". A function
declaration can be called earlier than it is defined. A function
expression is created when the execution reaches it and is usable only
from that moment. In strict mode, when a function declaration is within
a code block, it's visible everywhere inside that block. But not outside
of it</p>
<h3 id="arrow-function-the-basics">2.16 Arrow function, the basics</h3>
<p>There is another simple and concise syntax for creating functions:
the arrow functions </p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="title function_">func</span> = (<span class="params">arg1, arg2, ..., argN</span>) =&gt; expression</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>For example: </p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="title function_">sayHi</span> = (<span class="params"></span>) =&gt; <span class="title function_">alert</span>(<span class="string">"Hello!"</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">sayHi</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> age = <span class="title function_">prompt</span>(<span class="string">"what is your age?"</span>, <span class="number">18</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> welcome = (age &lt; <span class="number">18</span>) ? </span><br><span class="line">  <span class="function">() =&gt;</span> alert (<span class="string">"Hello!"</span>) :</span><br><span class="line">  <span class="function">() =&gt;</span> alert (<span class="string">"Greetings!"</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">welcome</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="title function_">sum</span> = (<span class="params">a, b</span>) =&gt; {</span><br><span class="line">  <span class="keyword">let</span> result = a + b;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">alert ( sum (<span class="number">1</span>, <span class="number">2</span>) ); <span class="comment">// 3</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<ul>
<li>Without curly braces, the right side is an expression: the function
evaluates it and returns the result</li>
<li>With curly braces, the right side contains multiple statement inside
the function, the we need an explicit <code>return</code> to return
something</li>
</ul>
<h2 id="code-quality">Code quality</h2>
<h3 id="debugging-in-the-browser">3.1 Debugging in the browser</h3>
<h4 id="debugger-command">Debugger command</h4>
<p>We can pause the code by using the <code>debugger</code> command in
the code like: </p><figure class="highlight typescript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hello</span>(<span class="params">name</span>) {</span><br><span class="line">  <span class="keyword">let</span> phrase = <span class="string">`Hello, <span class="subst">${name}</span>!`</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">debugger</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">say</span>(phrase);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="tracing-the-execution">Tracing the execution</h4>
<ul>
<li>Resume: continue the execution, hotkey <code>F8</code></li>
<li>Step: run the next command, hotkey <code>F9</code></li>
<li>Step over: run the next command, but don't go into a function, hokey
<code>F10</code></li>
<li>Step into：step into an asynchronous function calls, hotkey
<code>F11</code></li>
<li>Step out: continue the execution till the end of the current
function, hotkey <code>Shift+F11</code></li>
</ul>
<h3 id="coding-style">3.2 Coding style</h3>
<h4 id="suggested-syntax-rules">Suggested syntax rules</h4>
<ul>
<li>A space between parameters in function</li>
<li>No space between the function name and parentheses and between the
parentheses and parameter</li>
<li>Curly brace <code>{</code> on the same line, after a space</li>
<li>Indentation: 2 or 4 space</li>
<li>Space around operators</li>
<li>A space after
<code>for</code>,<code>if</code>,<code>while</code>...</li>
<li>A semicolon is mandatory</li>
<li>A space betweem arguments</li>
<li>An empty line between logical blocks</li>
<li>Lines should not be very long</li>
<li><code>} else {</code> without a line break</li>
<li>Spaces around a nested call</li>
</ul>
<p>There are lots of style guide from different companies and
organizations</p>
<h3 id="comments-1">3.3 Comments</h3>
<h4 id="comments-this">Comments this</h4>
<ul>
<li>Overall architecture, high-level view</li>
<li>Function usage</li>
<li>Important solutions, especially when not immediately obvious</li>
</ul>
<h4 id="avoid-comments">Avoid comments:</h4>
<ul>
<li>That tell "how code" works and "what it does"</li>
<li>Put them in only if it's impossible to make the code so simple and
self-descriptive that it doesn't require them</li>
</ul>
<h3 id="ninja-code">3.4 Ninja code</h3>
<h4 id="do-not"><em>DO NOT</em>:</h4>
<ul>
<li>Make the code as short as possible</li>
<li>Use one-letter variables</li>
<li>Use abbreviations</li>
<li>Be too abstract</li>
<li>Use similar variable names</li>
<li>Use many different synonyms for similar task</li>
<li>Reuse names</li>
<li>Use lots of underscores</li>
<li>Use meaningless adjectives in variable names</li>
<li>Overlap outer variables</li>
<li>Have side-effects everywhere</li>
<li>Provide too much functionalities to a single function</li>
</ul>
<h3 id="automated-testing-with-mocha">3.5 Automated testing with
Mocha</h3>
<p>When testing a code by manual re-runs, it's easy to miss something.
Automated testing means that tests are written separately, in addition
to the code. They run our functions in various ways and compare results
with the expected</p>
<h4 id="behavior-driven-development-bdd">Behavior Driven Development
(BDD)</h4>
<p>BDD is three things in one: tests AND documentation AND examples. For
example, to write a function <code>pow</code>.</p>
<h4 id="development-of-pow-the-spec">Development of "pow": the spec</h4>
<p>Before creating the code of <code>pow</code>, we can imagine what the
function should do and describe it. Such description is called a
specification or, in short, a spec, and contains descriptions of use
cases together with tests for them, like this:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">describe</span>(<span class="string">"pow"</span>, <span class="keyword">function</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="title function_">it</span>(<span class="string">"raises to n-th power"</span>, <span class="keyword">function</span>(<span class="params"></span>) {</span><br><span class="line">        assert.<span class="title function_">equal</span>(<span class="title function_">pow</span>(<span class="number">2</span>, <span class="number">3</span>), <span class="number">8</span>);</span><br><span class="line">    });</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>
<p>A spec has three main building blocks that you can see:</p>
<ul>
<li><code>describe("title", function() { ... })</code>: What
functionality we're describing. Used to group "workers" - the
<code>it</code> blocks</li>
<li><code>it("use case description", function() { ... })</code>_ In the
title of <code>it</code> we in a human-readable way describe the
particular use case, and the second argument is a function that tests
it</li>
<li><code>assert.equal(value1, value2)</code>: The code inside
<code>it</code> block, if the implementation is correct, should execute
without errors</li>
</ul>
<h4 id="the-development-flow">The development flow</h4>
<ol type="1">
<li>An initial spec is written, with tests for the most basic
functionality</li>
<li>An initial implementation is created</li>
<li>To check whether it works, we run the testing framework Mocha that
runs the spec. While the functionality is not complete, errors are
displayed. We make corrections until everything works</li>
<li>Now we have a working initial implementation with tests</li>
<li>We add more use cases to the spec, probably not yet supported by the
implementations. Tests start to fail</li>
<li>Go to 3, update the implementation till tests give no errors</li>
<li>Repeat steps 3 - 6 till the functionality is ready</li>
</ol>
<h4 id="the-spec-in-action">The spec in action</h4>
<p>In this tutorial we will be using the following JS libraries for
test:</p>
<ul>
<li><code>Mocha</code>: the core framework. It provides common testing
functions including <code>describe</code> and <code>it</code> and the
main function that runs tests</li>
<li><code>Chai</code>: the library with many assertions. It allows to
use a lot of different assertions, for now we need only
<code>assert.equal</code></li>
<li><code>Sinon</code>: a library to spy over functions, emulate
built-in functions are more, we'll need it much later</li>
</ul>
<p>These libraries are suitable for both in-browser and server-side
testing. Here we will consider the browser variant</p>
<p>The full HTML page with these frameworks and <code>pow</code>
spec:</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- add mocha css, to show results --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/mocha/3.2.0/mocha.css"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- add mocha framework code --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/mocha/3.2.0/mocha.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    mocha.<span class="title function_">setup</span>(<span class="string">'bdd'</span>); <span class="comment">// minimal setup</span></span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- add chai --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/chai/3.5.0/chai.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// chai has a lot of stuff, let's make assert global</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> assert = chai.<span class="property">assert</span>;</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">pow</span>(<span class="params">x, n</span>) {</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">/* function code is to be written, empty now */</span></span></span><br><span class="line"><span class="language-javascript">    }</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- the script with tests (describe, it...) --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"test.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- the element with id="mocha" will contain test results --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"mocha"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- run tests! --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">    mocha.run();</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>The page can be divided into 5 parts:</p>
<ol type="1">
<li>The <code>&lt;head&gt;</code> - add third--party libraries and
styles for tests</li>
<li>The <code>&lt;script&gt;</code> with the function to test, in out
case - with the code for <code>pow</code></li>
<li>The tests - in our case an external script <code>test.js</code> that
has <code>describe("pow", ...)</code> from above</li>
<li>The HTML element <code>&lt;div id="mocha"&gt;</code> will be used by
Mocha to output results</li>
<li>The tests are started by the command <code>mocha.run()</code></li>
</ol>
<h4 id="preprocess-and-postprocessing">Preprocess and
postprocessing</h4>
<p>We can setup <code>before/after</code> functions that execute
before/after running tests, and also <code>beforeEach/afterEach</code>
functions that execute before/after every <code>it</code>. For
instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">describe</span>(<span class="string">"test"</span>, <span class="keyword">function</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="title function_">before</span>(<span class="function">() =&gt;</span> <span class="title function_">alert</span>(<span class="string">"Testing started - before all tests"</span>));</span><br><span class="line">    <span class="title function_">after</span>(<span class="function">() =&gt;</span> <span class="title function_">alert</span>(<span class="string">"Testing finished - after all tests"</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">beforeEach</span>(<span class="function">() =&gt;</span> <span class="title function_">alert</span>(<span class="string">"Before a test - enter a test"</span>));</span><br><span class="line">    <span class="title function_">afterEach</span>(<span class="function">() =&gt;</span> <span class="title function_">alert</span>(<span class="string">"After a test - exit a test"</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">it</span>(<span class="string">"test 1"</span>, <span class="function">() =&gt;</span> <span class="title function_">alert</span>(<span class="number">1</span>));</span><br><span class="line">    <span class="title function_">it</span>(<span class="string">"test 2"</span>, <span class="function">() =&gt;</span> <span class="title function_">alert</span>(<span class="number">2</span>));</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>
<h4 id="other-assertions">Other assertions</h4>
<ul>
<li><code>assert.equal(value1, value2)</code>: checks the equality
<code>value1 == value2</code></li>
<li><code>assert.strictEqual(value1, value2)</code>: checks the strict
equality <code>value1 === value2</code></li>
<li><code>assert.notEqual</code>, <code>assert.notStrictEqual</code>:
inverse checks to the ones above</li>
<li><code>assert.isTrue(value)</code>: checks that
<code>value === true</code></li>
<li><code>assert.isFalse(value)</code>: checks that
<code>value === false</code></li>
<li><code>assert.isNaN</code>: checks if it is <code>NaN</code></li>
</ul>
<h3 id="polyfills-and-transpilers">3.6 Polyfills and transpilers</h3>
<p>How to make our modern code work on older engines that don't
understand recent features yet? There are two tools for that:</p>
<ol type="1">
<li>Transpilers</li>
<li>Polyfills</li>
</ol>
<h4 id="transpilers">Transpilers</h4>
<p>A transpiler is a special piece of software that translates source
code to another source code. It can parse modern code and rewrite it
using older syntax constructs, so that it will also work in outdated
engines. Usually, a developer runs the transpiler on their own computer,
and then deploys the transpiled code to the server</p>
<p><code>Babel</code> is one of the most prominent transpiler out there.
Modern project build systems, such as <code>webpack</code>, provide
means to run transpiler automatically on every code change, so it's very
easy to integrate into development process</p>
<h4 id="polyfills">Polyfills</h4>
<p>New language features may include not only syntax constructs and
operators , but also built-in functions. A script that updates / adds
new functions is called "polyfill". It "fills in" the gap and adds
missing implementations</p>
<p>JS is a highly dynamic language, scripts may add/modify any
functions, even including built-in ones. Two interesting libraries of
polyfills are:</p>
<ul>
<li><code>core js</code> that supports a lot, allows to include only
needed features</li>
<li><code>polyfill.io</code> service that provides a script with
polyfills, depending on the features and user's browser</li>
</ul>
<h2 id="objects-the-basics">Objects: the basics</h2>
<h3 id="objects">4.1 Objects</h3>
<p>An object can be created with figure brackets <code>{...}</code> with
an optional list of properties. A property is a "key: value" pair, where
<code>key</code> is a string (also called a "property name"), and
<code>value</code> can be anything</p>
<p>An empty object can be created using one of two syntaxes:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"><span class="keyword">let</span> user = {}; 	<span class="comment">// This is called an object literal</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="literals-and-properties">Literals and properties</h4>
<p>For example:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = {</span><br><span class="line">    <span class="attr">name</span>: <span class="string">"John"</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">30</span>,</span><br><span class="line">    <span class="string">"likes birds"</span>: <span class="literal">false</span>,	<span class="comment">// multiword property name must be quoted</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>( user.<span class="property">name</span> );			<span class="comment">// John</span></span><br><span class="line"><span class="title function_">alert</span>( user.<span class="property">age</span>  );			<span class="comment">// 30</span></span><br><span class="line"></span><br><span class="line">user.<span class="property">isAdmin</span> = <span class="literal">true</span>;</span><br><span class="line"><span class="title function_">alert</span>( user.<span class="property">isAdmin</span> );		<span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> user.<span class="property">age</span>;</span><br><span class="line"><span class="title function_">alert</span>( user.<span class="property">age</span> );			<span class="comment">// Undefined</span></span><br><span class="line"></span><br><span class="line">user[<span class="string">"likes birds"</span>]= <span class="literal">true</span>	<span class="comment">// For multiword properties, the dot access doesn't work</span></span><br><span class="line">alert (user[<span class="string">"likes birds"</span>])	<span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> key = <span class="string">"name"</span>;</span><br><span class="line"><span class="title function_">alert</span>( user[key] );			<span class="comment">// John</span></span><br><span class="line"><span class="title function_">alert</span>( user.<span class="property">key</span>  );			<span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> fruit = <span class="string">"apple"</span>;</span><br><span class="line"><span class="keyword">let</span> bag = {</span><br><span class="line">    [fruit]: <span class="number">5</span>,</span><br><span class="line">};</span><br><span class="line"><span class="title function_">alert</span>( bag.<span class="property">apple</span> );			<span class="comment">// 5 </span></span><br><span class="line">bag[fruit + <span class="string">"Computer"</span>] = <span class="number">6</span>;</span><br><span class="line"><span class="title function_">alert</span>( bag.<span class="property">appleComputer</span> );	<span class="comment">// 6</span></span><br></pre></td></tr></tbody></table></figure>
<p>The dot requires the key to be a valid variable identifier. That
implies: contains no spaces, doesn't start with a digit and doesn't
include special characters (<code>$</code> and <code>_</code> are
allowed)</p>
<h4 id="property-value-shorthand">Property value shorthand</h4>
<p>For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">makeUser</span>(<span class="params">name, age</span>) {</span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">        name,	<span class="comment">// same as name: name</span></span><br><span class="line">        age,	<span class="comment">// same as age: age</span></span><br><span class="line">    };</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> user = <span class="title function_">makeUser</span>(<span class="string">"John"</span>, <span class="number">30</span>);</span><br><span class="line"><span class="title function_">alert</span>( user.<span class="property">name</span> ); 	<span class="comment">// John</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="property-names-limitations">Property names limitations</h4>
<p>A variable cannot have a name equal to one of language-reserved words
like "for", "let", "return" etc. But for an object property, there is no
such restriction. They can be any strings or symbols. Other types are
automatically converted to strings</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = {</span><br><span class="line">    <span class="number">0</span>: <span class="string">"test"</span>		<span class="comment">// same as "0": "test"</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>( obj[<span class="string">"0"</span>] );	<span class="comment">// test</span></span><br><span class="line"><span class="title function_">alert</span>( obj[<span class="number">0</span>]   );	<span class="comment">// test</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="property-existence-test-in-operator">Property existence test,
"in" operator</h4>
<p>For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user { <span class="attr">name</span>: <span class="string">"John"</span>, <span class="attr">age</span>: <span class="number">30</span>, <span class="attr">unde</span>: <span class="literal">undefined</span> };</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>( <span class="string">"age"</span> <span class="keyword">in</span> user ); 	<span class="comment">// true</span></span><br><span class="line"><span class="title function_">alert</span>( <span class="string">"blabla"</span> <span class="keyword">in</span> user );	<span class="comment">// false</span></span><br><span class="line"><span class="title function_">alert</span>( <span class="string">"unde"</span> <span class="keyword">in</span> user );		<span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> key = <span class="string">"age"</span></span><br><span class="line"><span class="title function_">alert</span>( key <span class="keyword">in</span> user );		<span class="comment">// true</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="the-for...in-loop">The "for...in" loop</h4>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = {</span><br><span class="line">    <span class="attr">name</span>: <span class="string">"John"</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">30</span>,</span><br><span class="line">    <span class="attr">isAdmin</span>: <span class="literal">true</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> user) {</span><br><span class="line">    <span class="title function_">alert</span>( key );</span><br><span class="line">    <span class="title function_">alert</span>( user[key] );</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="ordered-like-an-object">Ordered like an object</h4>
<p>The properties is ordered in a special fashion: integer properties
are sorted, others appear in creation order</p>
<p>If we want integer properties with creation order, we can "cheat" by
making the codes non-integer. For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> codes = {</span><br><span class="line">    <span class="string">"+49"</span>: <span class="string">"Germany"</span>,</span><br><span class="line">    <span class="string">"+41"</span>: <span class="string">"Switzerland"</span>,</span><br><span class="line">    <span class="string">"+44"</span>: <span class="string">"Great Britain"</span>,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">     <span class="string">"+1"</span>: <span class="string">"USA"</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> code <span class="keyword">in</span> codes) {</span><br><span class="line">    alert ( +code );	<span class="comment">// 49, 41, 44, 1</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="object-references-and-copying">4.2 Object references and
copying</h3>
<p>One of the fundamental differences of objects versus primitives is
that objects are stored and copied "by reference", whereas primitive
values: strings, numbers, booleans, etc. - are always copied "as a whole
value"</p>
<h4 id="comparison-by-reference">Comparison by reference</h4>
<p>Two objects are equal only if they are the same object. For
instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = {};</span><br><span class="line"><span class="keyword">let</span> b = a;</span><br><span class="line"><span class="title function_">alert</span>( a == b );	<span class="comment">// true</span></span><br><span class="line"><span class="title function_">alert</span>( a === b );	<span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> c = {};</span><br><span class="line"><span class="keyword">let</span> d = {};</span><br><span class="line"><span class="title function_">alert</span>( c == d );	<span class="comment">// false</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="cloning-and-merging-object.assign">Cloning and merging,
<code>Object.assign</code></h4>
<p>We can copy an object in the following way:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = { <span class="attr">name</span>: <span class="string">"John"</span>, <span class="attr">age</span>: <span class="number">30</span> };</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> clone = {};</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> user) {</span><br><span class="line">    clone[key] = user[key];</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>Also we can use the method <code>Object.assign</code> for that. The
syntax is:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="title function_">assign</span>(dest, [src1, src2, src3 ...])</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>The first argument <code>dest</code> is a target object</li>
<li>Further arguments <code>src1, ..., srcN</code> are source
objects</li>
<li>It copies the properties of all source objects into the target</li>
<li>If the copied property name already exists, it gets overwritten</li>
<li>The call returns <code>dest</code></li>
</ul>
<p>For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = { <span class="attr">name</span>: <span class="string">"John"</span> };</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> permission1 = { <span class="attr">canView</span>: <span class="literal">true</span> };</span><br><span class="line"><span class="keyword">let</span> permission2 = { <span class="attr">canEdit</span>: <span class="literal">true</span> };</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">assign</span>(user, permission1, permission2);</span><br><span class="line"><span class="comment">// now user = { name: "John", canView: true, canEdit: true }</span></span><br></pre></td></tr></tbody></table></figure>
<p>We also can use <code>Object.assign</code> for simple cloning:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> clone = <span class="title class_">Object</span>.<span class="title function_">assign</span>({}, user);</span><br></pre></td></tr></tbody></table></figure>
<h4 id="nested-cloning">Nested cloning</h4>
<p>What if properties are references to other objects? Then it is not
enough to just copy all properties. We then need to perform a "deep
cloning". We can use recursion to implement it. Or take an existing
implementation, for instance <code>_.cloneDeep(obj)</code> from the JS
library <code>lodash</code></p>
<h4 id="const-objects-can-be-modified">Const objects can be
modified</h4>
<p>The value of the entire object is constant, it must always reference
the same object, but properties of that object are free to change</p>
<h3 id="garbage-collection">4.3 Garbage collection</h3>
<h4 id="reachability">Reachability</h4>
<p>The main concept of memory management in JS is reachability. Simply
put, "reachable" values are those that are accessible or usable somehow.
They are guaranteed to be stored in memory</p>
<ol type="1">
<li>There's a base set of inherently reachable values, that cannot be
deleted for obvious reasons. These values are called roots. For
instance:
<ul>
<li>The currently executing function, its local variables and
parameters</li>
<li>Other functions on the current chain of nested calls, their local
variables and parameters</li>
<li>Global variables</li>
<li>(There are some other, internal ones as well)</li>
</ul></li>
<li>Any other value is considered reachable if it's reachable from a
root by a reference or by a chain of references</li>
</ol>
<p>There is a background process in the JS engine that is called garbage
collector. It monitors all objects and removes those that have become
unreachable</p>
<h4 id="internal-algorithms">Internal algorithms</h4>
<p>The basic garbage collection algorithm is called "mark-and-sweep".
The following "garbage collection" steps are regularly performed:</p>
<ul>
<li>The garbage collector takes roots and "marks" (remembers) them</li>
<li>Then it visits and "marks" all references from them</li>
<li>Then it visits marked objects and marks their references. All
visited objects are remembered, so as not to visit the same object twice
in the future</li>
<li>And so on until every reachable (from the roots) references are
visited</li>
<li>All objects except marked ones are removed</li>
</ul>
<p>That's the concept of how garbage collection works. JS engines apply
many optimizations to make it run faster and not affect the execution.
Some of the optimizations:</p>
<ul>
<li>Generational collection: objects are split into two sets: "new ones"
and "old ones". Many objects appear, do their job and die fast, they can
be cleaned up aggressively. Those that survive for long enough, become
"old" and are examined less often</li>
<li>Incremental collection: If there are many objects, and we try to
walk and mark the whole object set at once, it may take some time and
introduce visible delays in the execution. So the engine tries to split
the garbage collection into pieces. Then the pieces are executed one by
one, separately. That requires some extra bookkeeping between them to
track changes, but we have many tiny delays instead of a big one</li>
<li>Idle-time collection: the garbage collector tries to run only while
the CPU is idle, to reduce the possible effect on the execution</li>
<li>There exist other optimizations</li>
</ul>
<h3 id="object-methods-this">4.4 Object methods, "this"</h3>
<h4 id="method-examples">Method examples</h4>
<p>A function that is property of an object is called its method</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = {</span><br><span class="line">    <span class="attr">name</span>: <span class="string">"John"</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">30</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">user.<span class="property">sayHi</span> = <span class="keyword">function</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">"Hello!"</span>);</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">user.<span class="title function_">sayHi</span>();	<span class="comment">// Hello!</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="method-shorthand">Method shorthand</h4>
<p>These two notations are not fully identical. There are subtle
differences related to object inheritance. In almost all cases the
shorter syntax is preferred</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">user = {</span><br><span class="line">    <span class="attr">sayHello</span>: <span class="keyword">function</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">"Hello"</span>);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">sayHi</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">"Hi"</span>);</span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<h4 id="this-in-methods">"this" in methods</h4>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = {</span><br><span class="line">    <span class="attr">name</span>: <span class="string">"John"</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">30</span>,</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">sayHi</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="comment">// "this" is the "current object"</span></span><br><span class="line">        <span class="title function_">alert</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">user.<span class="title function_">sayHi</span>();	<span class="comment">// John</span></span><br></pre></td></tr></tbody></table></figure>
<p>We can do the following, but the code is unreliable:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = {</span><br><span class="line">    <span class="attr">user</span>: <span class="string">"John"</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">30</span>,</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">sayHi</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="title function_">alert</span>(user.<span class="property">name</span>);	<span class="comment">// "user" instread of "this"</span></span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">user.<span class="title function_">sayHi</span>();	<span class="comment">// "John"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> admin = user;</span><br><span class="line">user = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">admin.<span class="title function_">sayHi</span>();	<span class="comment">// TypeError: Cannot read property 'name' of null</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="this-is-not-bound">"this" is not bound</h4>
<p>In JS, keyword <code>this</code> behaves unlike most other
programming languages. It can be used in any function, even if it's not
a method of an object. The value of <code>this</code> is evaluated
during the run-time, depending on the context. The rule is simple: if
<code>obj.f()</code> is called, then <code>this</code> is
<code>obj</code> during the call of <code>f</code>. For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = { <span class="attr">name</span>: <span class="string">"John"</span> };</span><br><span class="line"><span class="keyword">let</span> admin = { <span class="attr">name</span>: <span class="string">"Admin"</span> };</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sayHi</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="title function_">alert</span>( <span class="variable language_">this</span>.<span class="property">name</span> );</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">user.<span class="property">f</span> = sayHi;</span><br><span class="line">admin.<span class="property">f</span> = sayHi;</span><br><span class="line"></span><br><span class="line">user.<span class="title function_">f</span>();	<span class="comment">// John</span></span><br><span class="line">admin.<span class="title function_">f</span>();	<span class="comment">// Admin</span></span><br></pre></td></tr></tbody></table></figure>
<p>In strict mode, if we call <code>this</code> without an object,
<code>this</code> is <code>undefined</code>. In non-strict mode, the
value of <code>this</code> will be the global object(<code>window</code>
in a browser). This is a historical behavior</p>
<h4 id="arrow-functions-have-no-this">Arrow functions have no
"this"</h4>
<p>Arrow functions don't have their "own" <code>this</code>. If we
reference <code>this</code> from such a function, it's taken from the
outer "normal" function. For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = {</span><br><span class="line">    <span class="attr">firstName</span>: <span class="string">"Ilya"</span>,</span><br><span class="line">    <span class="title function_">sayHi</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="keyword">let</span> <span class="title function_">arrow</span> = (<span class="params"></span>) =&gt; <span class="title function_">alert</span>(<span class="variable language_">this</span>.<span class="property">firstName</span>);</span><br><span class="line">        <span class="title function_">arrow</span>();</span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">user.<span class="title function_">sayHi</span>();	<span class="comment">// Ilya</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="constructor-operator-new">4.5 Constructor, operator "new"</h3>
<h4 id="constructor-function">Constructor function</h4>
<p>Constructor functions technically are regular functions. There are
two conventions though:</p>
<ol type="1">
<li>They are named with capital letter first</li>
<li>They should be executed only with <code>"new"</code> operator</li>
</ol>
<p>For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">User</span>(<span class="params">name</span>) {</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAdmin</span> = <span class="literal">false</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> user = <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">"Jack"</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(user.<span class="property">name</span>);		<span class="comment">// Jack</span></span><br><span class="line"><span class="title function_">alert</span>(user.<span class="property">isAdmin</span>);	<span class="comment">// false</span></span><br></pre></td></tr></tbody></table></figure>
<p>When a function is executed with <code>new</code>, it does the
following steps:</p>
<ol type="1">
<li>A new empty object is created and assigned to <code>this</code></li>
<li>The function body executes. Usually it modifies <code>this</code>,
adds new properties to it</li>
<li>The value of <code>this</code> is returned</li>
</ol>
<p>In other words, <code>new User(...)</code> does something like:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">User</span>(<span class="params">name</span>) {</span><br><span class="line">    <span class="comment">// this = {};	(implicitly)</span></span><br><span class="line">    </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAdmin</span> = <span class="literal">false</span>;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// return this;	(implicitly)</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>We can omit parentheses after <code>new</code>, if it has no
arguments. But it is not considered a "good style"</p>
<h4 id="constructor-mode-test-new.target">Constructor mode test:
<code>new.target</code></h4>
<p>Inside a function, we can check whether it was called with
<code>new</code> or without it, using a special <code>new.target</code>
property. It is undefined for regular calls and equals the function if
called with <code>new</code>:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">User</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="title function_">alert</span>(<span class="keyword">new</span>.<span class="property">target</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// without "new":</span></span><br><span class="line"><span class="title class_">User</span>();		<span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// with "new":</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">User</span>();	<span class="comment">// function User {...}</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="return-from-constructors">Return from constructors</h4>
<p>If there is a <code>return</code> statement, then the rule is
simple:</p>
<ul>
<li>If <code>return</code> is called with an object, then the object is
returned instead of <code>this</code></li>
<li>If <code>return</code> is called with a primitive, it is
ignored</li>
</ul>
<h3 id="optional-chaining-.">4.6 Optional chaining '?.'</h3>
<p>The optional chaining <code>?.</code> is a safe way to access nested
object properties, even if an intermediate property</p>
<h4 id="the-non-existing-property-problem">The "non-existing property"
problem</h4>
<p>In many practical cases, we'd prefer to get <code>undefined</code>
instead of an error when we attempt to get an element of an
<code>undefined</code> object. That's why the optional chaining
<code>?.</code> was added to the language.</p>
<h4 id="optional-chaining">Optional chaining</h4>
<p>The optional chaining <code>?.</code> stops the evaluation
(short-circuiting) if the value before <code>?.</code> is
<code>undefined</code> or <code>null</code> and returns
<code>undefined</code>. For example:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = {};</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>( user?.<span class="property">address</span>?.<span class="property">street</span> );		<span class="comment">// undefined</span></span><br></pre></td></tr></tbody></table></figure>
<p>The <code>?.</code> syntax makes optional the value before it, but
not any further. We should use <code>?.</code> only where it's ok that
something doesn't exist. If there is no variable <code>user</code> at
all, then <code>user?.anything</code> triggers an error</p>
<h4 id="other-variants-.-.">Other variants: <code>?.()</code>,
<code>?.[]</code></h4>
<p>The optional chaining <code>?.</code> is not an operator, but a
special syntax construct, that also works with functions and square
brackets. For example, <code>?.()</code> is used to call a function that
may not exist.</p>
<p>The <code>?.()</code> checks the left part, if it exists, then it
runs. Otherwise the evaluation stops without errors.</p>
<p>The <code>?.[]</code> syntax also works, if we'd like to use brackets
<code>[]</code> to access properties instead of dot <code>.</code>.
Similar to previous case, it allows to safely read a property from an
object that may not exist.</p>
<p>Also we can use <code>?.</code> with <code>delete</code>:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> user?.<span class="property">name</span>;		<span class="comment">// delete user.name if user exists</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="symbol-type">4.7 Symbol type</h3>
<p>By specification, object property keys may be either of string type,
or of symbol type. Not numbers, not booleans.</p>
<h4 id="symbols">Symbols</h4>
<p>A "symbol" represents a unique identifier. A value of this type can
be created using <code>Symbol()</code>:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> id = <span class="title class_">Symbol</span>();</span><br></pre></td></tr></tbody></table></figure>
<p>Upon creation we can give symbol a description (also called a symbol
name), mostly useful for debugging purposes:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> id = <span class="title class_">Symbol</span>(<span class="string">"id"</span>);</span><br></pre></td></tr></tbody></table></figure>
<p>Symbols are guaranteed to be unique. Even if we create many symbols
with the same description, they are different values. The description is
just a label that doesn't affect anything.</p>
<p>To print symbols:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> id = <span class="title class_">Symbol</span>(<span class="string">"id"</span>);</span><br><span class="line"><span class="title function_">alert</span>(id.<span class="title function_">toString</span>());	<span class="comment">// Symbol(id)</span></span><br><span class="line"><span class="title function_">alert</span>(id.<span class="property">description</span>);	<span class="comment">// id</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="hidden-properties">"Hidden" properties</h4>
<p>Symbols allow us to create "hidden" properties of an object, that no
other part of code can accidentally access or overwrite. Symbolic
properties do not participate in <code>for..in</code> loop but the
direct access works.</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = {</span><br><span class="line">    <span class="attr">name</span>: <span class="string">"John"</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">user[id] = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>( user[id] );	<span class="comment">// 1</span></span><br></pre></td></tr></tbody></table></figure>
<p><code>Object.keys(user)</code> also ignores them. That's a part of
the general "hiding symbolic properties" principle.</p>
<p>If <code>user</code> objects belong to another code, and that code
also works with them, we shouldn't just add any fields to it. That is
unsafe.</p>
<h4 id="symbols-in-an-object-literal">Symbols in an object literal</h4>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> id = <span class="title class_">Symbol</span>(<span class="string">"id"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> user = {</span><br><span class="line">    <span class="attr">name</span>: <span class="string">"John"</span>,</span><br><span class="line">    [id]: <span class="number">123</span>	</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<h4 id="global-symbols">Global symbols</h4>
<p>There is a global symbol registry. We can create symbols in it and
access them later, and it guarantees that repeated accesses by the same
name return exactly the same symbol. In order to read (create if absent)
a symbol from the registry, use <code>Symbol.for(key)</code>. That call
checks the global registry, and if there's a symbol described as
<code>key</code>, then returns it, otherwise creates a new symbol
<code>Symbol(key)</code> and stores it in the registry by the given
<code>key</code>. For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> id = <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">"id"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> idAgain = <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">"id"</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(id === idAgain);	<span class="comment">// true</span></span><br></pre></td></tr></tbody></table></figure>
<h5 id="symbol.keyfor"><code>Symbol.keyFor</code></h5>
<p>For global symbols, not only <code>Symbol.for(key)</code> returns a
symbol by name, but there's a reverse call:
<code>Symbol.keyFor(sym)</code>, that does the reverse: returns a name
by a global symbol.</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sym = <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">"name"</span>);</span><br><span class="line"><span class="keyword">let</span> sym2 = <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">"id"</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>( <span class="title class_">Symbol</span>.<span class="title function_">keyFor</span>(sym) );	<span class="comment">// name</span></span><br><span class="line"><span class="title function_">alert</span>( <span class="title class_">Symbol</span>.<span class="title function_">keyFor</span>(sym2) );	<span class="comment">// id</span></span><br></pre></td></tr></tbody></table></figure>
<p>The <code>Symbol.keyFor</code> internally uses the global symbol
registry to look up the key for the symbol. So it doesn't work for
non-global symbols. It returns <code>undefined</code> for non-global
symbols.</p>
<h4 id="system-symbols">System symbols</h4>
<p>There exist many "system" symbols that JS uses internally, and we can
use them to fine-tune various aspects of our objects. For instance:</p>
<ul>
<li><code>Symbol.hasInstance</code></li>
<li><code>Symbol.isConcatSpreadable</code></li>
<li><code>Symbol.iterator</code></li>
<li><code>Symbol.toPrimitive</code></li>
<li>...</li>
</ul>
<h3 id="object-to-primitive-conversion">4.8 Object to primitive
conversion</h3>
<p>JS doesn't exactly allow to customize how operators work on objects.
We can't implement a special object method to handle, for example, an
addition. In case of such operations, objects are auto-converted to
primitives, and then the operation is carried out over these primitives
and results in a primitive value.</p>
<h4 id="conversion-rules">Conversion rules</h4>
<ol type="1">
<li>All object are <code>true</code> in a boolean context. There are
only numeric and string conversions</li>
<li>The numeric conversion happens when we subtract objects or apply
matematical functions</li>
<li>As for the string conversion - it usually happens when we output an
object like <code>alert(obj)</code> and in similar contexts</li>
</ol>
<p>We can fine-tune string and numeric conversion, using special object
methods. There are three variants of type conversion, that happen in
various situations. They are called "hints", as described in the
specification:</p>
<ul>
<li><code>"string"</code>: For an object-to-string conversion, when
we're doing an operation on an object that expects a string</li>
<li><code>"number"</code>: For an object-to-number conversion, like when
we're doing maths</li>
<li><code>"default"</code>: Occurs in rare cases when the operator is
"not sure" what type to expect. For instance, binary plus <code>+</code>
can work both with strings and numbers, so both strings and numbers
would do. So if a binary plus gets an object as an argument, it uses the
<code>"default"</code> to convert it. The greater and less comparison
operators can work with both strings and numbers too. Still, they use
the <code>"number"</code> hint, not <code>"default"</code>. That's for
historical reasons</li>
</ul>
<p>In practice though, we don't need to remember these peculiar details,
because all built-in objects except for one case, <code>Date</code>,
implement <code>"default"</code> conversion the same way
<code>"number"</code>. And we can do the same</p>
<p>To do the conversion, JS tries to find and call three object
methods:</p>
<ol type="1">
<li>Call <code>obj[Symbol.toPrimitive](hint)</code> - the method with
the symbolic key <code>Symbol.toPrimitive</code> (system symbol), if
such method exists</li>
<li>Otherwise if hint is <code>"string"</code>: try
<code>obj.toString()</code> and <code>obj.valueOf()</code>, whatever
exists</li>
<li>Otherwise if hint is <code>"number"</code> or
<code>"default"</code>: try <code>obj.valueOf()</code> and
<code>obj.toString()</code>, whatever exists</li>
</ol>
<h4 id="symbol.toprimitive"><code>Symbol.toPrimitive</code></h4>
<p>There's a built-in symbol named <code>Symbol.toPrimitive</code> that
should be used to name the conversion method, like this:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = {</span><br><span class="line">    <span class="attr">name</span>: <span class="string">"John"</span>,</span><br><span class="line">    <span class="attr">money</span>: <span class="number">1000</span>,</span><br><span class="line">    </span><br><span class="line">    [<span class="title class_">Symbol</span>.<span class="property">toPrimitive</span>](hint) {</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">`hint: <span class="subst">${hint}</span>`</span>);</span><br><span class="line">        <span class="keyword">return</span> hint == <span class="string">"string"</span> ? <span class="string">`{name: "<span class="subst">${<span class="variable language_">this</span>.name}</span>"}`</span> : <span class="variable language_">this</span>.<span class="property">money</span>; </span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">// conersions demo:</span></span><br><span class="line"><span class="title function_">alert</span>(user); 		<span class="comment">// hint: string -&gt; {name: "John"}</span></span><br><span class="line"><span class="title function_">alert</span>(+user);		<span class="comment">// hint: number -&gt; 1000</span></span><br><span class="line"><span class="title function_">alert</span>(user + <span class="number">500</span>);	<span class="comment">// hint: default -&gt; 1500</span></span><br></pre></td></tr></tbody></table></figure>
<p>If the method <code>Symbol.toPrimitive</code> exists, it's used for
all hints, and no more methods are needed</p>
<h4 id="tostring-valueof"><code>toString</code> /
<code>valueOf</code></h4>
<p>If there's no <code>Symbol.toPrimitive</code> then JS tries to find
methods <code>toString</code> to <code>valueOf</code></p>
<ul>
<li>For the "string" hint: <code>toString</code></li>
<li>For other hints: <code>valueOf</code></li>
</ul>
<p>These two methods come from ancient times. They are not symbols, but
rather "regular" string-named method. They provide an alternative
"old-style" way to implement the conversion</p>
<p>By default, a plain object has following methods:</p>
<ul>
<li>The <code>toString</code> method returns a string
<code>"[object Object]"</code></li>
<li>The <code>valueOf</code> method returns the object itself</li>
</ul>
<h4 id="a-conversion-can-return-any-primitive-type">A conversion can
return any primitive type</h4>
<p>The important thing to know about all primitive-conversion methods is
that they do not necessarily return the "hinted" primitive. There is no
control whether <code>toString</code> returns exactly a string, or
whether <code>Symbol.toPrimitive</code> method returns number for a hint
<code>"number"</code></p>
<h4 id="further-conversions">Further conversions</h4>
<p>Many operators and functions perform type conversions, e.g.
multiplication <code>*</code>converts operands to numbers. If we pass an
object as an argument, then there are two stages:</p>
<ol type="1">
<li>The object is converted to a primitive (using the rules described
above)</li>
<li>If the resulting primitive isn't of the right type, it's
converted</li>
</ol>
<p>For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = {</span><br><span class="line">    <span class="title function_">toString</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"2"</span>;</span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(obj * <span class="number">2</span>); 	<span class="comment">// 4, object converted to primitive "2", then multiplication made it 2 </span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="data-types-1">Data types</h2>
<h3 id="methods-of-primitives">5.1 Methods of primitives</h3>
<p>JS allows us to work with primitives (strings, numbers, etc) as if
they were objects. They also provide methods to call as such.</p>
<p>Let's look at the key distinctions between primitives and
objects:</p>
<p>A primitive</p>
<ul>
<li>Is a value of a primitive value</li>
<li>There are 7 primitive types: <code>string</code>,
<code>number</code>, <code>bigint</code>, <code>boolean</code>,
<code>symbol</code>, <code>null</code> and <code>undefined</code></li>
</ul>
<p>An object</p>
<ul>
<li>Is capable of storing multiple values as properties</li>
<li>Can be created with <code>{}</code>, for instance:
<code>{name: "John", age: 30}</code>. There are other kinds of objects
in JS: functions, for example, are objects</li>
</ul>
<h4 id="a-primitive-as-an-object">A primitive as an object</h4>
<p>Primitives are still primitive. A single value, as desired to make
them as fast and lightweight as possible. The language allow access to
methods and properties of strings, numbers, booleans and symbols. In
order for that to work, a special "object wrapper" that provides the
extra functionality is created, and then is destroyed. The "object
wrappers" are different for each primitive type and are called:
<code>String</code>, <code>Number</code>, <code>Boolean</code> and
<code>Symbol</code>. For instance, there exists a string method
<code>str.toUpperCase()</code> that returns a capitalized
<code>str</code>:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">"hello"</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>( str.<span class="title function_">toUpperCase</span>() );	<span class="comment">// HELLO</span></span><br></pre></td></tr></tbody></table></figure>
<p>Constructors <code>String/Number/Boolean</code> are for internal use
only, It is possible, but highly unrecommended.
<code>null</code>/<code>undefined</code> have no methods.</p>
<h3 id="numbers">5.2 Numbers</h3>
<p>In modern JS, there are two types of numbers:</p>
<ol type="1">
<li>Regular numbers in JS are stored in 64-bit format IEEE-754, also
known as "double precision floating point numbers". These are numbers
that we're using most of the time</li>
<li>BitInt numbers, to represent integers of arbitrary length</li>
</ol>
<h4 id="more-ways-to-write-a-number">More ways to write a number</h4>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> billion = <span class="number">1000000000</span>;</span><br><span class="line"><span class="keyword">let</span> other_billion = <span class="number">1_000_000_000</span>;</span><br><span class="line"><span class="keyword">let</span> another_billion = <span class="number">1e9</span>;</span><br></pre></td></tr></tbody></table></figure>
<h4 id="hex-binary-and-octal-numbers">Hex, binary and octal numbers</h4>
<p>Hexadecimal numbers are widely used in JS to represent colors, encode
chararcters, and for many other things. It is supported by the
<code>0x</code> number. For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">alert</span>( <span class="number">0xff</span> );	<span class="comment">// 255</span></span><br></pre></td></tr></tbody></table></figure>
<p>Binary and octal numeral systems are rarely used, but also supported
using the <code>0b</code> and <code>0o</code> prefixes.</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">0b11111111</span>; 	<span class="comment">// binary form of 255</span></span><br><span class="line"><span class="keyword">let</span> b = <span class="number">0o377</span>;			<span class="comment">// octal form of 255</span></span><br><span class="line">alert ( a == b );		<span class="comment">// true</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="tostringbase"><code>toString(base)</code></h4>
<p>For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> num = <span class="number">255</span>;</span><br><span class="line">alert (num.<span class="title function_">toString</span>(<span class="number">16</span>));		<span class="comment">// ff</span></span><br><span class="line">alert (num.<span class="title function_">toString</span>(<span class="number">2</span>));		<span class="comment">// 11111111</span></span><br><span class="line">alert (<span class="number">123456.</span>.<span class="title function_">toString</span>(<span class="number">36</span>));	<span class="comment">// 2n9c</span></span><br></pre></td></tr></tbody></table></figure>
<p>Here the two dots mean calling a method.</p>
<h4 id="rounding">Rounding</h4>
<p>There are several built-in functions for rounding:</p>
<ul>
<li><code>Math.floor</code>: rounds down</li>
<li><code>Math.ceil</code>: rounds up</li>
<li><code>Math.round</code>: rounds to the nearest integer</li>
<li><code>Math.trunc</code> (not supported by internet explorer):
removes anything after the decimal point without rounding</li>
</ul>
<h4 id="imprecise-calculations">Imprecise calculations</h4>
<p>A number is represented in 64-bit format IEEE-754 internally so
imprecision related to float number occurs. To fix this, you can use the
method <code>toFixed</code>:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sum = <span class="number">0.1</span> + <span class="number">0.2</span>;</span><br><span class="line">alert (sum.<span class="title function_">toFixed</span>(<span class="number">2</span>));	<span class="comment">// 0.30</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="tests-isfinite-and-isnan">Tests: <code>isFinite</code> and
<code>isNaN</code></h4>
<ul>
<li><p><code>Infinity</code> (and <code>-Infinity</code>) is a special
numeric value that is greater (less) than anything</p></li>
<li><p><code>NaN</code> represents an error</p>
<ul>
<li><p><code>isNaN(value)</code> converts its argument to a number and
then tests it for being <code>NaN</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">isNaN</span>(<span class="title class_">NaN</span>); 			<span class="comment">// true</span></span><br><span class="line"><span class="title function_">isNan</span>(<span class="string">"str"</span>);			<span class="comment">// true</span></span><br><span class="line"><span class="title class_">NaN</span> === <span class="title class_">NaN</span>;			<span class="comment">// false</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">is</span>(<span class="title class_">NaN</span>, <span class="title class_">NaN</span>);	<span class="comment">// true</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">is</span>(<span class="number">0</span>, -<span class="number">0</span>);		<span class="comment">// false</span></span><br><span class="line"><span class="built_in">isFinite</span>(<span class="string">"15"</span>);			<span class="comment">// true</span></span><br><span class="line"><span class="built_in">isFinite</span>(<span class="string">"str"</span>);		<span class="comment">// false</span></span><br><span class="line"><span class="built_in">isFinite</span>(<span class="title class_">Infinity</span>);		<span class="comment">// false</span></span><br></pre></td></tr></tbody></table></figure></li>
</ul></li>
</ul>
<h4 id="parseint-and-parsefloat"><code>parseInt</code> and
<code>parseFloat</code></h4>
<p>They "read" a number from a string until they can't. In case of an
error, the gathered number is returned. The <code>parseInt()</code>
function has an optional second parameter. It specifies the base of the
numeral system.</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">parseInt</span>(<span class="string">"100px"</span>); 		<span class="comment">// 100</span></span><br><span class="line"><span class="built_in">parseFloat</span>(<span class="string">"12.5em"</span>);	<span class="comment">// 12.5</span></span><br><span class="line"><span class="built_in">parseInt</span>(<span class="string">"12.3"</span>);		<span class="comment">// 12</span></span><br><span class="line"><span class="built_in">parseInt</span>(<span class="string">"0xff"</span>, <span class="number">16</span>);	<span class="comment">// 255</span></span><br><span class="line"><span class="built_in">parseInt</span>(<span class="string">"ff"</span>, <span class="number">16</span>);		<span class="comment">// 255</span></span><br><span class="line"><span class="built_in">parseInt</span>(<span class="string">"2n9c"</span>, <span class="number">36</span>);	<span class="comment">// 123456</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="other-math-functions">Other math functions</h4>
<ul>
<li><code>Math.random()</code>: returns a random number from 0 to 1 (not
including 1)</li>
<li><code>Math.max(a, b, c...)</code> /
<code>Math.min(a, b, c...)</code>: returns the greatest / smallest from
the arbitrary number of arguments</li>
<li><code>Math.pow(n, power)</code>: Returns <code>n</code> raised to
the given power</li>
</ul>
<h3 id="strings">5.3 Strings</h3>
<p>In JS, the textual data is stored as strings. There is no separate
type for a single character. The internal format for strings is always
UTF-16, it is not tied to the page encoding.</p>
<h4 id="quotes">Quotes</h4>
<p>String can be enclosed within either single quotes, double quotes or
backticks. Single and double quotes are essentially the same. Backticks
allow use to embed any expression into the string, by wrapping it in
<code>${...}</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sum</span> (a, b) {</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">alert (<span class="string">`1 + 2 = <span class="subst">${sum(<span class="number">1</span>,<span class="number">2</span>)}</span>.`</span>);		<span class="comment">// 1 + 2 = 3</span></span><br></pre></td></tr></tbody></table></figure>
<p>Another advantage of using backticks is that they allow a string to
span multiple lines</p>
<h4 id="special-characters">Special characters</h4>
<table>
<colgroup>
<col style="width: 38%">
<col style="width: 61%">
</colgroup>
<thead>
<tr>
<th>Character</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>\n</code></td>
<td>New line</td>
</tr>
<tr>
<td><code>\r</code></td>
<td>Carriage return</td>
</tr>
<tr>
<td><code>\'</code>, <code>\"</code></td>
<td>Quotes</td>
</tr>
<tr>
<td><code>\\</code></td>
<td>Backslash</td>
</tr>
<tr>
<td><code>\t</code></td>
<td>Tab</td>
</tr>
<tr>
<td><code>\b</code>, <code>\f</code>, <code>\v</code></td>
<td>Backspace, Form feed, Vertical tab - not used nowadays</td>
</tr>
<tr>
<td><code>\xXX</code></td>
<td>Unicode character with the given hexadecimal Unicode
<code>XX</code></td>
</tr>
<tr>
<td><code>\uXXXX</code></td>
<td>A Unicode symbol with the hex code <code>XXXX</code> in UTF-16
encoding</td>
</tr>
<tr>
<td><code>\u{X...XXXXXX}</code> (1-6 hex characters)</td>
<td>A Unicode symbol with the given UTF-32 encoding</td>
</tr>
</tbody>
</table>
<h4 id="accessing-characters">Accessing characters</h4>
<p>To get a character at position <code>pos</code>, use square bracket
<code>[pos]</code> or call the method <code>str.charAt(pos)</code>. The
first character starts from the zero position. The difference between
them is that if no character is found, <code>[]</code> returns
<code>undefined</code>, and <code>charAt</code> returns an empty
string.</p>
<p>We can also iterate over characters using <code>for ... of</code></p>
<h4 id="strings-are-immutable">Strings are immutable</h4>
<p>It is impossible to change a character. The usual workaround is to
create a whole new string and assign it to <code>str</code> instead of
the old one.</p>
<h4 id="searching-for-substring">Searching for substring</h4>
<p>There are multiple ways to look for a substring within a string</p>
<h5 id="str.indexofsubstr-pos"><code>str.indexOf(substr, pos)</code></h5>
<p>It looks for the <code>substr</code> in <code>str</code>, starting
from the given position <code>pos</code>, and returns the position where
the match was found or <code>-1</code> if nothing can be found.</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">"Widget with id"</span>;</span><br><span class="line"></span><br><span class="line">str.<span class="title function_">indexOf</span>(<span class="string">"Widget"</span>);	<span class="comment">// 0</span></span><br><span class="line">str.<span class="title function_">indexOf</span>(<span class="string">"widget"</span>);	<span class="comment">// -1</span></span><br><span class="line">str.<span class="title function_">indexOf</span>(<span class="string">"id"</span>);		<span class="comment">// 1</span></span><br><span class="line">str.<span class="title function_">indexOf</span>(<span class="string">"id"</span>, <span class="number">2</span>);	<span class="comment">// 12</span></span><br></pre></td></tr></tbody></table></figure>
<p>There is a similar method
<code>str.lastIndexOf(substr, position)</code> that searches from the
end of a string to its beginning. It would list the occurrences in the
reverse order.</p>
<h5 id="the-bitwise-not-trick">The bitwise NOT trick</h5>
<p>The bitwise NOT <code>~</code> operator converts the number to a
32-bit integer (removes the decimal part if exist) and then reverses all
bits in its binary representation. In practice, that means for 32-bit
integers <code>~n</code>, becomes <code>-(n+1)</code>. Thus we can use
this to test is a substring is found:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">"Widget"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (~str.<span class="title function_">indexOf</span>(<span class="string">"Widget"</span>)) {</span><br><span class="line">    alert (<span class="string">"Found it"</span>); </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>This only works when the length of the string is not 4294967295</p>
<h5 id="includes-startswith-endswith">includes, startsWith,
endsWith</h5>
<p>The more modern method <code>str.includes(substr, pos)</code> return
<code>true / false</code> depending on whether <code>str</code> contains
<code>substr</code> within. The methods <code>str.startsWith</code> and
<code>str.endsWith</code> do exactly what they say</p>
<h4 id="getting-a-substring">Getting a substring</h4>
<p>There are 3 methods in JS to get a substring: <code>substring</code>,
<code>substr</code> and <code>slice</code></p>
<ul>
<li><code>str.slice(start [, end])</code>
<ul>
<li>Returns the part of the string from <code>start</code>to (but not
including) <code>end</code></li>
<li>If there is no second argument, then <code>slice</code> goes till
the end of the string.</li>
<li>Negative values for <code>start/end</code> are also possible. They
mean the position is counted from the string end</li>
</ul></li>
<li><code>str.substring(start [, end])</code>
<ul>
<li>Returns the part of the string between <code>start</code> and
<code>end</code></li>
<li>This is almost the same as <code>slice</code>, but it allows
<code>start</code> to be greater than <code>end</code></li>
<li>Negative arguments are not supported. They are treated as 0</li>
</ul></li>
<li><code>str.substr(start [, length])</code>
<ul>
<li>Returns the part of the string from <code>start</code>, with the
given <code>length</code></li>
<li>The first argument may be negative, to count from the end</li>
</ul></li>
</ul>
<h4 id="comparing-strings">Comparing strings</h4>
<p>Strings are compared character-by-character in alphabetical order.
There are some oddities:</p>
<ol type="1">
<li>A lowercase letter is always greater than the uppercase</li>
<li>Letters with diacritical marks are "out of order"</li>
</ol>
<p>All strings are encoded using UTF-16. That is, each character has a
corresponding numeric code. There are special methods that allow to get
the character for the code and back:</p>
<ul>
<li><code>str.codePointAt(pos)</code></li>
<li><code>String.fromCodePoint(code)</code></li>
</ul>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"z"</span>.<span class="title function_">codePointAt</span>(<span class="number">0</span>);			<span class="comment">// 122</span></span><br><span class="line"><span class="title class_">String</span>.<span class="title function_">fromCodePoint</span>(<span class="number">122</span>);	<span class="comment">// z</span></span><br></pre></td></tr></tbody></table></figure>
<p>The browser needs to know the language to compare strings. All modern
browsers (IE10 - requires the additional library <code>Intl.js</code>)
support the internationalization standard ECMA-402. It provides a
special method to compare strings in different languages, following
their rules. The call <code>str.localeCompare(str2)</code> returns an
integer indicating whether <code>str</code> is less, equal or greater
than <code>str2</code> according to the language rules</p>
<h4 id="internals-unicode">Internals, Unicode</h4>
<p>All frequently used characters have 2-byte codes. Letters in most
European languages, numbers, and even most hieroglyphs, have a 2-byte
representation. But 2 bytes only allow 65536 combinations and that's not
enough for every possible symbol. So rare symbols are encoded with a
pair of 2-byte characters called "a surrogate pair". The surrogate pairs
did not exist at the time when JS was created, and thus are not
correctly processed by the language. We can have a single symbol in a
string while the <code>length</code> of the string being 2.
<code>String.fromCodePoint</code> and <code>str.codePointAt</code> are
few rare methods that deal with surrogate pairs right. They recently
appeared in the language</p>
<h4 id="diacritical-marks-and-normalization">Diacritical marks and
normalization</h4>
<p>In many languages there are symbols that are composed of the base
character with a mark above / under it. Most common "composite"
character have their own code in the UTF-16 table. But not all of them,
because there are too many possible combinations. To support arbitrary
compositions, UTF-16 allows us to use several Unicode characters: the
base character followed by one or many "mark" characters that "decorate"
it.</p>
<p>Since there are many ways to composite a character. There can be
situations where two characters may visually look the same, but be
represented with different Unicode compositions. To solve this, there
exists a "Unicode normalization" algorithm that brings each string to
the single "normal" form:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s1 = <span class="string">"S\u0307\u0323"</span>;	<span class="comment">// Ṩ, S + dot above + dot below</span></span><br><span class="line"><span class="keyword">let</span> s2 = <span class="string">"S\u0323\u0307"</span>;	<span class="comment">// Ṩ, S + dot below + dot above</span></span><br><span class="line"></span><br><span class="line">s1 == s2;							<span class="comment">// false</span></span><br><span class="line">s1.<span class="title function_">normalize</span>() == s2.<span class="title function_">normalize</span>();	<span class="comment">//true</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="arrays">5.4 Arrays</h3>
<p>Array is a data structure to store ordered collections</p>
<h4 id="declaration">Declaration</h4>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = <span class="keyword">new</span> <span class="title class_">Array</span>();</span><br><span class="line"><span class="keyword">let</span> arr2 = [];</span><br><span class="line"><span class="keyword">let</span> fruits = [<span class="string">"Apple"</span>, <span class="string">"Orange"</span>, <span class="string">"Plum"</span>];</span><br></pre></td></tr></tbody></table></figure>
<p>Array elements are numbered, starting with zero. We can replace an
element or add a new one to the array:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fruits[<span class="number">2</span>] = <span class="string">"Pear"</span>;		<span class="comment">// now ["Apple", "Orange", "Pear"]</span></span><br><span class="line">fruits[<span class="number">3</span>] = <span class="string">"Lemon"</span>;	<span class="comment">// now ["Apple", "Orange", "Pear", "Lemon"]</span></span><br></pre></td></tr></tbody></table></figure>
<p>An array can store elements of any type:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">"Apple"</span>, { <span class="attr">name</span>: <span class="string">"John"</span> }, <span class="literal">true</span>, <span class="keyword">function</span>(<span class="params"></span>) { <span class="title function_">alert</span>(<span class="string">"Hello"</span>); } ];</span><br><span class="line"><span class="title function_">alert</span>( arr[<span class="number">1</span>].<span class="property">name</span> );</span><br><span class="line">arr[<span class="number">3</span>]();</span><br></pre></td></tr></tbody></table></figure>
<p>An array, just like an object, may end with a comma:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fruits = [<span class="string">"Apple"</span>, <span class="string">"Orange"</span>, <span class="string">"Plum"</span>, ];</span><br></pre></td></tr></tbody></table></figure>
<h4 id="methods-pop-push-shift-unshift">Methods pop / push, shift /
unshift</h4>
<p>A queue is one of the most common uses of an array. In computer
science, this means an ordered collection of elements which supports two
operations.</p>
<ul>
<li><code>push</code> appends an element to the end</li>
<li><code>shift</code> get an element from the beginning, advancing the
queue, so that the 2nd element becomes the 1st</li>
</ul>
<p>There is another use case for arrays - the data structure named
stack. It supports two operations:</p>
<ul>
<li><code>push</code> adds an element to the end</li>
<li><code>pop</code> takes an element from the end</li>
</ul>
<p>Arrays in JS can work both as a queue and as a stack. They allow you
to add / remove elements both to / from the beginning or the end. In
computer science the data structure that allows this, is called
deque.</p>
<h4 id="internals">Internals</h4>
<p>An arrays is a special kind of object. The square brackets used to
access a property <code>arr[0]</code> actually come from the object
syntax. They extend objects providing special methods to work with
ordered collections of data and also the <code>length</code> property.
But at the core it's still an object. For instance, it is copied by
reference.</p>
<p>What makes arrays really special is their internal representation.
The engine tries to store its elements in the contiguous memory area,
one after another. There are other optimizations as well, to make arrays
work really fast. But they all break if we quit working with an array as
with an "ordered collection" and start working with it as if it were a
regular object. The ways to misuse an array:</p>
<ul>
<li>Add a non-numeric property like <code>arr.test = 5</code></li>
<li>Make holes, like: add <code>arr[0]</code> and then
<code>arr[1000]</code></li>
<li>Fill the array in the reverse order, like <code>arr[1000]</code>,
<code>arr[999]</code> and so on</li>
</ul>
<h4 id="performance">Performance</h4>
<p>Methods <code>push / pop</code> run fast, while
<code>shift / unshift</code> are slow. The more elements in the array,
the more time to move them, more in-memory operations. The
<code>pop</code> method does not need to move anything, because other
elements keep their indexes. That's why it's blazingly fast</p>
<h4 id="loops-1">Loops</h4>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">"Apple"</span>, <span class="string">"Orange"</span>, <span class="string">"Pear"</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.<span class="property">length</span>; i++) {</span><br><span class="line">    alert (arr[i])</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> fruit <span class="keyword">of</span> fruits) {</span><br><span class="line">    alert (fruit);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>It is possible to use <code>for ... in</code> to loop through array.
But that is a bad idea. There are potential problems with it:</p>
<ol type="1">
<li>The loop <code>for...in</code> iterates over all properties, not
only the numeric ones.</li>
<li>The <code>for...in</code> loop is optimized for generic objects, not
arrays, and thus is 10-100 times slower.</li>
</ol>
<h4 id="length">Length</h4>
<p>The length property automatically updates when we modify the array.
To be precise, it is actually not the count of values in the array, but
the greatest numeric index plus one. The <code>length</code> property is
writable. If we increase it manually, nothing interesting happens. But
if we decrease it, the array is truncated. The process is
irreversible</p>
<h4 id="new-array"><code>new Array()</code></h4>
<p>There is one more syntax to create an array:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = <span class="keyword">new</span> <span class="title class_">Array</span> (<span class="string">"Apple"</span>, <span class="string">"Pear"</span>, <span class="string">"etc"</span>);</span><br></pre></td></tr></tbody></table></figure>
<p>If <code>new Array</code> is called with a single argument which is a
number, then it creates an array without items, but with the given
length.</p>
<h4 id="tostring">toString</h4>
<p>Arrays have their own implementation of <code>toString</code> method
that returns a comma-separated list of elements. Arrays do not have
<code>Symbol.toPrimitive</code>, neither a viable <code>valueOf</code>
they implement only <code>toString</code> conversion</p>
<h4 id="dont-compare-arrays-with">Don't compare arrays with ==</h4>
<p>This operator has no special treatment for arrays, it works with them
as with any objects. Thus two arrays are equal <code>==</code> only if
they're references to the same object. So don't use the <code>==</code>
operator. Instead, compare them item-by-item in a loop or using
iteration methods explained in the next chapter.</p>
<h3 id="array-methods">5.5 Array methods</h3>
<p>Arrays provide a lot of methods.</p>
<h4 id="add-remove-items">Add / remove items</h4>
<ul>
<li><code>arr.push(...items)</code>: adds items to the end</li>
<li><code>arr.pop()</code>: extracts an item from the end</li>
<li><code>arr.shift()</code>: extracts an item from the beginning</li>
<li><code>arr.unshift(...items)</code>: adds items to the beginning</li>
</ul>
<h4 id="splice">Splice</h4>
<p>The <code>arr.splice</code> method is a swiss army knife for arrays.
It can do everything: insert, remove and replace elements. The syntax
is:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arr.<span class="title function_">splice</span>(start[, deleteCount, elem1, ..., elemN])</span><br></pre></td></tr></tbody></table></figure>
<p>It modifies <code>arr</code> starting from the index
<code>start</code>: removes <code>deleteCount</code> elements and then
inserts <code>elem1, ..., elemN</code> at their place. Returns the array
of removed elements.</p>
<p>The <code>splice</code> method is also able to insert the elements
without any removals. For that we need to set <code>deleteCount</code>
to 0</p>
<p>Here and in other array methods, negative indexes are allowed. They
specify the position from the end of the array</p>
<h4 id="slice">Slice</h4>
<p>The method <code>arr.slice</code> is much simpler than
similar-looking <code>arr.splice</code>. The syntax is:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arr.<span class="title function_">slice</span>([start], [end])</span><br></pre></td></tr></tbody></table></figure>
<p>It returns a new array copying to it all items from index
<code>start</code> to <code>end</code> (not including <code>end</code>).
Both <code>start</code> and <code>end</code> can be negative, in that
case position from array end is assumed</p>
<p>It is similar to a string method <code>str.slice</code>, but instead
of substrings, it makes subarrays</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">"t"</span>, <span class="string">"e"</span>, <span class="string">"s"</span>, <span class="string">"t"</span>];</span><br><span class="line">arr.<span class="title function_">slice</span>(<span class="number">1</span>, <span class="number">3</span>);	<span class="comment">// e,s</span></span><br><span class="line">arr.<span class="title function_">slice</span>(-<span class="number">2</span>);		<span class="comment">// s,t</span></span><br></pre></td></tr></tbody></table></figure>
<p>We can also call it without arguments: <code>arr.slice()</code>
creates a copy of <code>arr</code>. That's often used to obtain a copy
for further transformations that should not affect the original
array</p>
<h4 id="concat">Concat</h4>
<p>The method <code>arr.concat</code> creates a new array that includes
values from other arrays and additional items. The syntax is:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arr.<span class="title function_">concat</span>(arg1, arg2...)</span><br></pre></td></tr></tbody></table></figure>
<p>It accepts any number of arguments - either arrays or values. The
result is a new array containing items from <code>arr</code>, then
<code>arg1</code>, <code>arg2</code> etc. If an argument
<code>argN</code> is an array, then all its elements are copied.
Otherwise the argument itself is copied.</p>
<p>Normally, it only copies elements from arrays. Other objects, even if
they look like arrays, are added as whole:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line"><span class="keyword">let</span> arrayList = {</span><br><span class="line">    <span class="number">0</span>: <span class="string">"something"</span>,</span><br><span class="line">    <span class="attr">length</span>: <span class="number">1</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">arr.<span class="title function_">concat</span>(arrayLike);	<span class="comment">// 1,2,[object Object]</span></span><br></pre></td></tr></tbody></table></figure>
<p>But if an array-like object has a special
<code>Symbol.isConcatSpreadable</code> property, then it's treated as an
array by <code>concat</code>: its element are added instead:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> arrayLike = {</span><br><span class="line">    <span class="number">0</span>: <span class="string">"something"</span>,</span><br><span class="line">    <span class="number">1</span>: <span class="string">"else"</span>,</span><br><span class="line">    [<span class="title class_">Symbol</span>.<span class="property">isConcatSpreadable</span>]: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">length</span>: <span class="number">2</span></span><br><span class="line">};</span><br><span class="line">arr.<span class="title function_">concat</span>(arrayList);	<span class="comment">// 1,2,something,else</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="iterate-foreach">Iterate: forEach</h4>
<p>The <code>arr.forEach</code> method allows to run a function for
every element of the array. The syntax:</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arr.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">item, index, array</span>) {</span><br><span class="line">    <span class="comment">// ... do something with item</span></span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>
<p>For instance, to show each element of an array:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">"Bilbo"</span>, <span class="string">"Gandalf"</span>, <span class="string">"Nazgul"</span>].<span class="title function_">forEach</span>(alert);</span><br></pre></td></tr></tbody></table></figure>
<p>Or:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">"Bilbo"</span>, <span class="string">"Gandalf"</span>, <span class="string">"Nazul"</span>].<span class="title function_">forEach</span>(<span class="function">(<span class="params">item, index, array</span>) =&gt;</span> {</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">`<span class="subst">${item}</span> is at index <span class="subst">${index}</span> in <span class="subst">${array}</span>`</span>);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>
<h4 id="searching-in-array">Searching in array</h4>
<h5 id="indexof-lastindexof-and-includes">indexOf / lastIndexOf and
includes</h5>
<p>The methods <code>arr.indexOf</code>, <code>arr.lastIndexOf</code>
and <code>arr.includes</code> have the same syntax and do essentially
the same as their string counterparts, but operate on items instead of
characters</p>
<ul>
<li><code>arr.indexOf(item, from)</code>: looks for <code>item</code>
starting from index <code>from</code>, and returns the index where it
was found, otherwise -1</li>
<li><code>arr.lastIndexOf(item, from)</code>: same, but looks for it
from right to left</li>
<li><code>arr.includes(item, from)</code>: looks for <code>item</code>
starting from index <code>from</code>, returns <code>true</code> if
found</li>
</ul>
<p>A minor difference of <code>includes</code>is that it correctly
handles <code>NaN</code>, unlike <code>indexOf / lastIndexOf</code>:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="title class_">NaN</span>];</span><br><span class="line">arr.<span class="title function_">indexOf</span>(<span class="title class_">NaN</span>);		<span class="comment">// -1 (should be 0, but === equality doesn't work for NaN)</span></span><br><span class="line">arr.<span class="title function_">includes</span>(<span class="title class_">NaN</span>);		<span class="comment">// true</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="find-and-findindex">find and findIndex</h4>
<p>The find method finds an object in an array with a specific
condition. The syntax is:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> result = arr.<span class="title function_">find</span>(<span class="keyword">function</span>(<span class="params">item, index, array</span>) {</span><br><span class="line">    <span class="comment">// if true is returned, item is returned and ieration is stopped</span></span><br><span class="line">    <span class="comment">// for falsy scenario returns undefined</span></span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>
<p>The function is called for elements of the array, one after
another.</p>
<ul>
<li><code>item</code> is the element</li>
<li><code>index</code> is its index</li>
<li><code>array</code> is the array itself</li>
</ul>
<p>For example:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> users = [</span><br><span class="line">    {<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">"John"</span>},</span><br><span class="line">    {<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">"Pete"</span>},</span><br><span class="line">    {<span class="attr">id</span>: <span class="number">3</span>, <span class="attr">name</span>: <span class="string">"Mary"</span>}</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> user = users.<span class="title function_">find</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">id</span> == <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">user.<span class="property">name</span>;		<span class="comment">// John</span></span><br></pre></td></tr></tbody></table></figure>
<p>The <code>arr.findIndex</code> method is essentially the same, but it
returns the index where the element was found instead of the element
itself and <code>-1</code> is returned when nothing is found</p>
<h4 id="filter">filter</h4>
<p>The <code>find</code> method looks for a single element. if there may
be many, we can use <code>arr.filter(fn)</code>. The syntax is similar
to <code>find</code>, but <code>filter</code> returns an array of all
matching elements</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> results = arr.<span class="title function_">filter</span>(<span class="keyword">function</span>(<span class="params">item, index, array</span>) {</span><br><span class="line">    <span class="comment">// if true item is pushed to results and the iteration continues</span></span><br><span class="line">    <span class="comment">// returns empty array if nothing found</span></span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>
<h4 id="map">map</h4>
<p>The <code>arr.map</code> method calls the function for each element
of the array and returns the array of results. The syntax is:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> result = arr.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">item, index, array</span>) {</span><br><span class="line">    <span class="comment">// returns the new value instead of item</span></span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>
<p>For example:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> lengths = [<span class="string">"Bilbo"</span>, <span class="string">"Gandalf"</span>, <span class="string">"Nazgul"</span>].<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">length</span>); 	<span class="comment">// 5,7,6</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="sortfn">sort(fn)</h4>
<p>The call to <code>arr.sort()</code> sorts the array in place,
changing its element order. It also returns the sorted array, but the
returned value is usually ignored.</p>
<p>For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">15</span>];</span><br><span class="line"></span><br><span class="line">arr.<span class="title function_">sort</span>(); 	<span class="comment">// 1, 15, 2</span></span><br></pre></td></tr></tbody></table></figure>
<p>The items are sorted as strings by default. To use our own sorting
order, we need to supply a function as the argument of
<code>arr.sort()</code>:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">compareNumeric</span>(<span class="params">a, b</span>) {</span><br><span class="line">    <span class="keyword">if</span> (a &gt; b) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (a == b) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (a &lt; b) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">15</span>];</span><br><span class="line"></span><br><span class="line">arr.<span class="title function_">sort</span>(compareNumeric);	<span class="comment">// 1, 2, 15</span></span><br></pre></td></tr></tbody></table></figure>
<p>A shorter way to write it:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arr.<span class="title function_">sort</span>( <span class="function">(<span class="params">a, b</span>) =&gt;</span> a - b );</span><br></pre></td></tr></tbody></table></figure>
<h5 id="use-localecompare-for-strings">Use <code>localeCompare</code>
for strings</h5>
<p>For many alphabets, it's better to use <code>str.localeCompare</code>
method to correctly sort letters, such as <code>Ö</code>. For example,
let's sort in German:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> countries = [<span class="string">"Österreich"</span>, <span class="string">"Andorra"</span>, <span class="string">"Vietnam"</span>];</span><br><span class="line"></span><br><span class="line">countries.<span class="title function_">sort</span>( <span class="function">(<span class="params">a, b</span>) =&gt;</span> a.<span class="title function_">localeCompare</span>(b) );		<span class="comment">// Andorra, Österreich, Vietnam</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="reverse">reverse</h4>
<p>The method <code>arr.reverse</code> reverses the order of elements in
<code>arr</code></p>
<h4 id="split-and-join">split and join</h4>
<p>The <code>str.split(delim)</code> method splits the string into an
array by the given delimiter <code>delim</code>:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> names = <span class="string">"Bilbo, Gandalf, Nazgul"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> arr = names.<span class="title function_">split</span>(<span class="string">", "</span>);	<span class="comment">// ["Bilbo", "Gandalf", "Nazgul"]</span></span><br></pre></td></tr></tbody></table></figure>
<p>The <code>split</code> method has an optional second numeric argument
- a limit on the array length. If it is provided, then the extra
elements are ignored.</p>
<p>The call <code>arr.join(glue)</code> creates a string of
<code>arr</code> items joined by <code>glue</code> between them</p>
<h4 id="reduce-reduceright">reduce / reduceRight</h4>
<p>The methods <code>arr.reduce</code> and <code>arr.reduceRight</code>
are used to calculate a single value based on the array. The syntax
is:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> value = arr.<span class="title function_">reduce</span>(<span class="keyword">function</span>(<span class="params">accumulator, item, index, array</span>) {</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">}, [initial]);</span><br></pre></td></tr></tbody></table></figure>
<p>The function is applied to all array elements one after another and
"carries on" its result to the next call.</p>
<p>Arguments:</p>
<ul>
<li><code>accumulator</code>: is the result of the previous function
call, equals <code>initial</code> the first time (if
<code>initial</code> is provided). If there is no initial, then
<code>reduce</code> takes the first element of the array as the initial
value and starts the iteration from the 2nd element</li>
<li><code>item</code>: is the current array item</li>
<li><code>index</code>: is its position</li>
<li><code>array</code>: is the array</li>
</ul>
<p>As function is applied, the result of the previous function call is
passed to the next one as the first argument. So, the first argument is
essentially the accumulator that stores the combined result of all
previous executions. And at the end it becomes the result of
<code>reduce</code>. For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> result = arr.<span class="title function_">reduce</span>(<span class="function">(<span class="params">sum, current</span>) =&gt;</span> sum + current, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(result);		<span class="comment">// 15</span></span><br></pre></td></tr></tbody></table></figure>
<p>With <code>initial</code> requires extra care. If the array is empty,
then <code>reduce</code> call without initial value gives an error. So
it's advised to always specify the initial value.</p>
<p>The <code>arr.reduceRight</code> method does the same, but goes from
right to left</p>
<h4 id="array.isarray">Array.isArray</h4>
<p>Arrays do not form a separate language type. They are based on
objects. So <code>typeof</code> does not help to distinguish a plain
object from an array:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">alert</span>(<span class="keyword">typeof</span> {});	<span class="comment">// object</span></span><br><span class="line"><span class="title function_">alert</span>(<span class="keyword">typeof</span> []);	<span class="comment">// object</span></span><br></pre></td></tr></tbody></table></figure>
<p>But there is a special method, <code>Array.isArray(value)</code>. It
returns <code>true</code> if the <code>value</code> is an array, and
<code>false</code> otherwise</p>
<h4 id="most-methods-support-thisarg">Most methods support
"thisArg"</h4>
<p>Almost all array methods that call functions - like
<code>find</code>, <code>filter</code>, <code>map</code>, with a notable
exception of <code>sort</code>, accept an optional additional parameter
<code>thisArg</code>. For example:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arr.<span class="title function_">find</span>(func, thisArg);</span><br><span class="line">arr.<span class="title function_">filter</span>(func, thisArg);</span><br><span class="line">arr.<span class="title function_">map</span>(func, thisArg);</span><br></pre></td></tr></tbody></table></figure>
<p>The value of <code>thisArg</code> parameter becomes <code>this</code>
for <code>func</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> army = {</span><br><span class="line">    <span class="attr">minAge</span>: <span class="number">18</span>,</span><br><span class="line">    <span class="attr">maxAge</span>: <span class="number">27</span>,</span><br><span class="line">    <span class="title function_">canJoin</span>(<span class="params">user</span>) {</span><br><span class="line">        <span class="keyword">return</span> user.<span class="property">age</span> &gt;= <span class="variable language_">this</span>.<span class="property">minAge</span> &amp;&amp; user.<span class="property">age</span> &lt; <span class="variable language_">this</span>.<span class="property">maxAge</span>;</span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> users = [</span><br><span class="line">    {<span class="attr">age</span>: <span class="number">16</span>},</span><br><span class="line">    {<span class="attr">age</span>: <span class="number">20</span>},</span><br><span class="line">    {<span class="attr">age</span>: <span class="number">23</span>},</span><br><span class="line">    {<span class="attr">age</span>: <span class="number">30</span>}</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> soldiers = users.<span class="title function_">filter</span>(armyCanJoin, army);		<span class="comment">// 20, 23</span></span><br></pre></td></tr></tbody></table></figure>
<p>The filter function can be replaced with</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">users.<span class="title function_">filter</span>(<span class="function"><span class="params">user</span> =&gt;</span> army.<span class="title function_">canJoin</span>(user));</span><br></pre></td></tr></tbody></table></figure>
<p>There are many other array methods. For example,
<code>arr.some(fn)</code>, <code>arr.every(fn)</code>,
<code>arr.fill(value, start, end)</code>,
<code>arr.copyWithin(target, start, end)</code>,
<code>arr.flat(depth)</code>, <code>arr.flatMap(fn)</code>. Check manual
for more information.</p>
<h3 id="iterables">5.6 Iterables</h3>
<p>Iterable objects are a generalization of arrays. That's a concept
that allows us to make any object useable in a <code>for..of</code>
loop. If an object isn't technically an array, but represents a
collection (list, set) of something, then <code>for..of</code> is a
great syntax to loop over it</p>
<h4 id="symbol.iterator">Symbol.iterator</h4>
<p>We can making an iterator like this <code>range</code> object that
represents an interval of numbers:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> range = {</span><br><span class="line">    <span class="attr">from</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">to</span>: <span class="number">5</span></span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<p>To make the range object iterable (and thus let <code>for..of</code>
work), we need to add a method to the object named
<code>Symbol.iterator</code></p>
<ol type="1">
<li>When <code>for..of</code> starts, it calls that method once (or
errors if not found). The method must return an iterator - an object
with the method <code>next</code></li>
<li>Onward, <code>for..of</code> works only with that returned
object</li>
<li>When <code>for..of</code> wants the next value, it calls
<code>next()</code> on that object</li>
<li>The result of <code>next()</code> must have the form
<code>{done: Boolean, value: any}</code>, where <code>done = true</code>
means that the iteration is finished, otherwise <code>value</code> is
the next value</li>
</ol>
<p>Here's the full implementation for range:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> range = {</span><br><span class="line">    <span class="attr">from</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">to</span>: <span class="number">5</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">range[<span class="title class_">Symbol</span>.<span class="property">iterator</span>] = <span class="keyword">function</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">        <span class="attr">current</span>: <span class="variable language_">this</span>.<span class="property">from</span>,</span><br><span class="line">        <span class="attr">last</span>: <span class="variable language_">this</span>.<span class="property">to</span>,</span><br><span class="line">        </span><br><span class="line">        <span class="title function_">next</span>(<span class="params"></span>) {</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">current</span> &lt;= <span class="variable language_">this</span>.<span class="property">last</span>) {</span><br><span class="line">                <span class="keyword">return</span> { <span class="attr">done</span>: <span class="literal">false</span>, <span class="attr">value</span>: <span class="variable language_">this</span>.<span class="property">current</span>++ };</span><br><span class="line">            }<span class="keyword">else</span> {</span><br><span class="line">                <span class="keyword">return</span> { <span class="attr">done</span>: <span class="literal">true</span> };</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    };</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> num <span class="keyword">of</span> range) {</span><br><span class="line">    <span class="title function_">alert</span>(num);		<span class="comment">// 1, 2, 3, 4, 5 one by one</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>Note the core feature of iterables: separation of concerns</p>
<ul>
<li><p>The <code>range</code> itself does not have the
<code>next()</code> method</p></li>
<li><p>Instead, another object, a so-called "iterator" is created by the
call to <code>range[Symbol.iterator]()</code>, and its
<code>next()</code> generates values for the iteration</p></li>
<li><p>So the iterator object is separate from the object it iterates
over</p></li>
</ul>
<p>We can put the <code>next()</code> function inside of
<code>range</code> and let <code>Symbol.iterator()</code> return
<code>this</code>. It works too. The downside is that now it's
impossible to have two <code>for..of</code> loops running over the
object simultaneously: they'll share the iteration state.</p>
<h4 id="string-is-iterable">String is iterable</h4>
<p>Arrays and strings are most widely used built-in iterables.</p>
<h4 id="calling-an-iterator-explicitly">Calling an iterator
explicitly</h4>
<p>For deeper understanding, let's see how to use an iterator
explicitly. We'll iterate over a string in exactly the same way as
<code>for..of</code>, but with direct calls:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">"Hello"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> iterator = str[<span class="title class_">Symbol</span>.<span class="property">iterator</span>]();</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) {</span><br><span class="line">    <span class="keyword">let</span> result = iterator.<span class="title function_">next</span>();</span><br><span class="line">    <span class="keyword">if</span> (result.<span class="property">done</span>) <span class="keyword">break</span>;</span><br><span class="line">    alert (result.<span class="property">value</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="iterable-and-array-likes">Iterable and array-likes</h4>
<ul>
<li>Iterables are objects that implement the
<code>Symbol.iterator</code> method, as described above</li>
<li>Array-likes are object that have indexes and <code>length</code>, so
they look like arrays</li>
</ul>
<h4 id="array.from">Array.from</h4>
<p>There is a universal method <code>Array.from</code> that takes an
iterable or array-like value and makes a "real" <code>Array</code> from
it. For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arrayLike = {</span><br><span class="line">    <span class="number">0</span>: <span class="string">"Hello"</span>,</span><br><span class="line">    <span class="number">1</span>: <span class="string">"World"</span>,</span><br><span class="line">    <span class="attr">length</span>: <span class="number">2</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> arr = <span class="title class_">Array</span>.<span class="title class_">From</span>(arrayLike);</span><br><span class="line">arr.<span class="title function_">pop</span>();	<span class="comment">// World</span></span><br></pre></td></tr></tbody></table></figure>
<p>The full syntax for <code>Array.from</code> is:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Array</span>.<span class="title function_">from</span>(obj[, mapFn, thisArg])</span><br></pre></td></tr></tbody></table></figure>
<p>The optional second argument <code>mapFn</code> can be a function
that will be applied to each element before adding it to the array, and
<code>thisArg</code> allows us to set <code>this</code> for it</p>
<h3 id="map-and-set">5.7 Map and set</h3>
<h4 id="map-1">Map</h4>
<p>Map is a collection of keyed data items, just like an
<code>Object</code>. But the main difference is that Map allows keys of
any type</p>
<p>Methods and properties are:</p>
<ul>
<li><code>new Map()</code>: creates the map</li>
<li><code>map.set(key, value)</code>: stores the value by the key
<ul>
<li>Every <code>map.set</code> call returns the map itself, so we can
"chain" the calls</li>
</ul></li>
<li><code>map.get(key)</code>: returns the value by the key,
<code>undefined</code> if <code>key</code> doesn't exist in map</li>
<li><code>map.has(key)</code>: returns true if the key exists, false
otherwise</li>
<li><code>map.delete(key)</code>: removes the value by the key</li>
<li><code>map.clear()</code>: removes everything from the map</li>
<li><code>map.size</code>: returns the current element count</li>
</ul>
<p>For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"></span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">"1"</span>, <span class="string">"str1"</span>);</span><br><span class="line">map.<span class="title function_">set</span>(<span class="number">1</span>, <span class="string">"num1"</span>);</span><br><span class="line">map.<span class="title function_">set</span>(<span class="literal">true</span>, <span class="string">"bool1"</span>);</span><br><span class="line"></span><br><span class="line">map.<span class="title function_">get</span>(<span class="number">1</span>);		<span class="comment">// "num1"</span></span><br><span class="line">map.<span class="title function_">get</span>(<span class="string">"1"</span>);	<span class="comment">// "str1"</span></span><br><span class="line">map.<span class="property">size</span>;		<span class="comment">// 3</span></span><br></pre></td></tr></tbody></table></figure>
<p>To test keys for equivalence, <code>Map</code> uses the algorithm
<code>SameValueZero</code>. It is roughly the same as strict equality
<code>===</code>, but the difference is that <code>NaN</code> is
considered equal to <code>NaN</code></p>
<h5 id="map-can-also-use-objects-as-keys">Map can also use objects as
keys</h5>
<p>For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> john = { <span class="attr">name</span>: <span class="string">"John"</span> };</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> visitsCountMap = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"></span><br><span class="line">visitsCountMap.<span class="title function_">set</span>(john, <span class="number">123</span>);</span><br><span class="line"></span><br><span class="line">visitsCountMap.<span class="title function_">get</span>(john);	<span class="comment">// 123</span></span><br></pre></td></tr></tbody></table></figure>
<p><code>Object</code> cannot use objects as keys</p>
<h5 id="iteration-over-map">Iteration over Map</h5>
<p>For looping over a <code>Map</code>, there are 3 methods:</p>
<ul>
<li><code>map.keys()</code>: returns an iterable for keys</li>
<li><code>map.values()</code>: returns an iterable for values</li>
<li><code>map.entries()</code>: returns an iterable for entries
<code>[key, value]</code>, it's used by default in
<code>for..of</code></li>
</ul>
<p>The iteration goes in the same order as the values were inserted.
<code>Map</code> preserves this order, unlike a regular
<code>Object</code>. Besides that, <code>Map</code> has a built-in
<code>forEach</code> method, similar to Array</p>
<h5 id="object.entries-map-from-object">Object.entries: Map from
Object</h5>
<p>When a <code>Map</code> is created, we can pass an array (or another
iterable) with key/value pairs for initialization:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>([</span><br><span class="line">    [<span class="string">"1"</span>,	<span class="string">"str1"</span>],</span><br><span class="line">    [<span class="number">1</span>, 	<span class="string">"num1"</span>],</span><br><span class="line">    [<span class="literal">true</span>,	<span class="string">"bool1"</span>]</span><br><span class="line">]);</span><br></pre></td></tr></tbody></table></figure>
<p>If we have a plain object, and we'd like to create a <code>Map</code>
from it, then we can use built-in method
<code>Object.entries(obj)</code> that returns an array of key/value
pairs for an object exactly in that format:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = {</span><br><span class="line">    <span class="attr">name</span>: <span class="string">"John"</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">30</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>(<span class="title class_">Object</span>.<span class="title function_">entries</span>(obj));</span><br><span class="line"></span><br><span class="line">map.<span class="title function_">get</span>(<span class="string">"name"</span>);	<span class="comment">// John</span></span><br></pre></td></tr></tbody></table></figure>
<h5 id="object.fromentries-object-from-map">Object.fromEntries: Object
from Map</h5>
<p>The <code>Object.fromEntries</code> method does the reverse of
<code>Object.entries</code>. Given an array of <code>[key, value]</code>
pairs, it creates an object from them. We can use
<code>Object.fromEntries</code> to get a plain object from
<code>Map</code>:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">"banana"</span>, <span class="number">1</span>);</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">"orange"</span>, <span class="number">2</span>);</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">"meat"</span>, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = <span class="title class_">Object</span>.<span class="title function_">fromEntries</span>(map);</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(obj.<span class="property">orange</span>);	<span class="comment">// 2</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="set">Set</h4>
<p>A <code>Set</code> is a special type collection - "set of values"
(without keys), where each value may occur only once. Its main methods
are:</p>
<ul>
<li><code>new Set(iterable)</code>: creates the set, and if an
<code>iterable</code> object is provided, copies values from it into the
set</li>
<li><code>set.add(value)</code>: adds a value, returns the set
itself</li>
<li><code>set.delete(value)</code>: removes the value, returns true if
value existed at the moment of the call, otherwise false</li>
<li><code>set.has(value)</code>: returns true if the value exists in the
set, otherwise false</li>
<li><code>set.clear()</code>: removes everything from the set</li>
<li><code>set.size</code>: is the elements count</li>
</ul>
<h5 id="iteration-over-set">Iteration over Set</h5>
<p>We can loop over a set either with <code>for..of</code> or using
<code>forEach</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>([<span class="string">"oranges"</span>, <span class="string">"apples"</span>, <span class="string">"bananas"</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> value <span class="keyword">of</span> set) <span class="title function_">alert</span>(value);</span><br><span class="line"></span><br><span class="line">set.<span class="title function_">forEach</span>(<span class="function">(<span class="params">value, valueAgain, set</span>) =&gt;</span> {</span><br><span class="line">    <span class="title function_">alert</span>(value);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>
<p>The <code>forEach</code> has this form for compatibility with
<code>Map</code> where the callback passed <code>forEach</code> has
three arguments. Thus the same methods <code>Map</code> has for
iterators are also supported by <code>Set</code> where
<code>set.keys()</code> and <code>set.values()</code> are the same.</p>
<h3 id="weakmap-and-weakset">5.8 WeakMap and WeakSet</h3>
<p>JS engine keeps a value in memory while it is "reachable" and can
potentially be used. Usually, properties of an object or elements of an
array or another data structure are considered reachable and kept in
memory while that data structure is in memory. Similar to that, if we
use an object as the key in a regular <code>Map</code>, then while the
<code>Map</code> exists, that object exists as well. It occupies memory
and may not be garbage collected.</p>
<p><code>WeakMap</code> is fundamentally different in this aspect. It
doesn't prevent garbage-collection of key objects.</p>
<h4 id="weakmap">WeakMap</h4>
<p>The first difference between <code>Map</code> and
<code>WeakMap</code> is that keys must be objects, not primitive values.
If we use an object as the key in it, and there are no other references
to that object - it will be removed from memory (and from the map)
automatically. If an object only exists as the key of
<code>WeakMap</code> - it will be automatically deleted from the map
(and memory).</p>
<p><code>WeakMap</code> does not support iteration and methods
<code>keys()</code>, <code>values()</code>, <code>entries()</code>, so
there's no way to get all keys or values from it. <code>WeakMap</code>
has only the following methods:</p>
<ul>
<li><code>weakMap.get(key)</code></li>
<li><code>weakMap.set(key, value)</code></li>
<li><code>weakMap.delete(key)</code></li>
<li><code>weakMap.has(key)</code></li>
</ul>
<h5 id="use-case-additional-data">Use case: additional data</h5>
<p>The main area of application for <code>WeakMap</code> is an
additional data storage. If we are working with an object that "belongs"
to another code, maybe even a third-party library, and would like to
store some data associated with it, that should only exist while the
object is alive - then <code>WeakMap</code> is exactly what's needed</p>
<h5 id="use-case-caching">Use case: caching</h5>
<p>Another common example is caching. We can store ("cache") results
from a function, so that future calls on the same object can reuse it.
With <code>WeakMap</code>, the cached result will be removed from memory
automatically after the object gets garbage collected.</p>
<h4 id="weakset">WeakSet</h4>
<p><code>WeakSet</code> behaves similarly:</p>
<ul>
<li>It is analogous to <code>Set</code>, but we may only add objects to
<code>WeakSet</code> (not primitives)</li>
<li>An object exists in the set while it is reachable from somewhere
else</li>
<li>Like <code>Set</code>, it supports <code>add</code>,
<code>has</code> and <code>delete</code>, but not <code>size</code>,
<code>keys()</code> and no iterations</li>
</ul>
<p>Being "weak", it also serves as additional storage. But not for
arbitrary data, rather for "yes/no" facts. A membership in
<code>WeakSet</code> may mean something about the object.</p>
<p>The most notable limitation of <code>WeakMap</code> and
<code>WeakSet</code> is the absence of iterations, and the inability to
get all current content. That may appear inconvenient, but does not
prevent <code>WeakMap / WeakSet</code> from doing their main job - be an
"additional" storage of data for objects which are stored / managed at
another place</p>
<h3 id="object.keys-values-entries">5.9 Object.keys, values,
entries</h3>
<p>For plain objects, the following methods are available</p>
<ul>
<li><code>Object.keys(obj)</code>: returns an array of keys</li>
<li><code>Object.values(obj)</code>: returns an array of values</li>
<li><code>Object.entries(obj)</code>: returns an array of
<code>[key, value]</code> pairs</li>
<li>They ignore symbolic properties</li>
</ul>
<h4 id="transforming-objects">Transforming objects</h4>
<p>Objects lack many methods that exist for arrays, e.g.
<code>map</code>, <code>filter</code> and others. If we'd like to apply,
then we can <code>Object.entries</code> followed by
<code>Object.fromEntries</code>:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> prices = {</span><br><span class="line">    <span class="attr">banana</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">orange</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">meat</span>: <span class="number">4</span>,</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> doublePrices = <span class="title class_">Object</span>.<span class="title function_">fromEntries</span>(</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">entries</span>(prices).<span class="title function_">map</span>(<span class="function"><span class="params">entry</span> =&gt;</span> [entry[<span class="number">0</span>], entry[<span class="number">1</span>] * <span class="number">2</span>])</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(doublePrices.<span class="property">meat</span>)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="destructuring-assignment">5.10 Destructuring assignment</h3>
<p>Destructuring assignment is a special syntax that allows us to
"unpack" arrays or objects into a bunch of variables, as sometimes that
is more convenient. Destructuring also works great with complex
functions that have a lot of parameters, default values, and so on.</p>
<h4 id="array-destructuring">Array destructuring</h4>
<p>For example:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">"John"</span>, <span class="string">"Smith"</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> [firstName, surname] = arr;</span><br><span class="line"></span><br><span class="line">firstName;	<span class="comment">// John</span></span><br><span class="line">surname;	<span class="comment">// Smith</span></span><br></pre></td></tr></tbody></table></figure>
<p>Unwanted elements of the array can also be thrown away via an extra
comma. This syntax works with any iterable on the right-side and can use
any "assignables" at the left side</p>
<h5 id="the-rest-...">The rest "..."</h5>
<p>Usually, if the array is longer than the list at the left, the
"extra" items are omitted. If we'd like to gather all that follows, we
can add one more parameter that gets "the rest":</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> [name1, name2, ...rest] = [<span class="string">"Julius"</span>, <span class="string">"Caesar"</span>, <span class="string">"Consul"</span>, <span class="string">"of the Roman Republic"</span>]</span><br><span class="line"></span><br><span class="line">rest[<span class="number">0</span>];		<span class="comment">// Consul</span></span><br><span class="line">rest[<span class="number">1</span>];		<span class="comment">// of the Roman Republic</span></span><br><span class="line">rest.<span class="property">length</span>;	<span class="comment">// 2</span></span><br></pre></td></tr></tbody></table></figure>
<h5 id="default-values">Default values</h5>
<p>If the array is shorter than the list of variables at the left,
there'll be no errors. Absent values are considered undefined. If we
want a "default" value, we can provide it using <code>=</code>:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> [name = <span class="string">"Guest"</span>, surname = <span class="string">"Anonymous"</span>] = [<span class="string">"Julius"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// runs only prompt for surname</span></span><br><span class="line"><span class="keyword">let</span> [name = <span class="title function_">prompt</span>(<span class="string">"name?"</span>), surname = <span class="title function_">prompt</span>(<span class="string">"surname?"</span>)] = [<span class="string">"Julius"</span>];</span><br></pre></td></tr></tbody></table></figure>
<h4 id="object-destructuring">Object destructuring</h4>
<p>The destructuring assignment also works with objects. The basic
syntax is:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> {var1, var2} = {<span class="attr">var1</span>:..., <span class="attr">var2</span>:...}</span><br></pre></td></tr></tbody></table></figure>
<p>We should have an existing object at the right side, that we want to
split into variables. The left side contains an object-like "pattern"
for corresponding properties. In the simplest case, that's a list of
variable names in <code>{...}</code>. For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> options = {</span><br><span class="line">    <span class="attr">title</span>: <span class="string">"Menu"</span>,</span><br><span class="line">    <span class="attr">width</span>: <span class="number">100</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">200</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> {title, width, height} = options;</span><br><span class="line"></span><br><span class="line">title;		<span class="comment">// Menu</span></span><br><span class="line">width;		<span class="comment">// 100</span></span><br><span class="line">height;		<span class="comment">// 200</span></span><br></pre></td></tr></tbody></table></figure>
<p>The order does not matter.</p>
<p>If we want to assign a property to a variable with another name, we
can set the variable name using a colon:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> {<span class="attr">width</span>: w, <span class="attr">height</span>: h, title} = options;</span><br><span class="line"></span><br><span class="line">w;		<span class="comment">// 100</span></span><br><span class="line">h;		<span class="comment">// 200</span></span><br></pre></td></tr></tbody></table></figure>
<p>For potentially missing properties, we can set default values using
<code>=</code> like with arrays.</p>
<p>Or another way of writing it:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> title, width, height;</span><br><span class="line"></span><br><span class="line">({title, width, height} = {<span class="attr">title</span>: <span class="string">"Menu"</span>, <span class="attr">width</span>: <span class="number">200</span>, <span class="attr">height</span>: <span class="number">100</span>});</span><br><span class="line"></span><br><span class="line">title;	<span class="comment">// Menu</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="nested-destructuring">Nested destructuring</h4>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> options = {</span><br><span class="line">    <span class="attr">size</span>: {</span><br><span class="line">        <span class="attr">width</span>: <span class="number">100</span>,</span><br><span class="line">        <span class="attr">height</span>: <span class="number">200</span></span><br><span class="line">    },</span><br><span class="line">    <span class="attr">items</span>: [<span class="string">"Cake"</span>, <span class="string">"Donut"</span>],</span><br><span class="line">    <span class="attr">extra</span>: <span class="literal">true</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> {</span><br><span class="line">    <span class="attr">size</span>: {</span><br><span class="line">        width,</span><br><span class="line">        height</span><br><span class="line">    },</span><br><span class="line">    <span class="attr">items</span>: [item1, item2],</span><br><span class="line">    title = <span class="string">"Menu"</span></span><br><span class="line">} = options;</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(title); 	<span class="comment">// Menu</span></span><br><span class="line"><span class="title function_">alert</span>(width);	<span class="comment">// 100</span></span><br><span class="line"><span class="title function_">alert</span>(height);	<span class="comment">// 200</span></span><br><span class="line"><span class="title function_">alert</span>(item1);	<span class="comment">// Cake</span></span><br><span class="line"><span class="title function_">alert</span>(item2);	<span class="comment">// Donut</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="date-and-time">5.11 Date and time</h3>
<p><code>Date</code> stores the date, time and provides methods for
date/time management</p>
<h4 id="creation">Creation</h4>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> now = <span class="keyword">new</span> <span class="title class_">Date</span>();							<span class="comment">// current date/time</span></span><br><span class="line"><span class="keyword">let</span> <span class="title class_">Jan01</span>_1970 = <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="number">0</span>);					<span class="comment">// 1970-01-01</span></span><br><span class="line"><span class="keyword">let</span> <span class="title class_">Jan02</span>_1970 = <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="number">24</span> * <span class="number">3600</span> * <span class="number">1000</span>);	<span class="comment">// 1970-01-02</span></span><br><span class="line"><span class="keyword">let</span> <span class="title class_">Dec31</span>_1969 = <span class="keyword">new</span> <span class="title class_">Date</span>(-<span class="number">24</span> * <span class="number">3600</span> * <span class="number">1000</span>);	<span class="comment">// 1969-12-31</span></span><br><span class="line"><span class="keyword">let</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="string">"2017-01-26"</span>);				<span class="comment">// 2017-01-26</span></span><br></pre></td></tr></tbody></table></figure>
<p>The full syntax:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Date</span>(year, month, date, hours, minutes, seconds, ms)</span><br></pre></td></tr></tbody></table></figure>
<h4 id="access-date-components">Access date components</h4>
<ul>
<li><code>getFullYear()</code></li>
<li><code>getMonth()</code></li>
<li><code>getDate()</code></li>
<li><code>getHours(), getMinutes(), getSeconds(), getMilliseconds()</code></li>
<li><code>getDay()</code></li>
<li><code>getUTCFullYear(), getUTFMonth(), getUTCDay()</code></li>
</ul>
<h4 id="setting-date-components">Setting date components</h4>
<ul>
<li><code>setFullYear(year, [month], [date])</code></li>
<li><code>setMonth(month, [date])</code></li>
<li><code>setDate(date)</code></li>
<li><code>setHours(hour, [min], [sec], [ms])</code></li>
<li><code>setMilliseconds(ms)</code></li>
<li><code>setTime(milliseconds)</code></li>
</ul>
<p>Every one of them except <code>setTime()</code> has a UTC-variant</p>
<h4 id="autocorrection">Autocorrection</h4>
<p>We can set out-of-range values, and it will auto-adjust itself.</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="number">2013</span>, <span class="number">0</span>, <span class="number">32</span>);	<span class="comment">// 2013-02-01</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="date-to-number-date-diff">Date to number, date diff</h4>
<p>When a <code>Date</code> object is converted to number, it becomes
the timestamp same as <code>date.getTime()</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> start = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">1000000</span>; i++) {</span><br><span class="line">    <span class="keyword">let</span> doSomething = i * i * i;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> end = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(<span class="string">`The loop took <span class="subst">${end - start}</span> ms`</span>)</span><br></pre></td></tr></tbody></table></figure>
<h4 id="date.parse-from-a-string"><code>Date.parse</code> from a
string</h4>
<p>The method <code>Date.parse(str)</code> can read a date from a
string. The string format should be:
<code>YYYY-MM-DDTHH:mm:ss.sssZ</code>, where</p>
<ul>
<li><code>YYYY-MM-DD</code> is the date: year-month-day</li>
<li>The character <code>T</code> is used as the delimiter</li>
<li><code>HH:mm:ss.sss</code> is the time: hours, minutes, seconds and
milliseconds</li>
<li>The optional <code>Z</code> part denotes the time zone in the format
<code>+-hh:mm</code>. A single letter <code>Z</code> would mean
UTC+0</li>
</ul>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ms = <span class="title class_">Date</span>.<span class="title function_">parse</span>(<span class="string">'2012-01-26T13:51:50.417-07:00'</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(ms); <span class="comment">// 1327611110417  (timestamp)</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="json-methods-tojson">5.12 JSON methods, toJSON</h3>
<h4 id="json.stringify">JSON.stringify</h4>
<p>The JSON (JavaScript Object Notation) is a general format to
represent values and objects. It is easy to use JSON for data exchange
when the client uses JS and the server is written on
Ruby/PHP/Java/Whatever. JS provides methods:</p>
<ul>
<li><code>JSON.stringify</code> to convert objects into JSON</li>
<li><code>JSON.parse</code> to convert JSON back into an object</li>
</ul>
<p>For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> student = {</span><br><span class="line">    <span class="attr">name</span>: <span class="string">"John"</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">30</span>,</span><br><span class="line">    <span class="attr">isAdmin</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">courses</span>: [<span class="string">"html"</span>, <span class="string">"css"</span>, <span class="string">"js"</span>],</span><br><span class="line">    <span class="attr">wife</span>: <span class="literal">null</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> json = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(student);</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(<span class="keyword">typeof</span> json);</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(json);</span><br></pre></td></tr></tbody></table></figure>
<p>The method <code>JSON.stringify(student)</code> takes the object and
converts it into a string. The resulting <code>json</code> string is
called a JSON-encoded or serialized or stringified or marshalled object.
We can now send it over the wire or put it into a plain data store. Note
that a JSON-encoded object has several important differences from the
object literal:</p>
<ul>
<li>Strings use double quotes. No single quotes or backticks in
JSON</li>
<li>Object property names are double quoted also. That's obligatory</li>
</ul>
<p><code>JSON.stringify</code> can be applied to primitives as well.
JSON supports following data types:</p>
<ul>
<li>Objects</li>
<li>Arrays</li>
<li>Primitives
<ul>
<li>Strings</li>
<li>Numbers</li>
<li>Boolean values</li>
<li>Null</li>
</ul></li>
</ul>
<p>JSON is data-only language-independent specification, so some
JS-specific object properties are skipped by
<code>JSON.stringify</code>. Namely:</p>
<ul>
<li>Function properties (Methods)</li>
<li>Symbolic keys and values</li>
<li>Properties that store <code>undefined</code></li>
</ul>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = {</span><br><span class="line">    <span class="title function_">sayHi</span>(<span class="params"></span>) {				<span class="comment">// ignored</span></span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">"Hello"</span>);</span><br><span class="line">    },</span><br><span class="line">    [<span class="title class_">Symbol</span>(<span class="string">"id"</span>)]: <span class="number">123</span>,	<span class="comment">// ignored</span></span><br><span class="line">    <span class="attr">something</span>: <span class="literal">undefined</span>	<span class="comment">// ignored</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">alert (<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(user));	<span class="comment">// {} (empty object)</span></span><br></pre></td></tr></tbody></table></figure>
<p>The nested objects are supported and converted automatically. But
there must be no circular references.</p>
<h4 id="excluding-and-transforming-replacer">Excluding and transforming:
replacer</h4>
<p>The full syntax of <code>JSON.stringify</code> is:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> json = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(value[, replacer, space])</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>value: a value to encode</li>
<li>replacer: array of properties to encode or mapping function
<code>function(key, value)</code>. If we pass an array of properties to
it, only these properties will be encoded. If a function is used, then
the function will be called for every <code>(key, value)</code> pair and
should return the "replaced" value, which will be used instead of the
original one</li>
<li>space: amount of space to use for formatting</li>
</ul>
<h4 id="formatting-space">Formatting: space</h4>
<p>The third argument of
<code>JSON.stringify(value, replacer, space)</code> is the number of
spaces to use for pretty formatting. For example, <code>space = 2</code>
tells JS to show nested objects on multiple lines, with indentation of 2
spaces inside an object</p>
<h4 id="custom-tojson">Custom "toJSON"</h4>
<p>Like <code>toString</code> for string conversion, an object may
provide method <code>toJSON</code> for to-JSON conversion.
<code>JSON.stringify</code> automatically calls it if available. For
instance: </p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> room = {</span><br><span class="line">    <span class="attr">number</span>: <span class="number">23</span>,</span><br><span class="line">    <span class="title function_">toJSON</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">number</span>;</span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> meetup = {</span><br><span class="line">    <span class="attr">title</span>: <span class="string">"Conference"</span>, </span><br><span class="line">    room</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>( <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(room) );  <span class="comment">// 23</span></span><br><span class="line"><span class="title function_">alert</span>( <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(meetup)); </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    {</span></span><br><span class="line"><span class="comment">        "title":"Conference",</span></span><br><span class="line"><span class="comment">        "room":23</span></span><br><span class="line"><span class="comment">    }</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="json.parse">JSON.parse</h4>
<p>The deode a JSON-string, we need <code>JSON.parse</code>. The syntax:
</p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> value = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(str, [reviver]);</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>Here, * <code>str</code>: JSON-string to parse *
<code>reviver</code>: optional <code>function(key, value)</code> that
will be called for each <code>(key, value)</code> pair and can transform
the value</p>
<p>JSON does not support comments. Adding a comment to JSON makes it
invalid.</p>
<h5 id="using-reviver">Using reviver</h5>
<p>For example: </p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">'{"title":"Conference","date":"2017-11-30T12:00:00.000Z"}'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> meetup = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(str, <span class="keyword">function</span>(<span class="params">key, value</span>) {</span><br><span class="line">    <span class="keyword">if</span> (key == <span class="string">"date"</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Date</span>(value);</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>This works for nested objects as well.</p>
<h2 id="advanced-working-with-functions">Advanced working with
functions</h2>
<h3 id="recursion-and-stack">6.1 Recursion and stack</h3>
<p>The information about the process of execution of a running function
is stored in its execution context. The execution context is an internal
data structure that contains details about the execution of a function.
One function call has exactly one execution context associated with
it.</p>
<p>When a function makes a nested call, the following happens:</p>
<ul>
<li>The current function is paused</li>
<li>The execution context associated with it is remembered in a special
data structure called execution context stack</li>
<li>The nested call executes</li>
<li>After it ends, the old execution context is retrieved from the
stack, and the outer function is resumed from where it stopped</li>
</ul>
<h3 id="rest-parameters-and-spread-syntax">6.2 Rest parameters and
spread syntax</h3>
<h4 id="rest-parameters-...">Rest parameters <code>...</code></h4>
<p>A function can be called with any number of arguments, no matter how
it is defined. For example:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">showName</span>(<span class="params">firstName, lastName, ...titles</span>) {</span><br><span class="line">    <span class="title function_">alert</span>(firstName + <span class="string">" "</span> + lastName);	<span class="comment">// Julius Caesar</span></span><br><span class="line">    </span><br><span class="line">    <span class="title function_">alert</span>(titles[<span class="number">0</span>]);		<span class="comment">// Consul</span></span><br><span class="line">    <span class="title function_">alert</span>(titles[<span class="number">1</span>]);		<span class="comment">// Imperator</span></span><br><span class="line">    <span class="title function_">alert</span>(titles.<span class="property">length</span>);	<span class="comment">// 2</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="title function_">showName</span>(<span class="string">"Julius"</span>, <span class="string">"Caesar"</span>, <span class="string">"Consul"</span>, <span class="string">"Imperator"</span>);</span><br></pre></td></tr></tbody></table></figure>
<p>The rest parameters must be at the end</p>
<h4 id="the-arguments-variable">The "arguments" variable</h4>
<p>There is also a special array-like object named
<code>arguments</code> that contains all arguments by their indexes. For
instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">showName</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="title function_">alert</span>( <span class="variable language_">arguments</span>.<span class="property">length</span> );</span><br><span class="line">    <span class="title function_">alert</span>( <span class="variable language_">arguments</span>[<span class="number">0</span>] );</span><br><span class="line">    <span class="title function_">alert</span>( <span class="variable language_">arguments</span>[<span class="number">1</span>] );</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="title function_">showName</span>(<span class="string">"Julius"</span>, <span class="string">"Caesar"</span>);	<span class="comment">// 2, Julius, Caesar</span></span><br></pre></td></tr></tbody></table></figure>
<p>Although <code>arguments</code> is both array-like and iterable, it
is not an array. It does not support array methods. Also, it always
contains all arguments. We can't capture them partially, like we did
with rest parameters</p>
<h4 id="spread-syntax">Spread syntax</h4>
<p>Spread syntax looks similar to rest parameters, also using
<code>...</code>, but does the opposite. For example:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr  = [<span class="number">3</span>, <span class="number">5</span>, <span class="number">1</span>]</span><br><span class="line"><span class="keyword">let</span> arr2 = [<span class="number">8</span>, <span class="number">9</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// spread turns array into a list of arguments</span></span><br><span class="line"><span class="title class_">Math</span>.<span class="title function_">max</span>(...arr);	<span class="comment">// 5 </span></span><br><span class="line"><span class="title class_">Math</span>.<span class="title function_">max</span>(<span class="number">1</span>, ...arr, <span class="number">2</span>, ...arr2, <span class="number">3</span>);	<span class="comment">// 9</span></span><br></pre></td></tr></tbody></table></figure>
<p>Also, the spread syntax can be used to merge arrays:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> merged = [<span class="number">0</span>, ...arr, <span class="number">2</span>, ...arr2]</span><br></pre></td></tr></tbody></table></figure>
<p>And we can use the spread syntax to turn the string into array of
characters:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">"Hello"</span>;</span><br><span class="line">[...str];	<span class="comment">// H,e,l,l,o</span></span><br></pre></td></tr></tbody></table></figure>
<p>The spread syntax internally uses iterators to gather elements, the
same way as <code>for..of</code> does</p>
<h4 id="copy-an-arrayobject">Copy an array/object</h4>
<p>It is possible to copy arrays and objects with spread syntax:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> arrCopy = [ ...arr ];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = {<span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">3</span>};</span><br><span class="line"><span class="keyword">let</span> objCopy = { ...obj };</span><br></pre></td></tr></tbody></table></figure>
<h3 id="variable-scope-closure">6.3 Variable scope, closure</h3>
<h4 id="code-blocks">Code blocks</h4>
<p>If a variable is declared inside a code block <code>{...}</code>, it
is only visible inside that block</p>
<h4 id="nested-functions">Nested functions</h4>
<p>A nested function can be returned: either as a property of a new
object or as a result by itself. It can then be used somewhere else. No
matter where, it still has access to the same outer variables. For
example:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">makeCounter</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="keyword">return</span> count++;</span><br><span class="line">    };</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> counter = <span class="title function_">makeCounter</span>();</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>( <span class="title function_">counter</span>() );		<span class="comment">// 0</span></span><br><span class="line"><span class="title function_">alert</span>( <span class="title function_">counter</span>() );		<span class="comment">// 1</span></span><br><span class="line"><span class="title function_">alert</span>( <span class="title function_">counter</span>() );		<span class="comment">// 2</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="lexical-environment">Lexical environment</h4>
<h5 id="variables-1">Variables</h5>
<p>In JS, every running function, code block <code>{...}</code>, and the
script as a whole have an internal (hidden) associated object know as
the Lexical Environment. The Lexical Environment object consists of two
parts:</p>
<ol type="1">
<li>Environment Record: an object that stores all local variables as its
properties (and some other information like the value of
<code>this</code>)</li>
<li>A reference to the outer lexical environment, the one associated
with the outer code</li>
</ol>
<p>A "variable" is just a property of the special internal object,
<code>Environment Record</code>. "To get or change a variable" means "to
get or change a property of that object"</p>
<p>In a simple code without functions, there is only one Lexical
Environment, a.k.a. global Lexical Environment, that associated with the
whole script</p>
<h5 id="function-declarations">Function declarations</h5>
<p>A function is also a value, like a variable. The difference is that a
Function Declaration is instantly fully initialized. When a Lexical
Environment is created, a Function Declaration immediately becomes a
ready-to-use function (unlike <code>let</code>, that is unusable till
the declaration). What's why we can use a function, declared as Function
Declaration, even before the declaration itself.</p>
<p>Naturally, this behavior only applies to Function Declarations, not
Function Expressions where we assign a function to a variable, such as
<code>let say = function()...</code></p>
<h5 id="inner-and-outer-lexical-environment">Inner and outer Lexical
Environment</h5>
<p>When a function runs, at the beginning of the call, a new Lexical
Environment is created automatically to store local variables and
parameters of the call. During the function call we have two Lexical
Environments: the inner one (for the function call) and the outer one
(global)</p>
<ul>
<li>The inner Lexical Environment corresponds to the current execution
of the function. It has the function arguments as its properties</li>
<li>The outer Lexical Environment is the global Lexical Environment. It
has the global variables and the function itself</li>
</ul>
<p>The inner Lexical Environment has a reference to the outer one. When
the code wants to access a variable - the inner Lexical Environment is
searched first, then the outer one, then the more outer one and so on
until the global one. If a variable is not found anywhere, that's an
error in strict mode (without <code>use strict</code>, an assignment to
a non-existing variable creates a new global variable, for compatibility
with old code)</p>
<h5 id="returning-a-function">Returning a function</h5>
<p>All functions remember the Lexical Environment in which they were
made. Technically, there's no magic here: all functions have the hidden
property named <code>[[Environment]]</code>, that keeps the reference to
the Lexical Environment where the function was created</p>
<p>So, a function <code>func.[[Environment]]</code> has the reference to
variables in its outer Lexical Environment. That's how the function
remembers where it was created, no matter where it's called. The
<code>[[Environment]]</code> reference is set once and forever at
function creation time.</p>
<p>A variable is updated in the Lexical Environment where it lives</p>
<h5 id="closure">Closure</h5>
<p>There is a general programming term "closure". A closure is a
function that remembers its outer variables and can access them. In some
languages, that's not possible, or a function should be written in a
special way to make it happen. But in JS, all functions are naturally
closures (with only one exception to be covered later)</p>
<p>That is: they automatically remember where they were created using a
hidden <code>[[Environment]]</code> property, and then their code can
access outer variables.</p>
<h4 id="garbage-collection-1">Garbage collection</h4>
<p>Usually, a Lexical Environment is removed from memory with all the
variables after the function call finishes. That's because there are no
references to it. However, if there is a nested function that is still
reachable after the end of a function, then it has
<code>[[Environment]]</code> property that references the lexical
environment. In that case the Lexical Environment is still reachable
even after the completion of the function, so it stays alive</p>
<h5 id="real-life-optimizations">Real-life optimizations</h5>
<p>In practice, JS engines try to analyze variable usage and if it's
obvious from the code that an outer variable is not used - it is
removed. An important side effect in V8 is that such variable will be
come unavailable in debugging</p>
<p>That may lead to funny debugging issues.</p>
<h4 id="does-a-function-pickup-latest-changes">Does a function pickup
latest changes?</h4>
<p>A function gets outer variables as they are now, it uses the most
recent values</p>
<h3 id="the-old-var">6.4 The old "var"</h3>
<p>The <code>var</code> declaration is similar to <code>let</code>. Most
of the time we can replace <code>let</code> by <code>var</code> or
vice-versa and expect things to work. But internally <code>var</code> is
very different.</p>
<h4 id="var-has-no-block-scope">"var" has no block scope</h4>
<p>Variables, declared with <code>var</code>, are either function-scoped
or global-scoped. They are visible through blocks. For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="literal">true</span>) {</span><br><span class="line">    <span class="keyword">var</span> test = <span class="literal">true</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(test);</span><br></pre></td></tr></tbody></table></figure>
<p>If a code block is inside a function, then <code>var</code> becomes a
function-level variable:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sayHi</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">true</span>) {</span><br><span class="line">        <span class="keyword">var</span> phrase = <span class="string">"Hello"</span>;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">alert</span>(phrase);	<span class="comment">// works</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="title function_">sayHi</span>();</span><br><span class="line"><span class="title function_">alert</span>(phrase);		<span class="comment">// ReferenceError: phrase is not defined</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="var-tolerates-redeclarations">"var" tolerates
redeclarations</h4>
<p>If we declare the same variable with <code>let</code> twice in the
same scope, that's an error. With <code>var</code>, we can redeclare a
variable any number of times.</p>
<h4 id="var-variables-can-be-declared-below-their-use">"var" variables
can be declared below their use</h4>
<p><code>var</code> declarations are processed when the function starts
(or script starts for globals). Even in the following situation:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sayHi</span>(<span class="params"></span>) {</span><br><span class="line">    phrase = <span class="string">"Hello"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">false</span>) {</span><br><span class="line">        <span class="keyword">var</span> phrase;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">alert</span>(phrase);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="title function_">sayHi</span>();	<span class="comment">// Hello</span></span><br></pre></td></tr></tbody></table></figure>
<p>People also call such behavior "hoisting" (raising), because all
<code>var</code> are "hoisted" (raised) to the top of the function.
Declarations are hoisted, but assignments are not.</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sayHi</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="title function_">alert</span>(phrase);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> phrase = <span class="string">"Hello"</span>;</span><br><span class="line">}</span><br><span class="line"><span class="title function_">sayHi</span>();	<span class="comment">// undefined</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="iife">IIFE</h4>
<p>In the past, as there was only <code>var</code>, and it has no
block-level visibility, programmers invented a way to emulate it. What
they did was called "immediately-invoked function expressions" (IIFE).
That's not something we should use nowadays, but you can find them in
old scripts:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="keyword">var</span> message = <span class="string">"Hello"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">alert</span>(message);		<span class="comment">// Hello</span></span><br><span class="line">})();</span><br></pre></td></tr></tbody></table></figure>
<p>The parentheses around the function is a trick to show JS that the
function is created in the context of another expression, and hence it's
a Function Expression. It needs no name and can be called
immediately</p>
<p>There exist other ways besides parentheses to tell JS that we mean a
Function Expression:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">"Parentheses around the function"</span>);</span><br><span class="line">})();</span><br><span class="line"></span><br><span class="line">(<span class="keyword">function</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">"Parentheses around the whole thing"</span>);</span><br><span class="line">}());</span><br><span class="line"></span><br><span class="line">!<span class="keyword">function</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">"Bitwise NOT operato starts the expression"</span>);</span><br><span class="line">}();</span><br><span class="line"></span><br><span class="line">+<span class="keyword">function</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">"Unary plus starts the expression"</span>);</span><br><span class="line">}();</span><br></pre></td></tr></tbody></table></figure>
<p>Nowadays there is no reason to write such code</p>
<h3 id="global-object">6.5 Global object</h3>
<p>The global object provides variables and functions that are available
anywhere. By default, those that are built into the language or the
environment. In a browser it is named <code>window</code>, for Node.js
it is <code>global</code>, for other environments it may have another
name.</p>
<p>Recently, <code>globalThis</code> was added to the language, as a
standardized name for a global object, that should be supported across
all environment. It's supported in all major browsers.</p>
<p>All properties of the global object can be accessed directly:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">alert</span>(<span class="string">"Hello"</span>);</span><br><span class="line"><span class="comment">// is the same as</span></span><br><span class="line">globalThis.<span class="title function_">alert</span>(<span class="string">"Hello"</span>);</span><br></pre></td></tr></tbody></table></figure>
<h4 id="using-for-polyfills">Using for polyfills</h4>
<p>We use the global object to test for support of modern language
features. For instance, test if a built-in <code>Promise</code> object
exists:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="variable language_">window</span>.<span class="property">Promise</span>) {</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">"Your browser is really old!"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="function-object-nfe">6.6 Function object, NFE</h3>
<p>A good way to imagine functions in JS is as callable "action
objects". We can not only call them, but also treat them as objects: add
/ remove properties, pass by reference etc.</p>
<h4 id="the-name-property">The "name" property</h4>
<p>Function objects contain some usable properties. For instance, a
function's name is accessible as the "name" property:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sayHi</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">"Hi"</span>);</span><br><span class="line">}</span><br><span class="line"><span class="title function_">alert</span>(sayHi.<span class="property">name</span>);		<span class="comment">// sayHi</span></span><br></pre></td></tr></tbody></table></figure>
<p>Also works if the assignment is done via a default value:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">f</span>(<span class="params">sayHi = <span class="keyword">function</span>() {}</span>) {</span><br><span class="line">    <span class="title function_">alert</span>(sayHi.<span class="property">name</span>);		<span class="comment">// sayHi</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="title function_">f</span>();</span><br></pre></td></tr></tbody></table></figure>
<p>In the specification, this feature is called a "contextual name". If
the function does not provide one, then in an assignment it is figured
out from the context</p>
<h4 id="the-length-property">The "length" property</h4>
<p>The built-in property "length" returns the number of function
parameters, for instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">f1</span>(<span class="params">a</span>) {}</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">f2</span>(<span class="params">a, b</span>) {}</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">many</span>(<span class="params">a, b, ...more</span>) {}</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(f1.<span class="property">length</span>);		<span class="comment">// 1</span></span><br><span class="line"><span class="title function_">alert</span>(f2.<span class="property">length</span>);		<span class="comment">// 2</span></span><br><span class="line"><span class="title function_">alert</span>(many.<span class="property">length</span>);		<span class="comment">// 2</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="custom-properties">Custom properties</h4>
<p>We can also add properties of our own. Here we add the
<code>counter</code> property to track the total calls count:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sayHi</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">"Hi"</span>);</span><br><span class="line">    </span><br><span class="line">    sayHi.<span class="property">counter</span>++;</span><br><span class="line">}</span><br><span class="line">sayHi.<span class="property">counter</span> = <span class="number">0</span>;	<span class="comment">// initial value</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">sayHi</span>();	<span class="comment">// Hi</span></span><br><span class="line"><span class="title function_">sayHi</span>();	<span class="comment">// Hi</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>( <span class="string">`Called <span class="subst">${sayHi.counter}</span> times`</span> );	<span class="comment">// Called 2 times</span></span><br></pre></td></tr></tbody></table></figure>
<p>A property assigned to a function like <code>sayHi.counter = 0</code>
does not define a local variable <code>counter</code> inside it. In
other words, a property <code>counter</code> and a variable
<code>let counter</code> are two unrelated things</p>
<p>We can treat a function as an object, store properties in it, but
that has no effect on its execution. Variables are not function
properties and vice versa. These are just parallel worlds</p>
<p>Function properties can replace closure sometimes. For instance, we
can rewrite the counter function example previously to use a function
property:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">makeCounter</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">counter</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="keyword">return</span> counter.<span class="property">count</span>++;</span><br><span class="line">    };</span><br><span class="line">    </span><br><span class="line">    counter.<span class="property">count</span> = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> counter;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> counter = <span class="title function_">makeCounter</span>();</span><br><span class="line"><span class="title function_">alert</span>( <span class="title function_">counter</span>() );		<span class="comment">// 0</span></span><br><span class="line"><span class="title function_">alert</span>( <span class="title function_">counter</span>() );		<span class="comment">// 1</span></span><br></pre></td></tr></tbody></table></figure>
<p>The <code>count</code> is now stored in the function directly, not in
its outer Lexical Environment. The main difference is that if the value
of <code>count</code> lives in an outer variable, then external code is
unable to access it. Only nested functions may modify it. And if it's
bound to a function, then such a thing is possible.</p>
<h4 id="named-function-expression">Named Function Expression</h4>
<p>Named Function Expression, or NFE, is a term for Function Expressions
that have a name.</p>
<p>For instance, let's take an ordinary Function Expression:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sayHi = <span class="keyword">function</span>(<span class="params">who</span>) {</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">`Hello, <span class="subst">${who}</span>`</span>);</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<p>And add a name to it:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sayHi = <span class="keyword">function</span> <span class="title function_">func</span>(<span class="params">who</span>) {</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">`Hello, <span class="subst">${who}</span>`</span>);</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<p>This is still a Function Expression. Adding the name
<code>func</code> after <code>function</code> did not make it a Function
Declaration, because it is still created as a part of an assignment
expression. Adding such a name also did not break anything. The function
is still available as <code>sayHi()</code></p>
<p>There are two special things about the name <code>func</code>, that
are the reasons for it:</p>
<ol type="1">
<li>It allows the function to reference itself internally</li>
<li>It is not visible outside of the function</li>
</ol>
<p>Why do we use <code>func</code>? Maybe just use <code>sayHi</code>
for the nested call? Actually, in most cases we can. The problem with
that code is that <code>sayHi</code> may change in the outer code. If
the function gets assigned to another variable instead, the code will
start to give errors. Because the name <code>func</code> is
function-local. It is not taken from outside (and not visible there).
The specification guarantees that it will always reference the current
function.</p>
<p>There is no such thing for Function Declaration.</p>
<h3 id="the-new-function-syntax">6.7 The "new Function" syntax</h3>
<p>There is one more way to create a function. It is rarely used, but
sometimes there's no alternative.</p>
<h4 id="syntax">Syntax</h4>
<p>The syntax for creating a function</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> func = <span class="keyword">new</span> <span class="title class_">Function</span> ([arg1, arg2, ...argN], functionBody);</span><br></pre></td></tr></tbody></table></figure>
<p>The function is created with the arguments <code>arg1...argN</code>
and the given <code>functionBody</code>. For example:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sum = <span class="keyword">new</span> <span class="title class_">Function</span>(<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'return a + b'</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>( <span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>) );		<span class="comment">// 3</span></span><br></pre></td></tr></tbody></table></figure>
<p>For a function without arguments:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sayHi = <span class="keyword">new</span> <span class="title class_">Function</span>(<span class="string">'alert("Hello")'</span>);</span><br><span class="line"><span class="title function_">sayHi</span>();	<span class="comment">// Hello</span></span><br></pre></td></tr></tbody></table></figure>
<p>The major difference from other ways we've seen is that the function
is created literally from a string, that is passed at run time. It is
used in very specific cases, like when we receive code from a server, or
to dynamically compile a function from a template, in complex
web-applications</p>
<h4 id="closure-1">Closure</h4>
<p>When a function is created using <code>new Function</code>, its
<code>[[Environment]]</code> is set to reference not the current Lexical
Environment, but the global one. So, such function doesn't have access
to outer variables, only to the global ones. If
<code>new Function</code> had access to outer variables, it would have
problems with minifiers</p>
<h3 id="scheduling-settimeout-and-setinterval">6.8 Scheduling:
setTimeout and setInterval</h3>
<p>We may decide to execute a function not right now, but at a certain
time later. That's called "scheduling a call". There are two methods for
it:</p>
<ul>
<li><code>setTimeout</code> allows us to run a function once after the
interval of time</li>
<li><code>setInterval</code> allows us to run a function repeatedly,
starting after the interval of time, then repeating continuously at that
interval</li>
</ul>
<p>These methods are not a part of JS specification. But most
environments have the internal scheduler and provide these methods. In
particular, they are supported in all browsers and Node.js</p>
<h4 id="settimeout"><code>setTimeout</code></h4>
<p>The syntax</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> timerId = <span class="built_in">setTimeout</span>(func|code, [delay], [arg1], [arg2], ...)</span><br></pre></td></tr></tbody></table></figure>
<p>Parameters:</p>
<ul>
<li><code>func|code</code>: Function or a string of code to execute.
Usually, that's a function. For historical reasons, a string of code can
be passed, but not recommended. If the first argument is a string, then
JS creates a function from it</li>
<li><code>delay</code>: The delay before run, in milliseconds, by
default 0</li>
<li><code>arg1</code>, <code>arg2</code>,...: Arguments for the function
(not supported in IE9- )</li>
</ul>
<p>For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sayHi</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">"Hello"</span>);</span><br><span class="line">}</span><br><span class="line"><span class="built_in">setTimeout</span>(sayHi, <span class="number">1000</span>);</span><br></pre></td></tr></tbody></table></figure>
<h4 id="canceling-with-cleartimeout">Canceling with
<code>clearTimeout</code></h4>
<p>A call to <code>setTimeout</code> returns a "timer identifier"
<code>timerId</code> that we can use to cancel the execution. The syntax
to cancel:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> timerId = <span class="built_in">setTimeout</span>(...);</span><br><span class="line"><span class="built_in">clearTimeout</span>(timerId);</span><br></pre></td></tr></tbody></table></figure>
<h4 id="setinterval"><code>setInterval</code></h4>
<p>The <code>setInterval</code> method has the same syntax as
<code>setTimeout</code>:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> timerId = <span class="built_in">setInterval</span>(func|code, [delay], [arg1], [arg2], ...);</span><br></pre></td></tr></tbody></table></figure>
<p>All arguments have the same meaning. But unlike
<code>setTimeout</code> it runs the function not only once, but
regularly after the given interval of time. To stop further calls
<code>clearInterval(timerId)</code>.</p>
<h4 id="nested-settimeout">Nested <code>setTimeout</code></h4>
<p>For example:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> timerId = <span class="built_in">setTimeout</span>(<span class="keyword">function</span> <span class="title function_">tick</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">"tick"</span>);</span><br><span class="line">    <span class="title function_">timerId</span>(tick, <span class="number">2000</span>);</span><br><span class="line">}, <span class="number">2000</span>);</span><br></pre></td></tr></tbody></table></figure>
<p>The nested <code>setTimeout</code> is a more flexible method thant
<code>setInterval</code></p>
<p>The real delay between function calls for <code>setInterval</code> is
less than in the code. That's normal, because the time taken by the
function's execution "consumes" a part of the interval. The nested
<code>setTimeout</code> guarantees the fixed delay.</p>
<h4 id="zero-delay-settimeout">Zero delay <code>setTimeout</code></h4>
<p>There is a special use case: <code>setTimeout(func, 0)</code>, or
just <code>setTimeout(func)</code>. This schedules the execution of
<code>func</code> as soon as possible. But the scheduler will invoke it
only after the currently executing script is complete. For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span> <span class="title function_">alert</span>(<span class="string">"World"</span>));</span><br><span class="line"><span class="title function_">alert</span>(<span class="string">"Hello"</span>);		<span class="comment">// Prints before "World"</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="decorators-and-forwarding-callapply">6.9 Decorators and
forwarding, call/apply</h3>
<h4 id="transparent-caching">Transparent caching</h4>
<p>For example:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">slow</span>(<span class="params">x</span>) {</span><br><span class="line">    <span class="comment">// there can be a heavy CPU-intensive job here</span></span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">`Called with <span class="subst">${x}</span>`</span>);</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">cachingDecorator</span>(<span class="params">func</span>) {</span><br><span class="line">    <span class="keyword">let</span> cache = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">x</span>) {</span><br><span class="line">        <span class="keyword">if</span> (cache.<span class="title function_">has</span>(x)) {</span><br><span class="line">            <span class="keyword">return</span> cache.<span class="title function_">get</span>(x);</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> result = <span class="title function_">func</span>(x);</span><br><span class="line">        </span><br><span class="line">        cache.<span class="title function_">set</span>(x, result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    };</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">slow = <span class="title function_">cachingDecorator</span>(slow);</span><br></pre></td></tr></tbody></table></figure>
<p>In the code above, <code>cachingDecorator</code> is a decorator: a
special function that takes another function and alters its behavior.
There are several benefits of using a separate
<code>cachingDecorator</code> instead of altering the code of
<code>slow</code> itself:</p>
<ul>
<li>The <code>cachingDecorator</code> is reusable. We can apply it to
another function</li>
<li>The caching logic is separate, it did not increase the complexity of
<code>slow</code> itself</li>
<li>We can combine multiple decorators if needed</li>
</ul>
<h4 id="using-func.call-for-the-context">Using <code>func.call</code>
for the context</h4>
<p>The caching decorator mentioned above is not suited to work with
object methods because it cannot access <code>this</code> of the object.
There is a special built-in function method
<code>func.call(context, ...args)</code> that allows to call a function
explicitly setting <code>this</code>. The syntax is:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func.<span class="title function_">call</span>(context, arg1, arg2, ...)</span><br></pre></td></tr></tbody></table></figure>
<p>It runs <code>func</code> providing the first argument as
<code>this</code>, and the next as the arguments. For example, these two
calls do almost the same:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">func</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">func.<span class="title function_">call</span>(obj, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br></pre></td></tr></tbody></table></figure>
<p>The only difference is that <code>func.call</code> also sets
<code>this</code> to <code>obj</code></p>
<p>For example:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sayHi</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="title function_">alert</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> user = { <span class="attr">name</span>: <span class="string">"John"</span> };</span><br><span class="line"><span class="keyword">let</span> admin = { <span class="attr">name</span>: <span class="string">"Admin"</span> };</span><br><span class="line"></span><br><span class="line">sayHi.<span class="title function_">call</span>( user );		<span class="comment">// John</span></span><br><span class="line">sayHi.<span class="title function_">call</span>( admin );	<span class="comment">// Admin</span></span><br></pre></td></tr></tbody></table></figure>
<p>So, we can use <code>call</code> in the wrapper to pass the context
to the original function.</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> worker = {</span><br><span class="line">    <span class="title function_">someMethod</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    },</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">slow</span>(<span class="params">x</span>) {</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">"Called with "</span> + x);</span><br><span class="line">        <span class="keyword">return</span> x * <span class="variable language_">this</span>.<span class="title function_">someMethod</span>();</span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">cachingDecorator</span>(<span class="params">func</span>) {</span><br><span class="line">    <span class="keyword">let</span> cache = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">x</span>) {</span><br><span class="line">        <span class="keyword">if</span> (cache.<span class="title function_">has</span>(x)) {</span><br><span class="line">            <span class="keyword">return</span> cache.<span class="title function_">get</span>(x);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">let</span> result = func.<span class="title function_">call</span>(<span class="variable language_">this</span>, x);	<span class="comment">// "this" is passed correctly now</span></span><br><span class="line">        cache.<span class="title function_">set</span>(x, result);</span><br><span class="line">        <span class="keyword">return</span> result; </span><br><span class="line">    };</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">worker.<span class="property">slow</span> = <span class="title function_">cachingDecorator</span>(worker.<span class="property">slow</span>);</span><br></pre></td></tr></tbody></table></figure>
<p>To make it more clear:</p>
<ol type="1">
<li>After the decoration <code>worker.slow</code> is now the wrapper
<code>function (x) {...}</code></li>
<li>So when for example <code>worker.slow(2)</code> is executed, the
wrapper gets <code>2</code> as an argument and
<code>this = worker</code> (the object before dot)</li>
<li>Inside the wrapper, assuming the result is not yet cached,
<code>func.call(this, x)</code> passes the current
<code>this = worker</code> and the current argument (<code>=2</code>) to
the original method</li>
</ol>
<h4 id="going-multi-argument">Going multi-argument</h4>
<p>There are many solutions possible:</p>
<ol type="1">
<li>Implement a new (or use a third-party) map-like data structure that
is more versatile and allows multi-keys</li>
<li>Use nested maps</li>
<li>Join two values into one. For flexibility, we can allow to provide a
hashing function for the decorator, that knows how to make one value
from many</li>
</ol>
<p>For many practical applications, the 3rd variant is good enough. Here
is a more powerful <code>cachingDecorator</code>:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> worker = {</span><br><span class="line">    <span class="title function_">slow</span>(<span class="params">min, max</span>) {</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">`Called with <span class="subst">${min}</span>, <span class="subst">${max}</span>`</span>);</span><br><span class="line">        <span class="keyword">return</span> min + max;</span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">cachingDecorator</span>(<span class="params">func, hash</span>) {</span><br><span class="line">    <span class="keyword">let</span> cache = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="keyword">let</span> key = <span class="title function_">hash</span>(<span class="variable language_">arguments</span>);</span><br><span class="line">        <span class="keyword">if</span> (cache.<span class="title function_">has</span>(key)) {</span><br><span class="line">            <span class="keyword">return</span> cache.<span class="title function_">get</span>(key);</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> result = func.<span class="title function_">call</span>(<span class="variable language_">this</span>, ...<span class="variable language_">arguments</span>);</span><br><span class="line">        </span><br><span class="line">        cache.<span class="title function_">set</span>(key, result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    };</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">worker.<span class="property">slow</span> = <span class="title function_">cachingDecorator</span>(worker.<span class="property">slow</span>, hash);</span><br></pre></td></tr></tbody></table></figure>
<h4 id="func.apply"><code>func.apply</code></h4>
<p>Instead of <code>func.call(this, ...arguments)</code>, we could use
<code>func.apply(this, arguments)</code>. The syntax of built-in method
<code>func.apply</code> is:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func.<span class="title function_">apply</span>(context, args)</span><br></pre></td></tr></tbody></table></figure>
<p>It runs the <code>func</code> setting <code>this = context</code> and
using an array-like object <code>args</code> as the list of arguments.
The only syntax difference between <code>call</code> and
<code>apply</code> is that <code>call</code> expects a list of
arguments, while <code>apply</code> takes an array-like object with
them. So these two calls are almost equivalent:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">func.<span class="title function_">call</span>(context, ...args);</span><br><span class="line">func.<span class="title function_">apply</span>(context, args);</span><br></pre></td></tr></tbody></table></figure>
<p>Passing all arguments along with the context to another function is
called call forwarding. The simplest form of it:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> wrapper = <span class="keyword">function</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="keyword">return</span> func.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<p>When an external code calls such <code>wrapper</code>, it is
indistinguishable from the call of the original function
<code>func</code></p>
<h4 id="borrowing-a-method">Borrowing a method</h4>
<p>The hash function used above can be improved like this:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hash</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="comment">// We cannot run arguments.join() because it is not a real array</span></span><br><span class="line">    <span class="title function_">alert</span>( [].<span class="property">join</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>) );</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="title function_">hash</span>(<span class="number">1</span>, <span class="number">2</span>);</span><br></pre></td></tr></tbody></table></figure>
<p>This trick is called method borrowing. We take (borrow) a join method
from a regular array (<code>[]</code>) and use <code>[].join.call</code>
to run it in the context of <code>arguments</code>.</p>
<p>Why does it work? Because the internal algorithm of the native method
<code>arr.join(glue)</code> is very simple:</p>
<ol type="1">
<li>Let <code>glue</code> be the first argument or, if no arguments,
then a comma <code>,</code></li>
<li>Let <code>result</code> be an empty string</li>
<li>Append <code>this[0]</code> to <code>result</code></li>
<li>Append <code>glue</code> and <code>this[1]</code></li>
<li>Append <code>glue</code> and <code>this[2]</code></li>
<li>... Do so until <code>this.length</code> items are glued</li>
<li>Return <code>result</code></li>
</ol>
<p>So, technically it takes <code>this</code> and joins
<code>this[0]</code>, <code>this[1]</code>, ... etc together.</p>
<h4 id="decorators-and-function-properties">Decorators and function
properties</h4>
<p>It is generally safe to replace a function or a method with a
decorated one, except for one thing. If the original function had
properties on it, then the decorated one will not provide them. There
exists a way to create decorators that keep access to function
properties, but this requires using a special <code>Proxy</code> object
to wrap a function</p>
<h3 id="function-binding">6.10 Function binding</h3>
<h4 id="losing-this">Losing "this"</h4>
<p>Once a method is passed somewhere separately from the object -
<code>this</code> is lost.</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = {</span><br><span class="line">    <span class="attr">firstName</span>: <span class="string">"John"</span>,</span><br><span class="line">    <span class="title function_">sayHi</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">`Hello, <span class="subst">${<span class="variable language_">this</span>.firstName}</span>!`</span>);</span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(user.<span class="property">sayHi</span>, <span class="number">1000</span>);	<span class="comment">// Hello. undefined</span></span><br></pre></td></tr></tbody></table></figure>
<p>The task is quite typical - we want to pass an object method
somewhere else where it will be called. How to make sure that it will be
called in the right context?</p>
<h4 id="solution-1-a-wrapper">Solution 1: a wrapper</h4>
<p>The simplest solution is to use a wrapper function</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = {</span><br><span class="line">    <span class="attr">firstName</span>: <span class="string">"John"</span>,</span><br><span class="line">    <span class="title function_">sayHi</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">`Hello, <span class="subst">${<span class="variable language_">this</span>.firstName}</span>!`</span>);</span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) {</span><br><span class="line">    user.<span class="title function_">sayHi</span>();	<span class="comment">// Hello, John!</span></span><br><span class="line">}, <span class="number">1000</span>);</span><br></pre></td></tr></tbody></table></figure>
<p>It works because it receives <code>user</code> from the outer lexical
environment, and then calls the method normally.</p>
<p>The same, but shorter:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> user.<span class="title function_">sayHi</span>(), <span class="number">1000</span>);</span><br></pre></td></tr></tbody></table></figure>
<p>What if before <code>setTimeout</code> triggers, <code>user</code>
changes value? Then, suddenly, it will call the wrong object.</p>
<h4 id="solution-2-bind">Solution 2: bind</h4>
<p>Functions provide a built-in method <code>bind</code> that allows to
fix <code>this</code>. The basic syntax is:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> boundFunc = func.<span class="title function_">bind</span>(context);</span><br></pre></td></tr></tbody></table></figure>
<p>The result of <code>func.bind(context)</code> is a special
function-like object that is callable as function and transparently
passes the call to <code>func</code> setting
<code>this = context</code>. For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = {</span><br><span class="line">    <span class="attr">firstName</span>: <span class="string">"John"</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">func</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="title function_">alert</span>(<span class="variable language_">this</span>.<span class="property">firstName</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> funcUser = func.<span class="title function_">bind</span>(user);</span><br><span class="line"><span class="title function_">funcUser</span>();		<span class="comment">// John</span></span><br></pre></td></tr></tbody></table></figure>
<p>All arguments are passed to the original <code>func</code> "as is".
It works even with an object method:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = {</span><br><span class="line">    <span class="attr">firstName</span>: <span class="string">"John"</span>,</span><br><span class="line">    <span class="title function_">sayHi</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">`Hello, <span class="subst">${<span class="variable language_">this</span>.firstName}</span>!`</span>);</span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sayHi = user.<span class="property">sayHi</span>.<span class="title function_">bind</span>(user);</span><br><span class="line"></span><br><span class="line"><span class="title function_">sayHi</span>();	<span class="comment">// Hello, John!</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(sayHi, <span class="number">1000</span>);	<span class="comment">// Hello, John!</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// even if the value of user changes within 1 second</span></span><br><span class="line"><span class="comment">// sayHi uses the pre-bound value which is reference to</span></span><br><span class="line">user = {</span><br><span class="line">    <span class="title function_">sayHi</span>(<span class="params"></span>) { <span class="title function_">alert</span>(<span class="string">"Another user in setTimeout"</span>); }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<p>The arguments are passed "as is", only <code>this</code> is fixed by
<code>bind</code></p>
<h5 id="convenience-method-bindall">Convenience method:
<code>bindAll</code></h5>
<p>If an object has many methods and we plan to actively pass it around,
then we could bind them all in a loop:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> user) {</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> user[key] == <span class="string">"function"</span>) {</span><br><span class="line">        user[key] = user[key].<span class="title function_">bind</span>(user);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>JS libraries also provide functions for convenient mass binding, e.g.
<code>_.bindAll(object, methodNames)</code> in lodash</p>
<h4 id="partial-functions">Partial functions</h4>
<p>We can bind not only <code>this</code>, but also arguments. That's
rarely done, but sometimes can be handy. The full syntax of
<code>bind</code>:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> bound = func.<span class="title function_">bind</span>(context, [arg1], [arg2], ...);</span><br></pre></td></tr></tbody></table></figure>
<p>It allows to bind context as <code>this</code> and starting arguments
of the function. For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">mul</span>(<span class="params">a, b</span>) {</span><br><span class="line">    <span class="keyword">return</span> a * b;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> double = mul.<span class="title function_">bind</span>(<span class="literal">null</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">double</span>(<span class="number">3</span>);	<span class="comment">// 6</span></span><br><span class="line"><span class="title function_">double</span>(<span class="number">4</span>);	<span class="comment">// 8</span></span><br></pre></td></tr></tbody></table></figure>
<p>The call to <code>mul.bind(null, 2)</code> creates a new function
<code>double</code> that passes calls to <code>mul</code>, fixing
<code>null</code> as the context and <code>2</code> as the first
argument. Further arguments are passed "as is"</p>
<p>That's called partial function application - we create a new function
by fixing some parameters of the existing one. Note that we actually
don't use <code>this</code> here. But <code>bind</code> requires it, so
we must put in something like <code>null</code></p>
<p>The benefit of making a partial function is that we can create an
independent function with a readable name (<code>double</code>,
<code>triple</code>). In other cases, partial application is useful when
we have a very generic function and want a less universal variant of it
for convenience</p>
<h4 id="going-partial-without-context">Going partial without
context</h4>
<p>A function <code>partial</code> for bind only arguments can be easily
implemented:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">partial</span>(<span class="params">func, ...argsBound</span>) {</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">...args</span>) {</span><br><span class="line">        <span class="keyword">return</span> func.<span class="title function_">call</span>(<span class="variable language_">this</span>, ...argsBound, ...args);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// Usage:</span></span><br><span class="line"><span class="keyword">let</span> user = {</span><br><span class="line">    <span class="attr">firstName</span>: <span class="string">"John"</span>,</span><br><span class="line">    <span class="title function_">say</span>(<span class="params">time, phrase</span>) {</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">`[<span class="subst">${time}</span>] <span class="subst">${<span class="variable language_">this</span>.firstName}</span>: <span class="subst">${phrase}</span>!`</span>);</span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">user.<span class="property">sayNow</span> = <span class="title function_">partial</span>(user.<span class="property">say</span>, <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getHours</span>() + <span class="string">":"</span> + <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getMinutes</span>());</span><br><span class="line"></span><br><span class="line">user.<span class="title function_">sayNow</span>(<span class="string">"Hello"</span>);</span><br><span class="line"><span class="comment">// Gives something like:</span></span><br><span class="line"><span class="comment">// [10:00] John: Hello!</span></span><br></pre></td></tr></tbody></table></figure>
<p>The result of <code>partial(func[, arg1, arg2...])</code> call is a
wrapper that calls <code>func</code> with:</p>
<ul>
<li>Same <code>this</code> as it gets (for <code>user.sayNow</code> call
it's <code>user</code>)</li>
<li>Then gives it <code>...argsBound</code> - arguments from the
<code>partial</code> call (<code>10:00</code>)</li>
<li>Then gives it <code>...arg</code> - arguments given to the wrapper
(<code>Hello</code>)</li>
</ul>
<p>Also there's a ready <code>_.partial</code> implementation from
lodash library</p>
<h3 id="arrow-functions-revisited">6.11 Arrow functions revisited</h3>
<p>Arrow functions are not just a "shorthand" for writing small stuff.
They have some very specific and useful features</p>
<h4 id="arrow-functions-have-no-this-1">Arrow functions have no
<code>this</code></h4>
<p>Arrow functions do not have <code>this</code>. If <code>this</code>
is accessed, it is taken from the outside.</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> group = {</span><br><span class="line">    <span class="attr">title</span>: <span class="string">"Our Group"</span>,</span><br><span class="line">    <span class="attr">students</span>: [<span class="string">"John"</span>, <span class="string">"Pete"</span>, <span class="string">"Alice"</span>],</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">showList</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">students</span>.<span class="title function_">forEach</span>(</span><br><span class="line">            <span class="function"><span class="params">student</span> =&gt;</span> <span class="title function_">alert</span>(<span class="variable language_">this</span>.<span class="property">title</span> + <span class="string">": "</span> + student)</span><br><span class="line">        );</span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">group.<span class="title function_">showList</span>();</span><br></pre></td></tr></tbody></table></figure>
<p>Arrow functions cannot run with <code>new</code>. Because arrow
function does not have <code>this</code>, it cannot be used as
constructors. They cannot be called with <code>new</code></p>
<h5 id="arrow-functions-vs-bind">Arrow functions vs bind</h5>
<p>There is a subtle difference between an arrow function
<code>=&gt;</code> and a regular function called with
<code>.bind(this)</code></p>
<ul>
<li><code>.bind(this)</code> creates a "bound version" of the
function</li>
<li>The arrow <code>=&gt;</code> doesn't create any binding. The
function simply doesn't have <code>this</code></li>
</ul>
<h4 id="arrows-have-no-arguments-variable">Arrows have no "arguments"
variable</h4>
<p>That is great for decorators, when we need to forward a call with the
current <code>this</code> and <code>arguments</code>. For instance,
<code>defer(f, ms)</code> gets a function and returns a wrapper around
it that delays the call by <code>ms</code> milliseconds</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">defer</span>(<span class="params">f, ms</span>) {</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> f.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>), ms);</span><br><span class="line">    };</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sayHi</span>(<span class="params">who</span>) {</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">"Hello, "</span> + who);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sayHiDeferred = <span class="title function_">defer</span>(sayHi, <span class="number">2000</span>);</span><br><span class="line"><span class="title function_">sayHiDeferred</span>(<span class="string">"John"</span>);		<span class="comment">// Hello, John</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="object-properties-configuration">Object Properties
Configuration</h2>
<h3 id="property-flags-and-descriptors">7.1 Property flags and
descriptors</h3>
<p>Until now, a property was a simple "key-value" pair to us. But an
object property is actually a more flexible and powerful thing.</p>
<h4 id="property-flags">Property flags</h4>
<p>Object properties, besides a <code>value</code>, have three special
attributes (so-called "flags"):</p>
<ul>
<li><code>writable</code>: if <code>true</code>, the value can be
changed, otherwise it's read-only</li>
<li><code>enumerable</code>: if <code>true</code>, then listed in loops,
otherwise not listed</li>
<li><code>configurable</code>: if <code>true</code>, the property can be
deleted and these attributes can be modified, otherwise not
<ul>
<li>The non-configurable flag is sometimes preset for built-in objects
and properties. A non-configurable property can't be deleted, its
attributes can't be modified</li>
<li><code>configurable: false</code> prevents changes of property flags
and its deletion, while allowing to change its value
<ul>
<li>The only attribute change possible
<code>wrtable true -&gt; false</code></li>
</ul></li>
</ul></li>
</ul>
<p>When we create a property "the usual way", all of them are
<code>true</code>. But we also can change them anytime. The method
<code>Object.getOwnPropertyDescriptor</code> allows to query the full
information about a property. The syntax is:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> descriptor = <span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptor</span>(obj, propertyName);</span><br></pre></td></tr></tbody></table></figure>
<p>The returned value is a so-called "property descriptor" object: it
contains the value and all the flags. For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = {</span><br><span class="line">    <span class="attr">name</span>: <span class="string">"John"</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> descriptor = <span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptor</span>(user, <span class="string">"name"</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>( <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(descriptor, <span class="literal">null</span>, <span class="number">2</span>) );</span><br><span class="line"><span class="comment">/* property descriptor:</span></span><br><span class="line"><span class="comment">{</span></span><br><span class="line"><span class="comment">	"value": "John",</span></span><br><span class="line"><span class="comment">	"writable": true,</span></span><br><span class="line"><span class="comment">	"enumerable": true,</span></span><br><span class="line"><span class="comment">	"configurable": true</span></span><br><span class="line"><span class="comment">}</span></span><br><span class="line"><span class="comment">*/</span> </span><br></pre></td></tr></tbody></table></figure>
<p>To change the flags, we can use <code>Object.defineProperty</code>.
The syntax is:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="title function_">definePropery</span>(obj, propertyName, descriptor)</span><br></pre></td></tr></tbody></table></figure>
<p>If the property exists, <code>defineProperty</code> updates its
flags. Otherwise, it creates the property with the given value and
flags; in that case, if a flag is not supplied, it is assumed
<code>false</code>. For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = {};</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(user, <span class="string">"name"</span>, {</span><br><span class="line">    <span class="attr">value</span>: <span class="string">"John"</span></span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> descriptor = <span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptor</span>(user, <span class="string">"name"</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>( <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(descriptor, <span class="literal">null</span>, <span class="number">2</span>) );</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">{</span></span><br><span class="line"><span class="comment">	"value": "John",</span></span><br><span class="line"><span class="comment">	"writable": false,</span></span><br><span class="line"><span class="comment">	"enumerable": false,</span></span><br><span class="line"><span class="comment">	"configurable": false</span></span><br><span class="line"><span class="comment">}</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="object.defineproperties"><code>Object.defineProperties</code></h4>
<p>There is a method
<code>Object.defineProperties(obj, descriptors)</code> that allows to
define many properties at once. The syntax is:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperties</span>(obj, {</span><br><span class="line">    <span class="attr">prop1</span>: descriptor1,</span><br><span class="line">    <span class="attr">prop2</span>: descriptor2</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>
<h4 id="object.getownpropertydescriptors"><code>Object.getOwnPropertyDescriptors</code></h4>
<p>To get all property descriptors at once, we can use the method
<code>Object.getOwnPropertyDescriptors(obj)</code>. Together with
<code>Object.defineProperties</code> it can be used as a "flags-aware"
way of cloning an object</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> clone = <span class="title class_">Object</span>.<span class="title function_">defineProperties</span>({}, <span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptors</span>(obj));</span><br></pre></td></tr></tbody></table></figure>
<p>Normally when we clone an object, we use an assignment to copy
properties, but that does not copy flags. So if we want a "better" clone
then <code>Object.defineProperties</code> is preferred</p>
<h4 id="sealing-an-object-globally">Sealing an object globally</h4>
<p>Property descriptors work at the level of individual properties.
There are also methods that limit access to the whole object</p>
<ul>
<li><code>Object.preventExtensions(obj)</code>: forbids the addition of
new properties to the object</li>
<li><code>Object.seal(obj)</code>: forbids adding / removing of
properties. Set <code>configurable: false</code> for all existing
properties</li>
<li><code>Object.freeze(obj)</code>: forbids adding / removing /
changing of properties. Sets
<code>configurable: false, writable: false</code> for all existing
properties.</li>
</ul>
<p>And also there are tests for them:</p>
<ul>
<li><code>Object.isExtensible(obj)</code></li>
<li><code>Object.isSealed(obj)</code></li>
<li><code>Object.isFrozen(obj)</code></li>
</ul>
<h3 id="property-getters-and-setters">7.2 Property getters and
setters</h3>
<p>There are two kinds of object properties. The first kind is data
properties. All properties that we have been using until now were data
properties. The second type of properties is accessor properties. They
are essentially functions that execute on getting and setting a value,
but look like regular properties to an external code.</p>
<h4 id="getters-and-setters">Getters and setters</h4>
<p>Accessor properties are represented by "getter" and "setter" methods.
In an object literal they are denoted by <code>get</code> and
<code>set</code>:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = {</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">propName</span>() {</span><br><span class="line">        <span class="comment">// getter, the code executed on getting obj.propName</span></span><br><span class="line">    },</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">propName</span>(<span class="params">value</span>) {</span><br><span class="line">        <span class="comment">// setter, the code executed on setting obj.propName = value</span></span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<p>For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = {</span><br><span class="line">    <span class="attr">name</span>: <span class="string">"John"</span>,</span><br><span class="line">    <span class="attr">surname</span>: <span class="string">"Smith"</span>,</span><br><span class="line"></span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">fullName</span>() {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`<span class="subst">${<span class="variable language_">this</span>.name}</span> <span class="subst">${<span class="variable language_">this</span>.surname}</span>`</span>;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">fullName</span>(<span class="params">value</span>) {</span><br><span class="line">        [<span class="variable language_">this</span>.<span class="property">name</span>, <span class="variable language_">this</span>.<span class="property">surname</span>] = value.<span class="title function_">split</span>(<span class="string">" "</span>);</span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(user.<span class="property">fullName</span>);	<span class="comment">// John Smith</span></span><br><span class="line"></span><br><span class="line">user.<span class="property">fullName</span> = <span class="string">"Alice Cooper"</span>;</span><br><span class="line"><span class="title function_">alert</span>(user.<span class="property">name</span>);		<span class="comment">// Alice</span></span><br></pre></td></tr></tbody></table></figure>
<p>From the outside, an accessor property look like a regular one.
That's the idea of accesssor properties. We don't call
<code>user.fullName</code> as a function, we read it normally.</p>
<h4 id="accessor-descriptors">Accessor descriptors</h4>
<p>Descriptors for accessor properties are different from those for data
properties. For accessor properties, there is no <code>value</code> or
<code>writable</code>, but instead there are <code>get</code> and
<code>set</code> functions.</p>
<ul>
<li><code>get</code>: a function without arguments, that works when a
property is read</li>
<li><code>set</code>: a function without one argument, that is called
when the property is set</li>
<li><code>enumerable</code>: same as for data properties</li>
<li><code>configurable</code>: same as for data properties</li>
</ul>
<h4 id="smarter-getters-setters">Smarter getters / setters</h4>
<p>Getters / setters can be used as wrappers over "real" property values
to gain more control over operations with them. For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = {</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">name</span>()  {</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_name</span>;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">name</span>(<span class="params">value</span>) {</span><br><span class="line">        <span class="keyword">if</span> (value.<span class="property">length</span> &lt; <span class="number">4</span>) {</span><br><span class="line">            <span class="title function_">alert</span>(<span class="string">"Name is too short, need at least 4 characters"</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_name</span> = value;</span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<p>There is a widely known convention that properties starting with an
underscore <code>_</code> are internal and should not be touched from
outside the object</p>
<h4 id="using-for-compatibility">Using for compatibility</h4>
<p>One of the great uses of accessors is that they allow to take control
over a "regular" data property at any moment by replacing it with a
getter and a setter and tweak its behavior</p>
<h2 id="prototypes-inheritance">Prototypes, inheritance</h2>
<h3 id="prototypal-inheritance">8.1 Prototypal inheritance</h3>
<h4 id="prototype">[[Prototype]]</h4>
<p>In JS, objects have a special hidden property
<code>[[Prototype]]</code>, that is either <code>null</code> or
references another object. That object is called "a prototype". When we
read a property from an <code>object</code>, and it's missing, JS
automatically takes it from its prototype. This is called "prototypal
inheritance". The property <code>[[Prototype]]</code> is internal and
hidden, but there are many ways to set it:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> animal = {</span><br><span class="line">    <span class="attr">eats</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="title function_">walk</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">"Animal walk"</span>);</span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"><span class="keyword">let</span> rabbit = {</span><br><span class="line">    <span class="attr">jumps</span>: <span class="literal">true</span></span><br><span class="line">};</span><br><span class="line">rabbit.<span class="property">__proto__</span> = animal;</span><br><span class="line">rabbit.<span class="property">jumps</span>;		<span class="comment">// true</span></span><br><span class="line">rabbit.<span class="title function_">walk</span>();		<span class="comment">// Animal walk</span></span><br></pre></td></tr></tbody></table></figure>
<p>The prototype chain can be longer. There are only two
limitations:</p>
<ol type="1">
<li>The references can't go in circles. JS will throw an error if we try
to assign <code>__proto__</code> in a circle.</li>
<li>The value of <code>__proto__</code> can be either an object or
<code>null</code>. Other types are ignored.</li>
</ol>
<p>The <code>__proto__</code> property is a bit outdated. It exists for
historical reasons, modern JS suggests that we should use
<code>Object.getPrototypeOf/Object.setPrototypeOf</code> functions
instead of it.</p>
<h4 id="writing-doesnt-use-prototype">Writing doesn't use prototype</h4>
<p>The prototype is only used for reading properties. Write/delete
operations work directly with the object. Accessor properties are an
exception, as assignment is handled by a setter function. So writing to
such a property is actually the same as calling a function. For
instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = {</span><br><span class="line">    <span class="attr">name</span>: <span class="string">"John"</span>,</span><br><span class="line">    <span class="attr">surname</span>: <span class="string">"Smith"</span>,</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">fullName</span>(<span class="params">value</span>) {</span><br><span class="line">        [<span class="variable language_">this</span>.<span class="property">name</span>, <span class="variable language_">this</span>.<span class="property">surname</span>] = value.<span class="title function_">split</span>(<span class="string">" "</span>);</span><br><span class="line">    },</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">fullName</span>() {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`<span class="subst">${<span class="variable language_">this</span>.name}</span> <span class="subst">${<span class="variable language_">this</span>.surname}</span>`</span>;</span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> admin = {</span><br><span class="line">    <span class="attr">__proto__</span>: user,</span><br><span class="line">    <span class="attr">isAdmin</span>: <span class="literal">true</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(admin.<span class="property">fullName</span>);		<span class="comment">// John Smith</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// setter triggers</span></span><br><span class="line">admin.<span class="property">fullName</span> = <span class="string">"Alice Cooper"</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(admin.<span class="property">fullName</span>);		<span class="comment">// Alice Cooper, state of admin modified</span></span><br><span class="line"><span class="title function_">alert</span>(user.<span class="property">fullName</span>);		<span class="comment">// John Smith, state of user protected</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="the-value-of-this">The value of "this"</h4>
<p><code>this</code> is not affected by prototypes at all. No matter
where the method is found: in an object or its prototype. In a method
call, <code>this</code> is always the object before the dot. We may have
a big object with many methods, and have objects that inherit from it.
And when the inheriting objects run the inherited methods, they will
modify only their own states, not the state of the big object. as a
result, methods are shared, but the object state is not.</p>
<h4 id="for...in-loop">for...in loop</h4>
<p>The <code>for..in</code> loop iterates over inherited properties too.
We can filter out inherited properties:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> animal = {</span><br><span class="line">    <span class="attr">eats</span>: <span class="literal">true</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> rabbit = {</span><br><span class="line">    <span class="attr">jumps</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">__proto__</span>: animal</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> prop <span class="keyword">in</span> rabbit) {</span><br><span class="line">    <span class="keyword">let</span> isOwn = rabbit.<span class="title function_">hasOwnProperty</span>(prop);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (isOwn) {</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">`Our: <span class="subst">${prop}</span>`</span>);</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">`Inherited: <span class="subst">${prop}</span>`</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>Almost all other key-value getting methods, such as
<code>Object.keys</code>, <code>Object.values</code> and so on, ignore
inherited properties.</p>
<h3 id="f.prototype">8.2 F.prototype</h3>
<p>New objects can be created with a constructor function, like
<code>new F()</code>. If <code>F.prototype</code> is an object, then the
<code>new</code> operator uses it to set <code>[[Prototype]]</code> for
the new object. The <code>F.prototype</code> here means a regular
property named <code>"prototype"</code> on <code>F</code>. For
instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> animal = {</span><br><span class="line">    <span class="attr">eats</span>: <span class="literal">true</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Rabbit</span>(<span class="params">name</span>) {</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="title class_">Rabbit</span>.<span class="property"><span class="keyword">prototype</span></span> = animal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> rabbit = <span class="keyword">new</span> <span class="title class_">Rabbit</span>(<span class="string">"White Rabbit"</span>);	<span class="comment">// rabbit.__proto__ == animal</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>( rabbit.<span class="property">eats</span> );	<span class="comment">// true</span></span><br></pre></td></tr></tbody></table></figure>
<p><code>F.prototype</code> property is only used when
<code>new F</code> is called, it assigns <code>[[Prototype]]</code> of
the new object.</p>
<h4 id="default-f.prototype-constructor-property">Default F.prototype,
constructor property</h4>
<p>Every function has the <code>"prototype"</code> property even if we
don't supply it. The default <code>"prototype"</code> is an object with
the only property <code>constructor</code> that points back to the
function itself. We can use <code>constructor</code> property to create
a new object using the same constructor as the existing one:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Rabbit</span>(<span class="params">name</span>) {</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="title function_">alert</span>(name);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> rabbit = <span class="keyword">new</span> <span class="title class_">Rabbit</span>(<span class="string">"White Rabbit"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> rabbit2 = <span class="keyword">new</span> rabbit.<span class="title function_">constructor</span>(<span class="params"><span class="string">"Black Rabbit"</span></span>);</span><br></pre></td></tr></tbody></table></figure>
<p>However, if we replace the default prototype as a whole, then there
will be no "constructor" in it. To keep the right "constructor", we can
choose to add / remove properties to the default "prototype" instead of
overwriting it as a whole or, alternatively, recreate the
<code>constructor</code> property manually:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Rabbit</span> () {}</span><br><span class="line"></span><br><span class="line"><span class="title class_">Rabbit</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">jumps</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Rabbit</span>.<span class="property"><span class="keyword">prototype</span></span> = {</span><br><span class="line">    <span class="attr">jumps</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">constructor</span>: <span class="title class_">Rabbit</span></span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<h3 id="native-prototypes">8.3 Native prototypes</h3>
<p>The <code>prototype</code> property is widely used by the core of JS
itself. All built-in constructor functions use it.</p>
<h4 id="object.prototype">Object.prototype</h4>
<p>For example, an empty object:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = {};</span><br><span class="line"><span class="title function_">alert</span>( obj );</span><br></pre></td></tr></tbody></table></figure>
<p>The short notation <code>obj = {}</code> is the same as
<code>obj = new Object()</code>, where <code>Object</code> is a built-in
object constructor function, with its own <code>prototype</code>
referencing a huge object with <code>toString</code> and other methods.
When <code>new Object()</code> is called (or a literal object
<code>{...}</code> is created), the <code>[[Prototype]]</code> of it is
set to <code>Object.prototype</code> according to the rule that we
discussed previously. So then when <code>obj.toString()</code> is called
the method is taken from <code>Object.prototype</code>.</p>
<h4 id="other-build-in-prototypes">Other build-in prototypes</h4>
<p>Other built-in objects such as <code>Array</code>, <code>Date</code>,
<code>Function</code> and others also keep methods in prototypes. By
specification, all of the built-in prototypes have
<code>Object.prototype</code> on the top. That's why "everything
inherits from objects".</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="title function_">alert</span>(arr.<span class="property">__proto__</span> === <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"><span class="title function_">alert</span>(arr.<span class="property">__proto__</span>.<span class="property">__proto__</span> === <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"><span class="title function_">alert</span>(arr.<span class="property">__proto__</span>.<span class="property">__proto__</span>.<span class="property">__proto__</span>);	<span class="comment">// null</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="primitives">Primitives</h4>
<p>The most intricate thing happens with strings, numbers and booleans.
They are not objects. But if we try to access their properties,
temporary wrapper objects are created using built-in constructors
<code>String</code>, <code>Number</code> and <code>Boolean</code>. They
provide the methods and disappear. These objects are created invisibly
to us and most engines optimize them out, but the specification
describes it exactly this way. Methods of these objects also reside in
prototypes</p>
<h4 id="changing-native-prototypes">Changing native prototypes</h4>
<p>Native prototypes can be modified. For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">String</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">show</span> = <span class="keyword">function</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="title function_">alert</span>(<span class="variable language_">this</span>);</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="string">"BOOM!"</span>.<span class="title function_">show</span>();		<span class="comment">// BOOM!</span></span><br></pre></td></tr></tbody></table></figure>
<p>In modern programming, there is only one case where modifying native
prototypes is approved. That's polyfilling. Polyfilling is a term for
making a substitute for a method that method that exists in the JS
specification, but is not yet supported by a particular JS engine. We
may then implement it manually and populate the built-in prototype with
it.</p>
<h4 id="borrowing-from-prototypes">Borrowing from prototypes</h4>
<p>That's when we take a method from one object and copy it into
another. For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = {</span><br><span class="line">    <span class="number">0</span>: <span class="string">"Hello"</span>,</span><br><span class="line">    <span class="number">1</span>: <span class="string">"world!"</span>,</span><br><span class="line">    <span class="attr">length</span>: <span class="number">2</span>,</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">obj.<span class="property">join</span> = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">join</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(obj.<span class="title function_">join</span>(<span class="string">','</span>));	<span class="comment">// Hello,world!</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="prototype-methods-objects-without-__proto__">8.4 Prototype
methods, objects without <code>__proto__</code></h3>
<p>There are modern methods to setup a prototype:</p>
<ul>
<li><code>Object.create(proto, [descriptors])</code>: creates an empty
object with given <code>proto</code> as <code>[[Prototype]]</code> and
optional property descriptors</li>
<li><code>Object.getPrototypeOf(obj)</code>: returns the
<code>[[Prototype]]</code> of <code>obj</code></li>
<li><code>Object.setPrototypeOf(obj, proto)</code>: sets the
<code>[[Prototype]]</code> of <code>obj</code> to
<code>proto</code></li>
</ul>
<p>For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> animal = {</span><br><span class="line">    <span class="attr">eats</span>: <span class="literal">true</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> rabbit = <span class="title class_">Object</span>.<span class="title function_">create</span>(animal, {</span><br><span class="line">    <span class="attr">jumps</span>: {</span><br><span class="line">        <span class="attr">value</span>: <span class="literal">true</span></span><br><span class="line">    }</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(rabbit.<span class="property">eats</span>);		<span class="comment">// true</span></span><br><span class="line"><span class="title function_">alert</span>(rabbit.<span class="property">jumps</span>);	<span class="comment">// true</span></span><br><span class="line"><span class="title function_">alert</span>(<span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(rabbit) === animal);	<span class="comment">// true</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">setPrototypeOf</span>(rabbit, {});	<span class="comment">// change the prototype of rabbit to {}, this is a very slow operation</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="store-user-provided-keys-in-object">Store user-provided keys in
object</h4>
<p>If we try to store user-provided keys in it (for instance, a
user-entered dictionary), we can see an interesting glitch: all keys
work fine except <code>"__proto__"</code>. If we intend to use an object
as an associative array and be free of such problems, we can do it with
a little trick:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> key = <span class="title function_">prompt</span>(<span class="string">"What's the key?"</span>, <span class="string">"__proto__"</span>);</span><br><span class="line">obj[key] = <span class="string">"some value"</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(obj[key]);	<span class="comment">// "some value"</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="classes">Classes</h2>
<h3 id="class-basic-syntax">9.1 Class basic syntax</h3>
<p>The basic syntax is:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> {</span><br><span class="line">    <span class="comment">// class methods</span></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) {...}</span><br><span class="line">    <span class="title function_">method1</span>(<span class="params"></span>) {...}</span><br><span class="line">    <span class="title function_">method2</span>(<span class="params"></span>) {...}</span><br><span class="line">    <span class="title function_">method3</span>(<span class="params"></span>) {...}</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>For example:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> {</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name</span>) {</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">sayHi</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="title function_">alert</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> user = <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">"John"</span>);</span><br><span class="line">user.<span class="title function_">sayHi</span>();</span><br></pre></td></tr></tbody></table></figure>
<p>A common pitfall for novice developers is to put a comma between
class methods, which would result in a syntax error. The notation here
is not to be confused with object literals. Within the class, no commas
are required.</p>
<h4 id="what-is-a-class">What is a class?</h4>
<p>In JS, a class is a kind of function</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> {</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name</span>) { <span class="variable language_">this</span>.<span class="property">name</span> = name; }</span><br><span class="line">    <span class="title function_">sayHi</span>(<span class="params"></span>) { <span class="title function_">alert</span>(<span class="variable language_">this</span>.<span class="property">name</span>); }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(<span class="keyword">typeof</span> <span class="title class_">User</span>);		<span class="comment">// function</span></span><br></pre></td></tr></tbody></table></figure>
<p>What <code>class User {...}</code> construct really does is:</p>
<ol type="1">
<li>Creates a function named <code>User</code>, that becomes the result
of the class declaration. The function code is taken from the
<code>constructor</code> method</li>
<li>Stores class methods, such as <code>sayHi</code>, in
<code>User.prototype</code></li>
</ol>
<p>After <code>new User</code> object is created, when we call its
method, it's taken from the prototype, just like
<code>F.prototype</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">alert</span>(<span class="title class_">User</span> === <span class="title class_">User</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span>);		<span class="comment">// true</span></span><br><span class="line"><span class="title function_">alert</span>(<span class="title class_">User</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sayHi</span>);	<span class="comment">// the code of the sayHi method</span></span><br><span class="line"><span class="title function_">alert</span>(<span class="title class_">Object</span>.<span class="title function_">getOwnPropertyNames</span>(<span class="title class_">User</span>.<span class="property"><span class="keyword">prototype</span></span>));	<span class="comment">// constructor, sayHi</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="not-just-a-syntactic-sugar">Not just a syntactic sugar</h4>
<p>There are important differences between <code>class</code> and
<code>function</code> with <code>prototype</code>:</p>
<ol type="1">
<li>A function created by <code>class</code> is labelled by a special
internal property <code>[[IsClassConstructor]]: true</code>. So it's not
entirely the same as creating it manually. For example, unlike a regular
function, it must be called with <code>new</code></li>
<li>Class methods are non-enumerable. A class definition sets
<code>enumerable</code> flag to <code>false</code> for all methods in
the <code>prototype</code></li>
<li>Classes always <code>use strict</code>. All code inside the class
construct is automatically in strict mode</li>
</ol>
<h4 id="class-expression">Class expression</h4>
<p>Just like functions, classes can be defined inside another
expression, passed around, returned, assigned, etc.</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="title class_">User</span> = <span class="keyword">class</span> {</span><br><span class="line">    <span class="title function_">sayHi</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">"Hello"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="title class_">User2</span> = <span class="keyword">class</span> <span class="title class_">MyClass</span> {</span><br><span class="line">    <span class="title function_">sayHi</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="title function_">alert</span>(<span class="title class_">MyClass</span>);</span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">User</span>().<span class="title function_">sayHi</span>();		<span class="comment">// works, show MyClass definition</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(<span class="title class_">MyClass</span>);		<span class="comment">// error, MyClass name isn't visible outside of the class</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="getters-setters">Getters / setters</h4>
<p>Just like literal objects, classes may include getters / setters,
computed properties etc.</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> {</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name</span>) {</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">name</span>() {</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_name</span>;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">name</span>(<span class="params">value</span>) {</span><br><span class="line">        <span class="keyword">if</span> (value.<span class="property">length</span> &lt; <span class="number">4</span>) {</span><br><span class="line">            <span class="title function_">alert</span>(<span class="string">"Name is too short"</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_name</span> = value;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> user = <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">"John"</span>);</span><br><span class="line"><span class="title function_">alert</span>(user.<span class="property">name</span>);		<span class="comment">// John</span></span><br><span class="line"></span><br><span class="line">user = <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">""</span>);	<span class="comment">// Name is too short</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="computed-method-names-...">Computed method names [...]</h4>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> {</span><br><span class="line">    [<span class="string">'say'</span> + <span class="string">'Hi'</span>]() {</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">"Hello"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">User</span>().<span class="title function_">sayHi</span>();</span><br></pre></td></tr></tbody></table></figure>
<h4 id="class-fields">Class fields</h4>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> {</span><br><span class="line">    name = <span class="string">"John"</span>;</span><br><span class="line"></span><br><span class="line">	<span class="title function_">sayHi</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">`Hello, <span class="subst">${<span class="variable language_">this</span>.name}</span>`</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">User</span>().<span class="title function_">sayHi</span>();		<span class="comment">// Hello, John</span></span><br></pre></td></tr></tbody></table></figure>
<p>The important difference of class fields is that they are set on
individual objects, not <code>User.prototype</code></p>
<h4 id="making-bound-methods-with-class-fields">Making bound methods
with class fields</h4>
<p>To solve the problem of "losing <code>this</code>":</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Button</span> {</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">value</span>) {</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">value</span> = value;</span><br><span class="line">    }</span><br><span class="line">    click = <span class="function">() =&gt;</span> {</span><br><span class="line">        <span class="title function_">alert</span>(<span class="variable language_">this</span>.<span class="property">value</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> button = <span class="keyword">new</span> <span class="title class_">Button</span>(<span class="string">"hello"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(button.<span class="property">click</span>, <span class="number">1000</span>);		<span class="comment">// hello</span></span><br></pre></td></tr></tbody></table></figure>
<p>The class field <code>click = () =&gt; {...}</code> is created on a
per-object basis, there's a separate function for each
<code>Button</code> object, with <code>this</code> inside it referencing
that object. That's especially useful in browser environment, for event
listeners.</p>
<h3 id="class-inheritance">9.2 Class inheritance</h3>
<h4 id="the-extends-keyword">The "extends" keyword</h4>
<p>For example:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> {</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name</span>) {</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">speed</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    }</span><br><span class="line">    <span class="title function_">run</span>(<span class="params">speed</span>) {</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">speed</span> = speed;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">`<span class="subst">${<span class="variable language_">this</span>.name}</span> runs with speed <span class="subst">${<span class="variable language_">this</span>.speed}</span>.`</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="title function_">stop</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">speed</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">`<span class="subst">${<span class="variable language_">this</span>.name}</span> stands still.`</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rabbit</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> {</span><br><span class="line">    <span class="title function_">hide</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">`<span class="subst">${<span class="variable language_">this</span>.name}</span> hides!`</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> rabbit = <span class="keyword">new</span> <span class="title class_">Rabbit</span>(<span class="string">"White Rabbit"</span>);</span><br><span class="line"></span><br><span class="line">rabbit.<span class="title function_">run</span>(<span class="number">5</span>);		<span class="comment">// White Rabbit run with speed 5.</span></span><br><span class="line">rabbit.<span class="title function_">hide</span>();		<span class="comment">// White Rabbit hides!</span></span><br></pre></td></tr></tbody></table></figure>
<p>Internally, <code>extends</code> keyword works using the good old
prototype mechanics. It sets <code>Rabbit.prototype.[[Prototype]]</code>
to <code>Animal.prototype</code></p>
<p>Class syntax allows to specify not just a class, but any expression
after <code>extends</code></p>
<h4 id="overriding-a-method">Overriding a method</h4>
<p>Classes provide <code>"super"</code> keyword to call the parent
method</p>
<ul>
<li><code>super.method(...)</code> to call a parent method</li>
<li><code>super(...)</code> to call a parent constructor (inside child
constructor only)</li>
</ul>
<p>For example:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Rabbit</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> {</span><br><span class="line">    <span class="title function_">stop</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="variable language_">super</span>.<span class="title function_">stop</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">hide</span>();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>However, arrow functions have no <code>super</code>. If accessed,
it's taken from the outer function.</p>
<h4 id="overriding-constructor">Overriding constructor</h4>
<p>According to the specification, if a class extends another class and
has no <code>constructor</code>, then the following "empty" constructor
is generated:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Rabbit</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> {</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">...args</span>) {</span><br><span class="line">        <span class="variable language_">super</span>(...args);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>Constructors in inheriting classes must call <code>super(...)</code>,
and do it before using <code>this</code>. In JS, a derived constructor
has a special internal property
<code>[[ConstructorKind]]:"derived"</code>. That label affects its
behavior with <code>new</code>:</p>
<ul>
<li>When a regular function is executed with <code>new</code>, it
creates an empty object and assigns it to <code>this</code></li>
<li>But when a derived constructor runs, it expects the parent
constructor to do this job</li>
</ul>
<p>For example:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Rabbit</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> {</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name, earLength</span>) {</span><br><span class="line">        <span class="variable language_">super</span>(name);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">earLength</span> = earLength;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>Thus parent constructor always uses its own field value, not the
overridden one. However, it will use the overridden method.</p>
<h4 id="homeobject">[[HomeObject]]</h4>
<p>When a function is specified as a class or object method, its
<code>[[HomeObject]]</code> property becomes that object.
<code>super</code> uses it to resolve the parent prototype and its
methods. For example:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> animal = {</span><br><span class="line">    <span class="attr">name</span>: <span class="string">"Animal"</span>,</span><br><span class="line">    <span class="title function_">eat</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">`<span class="subst">${<span class="variable language_">this</span>.name}</span> eats`</span>);</span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> rabbit = {</span><br><span class="line">    <span class="attr">__proto__</span>: animal,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">"Rabbit"</span>, </span><br><span class="line">    <span class="title function_">eat</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="variable language_">super</span>.<span class="title function_">eat</span>();	<span class="comment">// rabbit.eat.[[HomeObject]] == rabbit</span></span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> longEar = {</span><br><span class="line">    <span class="attr">__proto__</span>: rabbit,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">"Long Ear"</span>,</span><br><span class="line">    <span class="title function_">eat</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="variable language_">super</span>.<span class="title function_">eat</span>();	<span class="comment">// longEar.eat.[[HomeObject]] == longEar</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">longEar.<span class="title function_">eat</span>();			<span class="comment">// Long Ear eats</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="methods-not-function-properties">Methods, not function
properties</h4>
<p>For objects, methods must be specified exactly as
<code>method()</code>, not as <code>"method: function()"</code></p>
<h3 id="static-properties-and-methods">9.3 Static properties and
methods</h3>
<p>We can also assign a method to the class function itself, not to its
<code>"prototype"</code>. Such methods are called static. For
example:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Article</span> {</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">title, date</span>) {</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">title</span> = title;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">date</span> = date;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">compare</span>(<span class="params">articleA, articleB</span>) {</span><br><span class="line">        <span class="keyword">return</span> articleA.<span class="property">date</span> - articleB.<span class="property">date</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> articles = [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Article</span>(<span class="string">"HTML"</span>, <span class="keyword">new</span> <span class="title class_">Data</span>(<span class="number">2019</span>, <span class="number">1</span>, <span class="number">1</span>)),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Article</span>(<span class="string">"CSS"</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="number">2019</span>, <span class="number">0</span>, <span class="number">1</span>)),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Article</span>(<span class="string">"JavaScript"</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="number">2019</span>, <span class="number">11</span>, <span class="number">1</span>))</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">articles.<span class="title function_">sort</span>(<span class="title class_">Article</span>.<span class="property">compare</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>( articles[<span class="number">0</span>].<span class="property">title</span> );		<span class="comment">// CSS</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="static-properties">Static properties</h4>
<p>Static properties are also possible</p>
<h4 id="inheritance-of-static-properties-and-methods">Inheritance of
static properties and methods</h4>
<p>Static properties and methods are inherited using prototypes.
<code>extends</code> gives the child the <code>[[Prototype]]</code>
reference to Animal</p>
<h3 id="private-and-protected-properties-and-methods">9.4 Private and
protected properties and methods</h3>
<ul>
<li>Public: accessible from anywhere. They comprise the external
interface</li>
<li>Private: accessible only from inside the class. These are for the
internal interface</li>
<li>Protected: accessible only from inside the class and those extending
it
<ul>
<li>Protected fields are not implemented in JS on the language level,
but in practice they are very convenient, so they are emulated</li>
</ul></li>
</ul>
<h4 id="protecting-wateramount">Protecting "waterAmount"</h4>
<p>Let's make a simple coffee machine class. Protected properties are
usually prefixed with an underscore <code>_</code>. That is not enforced
on the language level, but there's a well-known convention between
programmers that such properties and methods should not be accessed from
the outside</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CoffeeMachine</span> {</span><br><span class="line">    _waterAmount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">set</span> <span class="title function_">waterAmount</span>(<span class="params">value</span>) {</span><br><span class="line">        <span class="keyword">if</span> (value &lt; <span class="number">0</span>) {</span><br><span class="line">            value = <span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_waterAmount</span> = value;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">	<span class="keyword">get</span> <span class="title function_">waterAmount</span>() {</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_waterAmount</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">	<span class="title function_">constructor</span>(<span class="params">power</span>) {</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">power</span> = power;</span><br><span class="line">        <span class="title function_">alert</span>( <span class="string">`Created a coffee-machine, power: <span class="subst">${power}</span>`</span> );</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> coffeeMachine = <span class="keyword">new</span> <span class="title class_">CoffeeMachine</span>(<span class="number">100</span>);</span><br><span class="line"><span class="comment">// add water</span></span><br><span class="line">coffeeMachine.<span class="property">waterAmount</span> = -<span class="number">10</span>;	<span class="comment">// _waterAmount will become 0, not -10</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="read-only-power">Read-only "power"</h4>
<p>If you want to make a property, for example <code>power</code>, then
we only need to make getter, but not the setter.</p>
<h4 id="private-waterlimit">Private "#waterLimit"</h4>
<p>There is a finished JS proposal, almost in the standard, that
provides language-level support for private properties and methods.
Privates should start with <code>#</code>. They are only accessible from
inside the class. For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CoffeeMachine</span> {</span><br><span class="line">    #waterLimit = <span class="number">200</span>;</span><br><span class="line">    </span><br><span class="line">    #fixWaterAmount (value) {</span><br><span class="line">    	<span class="keyword">if</span> (value &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">if</span> (value &gt; <span class="variable language_">this</span>.#waterLimit) <span class="keyword">return</span> <span class="variable language_">this</span>.#waterLimit;</span><br><span class="line">	}</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">setWaterAmount</span>(<span class="params">value</span>) {</span><br><span class="line">        <span class="variable language_">this</span>.#waterLimit = <span class="variable language_">this</span>.#<span class="title function_">fixWaterAmount</span>(value);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> coffeeMachine = <span class="keyword">new</span> <span class="title class_">CoffeeMachine</span>();</span><br><span class="line"></span><br><span class="line">coffeeMachine.#<span class="title function_">fixWaterAmount</span>(<span class="number">123</span>);		<span class="comment">// Error</span></span><br><span class="line">coffeeMachine.#waterLimit = <span class="number">1000</span>;		<span class="comment">// Error</span></span><br></pre></td></tr></tbody></table></figure>
<p>On the language level, <code>#</code> is a special sign that the
field is private. Private fields do not conflict with public ones. We
can have both private <code>#waterAmount</code> and public
<code>waterAmount</code> field at the same time.</p>
<h3 id="extending-built-in-classes">9.5 Extending built-in classes</h3>
<p>Built-in classes like Array, Map, and others are extendable also. For
instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PowerArray</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Array</span> {</span><br><span class="line">    <span class="title function_">isEmpty</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">length</span> === <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> arr = <span class="keyword">new</span> <span class="title class_">PowerArray</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">50</span>);</span><br><span class="line"><span class="title function_">alert</span>(arr.<span class="title function_">isEmpty</span>());		<span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> filteredArr = arr.<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> item &gt;= <span class="number">10</span>);</span><br><span class="line"><span class="title function_">alert</span>(filteredArr);			<span class="comment">// 10, 50</span></span><br><span class="line"><span class="title function_">alert</span>(filteredArr.<span class="title function_">isEmtpy</span>());	<span class="comment">// false</span></span><br></pre></td></tr></tbody></table></figure>
<p>When <code>arr.filter()</code> is called, it internally creates the
new array of results using exactly <code>arr.constructor</code>, not
basic <code>Array</code>. We can add a special static getter
<code>Symbol.species</code> to the class. If it exists, it should return
the constructor that JS will use internally to create new entities in
<code>map</code>, <code>filter</code> and so on. If we'd like built-in
methods like <code>map</code> or <code>filter</code> to return regular
array, we can return <code>Array</code> in
<code>Symbol.species</code>:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PowerArray</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Array</span> {</span><br><span class="line">    <span class="title function_">isEmpty</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">length</span> === <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// build-in methods will use this as the constructor</span></span><br><span class="line">    <span class="keyword">static</span> get [<span class="title class_">Symbol</span>.<span class="property">species</span>]() {</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Array</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> arr = <span class="keyword">new</span> <span class="title class_">PowerArray</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">50</span>);</span><br><span class="line"><span class="title function_">alert</span>(arr.<span class="title function_">isEmpty</span>());		<span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> filteredArr = arr.<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> item &gt;= <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(filteredArr.<span class="title function_">isEmpty</span>());		<span class="comment">// Error: filteredArr.isEmpty is not a function</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="no-static-inheritance-in-built-ins">No static inheritance in
built-ins</h4>
<p>Normally, when one class extends another, both static and non-static
methods are inherited. But built-in classes are an exception. They don't
inherit statics from each other.</p>
<h3 id="class-checking-instanceof">9.6 Class checking: "instanceof"</h3>
<p>The <code>instanceof</code> operator allows to check whether an
object belongs to a certain class. It also takes inheritance into
account. The syntax is:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">obj <span class="keyword">instanceof</span> <span class="title class_">Class</span></span><br></pre></td></tr></tbody></table></figure>
<p>For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Rabbit</span> {}</span><br><span class="line"><span class="keyword">let</span> rabbit = <span class="keyword">new</span> <span class="title class_">Rabbit</span>();</span><br><span class="line">alert (rabbit <span class="keyword">instanceof</span> <span class="title class_">Rabbit</span>);	<span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">alert ( arr <span class="keyword">instanceof</span> <span class="title class_">Array</span> );		<span class="comment">// true</span></span><br><span class="line">alert ( arr <span class="keyword">instanceof</span> <span class="title class_">Object</span> );	<span class="comment">// true</span></span><br></pre></td></tr></tbody></table></figure>
<p>It also works with constructor functions:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Rabbit</span>(<span class="params"></span>) {}</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>( <span class="keyword">new</span> <span class="title class_">Rabbit</span>() <span class="keyword">instanceof</span> <span class="title class_">Rabbit</span>);	<span class="comment">// true</span></span><br></pre></td></tr></tbody></table></figure>
<p>The algorithm of <code>obj instanceof Class</code> works roughly as
follows:</p>
<ol type="1">
<li><p>If there's a static method <code>Symbol.hasInstance</code>, then
just call it: <code>Class[Symbol.hasInstance](obj)</code>. It should
return either <code>true</code> or <code>false</code>, and we are done.
For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> {</span><br><span class="line">    <span class="keyword">static</span> [<span class="title class_">Symbol</span>.<span class="property">hasInstance</span>](obj) {</span><br><span class="line">        <span class="keyword">if</span> (obj.<span class="property">canEat</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = {<span class="attr">canEat</span>: <span class="literal">true</span>}</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(obj <span class="keyword">instanceof</span> <span class="title class_">Animal</span>);		<span class="comment">// true: Animal[Symbol.hasInstance](obj) is called</span></span><br></pre></td></tr></tbody></table></figure></li>
<li><p>Most classes do not have <code>Symbol.hasInstance</code>. In that
case, the standard logic is used: <code>obj instanceof class</code>
check whether <code>class.prototype</code> is equal to one of the
prototypes in the <code>obj</code> prototype chain</p></li>
</ol>
<p>There is also a method <code>objA.isPrototypeOf(objB)</code>, that
returns <code>true</code> if <code>objA</code> is somewhere in the chain
of prototypes for <code>objB</code>. So the test of
<code>obj instanceof Class</code> can be rephrased as
<code>Class.prototype.isPrototypeOf(obj)</code></p>
<h4 id="symbol.tostringtag">Symbol.toStringTag</h4>
<p>The behavior of Object <code>toString</code> can be customized using
a special object property <code>Symbol.toStringTag</code>. For
instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = {</span><br><span class="line">    [<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>]: <span class="string">"User"</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">alert ( {}.<span class="property">toString</span>.<span class="title function_">call</span>(user) );		<span class="comment">// [object User]</span></span><br></pre></td></tr></tbody></table></figure>
<p>For most environment-specific objects, there is such a property. We
can use <code>{}.toString.call</code> instead of <code>instanceof</code>
for built-in objects when we want to get the type as a string rather
than just to check.</p>
<h3 id="mixins">9.7 Mixins</h3>
<p>In JS we can only inherit from a single object. There can be only one
<code>[[Prototype]]</code> for an object. And a class may extend only
one other class. But sometimes that feels limiting. There's a concept
that can help here, called "mixins". A mixin is a class containing
methods that can be used by other classes without a need to inherit from
it. In other words, a mixin provides methods that implement a certain
behavior, but we do not use it alone, we use it to add the behavior to
other classes</p>
<h4 id="a-mixin-example">A mixin example</h4>
<p>The simplest way to implement a mixin in JS is to make an object with
useful methods, so that we can easily merge them into a prototype of any
class. For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mixin</span></span><br><span class="line"><span class="keyword">let</span> sayHiMixin = {</span><br><span class="line">    <span class="title function_">sayHi</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">`Hello <span class="subst">${<span class="variable language_">this</span>.name}</span>`</span>);</span><br><span class="line">    },</span><br><span class="line">    <span class="title function_">sayBye</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">`Bye <span class="subst">${<span class="variable language_">this</span>.name}</span>`</span>);</span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">// usage</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> {</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name</span>) {</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// copy the methods</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">assign</span>(<span class="title class_">User</span>.<span class="property"><span class="keyword">prototype</span></span>, sayHiMixin);</span><br><span class="line"></span><br><span class="line"><span class="comment">// now User can say hi</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">"Dude"</span>).<span class="title function_">sayHi</span>();	<span class="comment">// Hello Dude!</span></span><br></pre></td></tr></tbody></table></figure>
<p>There is no inheritance, but a simple method copying. So
<code>User</code> may inherit from another class and also include the
mixin to "mix-in" the additional methods, like this:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Person</span> {</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">}</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">assign</span>(<span class="title class_">User</span>.<span class="property"><span class="keyword">prototype</span></span>, sayHiMixin);</span><br></pre></td></tr></tbody></table></figure>
<p>Mixins can make use of inheritance inside themselves. For
instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sayMixin = {</span><br><span class="line">    <span class="title function_">say</span>(<span class="params">phrase</span>) {</span><br><span class="line">        <span class="title function_">alert</span>(phrase);</span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sayHiMixin = {</span><br><span class="line">    <span class="attr">__proto__</span>: sayMixin, 	<span class="comment">// or we could use Object.setPrototypeOf to set the prototype here</span></span><br><span class="line">    </span><br><span class="line">    <span class="title function_">sayHi</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="variable language_">super</span>.<span class="title function_">say</span>(<span class="string">`Hello <span class="subst">${<span class="variable language_">this</span>.name}</span>`</span>);</span><br><span class="line">    },</span><br><span class="line">    <span class="title function_">sayBye</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="variable language_">super</span>.<span class="title function_">say</span>(<span class="string">`Bye <span class="subst">${<span class="variable language_">this</span>.name}</span>`</span>);</span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> {</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name</span>) {</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">assign</span>(<span class="title class_">User</span>.<span class="property"><span class="keyword">prototype</span></span>, sayHiMixin);</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">"Dude"</span>).<span class="title function_">sayHi</span>();		<span class="comment">// Hello Dude!</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="eventmixin">EventMixin</h4>
<p>Now let's make a mixin for real life. An important feature of many
browser objects is that they can generate events. Events are a great way
to "broadcast information" to anyone who wants it. So let's make a mixin
that allows us to easily add event-related functions to any
class/object.</p>
<ul>
<li>The mixin will provide a method
<code>.trigger(name, [...data])</code> to "generate an event" when
something important happens to it. The <code>name</code> argument is a
name of the event, optionally followed by additional arguments with
event data</li>
<li>Also the method <code>.on(name, handler)</code> that adds
<code>handler</code> function as the listener to events with the given
name. It will be called when an event with the given <code>name</code>
triggers, and get the arguments from the <code>.trigger</code> call</li>
<li>And the method <code>.off(name, handler)</code> that removes the
handler listener</li>
</ul>
<p>For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> eventMixin = {</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Subscribe to event, usage:</span></span><br><span class="line"><span class="comment">     *  menu.on('select', function(item) { ... })</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="title function_">on</span>(<span class="params">eventName, handler</span>) {</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">_eventHandlers</span>) <span class="variable language_">this</span>.<span class="property">_eventHandlers</span> = {};</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">_eventHandlers</span>[eventName]) {</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_eventHandlers</span>[eventName] = [];</span><br><span class="line">        }</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_eventHandlers</span>[eventName].<span class="title function_">push</span>(handler);</span><br><span class="line">    },</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Cnacel the subscription, usage:</span></span><br><span class="line"><span class="comment">     *  menu.off('select', handler)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="title function_">off</span>(<span class="params">eventName, handler</span>) {</span><br><span class="line">        <span class="keyword">let</span> handlers = <span class="variable language_">this</span>.<span class="property">_eventHandlers</span>?.[eventName];</span><br><span class="line">        <span class="keyword">if</span> (!handlers) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; handlers.<span class="property">length</span>; i++) {</span><br><span class="line">            <span class="keyword">if</span> (handlers[i] === handler) {</span><br><span class="line">                handlers.<span class="title function_">splice</span>(i--, <span class="number">1</span>);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    },</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Generate an event with the given name and data</span></span><br><span class="line"><span class="comment">     *  this.trigger('select', data1, data2);</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="title function_">trigger</span>(<span class="params">eventName, ...args</span>) {</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">_eventHandlers</span>?.[eventName]) {</span><br><span class="line">            <span class="keyword">return</span>;		<span class="comment">// no handlers for that event name</span></span><br><span class="line">        }</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_eventHandlers</span>[eventName].<span class="title function_">forEach</span>(<span class="function"><span class="params">handler</span> =&gt;</span> handler.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args));</span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li><code>.on(eventName, handler)</code>: assigns function
<code>handler</code> to run when the event with that name occurs</li>
<li><code>.off(eventName, handler)</code>: removes the function from the
handlers list</li>
<li><code>.trigger(event, ...args)</code>: generates the event: all
handlers from <code>_eventHandlers[eventName]</code> are called, with a
list of arguments <code>...args</code></li>
</ul>
<p>Usage:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Menu</span> {</span><br><span class="line">    <span class="title function_">choose</span>(<span class="params">value</span>) {</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">trigger</span>(<span class="string">"select"</span>, value);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">assign</span>(<span class="title class_">Menu</span>.<span class="property"><span class="keyword">prototype</span></span>, eventMixin);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> menu = <span class="keyword">new</span> <span class="title class_">Menu</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// add a handler, to be called on selection</span></span><br><span class="line">menu.<span class="title function_">on</span>(<span class="string">"select"</span>, <span class="function"><span class="params">value</span> =&gt;</span> <span class="title function_">alert</span>(<span class="string">`Value selected: <span class="subst">${value}</span>`</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// </span></span><br><span class="line">menu.<span class="title function_">choose</span>(<span class="string">"123"</span>);</span><br></pre></td></tr></tbody></table></figure>
<p>Now, if we'd like any code to react to a menu selection, we can
listen for it with <code>menu.on(...)</code>. And
<code>eventMixin</code> mixin makes it easy to add such behavior to as
many classes as we'd like, without interfering with the inheritance
chain.</p>
<h2 id="error-handling">Error handling</h2>
<h3 id="error-handling-try...catch">10.1 Error handling,
"try...catch"</h3>
<h4 id="the-syntax">The syntax</h4>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> {</span><br><span class="line">    <span class="comment">// code...</span></span><br><span class="line">} <span class="keyword">catch</span> (err) {</span><br><span class="line">    <span class="comment">// error handling</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li><code>try...catch</code> only works for runtime errors</li>
<li><code>try...catch</code> works synchronously
<ul>
<li>If an exception happens in "scheduled" code, like in
<code>setTimeout</code>, then <code>try...catch</code> won't catch
it</li>
</ul></li>
</ul>
<h4 id="error-object">Error object</h4>
<p>When an error occurs, JS generates an object containing the details
about it. The object is then passed as an argument to
<code>catch</code>. For all built-in errors, the error object has two
main properties:</p>
<ul>
<li><code>name</code>: Error name. For instance, for an undefined
variable that's <code>"ReferenceError"</code></li>
<li><code>message</code>: Textual message about error details</li>
</ul>
<p>There are other non-standard properties available in most
environments. One of most widely used and supported is:</p>
<ul>
<li><code>stack</code>: Current call stack</li>
</ul>
<h4 id="throwing-our-own-errors">Throwing our own errors</h4>
<p>The <code>throw</code> operator generates an error. The syntax
is:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">throw</span> <span class="language-xml"><span class="tag">&lt;<span class="name">error</span> <span class="attr">object</span>&gt;</span></span></span><br></pre></td></tr></tbody></table></figure>
<p>Technically, we can use anything as an error object. That may be even
a primitive, like a number or a string, but it's better to use objects,
preferably with <code>name</code> and <code>message</code> properties.
JS has many built-in constructors for standard errors,
<code>Error</code>, <code>SyntaxError</code>,
<code>ReferenceError</code>, <code>TypeError</code> and others. We can
use them to create error objects as well. The syntax is:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> error1 = <span class="keyword">new</span> <span class="title class_">Error</span> (message);</span><br><span class="line"><span class="keyword">let</span> error2 = <span class="keyword">new</span> <span class="title class_">SyntaxError</span> (message);</span><br><span class="line"><span class="keyword">let</span> error3 = <span class="keyword">new</span> <span class="title class_">ReferenceError</span> (message);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> error = <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">"Things happen"</span>)</span><br><span class="line">alert (error.<span class="property">name</span>);		<span class="comment">// Error</span></span><br><span class="line">alert (error.<span class="property">message</span>);	<span class="comment">// Things happen</span></span><br></pre></td></tr></tbody></table></figure>
<p>Catch should only process errors that it knows and "rethrow" all
others</p>
<h4 id="try...catch...finally">try...catch...finally</h4>
<p>If <code>finally</code> code clause exists, it runs in all cases:</p>
<ul>
<li>after <code>try</code>, if there were no errors,</li>
<li>after <code>catch</code>, if there were errors</li>
</ul>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> {</span><br><span class="line">    ... <span class="keyword">try</span> to execute the code</span><br><span class="line">} <span class="keyword">catch</span> (err) {</span><br><span class="line">    ... handle errors</span><br><span class="line">} <span class="keyword">finally</span> {</span><br><span class="line">    ... execute always</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>The <code>finally</code> clause works for any exit from
<code>try...catch</code>. That includes an explicit <code>return</code>.
For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">func</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    } <span class="keyword">catch</span>(err) {</span><br><span class="line">        <span class="comment">/*...*/</span></span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">"finally"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>( <span class="title function_">func</span>() );	<span class="comment">// first finally, and then 1</span></span><br></pre></td></tr></tbody></table></figure>
<p>The <code>try...finally</code> construct, without <code>catch</code>
clause, is also useful. We apply it when we don't want to handle errors
here, but want to be sure that processes that we started are
finalized.</p>
<h4 id="global-catch">Global catch</h4>
<p>What if we want to log the error, show something to the user, etc.
when a fatal error outside of <code>try...catch</code> occurs. There is
no solution in the specification, but environments usually provide it,
because it's really useful. For instance, Node.js has
<code>process.on("uncaughtException")</code> for that. And in the
browser we can assign a function to the special
<code>window.onerror</code> property, that will run in case of an
uncaught error. The syntax:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="property">onerror</span> = <span class="keyword">function</span>(<span class="params">message, url, line, col, error</span>) {</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li><code>message</code>: Error message</li>
<li><code>url</code>: URL of the script where error happened</li>
<li><code>line</code>, <code>col</code>: Line and column numbers where
error happened</li>
<li><code>error</code>: Error object</li>
</ul>
<p>For instance:</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	<span class="variable language_">window</span>.<span class="property">onerror</span> = <span class="keyword">function</span>(<span class="params">message, url, line, col, error</span>) {</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">alert</span>(<span class="string">`<span class="subst">${message}</span>\n At <span class="subst">${line}</span>:<span class="subst">${col}</span> of <span class="subst">${url}</span>`</span>);</span></span><br><span class="line"><span class="language-javascript">    };</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="custom-errors-extending-error">10.2 Custom errors, extending
error</h3>
<p>JS allows to use <code>throw</code> with any argument, so technically
our custom error classes don't need to inherit from <code>Error</code>
but it is a better practice to do so.</p>
<h4 id="extending-error">Extending error</h4>
<p>For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ValidationError</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Error</span> {</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">message</span>) {</span><br><span class="line">        <span class="variable language_">super</span>(message);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = <span class="string">"ValidationError"</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">readUser</span>(<span class="params">json</span>) {</span><br><span class="line">    <span class="keyword">let</span> user = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(json);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!user.<span class="property">age</span>) {</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ValidationError</span>(<span class="string">"No field: age"</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (!user.<span class="property">name</span>) {</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ValidationErro</span>(<span class="string">"No field: name"</span>);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> {</span><br><span class="line">    <span class="keyword">let</span> user = <span class="title function_">readUser</span>(<span class="string">'{"age": 25}'</span>);</span><br><span class="line">} <span class="keyword">catch</span> (err) {</span><br><span class="line">    <span class="keyword">if</span> (err <span class="keyword">instanceof</span> <span class="title class_">ValidationError</span>) {</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">"Invalid data: "</span> + err.<span class="property">message</span>);</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (err <span class="keyword">instanceof</span> <span class="title class_">SyntaxError</span>) {</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">"JSON syntax error: "</span> + err.<span class="property">message</span>);</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="keyword">throw</span> err;	<span class="comment">// unknown error, rethrow it</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>To make the custom errors shorter:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyError</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Error</span> {</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">message</span>) {</span><br><span class="line">        <span class="variable language_">super</span>(message);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = <span class="variable language_">this</span>.<span class="property">constructor</span>.<span class="property">name</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ValidationError</span> <span class="keyword">extends</span> <span class="title class_ inherited__">MyError</span> { }</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PropertyRequiredError</span> <span class="keyword">extends</span> <span class="title class_ inherited__">ValidationError</span> {</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">property</span>) {</span><br><span class="line">        <span class="variable language_">super</span>(<span class="string">"No property: "</span> + property);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">property</span> = property;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>( <span class="keyword">new</span> <span class="title class_">PropertyRequiredError</span>(<span class="string">"field"</span>).<span class="property">name</span> );</span><br></pre></td></tr></tbody></table></figure>
<h2 id="promises-asyncawait">Promises, async/await</h2>
<h3 id="introduction-callbacks">11.1 Introduction: callbacks</h3>
<p>A "callback-based" style of asynchronous programming means a function
that does something asynchronously should provide a
<code>callback</code> argument where we put the function to run after
it's complete. For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">loadScript</span>(<span class="params">src, callback</span>) {</span><br><span class="line">    <span class="keyword">let</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">'script'</span>);</span><br><span class="line">    script.<span class="property">src</span> = src;</span><br><span class="line">    script.<span class="property">onload</span> = <span class="function">() =&gt;</span> <span class="title function_">callback</span>(script);</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">head</span>.<span class="title function_">append</span>(script);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="title function_">loadScript</span>(<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/some_script.js"</span>, <span class="function"><span class="params">script</span> =&gt;</span> {</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">`Cool, the script <span class="subst">${script.src}</span> is loaded`</span>);</span><br><span class="line">    <span class="title function_">alert</span>( _ );		<span class="comment">// function declared in the loaded script</span></span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>
<h4 id="handling-errors">Handling errors</h4>
<p>An improved version of <code>loadScript</code> that tracks loading
errors:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">loadScript</span>(<span class="params">src, callback</span>) {</span><br><span class="line">    <span class="keyword">let</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">"script"</span>);</span><br><span class="line">    script.<span class="property">src</span> = src;</span><br><span class="line">    </span><br><span class="line">    script.<span class="property">onload</span> = <span class="function">() =&gt;</span> <span class="title function_">callback</span>(<span class="literal">null</span>, script);</span><br><span class="line">    script.<span class="property">onerror</span> = <span class="function">() =&gt;</span> <span class="title function_">callback</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`Script load error for <span class="subst">${src}</span>`</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">head</span>.<span class="title function_">append</span>(script);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="title function_">loadScript</span>(<span class="string">"/my/script.js"</span>, <span class="keyword">function</span>(<span class="params">error, script</span>) {</span><br><span class="line">    <span class="keyword">if</span> (error) {</span><br><span class="line">        <span class="comment">// handle error</span></span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="comment">// script loaded successfully</span></span><br><span class="line">    }</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>
<h3 id="promise">11.2 Promise</h3>
<p>The constructor syntax for a promise object is:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve, reject</span>) {</span><br><span class="line">    <span class="comment">// executor (the producing code)</span></span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>
<p>The function passed to <code>new Promise</code> is called the
executor. When <code>new Promise</code> is created, the executor runs
automatically. It contains the producing code which should eventually
produce the result. Its arguments <code>resolve</code> and
<code>reject</code> are callbacks provided by JS itself. Our code is
only inside the executor. When the executor obtains the result, be it
soon or late, doesn't matter, it should one of these callbacks:</p>
<ul>
<li><code>resolve(value)</code>: if the job is finished successfully,
with result <code>value</code></li>
<li><code>reject(error)</code>: if an error has occurred,
<code>error</code> is the error object</li>
</ul>
<p>The <code>promise</code> object returned by the
<code>new Promise</code> constructor has these internal properties:</p>
<ul>
<li><code>state</code>: initially <code>"pending"</code>, then changes
to either <code>"fulfilled"</code> when <code>resolve</code> is called
or <code>"rejected"</code> when <code>reject</code> is called</li>
<li><code>result</code>: initially <code>undefined</code>, then changes
to <code>value</code> when <code>resolve(value)</code> called or
<code>error</code> when <code>reject(error)</code> is called</li>
</ul>
<p>For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve, reject</span>) {</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">"done"</span>), <span class="number">1000</span>);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>
<p>or</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve, reject</span>) {</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">"Whoops"</span>)), <span class="number">1000</span>);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>
<p>But there can be only a single result or an error:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve, reject</span>) {</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="string">"done"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">"..."</span>));	<span class="comment">// ignored</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">"..."</span>));	<span class="comment">// ignored</span></span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>
<h4 id="consumers-then-catch-finally">Consumers: then, catch,
finally</h4>
<p>The properties <code>state</code> and <code>result</code> of the
Promise object are internal. We can't directly access them. We can use
the method <code>.then</code>/<code>.catch</code>/<code>.finally</code>
for that. A Promise object serves as a link between the executor and the
consuming functions, which will receive the result or error. Consuming
functions can be registered (substribed) using methods
<code>.then</code>, <code>.catch</code> and <code>.finally</code></p>
<h4 id="then"><code>then</code></h4>
<p>The syntax is:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">promise.<span class="title function_">then</span>(</span><br><span class="line">	<span class="keyword">function</span>(<span class="params">result</span>) { <span class="comment">/* handle a successful result */</span> },</span><br><span class="line">    <span class="keyword">function</span>(<span class="params">error</span>) { <span class="comment">/* handle an error */</span> }</span><br><span class="line">);</span><br></pre></td></tr></tbody></table></figure>
<p>The first argument of <code>.then</code> is a function that runs when
the promise is resolved, and receives the result. The second argument of
<code>.then</code> is a function that runs when the promise is rejected,
and receives the error. For example:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">promise.<span class="title function_">then</span>(</span><br><span class="line">	<span class="function"><span class="params">result</span> =&gt;</span> <span class="title function_">alert</span>(result),</span><br><span class="line">    <span class="function"><span class="params">error</span> =&gt;</span> <span class="title function_">alert</span>(error)</span><br><span class="line">);</span><br></pre></td></tr></tbody></table></figure>
<h4 id="catch"><code>catch</code></h4>
<p>If we are interested only in errors, we can use <code>null</code> as
the first argument in <code>then</code> or use <code>.catch</code>:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">promise.<span class="title function_">catch</span>(alert); <span class="comment">// shows for example "Error: Whoops!"</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="finally"><code>finally</code></h4>
<p>The call <code>.finally(f)</code> is similar to
<code>.then(f, f)</code> in the sense that <code>f</code> always runs
when the promise is settled. <code>finally</code> is a good handler for
performing cleanup, e.g. stopping our loading indicators, as they are
not needed anymore, no matter what the outcome is.</p>
<p>The differences between <code>finally(f)</code> and
<code>then(f, f)</code> are:</p>
<ol type="1">
<li>A <code>finally</code> handler has no arguments.</li>
<li>A <code>finally</code> handler passes through results and errors to
the next handler</li>
</ol>
<p>For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> {</span><br><span class="line">    <span class="comment">/* do something that takes time, and then call resolve/reject */</span> </span><br><span class="line">})</span><br><span class="line">    .<span class="title function_">finally</span>(<span class="function">() =&gt;</span> stop loading indicator)</span><br><span class="line">	.<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> show result, <span class="function"><span class="params">error</span> =&gt;</span> show error)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="promises-chaining">11.3 Promises chaining</h3>
<p>If we have a sequence of asynchronous tasks to be performed one after
another, how can we code it well? One solution is promise chaining:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve, reject</span>) {</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="number">1</span>), <span class="number">1000</span>);</span><br><span class="line">}).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">result</span>) {</span><br><span class="line">    <span class="title function_">alert</span>(result);		<span class="comment">// 1</span></span><br><span class="line">    <span class="keyword">return</span> result * <span class="number">2</span>;</span><br><span class="line">}).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">result</span>) {</span><br><span class="line">    <span class="title function_">alert</span>(result);		<span class="comment">// 2</span></span><br><span class="line">    <span class="keyword">return</span> result * <span class="number">2</span>;</span><br><span class="line">}).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">result</span>) {</span><br><span class="line">    <span class="title function_">alert</span>(result);		<span class="comment">// 4</span></span><br><span class="line">    <span class="keyword">return</span> result * <span class="number">2</span>;</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>
<p>Technically we can also add many <code>.then</code> to a single
promise. This is not chaining. It is just several handlers to one
promise. They don't pass the result to each other; instead they process
it independently</p>
<h4 id="returning-promises">Returning promises</h4>
<p>A handler, used in <code>.then(handler)</code> may create and return
a promise. In that case further handlers wait until it settles, and then
get its result. For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve, reject</span>) {</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="number">1</span>), <span class="number">1000</span>);</span><br><span class="line">}).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">result</span>){</span><br><span class="line">    <span class="title function_">alert</span>(result);		<span class="comment">// 1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> {</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(result * <span class="number">2</span>), <span class="number">1000</span>);</span><br><span class="line">    });</span><br><span class="line">}).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">result</span>){</span><br><span class="line">    <span class="title function_">alert</span>(result);		<span class="comment">// 2</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> {</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(result * <span class="number">2</span>), <span class="number">1000</span>);</span><br><span class="line">    });</span><br><span class="line">}).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">result</span>){</span><br><span class="line">    <span class="title function_">alert</span>(result);		<span class="comment">// 4</span></span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>
<h4 id="thenables">Thenables</h4>
<p>To be precise, a handler may return not exactly a promise, but a
so-called "thenable" object - an arbitrary object that ahas a method
<code>.then</code>. It will be treated the same way as a promise.</p>
<h3 id="error-handling-with-promises">11.4 Error handling with
promises</h3>
<p>Promise chains are great at error handling. When a promise rejects,
the control jumps to the closest rejection handler. That's very
convenient in practice.</p>
<h4 id="implicit-try...catch">Implicit try...catch</h4>
<p>The code of a promise executor and promise handlers has an "invisible
<code>"try...catch"</code> around it. If an exception happens, it gets
caught and treated as a rejection. This happens not only in the executor
function, but in its handlers as well. If we <code>throw</code> inside a
<code>.then</code> handler, that means a rejected promise, so the
control jumps to the nearest error handler.</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> {</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="string">"ok"</span>);</span><br><span class="line">}).<span class="title function_">then</span>(<span class="function">(<span class="params">result</span>) =&gt;</span> {</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">"Whoops!"</span>);</span><br><span class="line">}).<span class="title function_">catch</span>(alert);</span><br></pre></td></tr></tbody></table></figure>
<h4 id="rethrowing">Rethrowing</h4>
<p>If we <code>throw</code> inside <code>.catch</code>, then the control
goes to the next closest error handler. And if we handle the error and
finish normally, then it continues to the next closest successful
<code>.then</code> handler</p>
<h3 id="promise-api">11.5 Promise API</h3>
<p>There are 6 static methods in the <code>Promise</code> class</p>
<h4 id="promise.all">Promise.all</h4>
<p>Let's say we want many promises to execute in parallel and wait until
all of them are ready. That's what <code>Promise.all</code> is for.
<code>Promise.all</code> takes an array of promises (it technically can
be any iterable, but is usually an array) and returns a new promise. The
new promise resolves when all listed promises are resolved, and the
array of their results becomes its result. The syntax is:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="title class_">Promise</span>.<span class="title function_">all</span>([...promises...]);</span><br></pre></td></tr></tbody></table></figure>
<p>For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="number">1</span>), <span class="number">3000</span>)),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="number">2</span>), <span class="number">2000</span>)),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="number">3</span>), <span class="number">1000</span>))</span><br><span class="line">]).<span class="title function_">then</span>(alert);		<span class="comment">// 1,2,3 when promises are ready</span></span><br></pre></td></tr></tbody></table></figure>
<p>The order of the resulting array members is the same as in tis source
promises. If any of the promises is rejected, the promise returned by
<code>Promise.all</code> immediately rejects with that error and other
promises are ignored. <code>Promise.all(iterable)</code> allows
non-promise "regular" values in iterable.</p>
<h4 id="promise.allsettled">Promise.allSettled</h4>
<p><code>Promise.allSettled</code> just waits for all promises to
settle, regardless of the result. The resulting array has:</p>
<ul>
<li><code>{status:"fulfilled", value:result}</code> for successful
responses</li>
<li><code>{status:"rejected", reason:error}</code> for error</li>
</ul>
<p>We can use <code>Promise.allSettled</code> to get the results of all
given promises, even if some of them reject.</p>
<h4 id="promise.race">Promise.race</h4>
<p>Similar to <code>Promise.all</code>, but waits only for the first
settled promise and gets its result. The promise might be the fastest or
the one that get ran first, so it become the result. After the first
settled promise "wins the race", all further results / errors are
ignored.</p>
<h4 id="promise.any">Promise.any</h4>
<p>Similar to <code>Promise.race</code>, but waits only for the first
fulfilled promise and gets its result. If all of the given promises are
rejected, then the returned promise is rejected with
<code>AggregateError</code> - a special error object that stores all
promise errors in its <code>errors</code> property.</p>
<h4 id="promise.resolvereject">Promise.resolve/reject</h4>
<p>Methods <code>Promise.resolve</code> and <code>Promise.reject</code>
are rarely needed in modern code, because <code>async/await</code>
syntax makes them somewhat obsolete.</p>
<h5 id="promise.resolve">Promise.resolve</h5>
<p><code>Promise.resolve(value)</code> creates a resolved promise with
the result <code>value</code></p>
<h5 id="promise.reject">Promise.reject</h5>
<p><code>Promise.reject(error)</code> creates a rejected promise with
<code>error</code></p>
<h3 id="promisification">11.6 Promisification</h3>
<p>"Promisification" is the conversion of a function that accepts a
callback into a function that returns a promise. Such transformations
are often required in real-life, as many functions and libraries are
callback-based. But promises are more convenient, so it makes sense to
promisify them. For example, the following callback style function</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">loadScript</span>(<span class="params">src, callback</span>) {</span><br><span class="line">    <span class="keyword">let</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">"script"</span>);</span><br><span class="line">    script.<span class="property">src</span> = src;</span><br><span class="line">    </span><br><span class="line">    script.<span class="property">onload</span> = <span class="function">() =&gt;</span> <span class="title function_">callback</span>(<span class="literal">null</span>, script);</span><br><span class="line">    script.<span class="property">onerror</span> = <span class="function">() =&gt;</span> <span class="title function_">callback</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`Script load error for <span class="subst">${src}</span>`</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">head</span>.<span class="title function_">append</span>(script);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>After promisify it:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> loadScriptPromise = <span class="keyword">function</span>(<span class="params">src</span>) {</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> {</span><br><span class="line">        <span class="title function_">loadScript</span>(src, <span class="function">(<span class="params">err, script</span>) =&gt;</span> {</span><br><span class="line">            <span class="keyword">if</span> (err) <span class="title function_">reject</span>(err);</span><br><span class="line">            <span class="keyword">else</span> <span class="title function_">resolve</span>(script);</span><br><span class="line">        });</span><br><span class="line">    });</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<p>A more general way to promisify functions with a helper function
<code>promisift(f)</code>. It accepts a to-promisift function
<code>f</code> and returns a wrapper function</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">promisify</span>(<span class="params">f</span>) {</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">...args</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> {</span><br><span class="line">            <span class="keyword">function</span> <span class="title function_">callback</span>(<span class="params">err, result</span>) {</span><br><span class="line">                <span class="keyword">if</span> (err) {</span><br><span class="line">                    reject (err);</span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    resolve (result);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            </span><br><span class="line">            args.<span class="title function_">push</span>(callback);</span><br><span class="line">            </span><br><span class="line">            f.<span class="title function_">call</span>(<span class="variable language_">this</span>, ...args);</span><br><span class="line">        })</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// usage: </span></span><br><span class="line"><span class="keyword">let</span> loadScriptPromise = <span class="title function_">promisify</span>(loadScript);</span><br></pre></td></tr></tbody></table></figure>
<h3 id="microtasks">11.7 Microtasks</h3>
<p>Promise handlers <code>.then</code>, <code>.catch</code>,
<code>.finally</code> are always asynchronous. Even when a Promise is
immediately resolved, the code on the line below them will still execute
before these handlers.</p>
<h4 id="microtasks-queue">Microtasks queue</h4>
<p>Asynchronous tasks need proper management. For that, the ECMA
standard specifies an internal queue <code>PromiseJobs</code>, more
often referred to as the "microtask queue".</p>
<ul>
<li>The queue is first-in-first-out: tasks enqueued first are run
first</li>
<li>Execution of a task is initiated only when nothing else is
running</li>
</ul>
<p>What if the order matters for us? Just put it into the queue with
<code>.then</code></p>
<h4 id="unhandled-rejection">Unhandled rejection</h4>
<p>An "unhandled rejection" occurs when a promise error is not handled
at the end of the microtask queue. Normally, if we expect an error, we
add <code>.catch</code> to the promise chain to handle it. But if we
forget to add <code>.catch</code>, then, after the microtask queue is
empty, the engine triggers the event: </p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">"Promise Failed!"</span>));</span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">"unhandledrejection"</span>, <span class="function"><span class="params">event</span> =&gt;</span> <span class="title function_">alert</span>(event.<span class="property">reason</span>));</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>If we handle the error later, the event will still be triggered. When
the microtask queue is complete, the engine examines promises and, if
any of them is in the "rejected" state, then the event triggers.</p>
<h3 id="asyncawait">11.8 Async/await</h3>
<p>There is a special syntax to work with promises in a more comfortable
fashion, called "async/await". It's surprisingly easy to understand and
use.</p>
<h4 id="async-functions">Async functions</h4>
<p>The word "async" before a function means one simple thing: a function
always return a promise. Other values are wrapped in a resolved promise
automatically.</p>
<h4 id="await">Await</h4>
<p>The syntax: </p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> value = <span class="keyword">await</span> promise;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>The keyword <code>await</code> makes JS wait until that promise
settles and returns its result. For instance: </p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">f</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> {</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">"done"</span>), <span class="number">1000</span>)</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> result = <span class="keyword">await</span> promise;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">alert</span>(result);  <span class="comment">// done</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="title function_">f</span>();</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>The function execution "pauses" at the line with <code>await</code>
and resumes when the promise settles, with <code>result</code> becoming
its result.</p>
<p>If we try to use <code>await</code> in a non-async function, there
would be a syntax error. Thus it can't be used in top-level code. But we
can do the following: </p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">async</span> () =&gt; {</span><br><span class="line">    <span class="keyword">let</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">"/article/user.json"</span>);</span><br><span class="line">    <span class="keyword">let</span> user = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">})();</span><br></pre></td></tr></tbody></table></figure><p></p>
<p><code>await</code> also accept "thenable" objects.</p>
<h4 id="error-handling-1">Error handling</h4>
<p>If a promise resolves normally, then <code>await promise</code>
returns the result. But in the case of a rejection, it throws the error,
jsut as if there were a <code>throw</code> statement at that line.</p>
<h4 id="asyncawait-works-well-with-promise.all"><code>async/await</code>
works well with <code>Promise.all</code></h4>
<p>For instance: </p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> results = <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>([</span><br><span class="line">    <span class="title function_">fetch</span>(url1),</span><br><span class="line">    <span class="title function_">fetch</span>(url2),</span><br><span class="line">    ...</span><br><span class="line">]);</span><br></pre></td></tr></tbody></table></figure><p></p>
<h2 id="generators-advanced-iteration">Generators, advanced
iteration</h2>
<h3 id="generators">12.1 Generators</h3>
<p>Regular functions return only one, single value (or nothing).
Generators can return ("yield") multiple values, one after another,
on-demand. They work great with iterables</p>
<h4 id="generator-functions">Generator functions</h4>
<p>Its special syntax: </p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">generateSequence</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> generator = <span class="title function_">generateSequence</span>();</span><br><span class="line"><span class="title function_">alert</span>(generator);       <span class="comment">// [object Generator]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> one = generator.<span class="title function_">next</span>();</span><br><span class="line"><span class="title function_">alert</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(one));     <span class="comment">// {value: 1, done: false}</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> two = generator.<span class="title function_">next</span>();</span><br><span class="line"><span class="title function_">alert</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(two));     <span class="comment">// {value: 2, done: false}</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> three = generator.<span class="title function_">next</span>();</span><br><span class="line"><span class="title function_">alert</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(three));   <span class="comment">// {value: 3, done: true}</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> more = generator.<span class="title function_">next</span>();</span><br><span class="line"><span class="title function_">alert</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(more));    <span class="comment">// {done: true}</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="generators-are-iterable">Generators are iterable</h4>
<p>We can loop over their values using <code>for..of</code>:
</p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> generator = <span class="title function_">generateSequence</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> value <span class="keyword">of</span> generator) {</span><br><span class="line">    <span class="title function_">alert</span>(value);       <span class="comment">// 1, then 2</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="using-generators-for-iterables">Using generators for
iterables</h4>
<p>Previously, we created an iterable <code>range</code> object that
returns values <code>from..to</code>. We can use a generator function
for iteration by providing it as <code>Symbol.iterator</code>:
</p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> range = {</span><br><span class="line">    <span class="attr">from</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">to</span>: <span class="number">5</span>,</span><br><span class="line"></span><br><span class="line">    *[<span class="title class_">Symbol</span>.<span class="property">iterator</span>]() {  <span class="comment">// a shorthand for [Symbol.iterator]: function* ()</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> value = <span class="variable language_">this</span>.<span class="property">from</span>; value &lt;= <span class="variable language_">this</span>.<span class="property">to</span>; value++) {</span><br><span class="line">            <span class="keyword">yield</span> value;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>( [...range] );    <span class="comment">// 1,2,3,4,5</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="generator-composition">Generator composition</h4>
<p>Generator composition is a special feature of generators that allows
to transparently "embed" generators in each other. There is a special
<code>yield*</code> syntax to compose one generator into another. For
instance: </p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">generateSequence</span>(<span class="params">start, end</span>) {</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = start; i &lt;= end; i++) <span class="keyword">yield</span> i;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">generatePasswordCodes</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="comment">// 0..9</span></span><br><span class="line">    <span class="keyword">yield</span>* <span class="title function_">generateSequence</span>(<span class="number">48</span>, <span class="number">57</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// A..Z</span></span><br><span class="line">    <span class="keyword">yield</span>* <span class="title function_">generateSequence</span>(<span class="number">65</span>, <span class="number">90</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// a..z</span></span><br><span class="line">    <span class="keyword">yield</span>* <span class="title function_">generateSequence</span>(<span class="number">97</span>, <span class="number">122</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> str = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> code <span class="keyword">of</span> <span class="title function_">generatePasswordCodes</span>()) {</span><br><span class="line">    str += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(code);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(str);     <span class="comment">// 0..9A..Za..z</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<p>The <code>yield*</code> directive delegates the execution to another
generator. This term means that <code>yield* gen</code> iterates over
the generator <code>gen</code> and transparently forwards its yields
outside.</p>
<h4 id="yield-is-a-two-way-street"><code>yield</code> is a two-way
street</h4>
<p><code>yield</code> not only returns the result to the outside, but
also can pass the value inside the generator. To do so, we should call
<code>generator.next(arg)</code>. That argument becomes the result of
<code>yield</code>. For instace: </p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">gen</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="keyword">let</span> result = <span class="keyword">yield</span> <span class="string">"2 + 2 = ?`;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    alert(result);      // 4</span></span><br><span class="line"><span class="string">}</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">let generator = gen();</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">let question = generator.next().value;  // &lt;-- yield returns the value </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">generator.next(4);      // --&gt; pass the result into the generator</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<ol type="1">
<li>The first call <code>generator.next()</code> should be always made
without an argument (the argument is ignored is passed). It starts the
execution and returns the result of the first
<code>yield "2+2=?"</code>. At this point the generator pauses the
execution</li>
<li>Then, the result of <code>yield</code> gets into the
<code>question</code> variable in the calling code</li>
<li>On <code>generator.next(4)</code>, the generator resumes, and
<code>4</code> gets in as the result: <code>let result = 4</code></li>
</ol>
<h4 id="generator.throw">generator.throw</h4>
<p>The outer code may pass an error into the generator with the call
<code>generator.throw(err)</code>. In that case, the <code>err</code> is
thrown in the line with the <code>yield</code>.</p>
<h4 id="generator.return">generator.return</h4>
<p><code>generator.return(value)</code> finishes the generator execution
and return the given <code>value</code>: </p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">gen</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> g = <span class="title function_">gen</span>();</span><br><span class="line"></span><br><span class="line">g.<span class="title function_">next</span>();           <span class="comment">// { value: 1, done: false }</span></span><br><span class="line">g.<span class="keyword">return</span>(<span class="string">"foo"</span>);    <span class="comment">// { value: "foo", done: true }</span></span><br><span class="line">g.<span class="title function_">next</span>();           <span class="comment">// { value: undefined, done: true }</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="async-iteration-and-generators">12.2 Async iteration and
generators</h3>
<h4 id="async-iterables">Async iterables</h4>
<p>To make an object iterable asynchronously: 1. Use
<code>Symbol.asyncIterator</code> instead of
<code>Symbol.iterator</code> 2. The <code>next()</code> method should
return a promise * The <code>async</code> keyword handles it, we can
simply make <code>async next()</code> 3. To iterate over such an object,
we should use a <code>for await (let item of iterable)</code> loop</p>
<p>For instance: </p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> range = {</span><br><span class="line">    <span class="attr">from</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">to</span>: <span class="number">5</span>,</span><br><span class="line"></span><br><span class="line">    [<span class="title class_">Symbol</span>.<span class="property">asyncIterator</span>]() {</span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            <span class="attr">current</span>: <span class="variable language_">this</span>.<span class="property">from</span></span><br><span class="line">            <span class="attr">last</span>: <span class="variable language_">this</span>.<span class="property">to</span>,</span><br><span class="line"></span><br><span class="line">            <span class="keyword">async</span> <span class="title function_">next</span>(<span class="params"></span>) {</span><br><span class="line">                <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(resolve, <span class="number">1000</span>));</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">current</span> &lt;= <span class="variable language_">this</span>.<span class="property">last</span>) {</span><br><span class="line">                    <span class="keyword">return</span> { <span class="attr">done</span>: <span class="literal">false</span>, <span class="attr">value</span>: <span class="variable language_">this</span>.<span class="property">current</span>++ };</span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    <span class="keyword">return</span> { <span class="attr">done</span>: <span class="literal">true</span> };</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; {</span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">await</span> (<span class="keyword">let</span> value <span class="keyword">of</span> range) {</span><br><span class="line">        <span class="title function_">alert</span>(value);</span><br><span class="line">    }</span><br><span class="line">})()        <span class="comment">// 1,2,3,4,5</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<p>However, features that require regular, synchronous iterators, don't
work with asynchronous ones. For instance, a spread syntax won't work:
<code>alert( [...range] );</code></p>
<h4 id="async-generators">Async generators</h4>
<p>For most practical applicatioins, when we'd like to make an object
that asynchronously generates a sequence of values, we can use an
asynchronous generator.</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span>* <span class="title function_">generateSequence</span>(<span class="params">start, end</span>) {</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = start; i &lt;= end; i++) {</span><br><span class="line">        <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(resolve, <span class="number">1000</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">yield</span> i;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; {</span><br><span class="line">    <span class="keyword">let</span> generator = <span class="title function_">generateSequence</span>(<span class="number">1</span>, <span class="number">5</span>);</span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">await</span> (<span class="keyword">let</span> value <span class="keyword">of</span> generator) {</span><br><span class="line">        <span class="title function_">alert</span>(value);       <span class="comment">// 1, 2, 3, 4, 5</span></span><br><span class="line">    }</span><br><span class="line">})();</span><br></pre></td></tr></tbody></table></figure>
<h2 id="modles">Modles</h2>
<h3 id="modules-introduction">13.1 Modules, introduction</h3>
<h4 id="what-is-a-module">What is a module?</h4>
<p>A module is just a file. One script is one module. Modules can load
each other and use special directives <code>export</code> and
<code>import</code> to interchange functionality, call functions of one
module from another one. For instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// in file sayHi.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">sayHi</span>(<span class="params">user</span>) {</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">`Hello, <span class="subst">${user}</span>!`</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// in file main.js</span></span><br><span class="line"><span class="keyword">import</span> {sayHi} <span class="keyword">from</span> <span class="string">'./sayHi.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(sayHi);       <span class="comment">// function...</span></span><br><span class="line"><span class="title function_">sayHi</span>(<span class="string">"John"</span>);      <span class="comment">// Hello, John!</span></span><br></pre></td></tr></tbody></table></figure>
<p>Modules work only via HTTP(s), not locally.</p>
<h4 id="core-module-features">Core module features</h4>
<ul>
<li>Always "use strict"
<ul>
<li>Modules always work in strict mode</li>
</ul></li>
<li>Module-level scope
<ul>
<li>Each module has its own top-level scope.</li>
</ul></li>
<li>A module code is evaluated only the first time when imported
<ul>
<li>If the same module is imported into multiple other modules, its code
is executed only once, upon the first import. Then its exports are given
to all further importers.</li>
<li>Such behavior allows us to configure modules. Here's the classical
pattern
<ol type="1">
<li>A module exports some means of configuration, e.g. a configuration
object</li>
<li>On the first import we initialize it, write to its properties. The
top-level application script may do that.</li>
<li>Further imports use the module</li>
</ol></li>
</ul></li>
<li>import.meta
<ul>
<li>The object <code>import.meta</code> contains the information about
the current module. Its content depends on the environment. In the
browser, it contains the URL of the script, or a current webpage URL if
inside HTML</li>
</ul></li>
<li>In a module, "this" is undefined
<ul>
<li>In a non-module scripts, <code>this</code> is a global object</li>
</ul></li>
</ul>
<h4 id="browser-specific-features">Browser-specific features</h4>
<p>There are also several browser-specific differences of scripts with
<code>type="module"</code> compared to regular ones.</p>
<ul>
<li>Module scripts are deferred
<ul>
<li>Module scripts are always deferred, same effect as
<code>defer</code> attribute</li>
<li>Thus downloading external module scripts
<code>&lt;script type="module" src="..."&gt;</code> does not block HTML
processing</li>
<li>Module scripts wait until the HTML document is fully read, and then
run</li>
<li>Relative order of scripts is maintained: scripts that go first in
the document, execute first</li>
</ul></li>
<li>Async works on inline scripts
<ul>
<li>For non-module scripts, the <code>async</code> attribute only works
on external scripts. Async scripts run immediately when ready,
independently of other scripts or the HTML document</li>
<li>For module scripts, it works on inline scripts as well</li>
<li>For example: <figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">async</span> <span class="attr">type</span>=<span class="string">"module"</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> {counter} <span class="keyword">from</span> <span class="string">"./analytics.js"</span>;</span></span><br><span class="line"><span class="language-javascript">    counter.<span class="title function_">count</span>();</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></li>
</ul></li>
<li>External scripts that have <code>type="module"</code> are different
in two aspects:
<ol type="1">
<li>External scripts with the same <code>src</code> run only once</li>
<li>External scripts that are fetched from another origin require CORS
headers</li>
</ol></li>
<li>No "bare" modules allowed
<ul>
<li>In the browser, <code>import</code> must get either a relative or
absolute URL. Modules without any path are called "bare" modules. Such
modules are not allowed in "import"</li>
</ul></li>
<li>Old browsers do not understand <code>type="module"</code>. For them,
it's possible to provide a fallback using the <code>nomodule</code>
attribute <figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"module"</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">alert</span>(<span class="string">"Runs in modern browsers"</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">nomodule</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">alert</span>(<span class="string">"Modern browsers ignore this"</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">alert</span>(<span class="string">"Old browsers execute this."</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h3 id="export-and-import">13.2 Export and import</h3>
<p>Export and import directives have several syntax variants.</p>
<h4 id="export-before-declarations">Export before declarations</h4>
<p>We can label any declaration as exported by placing
<code>export</code> before it, be it a variable, function or a
class.</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> months = [<span class="string">'Jan'</span>, <span class="string">'Feb'</span>, <span class="string">'Mar'</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">MODUELS_BECAME_STANDARD_YEAR</span> = <span class="number">2015</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">User</span> {</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name</span>) {</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>Note that there is no semicolons after export class / function. The
<code>export</code> before a class or a function does not make it a
function expression. It's still a function declaration. Most JS style
guides don't recommend semicolons after function and class
declarations.</p>
<h4 id="export-apart-from-declarations">Export apart from
declarations</h4>
<p>We can also put <code>export</code> separately.</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sayHi</span>(<span class="params">user</span>) {</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">`Hello, <span class="subst">${user}</span>!`</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sayBye</span>(<span class="params">user</span>) {</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">`Bye, <span class="subst">${user}</span>!`</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> { sayHi, sayBye };</span><br></pre></td></tr></tbody></table></figure>
<h4 id="import">import *</h4>
<p>We can import everything as an object using
<code>import * as &lt;obj&gt;</code>:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> say <span class="keyword">from</span> <span class="string">'.say.js'</span>;</span><br><span class="line"></span><br><span class="line">say.<span class="title function_">sayHi</span>(<span class="string">"John"</span>);</span><br><span class="line">say.<span class="title function_">sayBye</span>(<span class="string">"John"</span>);</span><br></pre></td></tr></tbody></table></figure>
<h4 id="import-as">import as</h4>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { sayHi <span class="keyword">as</span> hi, sayBye <span class="keyword">as</span> bye } <span class="keyword">from</span> <span class="string">'./say.js'</span>;</span><br></pre></td></tr></tbody></table></figure>
<h4 id="export-as">export as</h4>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> { sayHi <span class="keyword">as</span> hi, sayBye <span class="keyword">as</span> bye };</span><br></pre></td></tr></tbody></table></figure>
<h4 id="export-default">Export default</h4>
<p>There are modules that declare a single entity, e.g. a module
<code>user.js</code> exports only <code>class User</code>. This approach
is preferred, so that every "thing" resides in its own module. Modules
provide a special <code>export default</code> syntax to make the "one
thing per module" way look better.</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// In user.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">User</span> {</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name</span>) {</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// In main.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">User</span> <span class="keyword">from</span> <span class="string">'./user.js'</span>;   <span class="comment">// Not {User}</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">'John'</span>);</span><br></pre></td></tr></tbody></table></figure>
<p>As there may be at most one default export per file, the exported
entity may have no name.</p>
<h4 id="the-default-name">The "default" name</h4>
<p>In some situations the <code>default</code> keyword is used to
reference the default export. For example:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sayHi</span>(<span class="params">user</span>) {</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">`Hello, <span class="subst">${user}</span>!`</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> {sayHi <span class="keyword">as</span> <span class="keyword">default</span>};</span><br></pre></td></tr></tbody></table></figure>
<p>or </p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> user <span class="keyword">from</span> <span class="string">'./user.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="title class_">User</span> = user.<span class="property">default</span>;</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">'John'</span>);</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="a-word-against-default-exports">A word against default
exports</h4>
<p>Named exports are explicit. They exactly name what they import, so we
have that information from them. For a default export, we always choose
the name when importing: </p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">User</span> <span class="keyword">from</span> <span class="string">'./user.js'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">MyUser</span> <span class="keyword">from</span> <span class="string">'./user.js'</span>;</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="re-export">Re-export</h4>
<p>"Re-export" syntax <code>export ... from ...</code> allows to import
things and immediately export them (possibly under another name), like
this:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> {sayHi} <span class="keyword">from</span> <span class="string">'./say.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> {<span class="keyword">default</span> <span class="keyword">as</span> <span class="title class_">User</span>} <span class="keyword">from</span> <span class="string">'./user.js'</span>;</span><br></pre></td></tr></tbody></table></figure>
<h4 id="re-exporting-the-default-export">Re-exporting the default
export</h4>
<p>The default export needs separate handling when re-exporting. We can
do it in two following way:</p>
<ol type="1">
<li><code>export {default as User} from './user.js'</code> will
re-export the default export</li>
<li><code>export * from './user.js'</code> will re-exports only named
exports, but ignores the default one.</li>
</ol>
<p>If we'd like to re-export both named and the default export, then two
statements are needed.</p>
<h3 id="dynamic-imports">13.3 Dynamic imports</h3>
<p>Export and import statements that we covered in previous chapters are
called "static". The syntax is very simple and strict. First, we can't
dynamically generate any parameters of <code>import</code>. Second, we
can't import conditionally or at run-time.</p>
<h4 id="the-import-expression">The import() expression</h4>
<p>The <code>import(module)</code> expression loads the module and
returns a promise that resolves into a module object that contains all
its exports. It can be called from any place in the code. For
instance:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> modulePath = <span class="title function_">prompt</span>(<span class="string">"Which module to load?"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span>(modulePath)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">obj</span> =&gt;</span> &lt;module object&gt;)</span><br><span class="line">    .catch(err =&gt; &lt;loading error, e.g. if no such module&gt;)</span><br></pre></td></tr></tbody></table></figure>
<p>or </p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> { hi, bye } = <span class="keyword">await</span> <span class="keyword">import</span>(<span class="string">'./say.js'</span>);</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>or if <code>say.js</code> has the default export: </p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = <span class="keyword">await</span> <span class="keyword">import</span>(<span class="string">'./say.js'</span>);</span><br><span class="line"><span class="keyword">let</span> say = obj.<span class="property">default</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">say</span>();</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>Dynamic imports work in regular scripts, they don't require
<code>script type="module"</code>. Although <code>import()</code> looks
like a function call, it's a special syntax that just happens to use
parentheses (similar to <code>super()</code>).</p>
<h2 id="miscullaneous">Miscullaneous</h2>
<h3 id="proxy-and-reflect">14.1 Proxy and Reflect</h3>
<p>A <code>Proxy</code> object wraps another object and intercepts
operations, like reading/writing properties and others, optionally
handling them on its own, or transparently allowing the object to handle
them. Proxies are used in many libraries and some browser
frameworks.</p>
<h4 id="proxy">Proxy</h4>
<p>The syntax: </p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> proxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(target, handler)</span><br></pre></td></tr></tbody></table></figure><p></p>
<ul>
<li><code>target</code> is an object to wrap</li>
<li><code>handler</code> is proxy configuration. An object with "traps",
methods that intercept operations, e.g. <code>get</code> trap for
reading a property, <code>set</code> trap for writign a property.</li>
</ul>
<p>For every internal method of objects, there is a Proxy trap for it:
The name of the method that we can add to the <code>handler</code>
parameter of <code>new Proxy</code> to intercept the operation</p>
<h4 id="default-value-with-get-trap">Default value with "get" trap</h4>
<p>The most common tarps are for reading/writing properties. To
intercept reading, the <code>handler</code> should have a method
<code>get(target, property, receiver)</code>. It triggers when a
property is read, with following arguments: * <code>target</code> is the
target object, the one passed as the fiorst argument to
<code>new Proxy</code> * <code>property</code> is the property name *
<code>receiver</code>: if the target property is a getter, then
<code>receiver</code> is the object that's going to be used as
<code>this</code> in its call. Usually that is the <code>proxy</code>
object itself.</p>
<p>For instance: </p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> numbers = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">numbers = <span class="keyword">new</span> <span class="title class_">Proxy</span>(numbers, {</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, prop</span>) {</span><br><span class="line">        <span class="keyword">if</span> (prop <span class="keyword">in</span> target) {</span><br><span class="line">            <span class="keyword">return</span> target[prop];</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>( numbers[<span class="number">1</span>] );    <span class="comment">// 1</span></span><br><span class="line"><span class="title function_">alert</span>( numbers[<span class="number">123</span>] );  <span class="comment">// 0 (no such item)</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="validation-with-set-trap">Validation with "set" trap</h4>
<p>The <code>set</code> trap triggers when a property is written:
<code>set（target, property, value, receiver)</code>: *
<code>target</code> is the target object, the one passed as the first
argument to <code>new Proxy</code> * <code>property</code> is the
property name * <code>value</code> is the property value *
<code>receiver</code> is similar to <code>get</code> trap, matters only
for setter properties</p>
<p>The <code>set</code> trap should return <code>true</code> if setting
is successful, and <code>false</code> otherwise (triggers
<code>TypeError</code>). For instance: </p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> numbers = [];</span><br><span class="line"></span><br><span class="line">numbers = <span class="keyword">new</span> <span class="title class_">Proxy</span>(numbers, {</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, prop, val</span>) {</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> val == <span class="string">'number'</span>) {</span><br><span class="line">            target[prop] = val;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>; </span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">numbers.<span class="title function_">push</span>(<span class="number">1</span>);</span><br><span class="line">numbers.<span class="title function_">push</span>(<span class="number">2</span>);</span><br><span class="line"><span class="title function_">alert</span>(<span class="string">"Length is: "</span> + numbers.<span class="property">length</span>);   <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">numbers.<span class="title function_">push</span>(<span class="string">"test"</span>);   <span class="comment">// TypeError</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(<span class="string">"This line is never reached (error in the line above)"</span>);</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>Note that the built-in functionality of arrays is still working.</p>
<h4 id="protected-properties-with-deleteproperty">Protected properties
with "deleteProperty"</h4>
<p>For example: </p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = {</span><br><span class="line">    <span class="attr">name</span>: <span class="string">"John"</span>, </span><br><span class="line">    <span class="attr">_password</span>: <span class="string">"secret"</span>,</span><br><span class="line"></span><br><span class="line">    <span class="title function_">checkPassword</span>(<span class="params">value</span>) {</span><br><span class="line">        <span class="keyword">return</span> value === <span class="variable language_">this</span>.<span class="property">_password</span>;</span><br><span class="line">    }</span><br><span class="line">}; </span><br><span class="line"></span><br><span class="line">user = <span class="keyword">new</span> <span class="title class_">Proxy</span>(user, {</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, prop</span>) {</span><br><span class="line">        <span class="keyword">if</span> (prop.<span class="title function_">startsWith</span>(<span class="string">'_'</span>)) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">"Access denied"</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">let</span> value = target[prop];</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">typeof</span> value === <span class="string">'function'</span>) ? value.<span class="title function_">bind</span>(target) : value;</span><br><span class="line">    },</span><br><span class="line"></span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, prop, val</span>) {</span><br><span class="line">        <span class="keyword">if</span> (prop.<span class="title function_">startsWith</span>(<span class="string">'_'</span>)) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">"Access denied"</span>);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            target[prop] = val;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        }</span><br><span class="line">    },</span><br><span class="line"></span><br><span class="line">    <span class="title function_">deleteProperty</span>(<span class="params">target, prop</span>) {</span><br><span class="line">        <span class="keyword">if</span> (prop.<span class="title function_">startsWith</span>(<span class="string">'_'</span>)) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">"Access denied"</span>);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="keyword">delete</span> target[prop];</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        }</span><br><span class="line">    },</span><br><span class="line"></span><br><span class="line">    <span class="title function_">ownKeys</span>(<span class="params">target</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">keys</span>(target).<span class="title function_">filter</span>(<span class="function"><span class="params">key</span> =&gt;</span> !key.<span class="title function_">startsWith</span>(<span class="string">'_'</span>));</span><br><span class="line">    },</span><br><span class="line"></span><br><span class="line">    <span class="title function_">getOwnPropertyDescriptor</span>(<span class="params">target, prop</span>) {    <span class="comment">// called for every property</span></span><br><span class="line">        <span class="keyword">return</span> {</span><br><span class="line">            <span class="attr">enumerable</span>: !prop.<span class="title function_">startsWith</span>(<span class="string">'_'</span>),</span><br><span class="line">            <span class="attr">configurable</span>: !prop.<span class="title function_">startsWith</span>(<span class="string">'_'</span>)</span><br><span class="line">            <span class="comment">/* ...other flags, probable "value:..." */</span></span><br><span class="line">        };</span><br><span class="line">    }</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>A call to <code>user.checkPassword()</code> gets proxied
<code>user</code> as <code>this</code> (the object before dot becomes
<code>this</code>), so when it tries to access
<code>this._passsword</code>, the <code>get</code> trap activates (it
triggers on any property read) and throws an error. So we bind the
context of object methods to the original object, <code>target</code>.
Then their future calls will use <code>target</code> as
<code>this</code>, without any trap. That solution usually works, but
isn't ideal. So, such a proxy shouldn't be used everywhere.</p>
<h4 id="in-range-with-has-trap">"In range" with "has" trap</h4>
<p>We have a range object: </p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> range = {</span><br><span class="line">    <span class="attr">start</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">end</span>: <span class="number">10</span></span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>We'd like to use the <code>in</code> operator to check that a number
is in <code>range</code>. The <code>has</code> trap intercepts
<code>in</code> calls: <code>has(target, property)</code> *
<code>target</code> is the target object, passed as the first argument
to <code>new Proxy</code> * <code>property</code> is the property
name</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">range = <span class="keyword">new</span> <span class="title class_">Proxy</span>(range, {</span><br><span class="line">    <span class="title function_">has</span>(<span class="params">target, prop</span>) {</span><br><span class="line">        <span class="keyword">return</span> prop &gt;= target.<span class="property">start</span> &amp;&amp; prop &lt;= target.<span class="property">end</span>;</span><br><span class="line">    }</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(<span class="number">5</span> <span class="keyword">in</span> range);      <span class="comment">// true</span></span><br><span class="line"><span class="title function_">alert</span>(<span class="number">50</span> <span class="keyword">in</span> range);     <span class="comment">// false</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="wrapping-functions-apply">Wrapping functions: "apply"</h4>
<p>We can wrap a proxy around a function as well. The
<code>apply(target, thisArg, args)</code> trap handles calling a proxy
as function. For instance: </p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">delay</span>(<span class="params">f, ms</span>) {</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Proxy</span>(f, {</span><br><span class="line">        <span class="title function_">apply</span>(<span class="params">target, thisArg, args</span>) {</span><br><span class="line">            <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> target.<span class="title function_">apply</span>(thisArg, args), ms);</span><br><span class="line">        }</span><br><span class="line">    });</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="reflect">Reflect</h4>
<p><code>Reflect</code> is a built-in object that simplifies creation of
<code>Proxy</code>. The internal methods, such as <code>[[Get]]</code>,
<code>[[Set]]</code> and others are specification-only, they can't be
called directly. The <code>Reflect</code> object makes that somewhat
possible. Its methods are minimal wrappers around the internal
methods.</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = {};</span><br><span class="line"></span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">set</span>(user, <span class="string">"name"</span>, <span class="string">"John"</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(user.<span class="property">name</span>);   <span class="comment">// John</span></span><br></pre></td></tr></tbody></table></figure>
<p>For every internal method, trappable by <code>Proxy</code>, there is
a corresponding method in <code>Reflect</code>, with the same name and
arguments as the <code>Proxy</code> trap. </p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = {</span><br><span class="line">    <span class="attr">name</span>: <span class="string">"John"</span>, </span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">user = <span class="keyword">new</span> <span class="title class_">Proxy</span>(user, {</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, prop, receiver</span>) {</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">`GET <span class="subst">${prop}</span>`</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target, prop, receiver);</span><br><span class="line">    },</span><br><span class="line"></span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, prop, val, receiver</span>) {</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">`SET <span class="subst">${prop}</span>=<span class="subst">${val}</span>`</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">set</span>(target, prop, val, receiver);</span><br><span class="line">    }</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> name = user.<span class="property">name</span>;   <span class="comment">// shows "GET name"</span></span><br><span class="line">user.<span class="property">name</span> = <span class="string">"Pete"</span>;     <span class="comment">// shows "SET name=Pete"</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<p>If a trap wants to forward the call to the object, it's enough to
call <code>Reflect.&lt;method&gt;</code> with the same arguments.</p>
<h4 id="proxy-limitations">Proxy limitations</h4>
<ul>
<li>Many built-in objects, for example Map, Set, Date, Promise and
others make use of so-called "internal slots". These are like
properties, but reserved for internal, specification-only purpose.
<code>Proxy</code> can't intercept that. To get around it:
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> proxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(map, {</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, prop, receiver</span>) {</span><br><span class="line">        <span class="keyword">let</span> value = <span class="title class_">Reflect</span>.<span class="title function_">get</span>(...<span class="variable language_">arguments</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">typeof</span> value == <span class="string">"function"</span> ? value.<span class="title function_">bind</span>(target) : value;</span><br><span class="line">    }</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">proxy.<span class="title function_">set</span>(<span class="string">"test"</span>, <span class="number">1</span>);</span><br><span class="line"><span class="title function_">alert</span>(proxy.<span class="title function_">get</span>(<span class="string">"test"</span>));</span><br></pre></td></tr></tbody></table></figure></li>
<li>A similar thing happens with private class fields. The reason is
that private fields are implemented using internal slots. JS does not
use <code>[[Get]]/[[Set]]</code> when accessing them.</li>
</ul>
<h4 id="revocable-proxies">Revocable proxies</h4>
<p>A revocable proxy is a proxy that can be disabled. Such a proxy will
forward operations to object, and we can disable it at any moment. For
instance: </p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> revokes = <span class="keyword">new</span> <span class="title class_">WeakMap</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> object = {</span><br><span class="line">    <span class="attr">data</span>: <span class="string">"Valuable data"</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> {proxy, revoke} = <span class="title class_">Proxy</span>.<span class="title function_">revocable</span>(object, {});</span><br><span class="line"></span><br><span class="line">revokes.<span class="title function_">set</span>(proxy, revoke);</span><br><span class="line"></span><br><span class="line">revoke = revokes.<span class="title function_">get</span>(proxy);</span><br><span class="line"><span class="title function_">revoke</span>();</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(proxy.<span class="property">data</span>);  <span class="comment">// Error (revoked)</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<p>We use <code>WeakMap</code> instead of <code>Map</code> here because
it won't block garbage collection.</p>
<h3 id="eval-run-a-code-string">14.2 Eval: run a code string</h3>
<p>The built-in <code>eval</code> function allows to execute a string of
code. The syntax is: </p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> result = <span class="built_in">eval</span>(code);</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>The eval'ed code is executed in the current lexical environment, so
it can see outer variables. It can change outer variables as well. In
strict mode, <code>eval</code> has its own lexical environment. So
functions and variables, declared inside eval, are no visible
outside.</p>
<p>In modern programming <code>eval</code> is used very sparingly. A
better way to use <code>eval</code>:</p>
<ul>
<li>If eval'ed code doesn't use outer variables, please call
<code>eval</code> as <code>window.eval(...)</code></li>
<li>If eavl'ed code needs local variables, change <code>eval</code> to
<code>new Function</code> and pass them as arguments.
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> f = <span class="keyword">new</span> <span class="title class_">Function</span>(<span class="string">'a'</span>, <span class="string">'alert(a)'</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">f</span>(<span class="number">5</span>);</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h3 id="currying">14.3 Currying</h3>
<p>Currying is a transformation of functions that translates a function
from callable as <code>f(a, b, c)</code> into callable as
<code>f(a)(b)(c)</code>. Currying doesn't call a function. It just
transforms it.</p>
<p>Advanced implementations of currying, such as <code>_.curry</code>
from lodash library, return a wrapper that allows a function to be
called both normally and partially. </p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">a, b</span>) {</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> curriedSum = _.<span class="title function_">curry</span>(sum);</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>( <span class="title function_">curriedSum</span>(<span class="number">1</span>, <span class="number">2</span>) );      <span class="comment">// 3</span></span><br><span class="line"><span class="title function_">alert</span>( <span class="title function_">curriedSum</span>(<span class="number">1</span>)(<span class="number">2</span>) );      <span class="comment">// 3</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="what-for">What for?</h4>
<p>For instance, we have the logging function
<code>log(date, importance, message)</code> that formats and outputs the
information: </p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">log</span>(<span class="params">date, importance, message</span>) {</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">`[<span class="subst">${date.getHours()}</span>:<span class="subst">${date.getMinutes()}</span>] [<span class="subst">${importance}</span>] <span class="subst">${message}</span>`</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">log = _.<span class="title function_">curry</span>(log);</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>Then we can create convenience functions for current logs:
</p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> logNow = <span class="title function_">log</span>(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> debugNow = <span class="title function_">logNow</span>(<span class="string">"DEBUG"</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">debugNow</span>(<span class="string">"message"</span>);</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="advanced-curry-implementation">Advanced curry
implementation</h4>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">curry</span>(<span class="params">func</span>) {</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">curried</span>(<span class="params">...args</span>) {</span><br><span class="line">        <span class="keyword">if</span> (args.<span class="property">length</span> &gt;= func.<span class="property">length</span>) {</span><br><span class="line">            <span class="keyword">return</span> func.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">...args2</span>) {</span><br><span class="line">                <span class="keyword">return</span> curried.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args.<span class="title function_">concat</span>(args2));</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="reference-type">14.4 Reference type</h3>
<h4 id="reference-type-explained">Reference type explained</h4>
<p>Looking closely, we may notice two operations in
<code>obj.method</code> statement: 1. First, the dot <code>.</code>
retrieves the property <code>obj.method()</code>. 2. Then parenthese
<code>()</code> execute it.</p>
<p>The <code>.</code> returns not a function, but a value of the special
Reference Type. The Reference Type is a "specification type". We can't
explicitly use it, but it is used internally by the language. The value
of Reference Type is a three-value combination
<code>(base, name, strict)</code>, where: * <code>base</code> is the
object * <code>name</code> is the property name * <code>strict</code> is
true if <code>use strict</code> is in effect</p>
<p>When parentheses <code>()</code> are called on the Reference Type,
they receive the full information about the object and its method, and
can set the right <code>this</code>. Reference type is a special
"intermediary" internal type, with the purpose to pass information from
dot <code>.</code> to calling parentheses <code>()</code>.</p>
<p>Any other operation like assignment <code>fun = obj.method</code>
discards the reference type as a whole, takes the value of
<code>obj.method</code> and passes it on. So any further operation
"loses" <code>this</code>.</p>
<h3 id="bigint">14.5 BigInt</h3>
<p><code>BigInt</code> is a special numberic tpye that provides support
for integers of arbitrary length. A bigint is created by appending
<code>n</code> to the end of an integer literal or by calling the
function <code>BigInt</code> that creates bigints from strings, numbers
etc.</p>
<p>For instance: </p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bigint = <span class="number">12345678901234567890234567890n</span>;</span><br><span class="line"><span class="keyword">const</span> sameBigint = <span class="title class_">BigInt</span>(<span class="string">"123456789012345678901234567890"</span>);</span><br><span class="line"><span class="keyword">const</span> bigintFromNumber = <span class="title class_">BigInt</span>(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(<span class="number">1n</span> + <span class="number">2n</span>);     <span class="comment">// 3</span></span><br><span class="line"><span class="title function_">alert</span>(<span class="number">5n</span> / <span class="number">2n</span>);     <span class="comment">// 2</span></span><br><span class="line"><span class="title function_">alert</span>(<span class="number">1n</span> + <span class="number">2</span>);      <span class="comment">// Error: Cannot mix BigInt and other types</span></span><br><span class="line"><span class="title function_">alert</span>( +bigint );   <span class="comment">// Error: the unary plus is not supported on bigints</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(<span class="number">2n</span> &gt; <span class="number">1n</span>);     <span class="comment">// true</span></span><br><span class="line"><span class="title function_">alert</span>(<span class="number">2n</span> &gt; <span class="number">1</span>);      <span class="comment">// true</span></span><br><span class="line"><span class="title function_">alert</span>(<span class="number">1</span> == <span class="number">1n</span>);     <span class="comment">// true</span></span><br><span class="line"><span class="title function_">alert</span>(<span class="number">1</span> === <span class="number">1n</span>);    <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="number">0n</span>) {</span><br><span class="line">    <span class="comment">// never executes</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="polyfills-1">Polyfills</h4>
<p>Polyfilling bigints is tricky. It is cumbersome and would cost a lot
of performance. The other way around is proposed by the developers of
JSBI library. This library implements big numbers uing its own methods.
We can use them instead of native bigints. For example:
</p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="variable constant_">JSBI</span>.<span class="title class_">BigInt</span>(<span class="number">789</span>);</span><br><span class="line">b = <span class="variable constant_">JSBI</span>.<span class="title class_">BigInt</span>(<span class="number">456</span>);</span><br><span class="line">c = <span class="variable constant_">JSBI</span>.<span class="title function_">add</span>(a, b);</span><br><span class="line">d = <span class="variable constant_">JSBI</span>.<span class="title function_">subtract</span>(a, b);</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>Then the polyfill plygin will convert JSBI calls to native bigints
for those browsers that support them.</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="followme">
  <span>Welcome to my other publishing channels</span>

  <div class="social-list">

      <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/Programming/" rel="tag"># Programming</a>
              <a href="/tags/JavaScript/" rel="tag"># JavaScript</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/modern_computer_graphics_note/" rel="prev" title="Modern Computer Graphics Course Note">
                  <i class="fa fa-angle-left"></i> Modern Computer Graphics Course Note
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/amortized-analysis/" rel="next" title="An Brief Introduction to Amortized Analysis">
                  An Brief Introduction to Amortized Analysis <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    © 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-fish"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Yue Jiao</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="Word count total">687k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">10:24</span>
  </span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener external nofollow noreferrer" target="_blank">Hexo</a> &amp; <a href="https://theme-next.js.org/" rel="noopener external nofollow noreferrer" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>








  




  

  






<script src="/bundle.js"></script><script>true;
{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script></body></html>